{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl940.cbl",
  "fileName": "sl940.cbl",
  "timestamp": "2025-09-15T16:25:31.523Z",
  "programId": "sl940",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 119
      },
      {
        "name": "file",
        "line": 132
      },
      {
        "name": "working-storage",
        "line": 140
      },
      {
        "name": "linkage",
        "line": 253
      },
      {
        "name": "init01",
        "line": 268
      },
      {
        "name": "Delete-Details",
        "line": 331
      },
      {
        "name": "Read-Details",
        "line": 347
      },
      {
        "name": "Update-Stock-n-Audit",
        "line": 366
      },
      {
        "name": "exit",
        "line": 520
      },
      {
        "name": "Eval-Status",
        "line": 522
      },
      {
        "name": "Program-Start",
        "line": 532
      },
      {
        "name": "invoice-details",
        "line": 559
      },
      {
        "name": "zz060-Convert-Date",
        "line": 681
      },
      {
        "name": "exit",
        "line": 718
      },
      {
        "name": "zz070-Convert-Date",
        "line": 720
      },
      {
        "name": "exit",
        "line": 748
      },
      {
        "name": "maps04",
        "line": 750
      },
      {
        "name": "exit",
        "line": 756
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 122
      },
      {
        "name": "file-defs",
        "line": 265
      },
      {
        "name": "done-open",
        "line": 291
      },
      {
        "name": "data-input",
        "line": 302
      },
      {
        "name": "main-exit",
        "line": 314
      },
      {
        "name": "end-perform",
        "line": 342
      },
      {
        "name": "end-perform",
        "line": 361
      },
      {
        "name": "WS-Temp-Stock-Key",
        "line": 394
      },
      {
        "name": "end-if",
        "line": 517
      },
      {
        "name": "Update-Stock-Exit",
        "line": 519
      },
      {
        "name": "menu-return",
        "line": 548
      },
      {
        "name": "invoice-enter",
        "line": 572
      },
      {
        "name": "customer-setup",
        "line": 620
      },
      {
        "name": "customer-display",
        "line": 625
      },
      {
        "name": "zz060-Exit",
        "line": 717
      },
      {
        "name": "zz070-Exit",
        "line": 747
      },
      {
        "name": "maps04-exit",
        "line": 755
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 536,
        "type": "DYNAMIC",
        "using": [
          "File-16",
          "*>",
          "Invoice",
          "File-Info",
          "end-call",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "SL196",
          "at",
          "2301",
          "display",
          "SL003",
          "at",
          "2401",
          "accept",
          "ws-reply",
          "at",
          "2440",
          "exit",
          "program",
          "end-if",
          "*>",
          "move",
          "to-day",
          "to",
          "u-date"
        ]
      },
      {
        "target": "maps04",
        "line": 753,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 109,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 118,
        "replacing": null
      },
      {
        "name": "selinv",
        "line": 125,
        "replacing": null
      },
      {
        "name": "selsl",
        "line": 126,
        "replacing": null
      },
      {
        "name": "seldel",
        "line": 127,
        "replacing": null
      },
      {
        "name": "seldnos",
        "line": 128,
        "replacing": null
      },
      {
        "name": "fdinv",
        "line": 135,
        "replacing": null
      },
      {
        "name": "fdsl",
        "line": 136,
        "replacing": null
      },
      {
        "name": "fddel",
        "line": 137,
        "replacing": null
      },
      {
        "name": "fddnos",
        "line": 138,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 144,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 145,
        "replacing": null
      },
      {
        "name": "slwsinv",
        "line": 146,
        "replacing": null
      },
      {
        "name": "slwsinv2",
        "line": 147,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 150,
        "replacing": null
      },
      {
        "name": "wsdel",
        "line": 151,
        "replacing": null
      },
      {
        "name": "wsdnos",
        "line": 152,
        "replacing": null
      },
      {
        "name": "wsaudit",
        "line": 153,
        "replacing": null
      },
      {
        "name": "wsstock",
        "line": 154,
        "replacing": null
      },
      {
        "name": "wsanal",
        "line": 155,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 237,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 256,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 257,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 258,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 526,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 758,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "program-start",
        "thru": null,
        "line": 281
      },
      {
        "target": "Invoice-Open",
        "thru": null,
        "line": 282
      },
      {
        "target": "Sales-Open-Input",
        "thru": null,
        "line": 283
      },
      {
        "target": "Delivery-Open-Input",
        "thru": null,
        "line": 284
      },
      {
        "target": "DelInvNos-Open",
        "thru": null,
        "line": 285
      },
      {
        "target": "Stock-Open",
        "thru": null,
        "line": 287
      },
      {
        "target": "Stock-Audit-Open",
        "thru": null,
        "line": 288
      },
      {
        "target": "Analysis-Open",
        "thru": null,
        "line": 289
      },
      {
        "target": "invoice-details",
        "thru": null,
        "line": 294
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 317
      },
      {
        "target": "Delivery-Close",
        "thru": null,
        "line": 318
      },
      {
        "target": "DelInvNos-Close",
        "thru": null,
        "line": 319
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 320
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 322
      },
      {
        "target": "Stock-Audit-Close",
        "thru": null,
        "line": 323
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 324
      },
      {
        "target": "sih-lines",
        "thru": null,
        "line": 337
      },
      {
        "target": "Invoice-Delete",
        "thru": null,
        "line": 341
      },
      {
        "target": "sih-lines",
        "thru": null,
        "line": 354
      },
      {
        "target": "Invoice-Read-Next",
        "thru": null,
        "line": 358
      },
      {
        "target": "Update-Stock-n-Audit",
        "thru": null,
        "line": 360
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 412
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 420
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 431
      },
      {
        "target": "Stock-Rewrite",
        "thru": null,
        "line": 487
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 495
      },
      {
        "target": "Stock-Audit-Write",
        "thru": null,
        "line": 508
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 510
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 553
      },
      {
        "target": "Invoice-Read-Indexed",
        "thru": null,
        "line": 586
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 597
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 603
      },
      {
        "target": "Delivery-Read-Indexed",
        "thru": null,
        "line": 612
      },
      {
        "target": "Read-Details",
        "thru": null,
        "line": 663
      },
      {
        "target": "Invoice-Delete-All",
        "thru": null,
        "line": 665
      },
      {
        "target": "Invoice-Delete",
        "thru": null,
        "line": 667
      },
      {
        "target": "Delete-Details",
        "thru": null,
        "line": 668
      },
      {
        "target": "DelInvNos-Write",
        "thru": null,
        "line": 676
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 690
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines",
        "line": 272
      },
      {
        "from": "spaces",
        "to": "escape-code",
        "line": 292
      },
      {
        "from": "1",
        "to": "cole",
        "line": 299
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 307
      },
      {
        "from": "zero",
        "to": "j",
        "line": 336
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos\n              move   j to item-nos\n              perform Invoice-Delete     *> delete invoice-file\n     end-perform",
        "line": 339
      },
      {
        "from": "zero",
        "to": "j",
        "line": 353
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos\n              move     j to item-nos\n              perform  Invoice-Read-Next\n              move     WS-Invoice-Record to Invoice-Lines (j)\n              perform  Update-Stock-n-Audit\n     end-perform",
        "line": 356
      },
      {
        "from": "3",
        "to": "Audit-Type",
        "line": 390
      },
      {
        "from": "Sih-Invoice",
        "to": "Audit-Invoice-PO",
        "line": 391
      },
      {
        "from": "ws-Date",
        "to": "Audit-Process-Date",
        "line": 392
      },
      {
        "from": "zero",
        "to": "Audit-Unit-Cost",
        "line": 397
      },
      {
        "from": "5",
        "to": "Audit-Type\n              move zero     to Audit-Reverse-Transaction   *> was 1\n              move Sih-cr   to Audit-Cr-for-Invoice\n     else\n              move 1        to Audit-Reverse-Transaction   *> was zero\n     end-if\n     move     Stk-Audit-No  to Audit-No",
        "line": 399
      },
      {
        "from": "ws-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              perform Stock-Read-Indexed      *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n              if   FS-Reply = 21 or 23\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if                           *> end-read\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move  1 to File-Key-No\n              perform Stock-Read-Indexed    *> read Stock-File key WS-Stock-Key invalid key\n              if   FS-Reply = 21 or 23\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if                                *> end-read\n     end-if\n*>\n*> As stock items are checked this should not happen\n*>     but it is a multi user system\n*>\n     if       fs-reply not = zero\n              perform Eval-Status\n              display SL194           at line ws-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply        at line ws-23-lines col 26 with foreground-color 3\n              display exception-msg   at line ws-23-lines col 29 with foreground-color 3\n              display WS-Stock-Key       at 2064 with foreground-color 3\n              display sl006           at line ws-lines col 01 with foreground-color 3\n              accept  ws-reply        at line ws-lines col 45\n              display \" \"             at line ws-23-lines col 1 with erase eos\n     end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it\n*>          show up in proof reports (sil-type same as sih-type so use later - less ram)\n*>\n     if       WS-Stock-Key not = spaces         *> we have a stock rec",
        "line": 410
      },
      {
        "from": "zero",
        "to": "Stock-Held\n              end-if\n              if       Stock-Held > zero\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) invoices but reversed",
        "line": 460
      },
      {
        "from": "1",
        "to": "File-Key-No\n              perform  Stock-Rewrite      *> rewrite  WS-Stock-Record invalid key\n              if       FS-Reply = 21 or 23\n                       display SL191    at line ws-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply at line ws-23-lines col 38 with foreground-color 2 highlight\n                       display SL006    at line ws-lines col 1\n                       accept ws-reply  at line ws-lines col 45\n              end-if                         *> end-rewrite\n              if       fs-reply not = zero\n                       perform Eval-Status\n                       display SL197         at line ws-23-lines col 1 with erase eol foreground-color 4\n                       display fs-reply      at line ws-23-lines col 22 with foreground-color 3\n                       display exception-msg at line ws-23-lines col 25 with foreground-color 3\n                       display WS-Stock-Key  at 2064 with foreground-color 3\n                       display sl006         at line ws-lines col 01 with foreground-color 3\n                       accept  ws-reply      at line ws-lines col 30\n                       display \" \"           at line ws-23-lines col 1 with erase eos\n              end-if\n     end-if\n*>\n     if       Stk-Audit-Used = 1\n              move zero to Stk-Activity-Rep-Run    *> Need to run audit report\n              perform  Stock-Audit-Write           *> write Stock-Audit-Record\n              if       fs-reply not = zero\n                       perform Eval-Status\n                       display SL190         at line ws-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply      at line ws-23-lines col 38 with foreground-color 2 highlight\n                       display exception-msg at line ws-23-lines col 41 with foreground-color 3\n                       display SL006         at line ws-lines col 1\n                       accept ws-reply       at line ws-lines col 45\n              end-if\n     end-if",
        "line": 486
      },
      {
        "from": "spaces",
        "to": "exception-msg",
        "line": 525
      },
      {
        "from": "to-day",
        "to": "u-date",
        "line": 546
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to  main-exit",
        "line": 578
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos",
        "line": 581
      },
      {
        "from": "zero",
        "to": "item-nos",
        "line": 582
      },
      {
        "from": "WS-Invoice-Record",
        "to": "sinvoice-header",
        "line": 591
      },
      {
        "from": "sih-date",
        "to": "u-bin",
        "line": 596
      },
      {
        "from": "1",
        "to": "c-check",
        "line": 600
      },
      {
        "from": "sih-customer",
        "to": "WS-Sales-Key",
        "line": 601
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 602
      },
      {
        "from": "zero",
        "to": "c-check",
        "line": 605
      },
      {
        "from": "\"D\"",
        "to": "WS-Deliv-Key-Type",
        "line": 610
      },
      {
        "from": "WS-Sales-Key",
        "to": "WS-Deliv-Sales-Key",
        "line": 611
      },
      {
        "from": "zero",
        "to": "delivery-tag\n              go to  customer-setup",
        "line": 614
      },
      {
        "from": "deliv-address",
        "to": "address-a",
        "line": 617
      },
      {
        "from": "sales-address",
        "to": "address-a",
        "line": 623
      },
      {
        "from": "1",
        "to": "a",
        "line": 633
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 637
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 641
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 645
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 649
      },
      {
        "from": "\"N\"",
        "to": "ws-reply",
        "line": 655
      },
      {
        "from": "sih-invoice",
        "to": "WS-Del-Inv-Nos",
        "line": 672
      },
      {
        "from": "sih-date",
        "to": "del-inv-dat",
        "line": 673
      },
      {
        "from": "sih-customer",
        "to": "del-inv-cus",
        "line": 674
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 692
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 694
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n              move 1 to Date-Form",
        "line": 697
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n              go to zz060-Exit",
        "line": 700
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              move WS-Month to WS-Inv-Month\n              go to zz060-Exit",
        "line": 703
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 711
      },
      {
        "from": "WS-Intl-Month",
        "to": "WS-Inv-Month\n     move     u-date (1:2) to ws-Intl-Days",
        "line": 714
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 728
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 731
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 735
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 742
      }
    ],
    "computes": [
      {
        "target": "Audit-Stock-Value-Change",
        "expression": "Audit-Transaction-Qty\n                                    * Stock-Cost * -1\n                       subtract Audit-Transaction-Qty from Stock-Held\n              else\n               if      Sih-Type = 1 or = 2      *> Was = 3\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost\n                       add Audit-Transaction-Qty to Stock-Held\n               end-if\n              end-if\n*>\n              if       Stock-Held < zero\n                       multiply -1 by Stock-Held\n                       add Stock-Held to Stock-Pre-Sales\n                       move zero to Stock-Held\n              end-if\n              if       Stock-Held > zero\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) invoices but reversed",
        "line": 446
      }
    ]
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n*> copy \"selinv.cob\".\n*> copy \"selsl.cob\".\n*> copy \"seldel.cob\".\n*> copy \"seldnos.cob\".\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdinv.cob\".\n*> copy \"fdsl.cob\".\n*> copy \"fddel.cob\".\n*> copy \"fddnos.cob\".\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"SL940 (3.02.11)\".\n 77  Exception-Msg       pic x(25) value spaces.\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n copy \"slwsinv.cob\" replacing Invoice-Line by Invoice-Lines. *> this is header and 40 lines table\n copy \"slwsinv2.cob\".\n 01  WS-Invoice-Record  redefines Invoice-Record\n                                pic x(137).\n copy \"wssl.cob\".\n copy \"wsdel.cob\".\n copy \"wsdnos\".\n copy \"wsaudit.cob\".\n copy \"wsstock.cob\".     *> 3.02\n copy \"wsanal.cob\".   *> 17/12/24  missed\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n*>     03  WS-Stock-Audit-Record  pic x.\n*>     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n*>     03  WS-Delivery-Record     pic x.\n*>     03  WS-Analysis-Record     pic x.\n*>     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n*>     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  ws-data.\n     03  menu-reply      pic 9.\n     03  ws-reply        pic x.\n     03  a               pic 99.\n     03  c-check         pic 9.\n         88  c-exists                    value 1.\n     03  address-A       pic x(96).\n     03  address-line    pic x(36).\n     03  i               pic 99.\n     03  j               pic 99.\n     03  k               pic 99.\n     03  escape-code     pic x.\n     03  WS-Inv-Month.\n         05  WS-Inv-Mth  pic 99.\n             88 WS-Valid-Mth   values 01 thru 12.\n     03  WS-Temp-Stock-Key                    value spaces.\n         05  ws-Abrev-Stock   pic x(7).\n         05  ws-Stock-No-Long pic x(6).\n     03  ws-env-lines    pic 999         value zero.\n     03  ws-lines        binary-char unsigned value zero.\n     03  ws-23-lines     binary-char unsigned value zero.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n01  Error-Messages.\n*> System Wide\n     03  SL003          pic x(28) value \"SL003 Hit Return To Continue\".\n     03  SL006          pic x(43) value \"SL006 Note Details & Hit Return to continue\".\n*> Module specific\n     03  SL190          pic x(35) value \"SL190 Error on Writing Audit record\".\n     03  SL191          pic x(33) value \"SL191 Error on Stock rec. Rewrite\".\n     03  SL194          pic x(24) value \"SL194 Invoice Not Found\".\n     03  SL195          pic x(52) value \"SL195 Invoice Details Already Passed To Sales Ledger\".\n     03  SL196          pic x(37) value \"SL196 Invoice File does Not yet Exist\".\n     03  SL197          pic x(22) value \"SL197 Stock Rewrite : \".\n*>\n 01  error-code          pic 999.\n*>\n linkage section.\n*>***************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n*>\n     accept   ws-env-lines from lines.\n     if       ws-env-lines < 24\n              move  24 to ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n     perform  program-start.\n     perform  Invoice-Open.              *> open i-o    invoice-file.\n     perform  Sales-Open-Input.          *> open input  sales-file.\n     perform  Delivery-Open-Input.       *> open input  delivery-file.\n     perform  DelInvNos-Open.            *> open extend Del-Inv-Nos-file. [ Now I/O ]\n*> new 19/03--\n     perform  Stock-Open.\n     perform  Stock-Audit-Open.\n     perform  Analysis-Open.\n*>\n done-open.\n     move     spaces to escape-code.\n     initialize SInvoice-Bodies.   *> Sil-Data (occ 40).\n     perform  invoice-details.\n*>\n     if       escape-code = \"Q\"\n              go to  main-exit.\n*>\n     move     1 to cole.\n     display  \" \" at 1601 with erase eos.\n*>\n data-input.\n*>**********\n*>\n     display  \"Delete Further Invoices (Y/N) ? [Y]\" at 1629 with foreground-color 2.\n*>\n     move     \"Y\"  to   ws-reply.\n     accept   ws-reply at 1662 with foreground-color 6 update.\n     move     function upper-case (ws-reply) to ws-reply.\n     display  \" \" at 1601 with erase eol.\n     if       ws-reply = \"Y\"\n              go to done-open.\n*>\n main-exit.\n*>********\n*>\n     perform  Sales-Close.       *> close sales-file delivery-file Del-Inv-Nos-file.\n     perform  Delivery-Close.\n     perform  DelInvNos-Close.\n     perform  Invoice-Close.       *> close    invoice-file.\n*> new 19/03--\n     perform  Stock-Close.\n     perform  Stock-Audit-Close.\n     perform  Analysis-Close.\n     exit     program.\n*>\n*>****************************************************\n*>                    Procedures                     *\n*>****************************************************\n*>\n Delete-Details section.\n*>=====================\n*>\n*> Used with Cobol files only.\n*>\n     move     zero  to  j.\n     perform  sih-lines times\n              add    1 to j\n              move   sih-invoice to invoice-nos\n              move   j to item-nos\n              perform Invoice-Delete     *> delete invoice-file\n     end-perform.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n Read-Details  section.\n*>====================\n*>\n*> Uses read next but if problem, can use read indexed just a bit faster.\n*> Having read each in process audit update.\n*>\n     move     zero to j.\n     perform  sih-lines times\n              add      1 to j\n              move     sih-invoice to invoice-nos\n              move     j to item-nos\n              perform  Invoice-Read-Next\n              move     WS-Invoice-Record to Invoice-Lines (j)\n              perform  Update-Stock-n-Audit\n     end-perform.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n Update-Stock-n-Audit section.\n*>===========================\n*>\n*>  This procedure update ONE line entry from the Invoice-Lines record.\n*>    and is called for every entry.\n*>\n*> Only processes if linked to Stock Control and not proforma\n*>  This section only creates an Audit record and updates\n*>   Stock record quantity held (Stock-Held) and Stock-Value",
        "line": 106
      },
      {
        "type": "IF",
        "condition": "in error chg sl910.\n*>\n*>    These routines do the reverse of code in sl910 regarding invoice rec type.\n*>\n     if       SL-Stock-Link not = \"Y\"\n              go to Update-Stock-Exit.\n     if       Sih-Type   = 4\n              go to Update-Stock-Exit.\n*>\n*> Normal for Receipts(1) and Invoices (2) but reverse process for\n*>      Credit Notes (3) AND Proformas are ignored.\n*>\n     initialize WS-Stock-Audit-Record.\n     move     3                   to Audit-Type.\n     move     Sih-Invoice         to Audit-Invoice-PO.\n     move     ws-Date             to Audit-Process-Date.\n     move     Sil-Product (j)     to Audit-Stock-Key\n                                     WS-Temp-Stock-Key.\n     move     Sil-Description (j) to Audit-Desc.\n     move     sil-qty (j)         to Audit-Transaction-Qty.\n     move     zero                to Audit-Unit-Cost.\n     if       Sil-Type (j) = 3\n              move 5        to Audit-Type\n              move zero     to Audit-Reverse-Transaction   *> was 1\n              move Sih-cr   to Audit-Cr-for-Invoice\n     else\n              move 1        to Audit-Reverse-Transaction   *> was zero\n     end-if\n     move     Stk-Audit-No  to Audit-No.\n*>\n*> Get the Stock record\n*>\n     if       ws-Stock-No-Long = spaces\n              move ws-Abrev-Stock to WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              perform Stock-Read-Indexed      *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n              if   FS-Reply = 21 or 23\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if                           *> end-read\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move  1 to File-Key-No\n              perform Stock-Read-Indexed    *> read Stock-File key WS-Stock-Key invalid key\n              if   FS-Reply = 21 or 23\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if                                *> end-read\n     end-if\n*>\n*> As stock items are checked this should not happen\n*>     but it is a multi user system\n*>\n     if       fs-reply not = zero\n              perform Eval-Status\n              display SL194           at line ws-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply        at line ws-23-lines col 26 with foreground-color 3\n              display exception-msg   at line ws-23-lines col 29 with foreground-color 3\n              display WS-Stock-Key       at 2064 with foreground-color 3\n              display sl006           at line ws-lines col 01 with foreground-color 3\n              accept  ws-reply        at line ws-lines col 45\n              display \" \"             at line ws-23-lines col 1 with erase eos\n     end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it\n*>          show up in proof reports (sil-type same as sih-type so use later - less ram)\n*>\n     if       WS-Stock-Key not = spaces         *> we have a stock rec.\n              if       Sih-Type = 3             *> was 1 or 2             *> Credit note\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost * -1\n                       subtract Audit-Transaction-Qty from Stock-Held\n              else\n               if      Sih-Type = 1 or = 2      *> Was = 3\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost\n                       add Audit-Transaction-Qty to Stock-Held\n               end-if\n              end-if\n*>\n              if       Stock-Held < zero\n                       multiply -1 by Stock-Held\n                       add Stock-Held to Stock-Pre-Sales\n                       move zero to Stock-Held\n              end-if\n              if       Stock-Held > zero\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) invoices but reversed.\n*>\n*> Update record period and month in year totals but check that WS-Inv-Mth is valid.\n*>    [ All values should be positive ]\n*>       and    could be different month - WIP stock is NOT sold!\n*>\n              if       WS-Inv-Mth not < 1 or > 12\n                if     Sih-Type = 3                         *> Credit Notes  WAS 1 or 2\n                       add Audit-Transaction-Qty to Stock-Deducts\n                       add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                else\n                 if    Sih-Type = 1 or 2                    *> Invoice and Recepts  WAS 3\n                       add Audit-Transaction-Qty to Stock-Adds\n                       add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                 end-if\n                end-if\n              end-if\n*>\n              move 1 to File-Key-No\n              perform  Stock-Rewrite      *> rewrite  WS-Stock-Record invalid key\n              if       FS-Reply = 21 or 23\n                       display SL191    at line ws-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply at line ws-23-lines col 38 with foreground-color 2 highlight\n                       display SL006    at line ws-lines col 1\n                       accept ws-reply  at line ws-lines col 45\n              end-if                         *> end-rewrite\n              if       fs-reply not = zero\n                       perform Eval-Status\n                       display SL197         at line ws-23-lines col 1 with erase eol foreground-color 4\n                       display fs-reply      at line ws-23-lines col 22 with foreground-color 3\n                       display exception-msg at line ws-23-lines col 25 with foreground-color 3\n                       display WS-Stock-Key  at 2064 with foreground-color 3\n                       display sl006         at line ws-lines col 01 with foreground-color 3\n                       accept  ws-reply      at line ws-lines col 30\n                       display \" \"           at line ws-23-lines col 1 with erase eos\n              end-if\n     end-if\n*>\n     if       Stk-Audit-Used = 1\n              move zero to Stk-Activity-Rep-Run    *> Need to run audit report\n              perform  Stock-Audit-Write           *> write Stock-Audit-Record\n              if       fs-reply not = zero\n                       perform Eval-Status\n                       display SL190         at line ws-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply      at line ws-23-lines col 38 with foreground-color 2 highlight\n                       display exception-msg at line ws-23-lines col 41 with foreground-color 3\n                       display SL006         at line ws-lines col 1\n                       accept ws-reply       at line ws-lines col 45\n              end-if\n     end-if.\n*>\n Update-Stock-Exit.\n     exit     section.\n*>\n Eval-Status  section.\n*>===================\n*>\n     move     spaces to exception-msg.\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n main-exit.   exit section.\n*>************************\n*>\n Program-Start  section.\n*>=====================\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-16      *> Invoice\n                                                 File-Info\n              end-call\n              if    return-code not = zero          *> not = zero - No file found\n                    display SL196    at 2301\n                    display SL003    at 2401\n                    accept  ws-reply at 2440\n                    exit program\n     end-if\n*>\n     move     to-day to u-date.\n*>\n menu-return.\n*>**********\n*>\n     display  prog-name at 0101 with erase eos foreground-color 2.\n     display  \"Invoicing Data Deletion\" at 0131 with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n invoice-details         section.\n*>==============================\n*>\n     display  \"****************************************\" at 0441 with erase eol foreground-color 2.\n     display  \"*Date   [  /  /    ]*                  *\" at 0541 with erase eol foreground-color 2.\n     display  \"*A/C Nos   [       ]*                 **\" at 0641 with erase eol foreground-color 2.\n     display  \"*Invoice  [        ]*Order [          ]*\" at 0741 with erase eol foreground-color 2.\n     display  \"****************************************\" at 0841 with erase eol foreground-color 2.\n     display  \"**   Only for the unposted Invoices   **\" at 0941 with erase eol foreground-color 2.\n     display  \"Type [ ]  <1> = Receipt; <2> = Account; <3> = Credit Note; <4> = Pro-Forma\"\n                                                         at 1001 with foreground-color 2.\n     display  \"Zero invoice to quit\"  at 1201 with foreground-color 2.\n*>\n invoice-enter.\n*>************\n*>\n     accept   sih-invoice at 0752 with foreground-color 3 update.\n     display  \" \" at 1601 with erase eol.\n     if       sih-invoice = zero\n              move  \"Q\"  to  escape-code\n              go to  main-exit.\n*>\n     move     sih-invoice  to  invoice-nos.\n     move     zero  to  item-nos.\n*>\n*> Read the Invoice Header Rec\n*>\n     perform  Invoice-Read-Indexed.     *> read invoice-file  invalid key\n     if       fs-reply not = zero\n              display SL194 at 1640 with foreground-color 4\n              go to  invoice-enter.\n*>\n     move     WS-Invoice-Record  to  sinvoice-header.\n*>\n     if       sih-status = \"Z\"   or \"z\"\n              display SL195 at 1601 with foreground-color 4 erase eol\n              go to  invoice-enter.\n     move     sih-date to u-bin.\n     perform  zz060-Convert-Date.                          *> in ws-date\n     display  sih-customer at 0653 with foreground-color 3.\n*>\n     move     1  to  c-check.\n     move     sih-customer  to  WS-Sales-Key.\n     move     1  to File-Key-No.\n     perform  Sales-Read-Indexed.           *> read sales-file  record  invalid key\n     if       fs-reply = 21 or 23\n              move  zero  to  c-check.\n*>\n     if       delivery-tag = zero\n              go to  customer-setup.\n*>\n     move     \"D\"          to WS-Deliv-Key-Type.\n     move     WS-Sales-Key to WS-Deliv-Sales-Key.\n     perform  Delivery-Read-Indexed.          *> read delivery-file  invalid\n     if       fs-reply = 21 or 23\n              move  zero  to  delivery-tag\n              go to  customer-setup.\n*>\n     move     deliv-address to  address-a.\n     go       to customer-display.\n*>\n customer-setup.\n*>*************\n*>\n     move     sales-address  to  address-a.\n*>\n customer-display.\n*>***************\n*>\n     if       delivery-tag = zero\n              display sales-name at 0401 with foreground-color 3\n     else\n              display deliv-name at 0401 with foreground-color 3\n     end-if\n     move     1  to  a.\n     unstring address-a  delimited  by  sl-delim into  address-line count a pointer  a.\n     display  address-line at 0501 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited  by  sl-delim into  address-line count a pointer  a.\n     display  address-line at 0601 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited  by  sl-delim into  address-line count a pointer  a.\n     display  address-line at 0701 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a              into  address-line  pointer  a.\n     display  address-line at 0801 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n*>\n     display  ws-date at 0550 with foreground-color 3.\n     display  sih-order at 0769 with foreground-color 3.\n     display  sih-type at 1007 with foreground-color 3.\n     display  \"Invoice To Be Deleted (Y/N) - [ ]\" at 1601 with foreground-color 2.\n     move     \"N\" to ws-reply.\n     accept   ws-reply at 1632 with foreground-color 6 update UPPER.\n     if       ws-reply not = \"Y\"\n              go to  main-exit.\n*>\n*>  Need to read in all line recs and update stats one by one\n*>    and the stock rec.\n*>\n     perform  Read-Details.                 *> Get all item lines and update audit & stock recs\n     if       not FS-Cobol-Files-Used\n              perform Invoice-Delete-All    *> Delete All for invoice # using RDB\n     else\n              perform  Invoice-Delete       *>  delete   invoice-file -> Deleting Header\n              perform  Delete-Details.\n*>\n*> Save the deleted inv # for re-use in sl910.\n*>\n     move     sih-invoice  to  WS-Del-Inv-Nos.\n     move     sih-date     to  del-inv-dat.\n     move     sih-customer to  del-inv-cus.\n*>\n     perform  DelInvNos-Write.        *> write    WS-Del-Inv-Nos-record.\n*>\n main-exit.   exit.\n*>********    ****\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move WS-Month to WS-Inv-Month\n              move 1 to Date-Form.\n     if       Date-UK\n              move WS-Month to WS-Inv-Month\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              move WS-Month to WS-Inv-Month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     WS-Intl-Month to WS-Inv-Month\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 377
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 6,
    "cognitive": 2,
    "halstead": {
      "uniqueOperators": 2,
      "uniqueOperands": 66,
      "totalOperators": 53,
      "totalOperands": 104,
      "vocabulary": 68,
      "length": 157,
      "volume": 955.7316660763032
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
