{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/purchase.cbl",
  "fileName": "purchase.cbl",
  "timestamp": "2025-09-15T16:25:48.232Z",
  "programId": "purchase",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 159
      },
      {
        "name": "File",
        "line": 169
      },
      {
        "name": "working-storage",
        "line": 173
      },
      {
        "name": "zz060-Convert-Date",
        "line": 894
      },
      {
        "name": "exit",
        "line": 927
      },
      {
        "name": "maps04",
        "line": 929
      },
      {
        "name": "exit",
        "line": 935
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 162
      },
      {
        "name": "Purchase-Main",
        "line": 311
      },
      {
        "name": "goback",
        "line": 324
      },
      {
        "name": "goback",
        "line": 329
      },
      {
        "name": "File-Duplicates-In-Use",
        "line": 335
      },
      {
        "name": "end-if",
        "line": 344
      },
      {
        "name": "aa010-Get-System-Recs",
        "line": 346
      },
      {
        "name": "end-if",
        "line": 361
      },
      {
        "name": "display-menu",
        "line": 472
      },
      {
        "name": "Conv-date",
        "line": 485
      },
      {
        "name": "end-if",
        "line": 504
      },
      {
        "name": "conv-date-end",
        "line": 506
      },
      {
        "name": "display-go",
        "line": 509
      },
      {
        "name": "accept-loop",
        "line": 562
      },
      {
        "name": "call-system-setup",
        "line": 584
      },
      {
        "name": "pre-overrewrite",
        "line": 602
      },
      {
        "name": "goback",
        "line": 619
      },
      {
        "name": "end-if",
        "line": 634
      },
      {
        "name": "File-Duplicates-In-Use",
        "line": 639
      },
      {
        "name": "overclose",
        "line": 652
      },
      {
        "name": "goback",
        "line": 653
      },
      {
        "name": "load-it",
        "line": 655
      },
      {
        "name": "loader",
        "line": 665
      },
      {
        "name": "load00",
        "line": 670
      },
      {
        "name": "load00-exit",
        "line": 687
      },
      {
        "name": "load000",
        "line": 691
      },
      {
        "name": "load000-exit",
        "line": 706
      },
      {
        "name": "load01",
        "line": 710
      },
      {
        "name": "load02",
        "line": 716
      },
      {
        "name": "load03",
        "line": 722
      },
      {
        "name": "load04",
        "line": 728
      },
      {
        "name": "load05",
        "line": 734
      },
      {
        "name": "load06",
        "line": 740
      },
      {
        "name": "load07",
        "line": 746
      },
      {
        "name": "load08",
        "line": 752
      },
      {
        "name": "load11",
        "line": 776
      },
      {
        "name": "load12",
        "line": 786
      },
      {
        "name": "load13",
        "line": 792
      },
      {
        "name": "load14",
        "line": 798
      },
      {
        "name": "load15",
        "line": 804
      },
      {
        "name": "load16",
        "line": 810
      },
      {
        "name": "load17",
        "line": 826
      },
      {
        "name": "load18",
        "line": 836
      },
      {
        "name": "load19",
        "line": 842
      },
      {
        "name": "load20",
        "line": 848
      },
      {
        "name": "load20a",
        "line": 857
      },
      {
        "name": "load21",
        "line": 871
      },
      {
        "name": "load22",
        "line": 877
      },
      {
        "name": "loadsr",
        "line": 883
      },
      {
        "name": "main-exit",
        "line": 889
      },
      {
        "name": "goback",
        "line": 890
      },
      {
        "name": "zz060-Exit",
        "line": 926
      },
      {
        "name": "maps04-exit",
        "line": 934
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "maps04",
        "line": 405,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 432,
        "type": "DYNAMIC",
        "using": [
          "Run-Backup",
          "File-Info",
          "end-call",
          "if",
          "Return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "and",
          "Batch-Text",
          "(1:1)",
          "not",
          "=",
          "space",
          "move",
          "\"No",
          "BackUp",
          "Script",
          "in",
          "Bin\"",
          "to",
          "Batch-Text",
          "else",
          "move",
          "1",
          "to",
          "Backup-Sw",
          "string",
          "\"Using",
          "\"",
          "delimited",
          "by",
          "size",
          "Script-Name",
          "delimited",
          "by",
          "space",
          "into",
          "Batch-Text",
          "end-if",
          "*>",
          "*>",
          "*>",
          "22/03/18",
          "New",
          "code",
          "(from",
          "stock)"
        ]
      },
      {
        "target": "SYSTEM",
        "line": 619,
        "type": "DYNAMIC",
        "using": [
          "Full-Backup-Script"
        ]
      },
      {
        "target": "maps04",
        "line": 933,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 150,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 159,
        "replacing": null
      },
      {
        "name": "selsys",
        "line": 166,
        "replacing": null
      },
      {
        "name": "fdsys",
        "line": 173,
        "replacing": null
      },
      {
        "name": "sys-params-versioning",
        "line": 190,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 232,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 233,
        "replacing": null
      },
      {
        "name": "wstime",
        "line": 234,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 235,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 236,
        "replacing": null
      },
      {
        "name": "wssys4",
        "line": 237,
        "replacing": null
      },
      {
        "name": "wsdflt",
        "line": 238,
        "replacing": null
      },
      {
        "name": "wsfinal",
        "line": 239,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 240,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 267,
        "replacing": null
      },
      {
        "name": "Proc-Get-Env-Set-Files",
        "line": 893,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 938,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "overwrite",
        "thru": null,
        "line": 84
      },
      {
        "target": "zz020-Get-Program-Args",
        "thru": null,
        "line": 332
      },
      {
        "target": "System-Open-Input",
        "thru": null,
        "line": 339
      },
      {
        "target": "System-close",
        "thru": null,
        "line": 341
      },
      {
        "target": "System-open",
        "thru": null,
        "line": 344
      },
      {
        "target": "System-Read-Indexed",
        "thru": null,
        "line": 352
      },
      {
        "target": "System-Read-Indexed",
        "thru": null,
        "line": 355
      },
      {
        "target": "System-close",
        "thru": null,
        "line": 357
      },
      {
        "target": "System-open",
        "thru": null,
        "line": 360
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 375
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 379
      },
      {
        "target": "System-Read-Indexed",
        "thru": null,
        "line": 380
      },
      {
        "target": "System-Read-Indexed",
        "thru": null,
        "line": 385
      },
      {
        "target": "System-Write",
        "thru": null,
        "line": 388
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 394
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 399
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 407
      },
      {
        "target": "Load00",
        "thru": null,
        "line": 465
      },
      {
        "target": "conv-date",
        "thru": null,
        "line": 529
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 591
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 592
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 595
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 596
      },
      {
        "target": "overrewrite",
        "thru": null,
        "line": 618
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 626
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 629
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 632
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 633
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 643
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 646
      },
      {
        "target": "System-rewrite",
        "thru": null,
        "line": 649
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 651
      },
      {
        "target": "overrewrite",
        "thru": null,
        "line": 684
      },
      {
        "target": "overrewrite",
        "thru": null,
        "line": 703
      },
      {
        "target": "load000",
        "thru": null,
        "line": 757
      },
      {
        "target": "load000",
        "thru": null,
        "line": 761
      },
      {
        "target": "load00",
        "thru": null,
        "line": 782
      },
      {
        "target": "load00",
        "thru": null,
        "line": 818
      },
      {
        "target": "load00",
        "thru": null,
        "line": 821
      },
      {
        "target": "load00",
        "thru": null,
        "line": 832
      },
      {
        "target": "load00",
        "thru": null,
        "line": 856
      },
      {
        "target": "load000",
        "thru": null,
        "line": 861
      },
      {
        "target": "load00",
        "thru": null,
        "line": 866
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 904
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "zeros",
        "to": "File-System-Used\r\n                       File-Duplicates-In-Use",
        "line": 335
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 337
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 338
      },
      {
        "from": "\"sys002\"",
        "to": "ws-called    *> create param file by requested info from user\r\n              call    ws-called using ws-calling-data file-defs\r\n              perform System-open\r\n     end-if",
        "line": 342
      },
      {
        "from": "zeros",
        "to": "File-System-Used         *> again in case RDB setup\r\n                       File-Duplicates-In-Use,  *> if sys002 just been run",
        "line": 348
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 350
      },
      {
        "from": "4",
        "to": "File-Key-No",
        "line": 351
      },
      {
        "from": "System-Record",
        "to": "WS-System-Record-4",
        "line": 353
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 354
      },
      {
        "from": "\"sys002\"",
        "to": "ws-called    *> create param file by requested info from user\r\n              call    ws-called using ws-calling-data file-defs\r\n              perform System-open\r\n              go to aa010-Get-System-Recs\r\n     end-if",
        "line": 358
      },
      {
        "from": "System-Record",
        "to": "WS-Temp-System-Rec",
        "line": 363
      },
      {
        "from": "File-System-Used",
        "to": "Arg-Number       *> save value from param in Cobol file\r\n*>              move     zero to File-System-Used             *> so we can close the cobol file\r\n*>              perform  System-Close                         *>  close cobol file\r\n*>              move     Arg-Number to File-System-Used       *> restore value from param in cobol file\r\n*>              move     \"66\" to FA-RDBMS-Flat-Statuses       *> Force RDB processing\r\n*>              move     4 to File-Key-No\r\n*>              perform  System-Open                          *> It could be values 1 thru 5 when the other RDBs are programmed for\r\n*>              perform  System-Read-Indexed                  *> Read in RDB table sys totals\r\n*>              if       fs-reply = zero\r\n*>                       move System-Record to WS-System-Record-4  *> overwrite cobol rec",
        "line": 373
      },
      {
        "from": "1",
        "to": "File-Key-No\r\n*>              perform  System-Read-Indexed                  *> get the record from the RDB table\r\n*>              if       fs-reply not = zero                  *> but if error we have a problem such as someone forgot to run system load modules",
        "line": 384
      },
      {
        "from": "WS-Temp-System-Rec",
        "to": "System-Record   *> restore saved cobol file rec\r\n*>                       perform System-Write                 *> So create RDB row in SYSTEM-REC from the Cobol file data\r\n*>                       if      fs-reply not = zero\r\n*>                               display SY011    at 2301 with erase eos\r\n*>                               display fs-reply at 2348\r\n*>                               display SY008    at 2401\r\n*>                               accept  ws-Reply at 2432\r\n*>                               perform System-Close\r\n*>                               goback\r\n*>                       end-if\r\n*>              end-if\r\n*>     end-if",
        "line": 387
      },
      {
        "from": "run-date",
        "to": "u-bin",
        "line": 404
      },
      {
        "from": "u-date",
        "to": "to-day",
        "line": 406
      },
      {
        "from": "\"O/S\"",
        "to": "op-display",
        "line": 413
      },
      {
        "from": "\"Linux\"",
        "to": "op-display\r\n     else if  Windows move \"Windows\" To op-display\r\n     else if  Mac     move \"Mac\"     To op-display\r\n     else if  OS2     move \"OS/2\"    To op-display\r\n     else if  unix    move \"Unix\"    To op-display\r\n     else if  dos     move \"Dos\"     To op-display",
        "line": 414
      },
      {
        "from": "Windows-Backup-Script-Name",
        "to": "Script-Name\r\n     else if  OS2\r\n              move OS2-Backup-Script-Name     to Script-Name\r\n     else if  Linux or Unix or Mac\r\n              move Linux-Backup-Script-Name   to Script-Name",
        "line": 422
      },
      {
        "from": "1",
        "to": "Backup-Sw\r\n              string \"Using \"    delimited by size\r\n                     Script-Name delimited by space into Batch-Text\r\n     end-if\r\n*>\r\n*>\r\n*> 22/03/18 New code (from stock)",
        "line": 439
      },
      {
        "from": "\"xl150\"",
        "to": "WS-Called\r\n              move     \"purchase\" to WS-Caller\r\n              move     zeros      to WS-Term-Code\r\n              move     spaces     to WS-Del-Link\r\n              move     zero       to WS-Process-Func\r\n              move     zero       to WS-Sub-Function\r\n              perform  Load00\r\n              go to    Pre-OverRewrite\r\n     end-if\r\n*>\r\n     move     zeros to ws-Process-Func ws-Sub-Function",
        "line": 459
      },
      {
        "from": "to-day",
        "to": "u-date",
        "line": 475
      },
      {
        "from": "\"purchase\"",
        "to": "ws-caller",
        "line": 476
      },
      {
        "from": "spaces",
        "to": "ws-called ws-del-link menu-reply",
        "line": 477
      },
      {
        "from": "zeros",
        "to": "ws-term-code",
        "line": 478
      },
      {
        "from": "maps-ser-nn",
        "to": "curs2",
        "line": 479
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 491
      },
      {
        "from": "u-date",
        "to": "ws-date\r\n              move ws-days to ws-swap\r\n              move ws-month to ws-days\r\n              move ws-swap to ws-month\r\n              move ws-date to u-date\r\n     end-if\r\n     if       Date-Intl\r\n              move \"ccyy/mm/dd\" to ws-date   *> swap Intl to UK form\r\n              move u-date (7:4) to ws-Intl-Year\r\n              move u-date (4:2) to ws-Intl-Month\r\n              move u-date (1:2) to ws-Intl-Days\r\n              move ws-date to u-date\r\n     end-if",
        "line": 493
      },
      {
        "from": "wsb-hh",
        "to": "wsd-hh\r\n              move wsb-mm to wsd-mm\r\n              move wsb-ss to wsd-ss\r\n              display \"at \"    at 0355 with foreground-color 2\r\n              display wsd-time at 0358 with foreground-color 2",
        "line": 517
      },
      {
        "from": "wsa-yy",
        "to": "u-year\r\n              move wsa-mm to u-month\r\n              move wsa-dd to u-days\r\n              display \"on \" at 0367 with foreground-color 2\r\n              perform conv-date\r\n              display u-date at 0370 with foreground-color 2",
        "line": 525
      },
      {
        "from": "zero",
        "to": "z",
        "line": 575
      },
      {
        "from": "letters-upper",
        "to": "letters",
        "line": 576
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 588
      },
      {
        "from": "zero",
        "to": "ws-term-code",
        "line": 589
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 590
      },
      {
        "from": "4",
        "to": "File-Key-No",
        "line": 593
      },
      {
        "from": "WS-System-Record-4",
        "to": "System-Record",
        "line": 594
      },
      {
        "from": "\"sys002\"",
        "to": "ws-called",
        "line": 597
      },
      {
        "from": "Script-Name",
        "to": "Full-Backup-Script\r\n      else\r\n       if     OS2\r\n              move Script-Name to Full-Backup-Script",
        "line": 614
      },
      {
        "from": "\"66\"",
        "to": "FA-RDBMS-Flat-Statuses\r\n              move     1 to File-Key-No\r\n              perform  System-Open\r\n              move     1 to File-Key-No\r\n              move     System-Record to WS-Temp-System-Rec\r\n              perform  System-Rewrite            *> In case of any changes\r\n              move     4 to File-Key-No\r\n              move     WS-System-Record-4 to System-Record\r\n              perform  System-Rewrite            *> In case of any changes\r\n              perform  System-Close\r\n              move     WS-Temp-System-Rec to System-Record\r\n     end-if",
        "line": 624
      },
      {
        "from": "zeros",
        "to": "File-System-Used\r\n                       File-Duplicates-In-Use",
        "line": 639
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 641
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 642
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 644
      },
      {
        "from": "System-Record",
        "to": "WS-Temp-System-Rec\r\n     perform  System-Rewrite",
        "line": 645
      },
      {
        "from": "4",
        "to": "File-Key-No",
        "line": 647
      },
      {
        "from": "WS-System-Record-4",
        "to": "System-Record",
        "line": 648
      },
      {
        "from": "WS-Temp-System-Rec",
        "to": "System-Record\r\n     perform  System-Close",
        "line": 650
      },
      {
        "from": "space",
        "to": "menu-reply",
        "line": 659
      },
      {
        "from": "zero",
        "to": "ws-term-code",
        "line": 674
      },
      {
        "from": "zero",
        "to": "ws-term-code",
        "line": 695
      },
      {
        "from": "\"pl000\"",
        "to": "ws-called",
        "line": 714
      },
      {
        "from": "\"pl010\"",
        "to": "ws-called",
        "line": 720
      },
      {
        "from": "\"pl015\"",
        "to": "ws-called",
        "line": 726
      },
      {
        "from": "\"pl020\"",
        "to": "ws-called",
        "line": 732
      },
      {
        "from": "\"pl030\"",
        "to": "ws-called",
        "line": 738
      },
      {
        "from": "\"pl040\"",
        "to": "ws-called",
        "line": 744
      },
      {
        "from": "\"pl050\"",
        "to": "ws-called",
        "line": 750
      },
      {
        "from": "\"pl830\"",
        "to": "WS-Called",
        "line": 756
      },
      {
        "from": "\"pl055\"",
        "to": "ws-called",
        "line": 760
      },
      {
        "from": "\"pl060\"",
        "to": "ws-called",
        "line": 762
      },
      {
        "from": "\"pl080\"",
        "to": "ws-called",
        "line": 768
      },
      {
        "from": "\"pl085\"",
        "to": "ws-called",
        "line": 774
      },
      {
        "from": "\"pl090\"",
        "to": "ws-called\r\n              perform  load00\r\n     end-if\r\n     move     \"pl095\" to ws-called",
        "line": 781
      },
      {
        "from": "\"pl100\"",
        "to": "ws-called",
        "line": 790
      },
      {
        "from": "\"pl070\"",
        "to": "ws-called",
        "line": 796
      },
      {
        "from": "\"pl130\"",
        "to": "ws-called",
        "line": 802
      },
      {
        "from": "\"pl140\"",
        "to": "ws-called",
        "line": 808
      },
      {
        "from": "zero",
        "to": "error-code",
        "line": 816
      },
      {
        "from": "\"pl165\"",
        "to": "ws-called",
        "line": 817
      },
      {
        "from": "\"Y\"",
        "to": "oi-5-flag",
        "line": 819
      },
      {
        "from": "\"pl115\"",
        "to": "ws-called",
        "line": 820
      },
      {
        "from": "\"pl120\"",
        "to": "ws-called   *> Aged anal report\r\n              go  to load000",
        "line": 823
      },
      {
        "from": "\"pl165\"",
        "to": "ws-called   *> purch file name sort\r\n              perform load00\r\n     end-if\r\n     move     \"pl160\" to ws-called",
        "line": 831
      },
      {
        "from": "\"pl170\"",
        "to": "ws-called",
        "line": 840
      },
      {
        "from": "\"pl900\"",
        "to": "ws-called",
        "line": 846
      },
      {
        "from": "\"pl140\"",
        "to": "ws-called",
        "line": 855
      },
      {
        "from": "\"xl150\"",
        "to": "ws-called",
        "line": 860
      },
      {
        "from": "\"pl130\"",
        "to": "ws-called\r\n              perform load00\r\n              move zero to ws-term-code\r\n              go to load20a",
        "line": 865
      },
      {
        "from": "\"pl180\"",
        "to": "ws-called",
        "line": 875
      },
      {
        "from": "\"pl190\"",
        "to": "ws-called",
        "line": 881
      },
      {
        "from": "spaces",
        "to": "ws-Date\r\n              go to zz060-Exit",
        "line": 906
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 908
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 911
      },
      {
        "from": "ws-days",
        "to": "ws-swap\r\n              move ws-month to ws-days\r\n              move ws-swap to ws-month\r\n              go to zz060-Exit",
        "line": 915
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 922
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "called by Stock.\r\n*> 22/09/15 vbc - .20 Added support for Param-Restrict & option Z.\r\n*> 24/10/16 vbc - .   ALL programs now using wsnames.cob in copybooks\r\n*>                    Changed get-Env stuff to a copybook using common msgs.\r\n*> 15/01/17 vbc - .   All programs upgraded to v3.02 for RDB processing.\r\n*> 16/01/17 vbc - .22 Removed dead call - maps99.\r\n*>                    Change proc step for SL160 so no sort if RDB processing.\r\n*>                    IS THERE OTHERS ??\r\n*> 30/08/17 vbc - .23 Set wsnames to use default in copybook without the 'in ..'.\r\n*> 01/09/17 vbc - .24 New code to update sys4 record or param record if\r\n*>                    the called program could or does any changes to them.\r\n*>                    removed the stop run after a goback - unneeded.\r\n*>                    Chg load000 & load00 to perform/goback instead of go to.\r\n*>                    also add after call to perform overwrite to update\r\n*>                    any data changes in system or sys4 record data\r\n*>                    depending on called program for load00.\r\n*>                    Started work on removing calls to maps99 throughout\r\n*>                    Purchase notes added per program.\r\n*> 05/02/18 vbc - .25 Dont close file pre calling sys002 as not open!!!\r\n*> 13/03/18 vbc -     Adjusted code base to bring it inline with all other menu programs.\r\n*> 22/03/18 vbc - .26 Added process to allow internal params via WS-Calling-Data\r\n*>                    WS-Args (13) to start and pass extra info to a called program\r\n*>                    In this case running xl150 with answers to the start up\r\n*>                    questions. (F = Forced run).\r\n*>                    This way program can be started via crontab or better still via\r\n*>                    Sales Ledger if end of month/beginning of new month.\r\n*>                    xl150 End of cycle program should only be run if all reports\r\n*>                    completed, i.e.,\r\n*>                    Sales: Proof, Packing lists, Invoices, Value Analysis & Postings\r\n*>                    and payments Proof and Postings.\r\n*>                    Purchase: Proof, Purchase Orders, Value Analysis & Postings\r\n*>                    and payments Proof and Postings, Cheques etc if required.\r\n*>                    Force run will try to run all outstanding reports.\r\n*> 14/04/18 vbc - .27 Remark out code for reading in rdb system data as file will\r\n*>                    ALWAYS be up2date.\r\n*>                    On request for system setup write out sys rec 1 to file first.\r\n*>                    Adjust overwrite so that rdb if valid is processed\r\n*>                    followed by the file. Doing this system wide.\r\n*> 21/05/18 vbc - .28 Small change to the backup process at prerewrite\r\n*>                    On menu exit do NOT display space as it forces a wait stop.\r\n*> 28/05/18 vbc - .29 Added ws fields for env. columns and lines to verify minimums.\r\n*> 31/05/23 vbc - .30 Added execution of pl830 first when Transactions Post selected\r\n*>                    at para load08 - All 4 lines are currently remarked out until\r\n*>                    the programs have been written.\r\n*> 27/07/23 vbc - .31 Change title of menu option U to Invoice Sub-System\r\n*>                    to standardise with SL.\r\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\r\n*> 26/12/24 vbc       Change menu ACCEPT to use UPPER and remove the function.\r\n*> 29.07.25 vbc   .32 Changed Menu option S, from Cheque to Payment to match\r\n*>                    pl900.\r\n*>\r\n*>*************************************************************************\r\n*>\r\n*>  From copyright.cob.\r\n*>\r\n*> Copyright Notice.\r\n*> ****************\r\n*>\r\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\r\n*>\r\n*> These files and programs are part of the Applewood Computers Accounting\r\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\r\n*>\r\n*> This program is now free software; you can redistribute it and/or modify it\r\n*> under the terms listed here and of the GNU General Public License as\r\n*> published by the Free Software Foundation; version 3 and later as revised\r\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\r\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\r\n*>\r\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\r\n*> distribution in a rental or hire mode must get in touch with the copyright\r\n*> holder with your commercial plans and proposals.\r\n*>\r\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\r\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\r\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\r\n*> for more details. If it breaks, you own both pieces but I will endeavour\r\n*> to fix it, providing you tell me about the problem.\r\n*>\r\n*> You should have received a copy of the GNU General Public License along\r\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\r\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\r\n*>\r\n*>*************************************************************************\r\n*>\r\n environment             division.\r\n*>===============================\r\n*>\r\n copy  \"envdiv.cob\".\r\n input-output            section.\r\n*>------------------------------\r\n*>\r\n file-control.\r\n*>------------\r\n*>\r\n*> copy \"selsys.cob\".\r\n Data  Division.\r\n*>=============\r\n*>\r\n File Section.\r\n*>-----------\r\n*>\r\n*> copy \"fdsys.cob\".\r\n working-storage section.\r\n*>----------------------\r\n 77  prog-name           pic x(18)    value \"Purchase (3.02.32)\".\r\n 77  z                   binary-char  value zero.\r\n 77  Batch-Text          pic x(28)    value spaces.\r\n 77  Script-Name         pic x(20)    value spaces.\r\n 77  Run-Backup          pic x(512)   value spaces.  *> size changed\r\n 77  Full-Backup-Script  pic x(512)   value spaces.\r\n 77  OS-Delimiter        pic x        value \"/\".     *> Preset for *nix\r\n 77  ACAS_BIN            pic x(512)   value spaces.  *> added\r\n 77  ACAS_LEDGERS        pic x(500)   value spaces.\r\n 77  Arg-Number          pic 9        value zero.\r\n*>========================================================\r\n*>  in case file layout upgrade is needed.\r\n*>   Using a file update program.\r\n*>\r\n copy \"sys-params-versioning.cob\".\r\n*>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n*>\r\n*> holds program parameter values from command line\r\n 01  Arg-Vals                         value spaces.\r\n     03  Arg-Value       pic x(525)  occurs 2.\r\n 01  Arg-Test            pic x(525)   value spaces.\r\n 01  Saved-CD-Args       pic x(13).\r\n*>\r\n 01  Backup-Sw           pic 9     value zero.\r\n     88  Backup-Script-Found       value 1.\r\n 01  Linux-Backup-Script-Name   pic x(20) value \"acasbkup.sh\".\r\n 01  Windows-Backup-Script-Name pic x(20) value \"acasbkup.bat\".\r\n 01  OS2-Backup-Script-Name     pic x(20) value \"acasbkup.cmd\".\r\n*>\r\n 01  File-Info                          value zero.       *> Layout as per GNU v2 manual\r\n     05 File-Size-Bytes  pic 9(18) comp.\r\n     05 Mod-DD           pic 9(2)  comp.    *> Mod date.\r\n     05 Mod-MO           pic 9(2)  comp.\r\n     05 Mod-YYYY         pic 9(4)  comp.\r\n     05 Mod-HH           pic 9(2)  comp.    *> Mod time\r\n     05 Mod-MM           pic 9(2)  comp.\r\n     05 Mod-SS           pic 9(2)  comp.\r\n     05 filler           pic 9(2)  comp. *> Always 00\r\n*>\r\n 01  ws-data.\r\n     03  menu-reply      pic x        value \"A\".\r\n     03  op-display      pic x(7).\r\n*>\r\n     03  letters-upper   pic x(26)    value \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".\r\n     03  letters.\r\n         05  a-entry     pic x          occurs  26  indexed by q.\r\n*>\r\n     03  ws-reply        pic x.\r\n     03  a               pic 99         comp.\r\n     03  wsmaps-ser.\r\n         05  wsmaps-ser-xx pic xx.\r\n         05  wsmaps-ser-nn pic 9(4).\r\n*>\r\n     03  ws-env-columns  pic 999       value zero.\r\n     03  ws-env-lines    pic 999       value zero.\r\n*>\r\n copy \"wsmaps03.cob\".   *> for maps04\r\n copy \"wscall.cob\".\r\n copy \"wstime.cob\".\r\n copy \"wsfnctn.cob\".\r\n copy \"wssystem.cob\".\r\n copy \"wssys4.cob\"   replacing System-Record-4 by WS-System-Record-4.\r\n copy \"wsdflt.cob\".\r\n copy \"wsfinal.cob\".\r\n copy \"wsnames.cob\".\r\n*>\r\n*> REMARK OUT ANY IN USE\r\n*>\r\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\r\n*>     03  System-Record       pic x.\r\n*>     03  Default-Record         pic x.\r\n*>     03  Final-Record           pic x.\r\n*>     03  System-Record-4        pic x.\r\n     03  WS-Ledger-Record       pic x.\r\n     03  WS-Posting-Record      pic x.\r\n     03  WS-Batch-Record        pic x.\r\n     03  WS-IRS-Posting-Record  pic x.\r\n     03  WS-Stock-Audit-Record  pic x.\r\n     03  WS-Stock-Record        pic x.\r\n     03  WS-Sales-Record        pic x.\r\n     03  WS-Value-Record        pic x.\r\n     03  WS-Delivery-Record     pic x.\r\n     03  WS-Analysis-Record     pic x.\r\n     03  WS-Del-Inv-Nos-Record  pic x.\r\n     03  WS-Purch-Record        pic x.\r\n     03  WS-Pay-Record          pic x.\r\n     03  WS-Invoice-Record      pic x.\r\n     03  WS-PInvoice-Record     pic x.\r\n     03  WS-OTM3-Record         pic x.\r\n     03  WS-OTM5-Record         pic x.\r\n*>\r\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\r\n*>\r\n 01  ws-Test-Date            pic x(10).\r\n 01  ws-date-formats.\r\n     03  ws-swap             pic xx.\r\n     03  ws-Conv-Date        pic x(10).\r\n     03  ws-date             pic x(10).\r\n     03  ws-UK redefines ws-date.\r\n         05  ws-days         pic xx.\r\n         05  filler          pic x.\r\n         05  ws-month        pic xx.\r\n         05  filler          pic x.\r\n         05  ws-year         pic x(4).\r\n     03  ws-USA redefines ws-date.\r\n         05  ws-usa-month    pic xx.\r\n         05  filler          pic x.\r\n         05  ws-usa-days     pic xx.\r\n         05  filler          pic x.\r\n         05  filler          pic x(4).\r\n     03  ws-Intl redefines ws-date.\r\n         05  ws-intl-year    pic x(4).\r\n         05  filler          pic x.\r\n         05  ws-intl-month   pic xx.\r\n         05  filler          pic x.\r\n         05  ws-intl-days    pic xx.\r\n*>\r\n 01  Error-Messages.\r\n*> System Wide\r\n     03  SY006           pic x(62) value \"SY006 Program Arguments limited to two and you have specified \".\r\n     03  SY007           pic x(35) value \"SY007 Program arguments incorrect: \".\r\n     03  SY008           pic x(31) value \"SY008 Note message & Hit return\".\r\n     03  SY009           pic x(53) value \"SY009 Environment variables not yet set up : ABORTING\".\r\n     03  SY010           pic x(46) value \"SY010 Terminal program not set to length => 24\".\r\n     03  SY011           pic x(47) value \"SY011 Error on systemMT processing, Fs-reply = \".\r\n     03  SY013           pic x(47) value \"SY013 Terminal program not set to Columns => 80\".\r\n*> Module specific\r\n*>\r\n 01  error-code          pic 999    value zero.\r\n 01  to-day              pic x(10).\r\n*>\r\n 01  WS-Temp-System-Rec  pic x(2048).   *> Size overkill\r\n*>\r\n procedure division.\r\n*>*****************\r\n*>\r\n Purchase-Main.\r\n*>************\r\n*>\r\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\r\n*>\r\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\r\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\r\n     move     function current-date to wse-date-block.\r\n*>\r\n     accept   ws-env-lines   from lines.\r\n     if       ws-env-lines < 24\r\n              display SY010    at 0101 with erase eos\r\n              accept  ws-reply at 0133\r\n              goback.\r\n     accept   ws-env-Columns from Columns.\r\n     if       ws-Env-Columns < 80\r\n              display SY013    at 0101 with erase eos\r\n              accept  ws-reply at 0133\r\n              goback.\r\n*>\r\n     perform  zz020-Get-Program-Args.\r\n*>\r\n Open-System.                *> First get system param cobol file\r\n     move     zeros to File-System-Used\r\n                       File-Duplicates-In-Use.\r\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.  *> Force Cobol proc.\r\n     move     1 to File-Key-No.\r\n     perform  System-Open-Input.\r\n     if       fs-reply not = zero\r\n *>             perform System-close\r\n              move    \"sys002\" to ws-called    *> create param file by requested info from user\r\n              call    ws-called using ws-calling-data file-defs\r\n              perform System-open\r\n     end-if.\r\n*>\r\n aa010-Get-System-Recs.\r\n     move     zeros to File-System-Used         *> again in case RDB setup\r\n                       File-Duplicates-In-Use,  *> if sys002 just been run.\r\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.  *> Force Cobol proc.\r\n     move     4 to File-Key-No.\r\n     perform  System-Read-Indexed.        *> Read Cobol file sys totals\r\n     move     System-Record to WS-System-Record-4.\r\n     move     1 to File-Key-No.\r\n     perform  System-Read-Indexed.        *> Read Cobol file params\r\n     if       fs-reply not = zero          *> should NOT happen as done in\r\n              perform System-close          *> open-system\r\n              move    \"sys002\" to ws-called    *> create param file by requested info from user\r\n              call    ws-called using ws-calling-data file-defs\r\n              perform System-open\r\n              go to aa010-Get-System-Recs\r\n     end-if.\r\n     move     System-Record to WS-Temp-System-Rec.   *> save in case of sys-rec-4 overwrite\r\n*>\r\n*> BY PASS THIS CODE AS THE FILE WILL ALWAYS BE CURRENT.\r\n*>\r\n*>  We now have the param file along with RDB information so -\r\n*>  Check if RDB in use & if so, close Cobol file and open\r\n*>   and read the RDB system-rec but if recs do not exist\r\n*>    write using the Cobol file versions.\r\n*>\r\n*>     if       File-System-Used NOT = zero      *> RDB in use ( could be values 1 thru 5 but currently only 1)\r\n*>              move     File-System-Used to Arg-Number       *> save value from param in Cobol file\r\n*>              move     zero to File-System-Used             *> so we can close the cobol file\r\n*>              perform  System-Close                         *>  close cobol file\r\n*>              move     Arg-Number to File-System-Used       *> restore value from param in cobol file\r\n*>              move     \"66\" to FA-RDBMS-Flat-Statuses       *> Force RDB processing\r\n*>              move     4 to File-Key-No\r\n*>              perform  System-Open                          *> It could be values 1 thru 5 when the other RDBs are programmed for\r\n*>              perform  System-Read-Indexed                  *> Read in RDB table sys totals\r\n*>              if       fs-reply = zero\r\n*>                       move System-Record to WS-System-Record-4  *> overwrite cobol rec.\r\n*>              end-if\r\n*>              move     1 to File-Key-No\r\n*>              perform  System-Read-Indexed                  *> get the record from the RDB table\r\n*>              if       fs-reply not = zero                  *> but if error we have a problem such as someone forgot to run system load modules.\r\n*>                       move WS-Temp-System-Rec to System-Record   *> restore saved cobol file rec\r\n*>                       perform System-Write                 *> So create RDB row in SYSTEM-REC from the Cobol file data\r\n*>                       if      fs-reply not = zero\r\n*>                               display SY011    at 2301 with erase eos\r\n*>                               display fs-reply at 2348\r\n*>                               display SY008    at 2401\r\n*>                               accept  ws-Reply at 2432\r\n*>                               perform System-Close\r\n*>                               goback\r\n*>                       end-if\r\n*>              end-if\r\n*>     end-if.\r\n     perform  System-Close.\r\n*>\r\n*>   Back to work as we have the RDB rec if in use otherwise the Cobol one\r\n*>    regardless the system file/table is now closed with recs saved in WS.\r\n*>\r\n     move     run-date to u-bin.\r\n     call     \"maps04\" using maps03-ws.\r\n     move     u-date to to-day.\r\n     perform  zz060-Convert-Date.\r\n*>\r\n     if       not B-L\r\n              set B-L to true.\r\n*>\r\n     if       op-system = zero\r\n              move \"O/S\" to op-display.\r\n     if       linux   move \"Linux\"   To op-display\r\n     else if  Windows move \"Windows\" To op-display\r\n     else if  Mac     move \"Mac\"     To op-display\r\n     else if  OS2     move \"OS/2\"    To op-display\r\n     else if  unix    move \"Unix\"    To op-display\r\n     else if  dos     move \"Dos\"     To op-display.\r\n*>\r\n     if       Dos or Windows\r\n              move Windows-Backup-Script-Name to Script-Name\r\n     else if  OS2\r\n              move OS2-Backup-Script-Name     to Script-Name\r\n     else if  Linux or Unix or Mac\r\n              move Linux-Backup-Script-Name   to Script-Name.\r\n*>\r\n     string   ACAS_BIN     delimited by space\r\n              OS-Delimiter delimited by size\r\n              Script-Name  delimited by space  into Run-Backup\r\n     end-string\r\n     call     \"CBL_CHECK_FILE_EXIST\" using Run-Backup\r\n                                           File-Info\r\n     end-call\r\n     if       Return-Code not = zero\r\n*>          and Batch-Text (1:1) not = space\r\n              move \"No BackUp Script in Bin\" to Batch-Text\r\n     else\r\n              move 1 to Backup-Sw\r\n              string \"Using \"    delimited by size\r\n                     Script-Name delimited by space into Batch-Text\r\n     end-if\r\n*>\r\n*>\r\n*> 22/03/18 New code (from stock).\r\n*>\r\n*> Check to see if WS-Calling-Data set to auto to run a program (st0020 or st040).\r\n*>  A field within takes on the value of param 2 that is supplied when calling\r\n*>   stock where param 1 must be one of the following :\r\n*>     ACAS_LEDGERS=path   OR 'NONE' OR 'NO' OR 'NULL' (Case dont care),\r\n*>         where param 2 must be xl150 or ? (case dont care).\r\n*>",
        "line": 71
      },
      {
        "type": "IF",
        "condition": "WS-CD-Args (1:5) = \"xl150\"\r\n              move     \"xl150\"    to WS-Called\r\n              move     \"purchase\" to WS-Caller\r\n              move     zeros      to WS-Term-Code\r\n              move     spaces     to WS-Del-Link\r\n              move     zero       to WS-Process-Func\r\n              move     zero       to WS-Sub-Function\r\n              perform  Load00\r\n              go to    Pre-OverRewrite\r\n     end-if\r\n*>\r\n     move     zeros to ws-Process-Func ws-Sub-Function.\r\n     if       menu-reply = \"A\"            *> menu run for 1st time in run unit ONLY\r\n              go to load01.\r\n*>\r\n display-menu.\r\n     display  usera at 0101 with erase eos foreground-color 3.\r\n     move     to-day to u-date.\r\n     move     \"purchase\" to ws-caller.\r\n     move     spaces to ws-called ws-del-link menu-reply.\r\n     move     zeros to ws-term-code.\r\n     move     maps-ser-nn to curs2.\r\n     display  maps-ser-xx at 2474 with foreground-color 3.\r\n     display  curs2 at 2476 with foreground-color 3.\r\n     display  \"Copyright (c) 1976-\" at 2401 with foreground-color 3.\r\n     display  wse-year at 2420 with foreground-color 3.\r\n     display  \" Applewood Computers\" at 2424 with foreground-color 3.\r\n*>\r\n Conv-date.\r\n*>\r\n*> Convert from UK to selected form\r\n*>\r\n     if       Date-Form not > zero and < 4\r\n              move 1 to Date-Form.\r\n     if       Date-USA\r\n              move u-date to ws-date\r\n              move ws-days to ws-swap\r\n              move ws-month to ws-days\r\n              move ws-swap to ws-month\r\n              move ws-date to u-date\r\n     end-if\r\n     if       Date-Intl\r\n              move \"ccyy/mm/dd\" to ws-date   *> swap Intl to UK form\r\n              move u-date (7:4) to ws-Intl-Year\r\n              move u-date (4:2) to ws-Intl-Month\r\n              move u-date (1:2) to ws-Intl-Days\r\n              move ws-date to u-date\r\n     end-if.\r\n*>\r\n conv-date-end.\r\n     display  u-date at 0171 with foreground-color 3.\r\n*>\r\n display-go.\r\n*>\r\n     display  prog-name at 0301 with foreground-color 2.\r\n     display  \"Purchase Ledger System Menu\" at 0326 with foreground-color 2.\r\n*>\r\n     accept   wsb-time from time.\r\n     if       wsb-time not = \"00000000\"\r\n              move wsb-hh to wsd-hh\r\n              move wsb-mm to wsd-mm\r\n              move wsb-ss to wsd-ss\r\n              display \"at \"    at 0355 with foreground-color 2\r\n              display wsd-time at 0358 with foreground-color 2.\r\n*>\r\n     accept   wsa-date from date.\r\n     if       wsa-date not = \"000000\"\r\n              move wsa-yy to u-year\r\n              move wsa-mm to u-month\r\n              move wsa-dd to u-days\r\n              display \"on \" at 0367 with foreground-color 2\r\n              perform conv-date\r\n              display u-date at 0370 with foreground-color 2.\r\n*>\r\n     display  \"Select one of the following by letter  :- [ ]\" at 0601 with foreground-color 2.\r\n*>\r\n     display  \"(A)  Date Entry\"                   at 1004 with foreground-color 2.\r\n     display  \"(B)  Supplier File Maintenance\"    at 1104 with foreground-color 2.\r\n     display  \"(C)  Purchase Ledger Enquiry\"      at 1204 with foreground-color 2.\r\n     display  \"(D)  Purchase Transactions Input\"  at 1304 with foreground-color 2.\r\n     display  \"(E)  Purchase Transactions Amend\"  at 1404 with foreground-color 2.\r\n     display  \"(F)  Purchase Transactions Delete\" at 1504 with foreground-color 2.\r\n     display  \"(G)  Purchase Transactions Proof\"  at 1604 with foreground-color 2.\r\n     display  \"(H)  Purchase Transactions Post\"   at 1704 with foreground-color 2.\r\n     display  \"(I)  Payment Input\"                at 1804 with foreground-color 2.\r\n     display  \"(J)  Payment Amend\"                at 1904 with foreground-color 2.\r\n     display  \"(K)  Payment Proof\"                at 2004 with foreground-color 2.\r\n     display  \"(L)  Payment Post\"                 at 2104 with foreground-color 2.\r\n     display  \"(M)  Set-Up Purchase Analysis Codes\" at 2204 with foreground-color 2.\r\n     display  \"(N)  Purchase Analysis Report\"     at 1044 with foreground-color 2.\r\n     display  \"(O)  Purchase Day Book\"            at 1144 with foreground-color 2.\r\n     display  \"(P)  Aged Creditors Report\"        at 1244 with foreground-color 2.\r\n     display  \"(Q)  Alphabetical Supplier List\"   at 1344 with foreground-color 2.\r\n     display  \"(R)  Supplier Turnover Report\"     at 1444 with foreground-color 2.\r\n     display  \"(S)  Payments System\"              at 1544 with foreground-color 2.\r\n     display  \"(T)  End Of Cycle Processing\"      at 1644 with foreground-color 2.\r\n     display  \"(U)  Transaction Sub-System\"       at 1744 with foreground-color 2.\r\n     display  \"(V)  Supplier File Dump\"           at 1844 with foreground-color 2.\r\n     display  \"(X)  Exit to \"                     at 1944 with foreground-color 2.\r\n     display  op-display                          at 1957 with foreground-color 2.\r\n     display  batch-text                          at 2049 with foreground-color 2.\r\n*>     display  \"(Y)  File Fix Up\"                at 2144 with foreground-color 2.\r\n     if       Param-Restrict not = \"Y\"\r\n              display  \"(Z)  System Set Up\"       at 2244 with foreground-color 2.\r\n*>\r\n accept-loop.\r\n*>\r\n     accept   menu-reply at 0644 with foreground-color 6 auto UPPER.\r\n*>\r\n     if       menu-reply = \"X\"\r\n              go to pre-overrewrite.\r\n*>\r\n     if       menu-reply = \"Z\" and\r\n              Param-Restrict = \"Y\"\r\n              display  \"Not permitted\" at 2331 with foreground-color 2\r\n              go to display-menu.\r\n*>\r\n     move     zero to z.\r\n     move     letters-upper  to  letters.\r\n     set      q  to  1.\r\n     search   a-entry\r\n              when  a-entry (q) = menu-reply\r\n              set z to q.\r\n     if       z = zero\r\n              go to accept-loop.\r\n     go       to load-it.\r\n*>\r\n call-system-setup.\r\n*>*****************\r\n*>\r\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.  *> Force Cobol proc.\r\n     move     zero to ws-term-code.\r\n     move     1 to File-Key-No.\r\n     perform  System-Open.\r\n     perform  System-Rewrite.                           *> in case of any changes\r\n     move     4 to File-Key-No.\r\n     move     WS-System-Record-4 to System-Record.\r\n     perform  System-Rewrite.         *> In case of any changes\r\n     perform  System-Close.\r\n     move     \"sys002\" to ws-called.\r\n     call     ws-called using ws-calling-data file-defs.\r\n     if       ws-term-code > 7\r\n              stop run.\r\n     go       to Open-System.\r\n*>\r\n pre-overrewrite.\r\n     if       not Backup-Script-Found\r\n              go to overrewrite.\r\n*>\r\n     if       Linux or Unix or Mac\r\n              string \"nohup \" delimited by size\r\n                      Run-Backup delimited by space\r\n                    \" 0</dev/null &>/dev/null &\" delimited by size into Full-Backup-Script\r\n              end-string\r\n     else\r\n      if      Dos or Windows\r\n              move Script-Name to Full-Backup-Script\r\n      else\r\n       if     OS2\r\n              move Script-Name to Full-Backup-Script.\r\n     perform  overrewrite.\r\n     call     \"SYSTEM\" using Full-Backup-Script.\r\n     goback.\r\n*>\r\n overrewrite.                                    *> save to RDB or file.\r\n     if       File-System-Used NOT = zero        *> Force RDB processing\r\n              move     \"66\" to FA-RDBMS-Flat-Statuses\r\n              move     1 to File-Key-No\r\n              perform  System-Open\r\n              move     1 to File-Key-No\r\n              move     System-Record to WS-Temp-System-Rec\r\n              perform  System-Rewrite            *> In case of any changes\r\n              move     4 to File-Key-No\r\n              move     WS-System-Record-4 to System-Record\r\n              perform  System-Rewrite            *> In case of any changes\r\n              perform  System-Close\r\n              move     WS-Temp-System-Rec to System-Record\r\n     end-if.\r\n*>\r\n*> Now do the same for the Cobol file.\r\n*>\r\n     move     zeros to File-System-Used\r\n                       File-Duplicates-In-Use.\r\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.   *> Force Cobol proc.\r\n     move     1 to File-Key-No.\r\n     perform  System-Open.                       *> Open cobol file params as I/O\r\n     move     1 to File-Key-No.\r\n     move     System-Record to WS-Temp-System-Rec\r\n     perform  System-Rewrite.                    *> Update Cobol file params\r\n     move     4 to File-Key-No.\r\n     move     WS-System-Record-4 to System-Record.\r\n     perform  System-rewrite.                    *> Update Cobol file sys totals\r\n     move     WS-Temp-System-Rec to System-Record\r\n     perform  System-Close.                      *> Close the Cobol param file.\r\n*>\r\n overclose.\r\n     goback.\r\n*>\r\n load-it.\r\n*>*******\r\n*>\r\n     move     space to menu-reply.\r\n     go       to load01 load02 load03 load04 load05 load06 load07\r\n                 load08 load09 load10 load11 load12 load13 load14\r\n                 load15 load16 load17 load18 load19 load20 load21\r\n                 load22 loader loader loadsr call-system-setup\r\n              depending on z.\r\n*>\r\n loader.\r\n*>-------\r\n*>\r\n     go       to display-menu.\r\n*>\r\n load00.\r\n*>------\r\n*>\r\n     move     zero to ws-term-code.\r\n     call     ws-called using ws-calling-data\r\n                              system-record\r\n                              to-day\r\n                              file-defs\r\n     end-call\r\n     if       ws-term-code < 8\r\n        and   (ws-called = \"pl000\" or \"pl020\" or \"pl030\" or \"pl080\" or \"pl085\"\r\n                        or \"pl090\" or \"pl090\" or \"pl100\" or \"pl115\" or \"pl180\"\r\n                        or \"pl190\")\r\n              perform overrewrite.     *> Update sys4 and system recs in case of changes.\r\n     if       ws-term-code > 7      *> Got a serious (reported) error\r\n              go to overrewrite.\r\n*>\r\n load00-exit.\r\n*>\r\n     go       to display-menu.\r\n*>\r\n load000.\r\n*>------\r\n*>\r\n     move     zero to ws-term-code.\r\n     call     ws-called using ws-calling-data\r\n                              system-record\r\n                              WS-system-record-4\r\n                              to-day\r\n                              file-defs\r\n     end-call\r\n     if       ws-term-code < 8  *> for pl055 & 060, xl150\r\n              perform overrewrite.    *> Update sys4 and system recs in case of changes.\r\n     if       ws-term-code > 7      *> Got a serious (reported) error\r\n              go to overrewrite.\r\n*>\r\n load000-exit.\r\n*>\r\n     go       to display-menu.\r\n*>\r\n load01.\r\n*>------\r\n*>\r\n     move     \"pl000\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load02.\r\n*>------\r\n*>\r\n     move     \"pl010\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load03.\r\n*>-------\r\n*>\r\n     move     \"pl015\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load04.\r\n*>------\r\n*>\r\n     move     \"pl020\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load05.\r\n*>------\r\n*>\r\n     move     \"pl030\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load06.\r\n*>------\r\n*>\r\n     move     \"pl040\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load07.\r\n*>------\r\n*>\r\n     move     \"pl050\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load08.\r\n*>------\r\n*>\r\n *>    move     \"pl830\" to WS-Called.   *> In case autogen is use\r\n *>    perform  load000.\r\n *>    if       ws-term-code not = zero\r\n *>             go to display-menu.\r\n     move     \"pl055\" to ws-called.\r\n     perform  load000.\r\n     move     \"pl060\" to ws-called.\r\n     go       to load000.\r\n*>\r\n load09.   *> Pay enter\r\n*>------\r\n*>\r\n     move     \"pl080\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load10.   *> pay Amend\r\n*>------\r\n*>\r\n     move     \"pl085\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load11.\r\n*>------\r\n*>\r\n     if       FS-Cobol-Files-Used    *> well use fn-Read-By-Batch (32)\r\n              move     \"pl090\" to ws-called\r\n              perform  load00\r\n     end-if\r\n     move     \"pl095\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load12.\r\n*>------\r\n*>\r\n     move     \"pl100\" to ws-called.\r\n     go       to load000.\r\n*>\r\n load13.\r\n*>------\r\n*>\r\n     move     \"pl070\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load14.\r\n*>------\r\n*>\r\n     move     \"pl130\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load15.\r\n*>------\r\n*>\r\n     move     \"pl140\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load16.\r\n*>------\r\n*>\r\n*>  THIS MAY NEED changing when using RDB call by custname etc. (33)\r\n*>\r\n     move     zero to error-code.\r\n     move     \"pl165\" to ws-called.        *> Purchase name sort\r\n     perform  load00.\r\n     move     \"Y\" to oi-5-flag.\r\n     move     \"pl115\" to ws-called.        *> OTM5 sort\r\n     perform  load00.\r\n     if       error-code = zero\r\n              move  \"pl120\" to ws-called   *> Aged anal report\r\n              go  to load000.\r\n     go       to display-menu.\r\n*>\r\n load17.\r\n*>------\r\n*>\r\n     if       FS-Cobol-Files-Used    *> well use fn-Read-By-Name (31)\r\n              move  \"pl165\" to ws-called   *> purch file name sort\r\n              perform load00\r\n     end-if\r\n     move     \"pl160\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load18.\r\n*>------\r\n*>\r\n     move     \"pl170\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load19.\r\n*>------\r\n*>\r\n     move     \"pl900\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load20.\r\n*>------\r\n*>\r\n     if       ws-term-code = 3\r\n              go to load20a.\r\n*>\r\n     move     \"pl140\" to ws-called.\r\n     perform  load00.\r\n*>\r\n load20a.\r\n*>\r\n     move     \"xl150\" to ws-called.\r\n     perform  load000.\r\n     if       ws-term-code = 2 or 3\r\n              go to display-menu.\r\n     if       ws-term-code = 1\r\n              move \"pl130\" to ws-called\r\n              perform load00\r\n              move zero to ws-term-code\r\n              go to load20a.\r\n*>\r\n     go       to display-menu.\r\n*>\r\n load21.\r\n*>------\r\n*>\r\n     move     \"pl180\" to ws-called.\r\n     go       to load00.\r\n*>\r\n load22.\r\n*>------\r\n*>\r\n     move     \"pl190\" to ws-called.\r\n     go       to load00.\r\n*>\r\n loadsr.\r\n*>------\r\n*>\r\n     display  \"Sorry not available\" at 2331 with foreground-color 2.\r\n     go       to accept-loop.\r\n*>\r\n main-exit.\r\n     goback.\r\n*>\r\n copy \"Proc-Get-Env-Set-Files.cob\".\r\n*>\r\n zz060-Convert-Date        section.\r\n*>********************************\r\n*>\r\n*>  Converts date in binary to UK/USA/Intl date format\r\n*>****************************************************\r\n*> Input:   u-bin\r\n*> output:  ws-date as uk/US/Inlt date format\r\n*>          u-date & ws-Date = spaces if invalid date\r\n*>\r\n     perform  maps04.\r\n     if       u-date = spaces\r\n              move spaces to ws-Date\r\n              go to zz060-Exit.\r\n     move     u-date to ws-date.\r\n*>\r\n     if       Date-Form = zero\r\n              move 1 to Date-Form.\r\n     if       Date-UK\r\n              go to zz060-Exit.\r\n     if       Date-USA                *> swap month and days\r\n              move ws-days to ws-swap\r\n              move ws-month to ws-days\r\n              move ws-swap to ws-month\r\n              go to zz060-Exit.\r\n*>\r\n*> So its International date format\r\n*>\r\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\r\n     move     u-date (7:4) to ws-Intl-Year.\r\n     move     u-date (4:2) to ws-Intl-Month.\r\n     move     u-date (1:2) to ws-Intl-Days.\r\n*>\r\n zz060-Exit.\r\n     exit     section.\r\n*>\r\n maps04       section.\r\n*>*******************\r\n*>\r\n     call     \"maps04\"  using  maps03-ws.\r\n*>\r\n maps04-exit.\r\n     exit     section.\r\n*>\r\n copy \"Proc-ACAS-FH-Calls.cob\".\r\n*>",
        "line": 458
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 7,
    "cognitive": 2,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 94,
      "totalOperators": 86,
      "totalOperands": 172,
      "vocabulary": 95,
      "length": 258,
      "volume": 1695.0227469493846
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
