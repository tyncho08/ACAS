{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl050.cbl",
  "fileName": "pl050.cbl",
  "timestamp": "2025-09-15T16:25:46.925Z",
  "programId": "pl050",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 97
      },
      {
        "name": "file",
        "line": 111
      },
      {
        "name": "working-storage",
        "line": 117
      },
      {
        "name": "linkage",
        "line": 319
      },
      {
        "name": "init01",
        "line": 334
      },
      {
        "name": "headings",
        "line": 495
      },
      {
        "name": "analysis-print",
        "line": 521
      },
      {
        "name": "extra-analysis",
        "line": 557
      },
      {
        "name": "total-report",
        "line": 576
      },
      {
        "name": "compute-vatcodes",
        "line": 591
      },
      {
        "name": "zz060-Convert-Date",
        "line": 604
      },
      {
        "name": "exit",
        "line": 637
      },
      {
        "name": "zz070-Convert-Date",
        "line": 639
      },
      {
        "name": "exit",
        "line": 667
      },
      {
        "name": "maps04",
        "line": 669
      },
      {
        "name": "exit",
        "line": 675
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 101
      },
      {
        "name": "file-defs",
        "line": 331
      },
      {
        "name": "Menu-Return",
        "line": 346
      },
      {
        "name": "loop",
        "line": 368
      },
      {
        "name": "main-end",
        "line": 467
      },
      {
        "name": "menu-call",
        "line": 492
      },
      {
        "name": "main12",
        "line": 498
      },
      {
        "name": "end-if",
        "line": 512
      },
      {
        "name": "cont-hds",
        "line": 514
      },
      {
        "name": "zz060-Exit",
        "line": 636
      },
      {
        "name": "zz070-Exit",
        "line": 666
      },
      {
        "name": "maps04-exit",
        "line": 674
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 352,
        "type": "DYNAMIC",
        "using": [
          "File-26",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "PL120",
          "at",
          "0501",
          "with",
          "foreground-color",
          "4",
          "if",
          "WS-Caller",
          "not",
          "=",
          "\"xl150\"",
          "accept",
          "ws-reply",
          "at",
          "0563",
          "with",
          "foreground-color",
          "6",
          "end-if",
          "goback"
        ]
      },
      {
        "target": "SYSTEM",
        "line": 490,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "maps04",
        "line": 672,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 87,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 96,
        "replacing": null
      },
      {
        "name": "selpl",
        "line": 104,
        "replacing": null
      },
      {
        "name": "selpinv",
        "line": 105,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 106,
        "replacing": null
      },
      {
        "name": "fdpl",
        "line": 114,
        "replacing": null
      },
      {
        "name": "fdpinv",
        "line": 115,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 116,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 120,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 121,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 122,
        "replacing": null
      },
      {
        "name": "wspl",
        "line": 126,
        "replacing": null
      },
      {
        "name": "wsfdpinv",
        "line": 127,
        "replacing": null
      },
      {
        "name": "wspinv",
        "line": 179,
        "replacing": null
      },
      {
        "name": "plwspinv",
        "line": 180,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 206,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 322,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 323,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 324,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 677,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "varying",
        "thru": null,
        "line": 337
      },
      {
        "target": "*>",
        "thru": null,
        "line": 339
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 342
      },
      {
        "target": "Purch-Open-Input",
        "thru": null,
        "line": 361
      },
      {
        "target": "PInvoice-Open-Input",
        "thru": null,
        "line": 362
      },
      {
        "target": "headings",
        "thru": null,
        "line": 366
      },
      {
        "target": "PInvoice-Read-Next",
        "thru": null,
        "line": 369
      },
      {
        "target": "Purch-Read-Indexed",
        "thru": null,
        "line": 386
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 397
      },
      {
        "target": "headings",
        "thru": null,
        "line": 456
      },
      {
        "target": "analysis-print",
        "thru": null,
        "line": 463
      },
      {
        "target": "extra-analysis",
        "thru": null,
        "line": 464
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 469
      },
      {
        "target": "PInvoice-Close",
        "thru": null,
        "line": 470
      },
      {
        "target": "main12",
        "thru": null,
        "line": 472
      },
      {
        "target": "total-report",
        "thru": null,
        "line": 477
      },
      {
        "target": "compute-vatcodes",
        "thru": null,
        "line": 487
      },
      {
        "target": "PInvoice-Read-Next",
        "thru": null,
        "line": 524
      },
      {
        "target": "headings",
        "thru": null,
        "line": 552
      },
      {
        "target": "headings",
        "thru": null,
        "line": 561
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 613
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 335
      },
      {
        "from": "spaces",
        "to": "print-out",
        "line": 336
      },
      {
        "from": "prog-name",
        "to": "l1-version",
        "line": 341
      },
      {
        "from": "ws-date",
        "to": "l1-date",
        "line": 343
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 344
      },
      {
        "from": "zero",
        "to": "j",
        "line": 365
      },
      {
        "from": "WS-PInvoice-Record",
        "to": "PInvoice-Header",
        "line": 373
      },
      {
        "from": "zero",
        "to": "l",
        "line": 382
      },
      {
        "from": "ih-supplier",
        "to": "WS-Purch-Key  l5-cust",
        "line": 383
      },
      {
        "from": "space",
        "to": "ws-reply",
        "line": 385
      },
      {
        "from": "\"X\"",
        "to": "ws-reply",
        "line": 388
      },
      {
        "from": "1",
        "to": "ws-error\n     else     move purch-name  to  l5-name",
        "line": 392
      },
      {
        "from": "ih-invoice",
        "to": "l5-nos",
        "line": 395
      },
      {
        "from": "ih-date",
        "to": "u-bin",
        "line": 396
      },
      {
        "from": "ws-date",
        "to": "l5-date",
        "line": 398
      },
      {
        "from": "ih-deduct-amt",
        "to": "ws-deduct-amt",
        "line": 400
      },
      {
        "from": "spaces",
        "to": "lb-a  lb-code\n              move  zero    to  lb-amount\n     else\n              move  \"Prompt Pay  \"  to  lb-a\n              move  spaces          to  lb-code\n              move  ws-deduct-amt   to  lb-amount",
        "line": 412
      },
      {
        "from": "spaces",
        "to": "ld-a  ld-code  ld-c\n              move  zero   to ld-amount  ld-vat\n     else\n              move  \"Carriage    \"  to  ld-a\n              move  spaces          to  ld-code  ld-c\n              move  ih-carriage     to  ld-amount\n              if    ih-c-vat = zero\n                    move  zero  to  ld-vat\n              else\n                    move  1  to  ld-vat",
        "line": 420
      },
      {
        "from": "ih-type",
        "to": "a",
        "line": 431
      },
      {
        "from": "\"Receipt\"",
        "to": "l5-type\n     else\n              if    ih-type = 2\n                    move  \"Invoice\"  to  l5-type\n              else\n                    move  \"Cr",
        "line": 434
      },
      {
        "from": "ih-net",
        "to": "l5-goods",
        "line": 443
      },
      {
        "from": "\"Y\"",
        "to": "Print-Out",
        "line": 461
      },
      {
        "from": "\"Y\"",
        "to": "first-time",
        "line": 462
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 474
      },
      {
        "from": "zero",
        "to": "a",
        "line": 476
      },
      {
        "from": "\"Y\"",
        "to": "Print-Out",
        "line": 482
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 485
      },
      {
        "from": "j",
        "to": "l3-page",
        "line": 501
      },
      {
        "from": "usera",
        "to": "l3-user",
        "line": 503
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if",
        "line": 507
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 517
      },
      {
        "from": "5",
        "to": "line-cnt",
        "line": 519
      },
      {
        "from": "WS-PInvoice-Record",
        "to": "invoice-line (1)",
        "line": 526
      },
      {
        "from": "\"Analysis\"",
        "to": "la-a\n              move  \"Value\"     to  la-b\n              move  \"Vat Code\"  to  la-c\n              move  \"N\"         to  first-time\n     else\n              move  spaces      to  la-a  la-b  la-c",
        "line": 542
      },
      {
        "from": "spaces",
        "to": "lb-a",
        "line": 566
      },
      {
        "from": "spaces",
        "to": "ld-a",
        "line": 571
      },
      {
        "from": "zero",
        "to": "i",
        "line": 580
      },
      {
        "from": "i",
        "to": "l8-vat-code",
        "line": 595
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 615
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 617
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 620
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 624
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 631
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 647
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 650
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 654
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 661
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "called by xl150 do not stop for any errors.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 18/08/25 vbc - .07 in initialize Total-Group (a) had 4 in it, chg to varying 1 by 1\n*>                    until > 3 - compiler problem ?.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>------------\n*>\n *> copy \"selpl.cob\".\n *> copy \"selpinv.cob\".\n copy \"selprint.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n *> copy \"fdpl.cob\".\n *> copy \"fdpinv.cob\".\n copy \"fdprint.cob\".\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"PL050 (3.02.07)\".\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n*>  EX FDs\n*>\n copy \"wspl.cob\".\n copy \"wsfdpinv.cob\". *> replacing Invoice-Record by WS-PInvoice-Record.\n*>\n*> REMARK OUT, ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n*>     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n*>     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  ws-data.\n     03  test-product.\n         05  filler      pic x.\n             88  il-comment              value \"/\".\n         05  filler      pic x(11).\n     03  ws-reply        pic x.\n     03  ws-error        pic 9           value zero.\n         88  purchase-missing            value 1.\n     03  i               pic 99.\n     03  j               pic 999.\n     03  k               pic 99.\n     03  l               pic 99          value zero.\n     03  first-time      pic x           value \"Y\".\n     03  print-out       pic x           value space.\n     03  a               pic 9           value zero.\n     03  Total-Group                     occurs 3    comp-3.\n         05  total-ded   pic s9(8)v99.\n         05  total-gds   pic s9(8)v99.\n         05  total-car   pic s9(8)v99.\n         05  total-net   pic s9(8)v99.\n         05  total-vat   pic s9(8)v99.\n         05  total-grs   pic s9(8)v99.\n         05  total-cvat  pic s9(8)v99    occurs 3.\n     03  ws-deduct-amt   pic s999v99 comp-3 value zero.\n     03  line-cnt        binary-char        value zero.\n*>\n *> copy \"wspinv.cob\".  *> replacing WS table.\n copy \"plwspinv.cob\".   *> invoice table\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  Error-Messages.\n*> System Wide\n*> Module specific\n     03  PL120          pic x(57) value \"PL120 No Transactions to proof! ...Press return for menu.\".\n*>\n 01  ws-group-lits.\n     03  filler          pic x(17)      value \"Receipts\".\n     03  filler          pic x(17)      value \"Invoices\".\n     03  filler          pic x(17)      value \"Credit Notes\".\n 01  filler  redefines ws-group-lits.\n     03  ws-lit          pic x(17)   occurs 3.\n\n 01  line-1.\n     03  l1-version      pic x(49)       value spaces.\n     03  filler          pic x(75)       value \"Unapplied Purchase Transaction Report\".\n     03  filler          pic x(5)        value \"Page \".\n     03  l3-page         pic zz9.\n*>\n 01  line-2.\n     03  l3-user         pic x(49)       value spaces.\n     03  filler          pic x(37)       value spaces.\n     03  filler          pic x(36)       value spaces.\n     03  l1-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(66)       value\n         \" Number  ---Date--- <------------Supplier------------>    --Type--\".\n     03  filler          pic xxxx        value spaces.\n     03  filler          pic x(62)       value\n         \"     Goods                 <---Net-->  <---Vat-->  <--Gross->\".\n*>\n 01  line-5.\n     03  l5-nos          pic z(7)9b.\n     03  l5-date         pic x(11).\n     03  l5-cust         pic x(9).\n     03  l5-name         pic x(25).\n     03  l5-marker       pic x(4)        value spaces.\n     03  l5-type         pic x(14).\n     03  l5-goods        pic z(6)9.99cr.\n     03  filler          pic x(12)       value spaces.\n     03  l5-net          pic z(6)9.99cr.\n     03  l5-vat          pic z(6)9.99cr.\n     03  l5-gross        pic z(6)9.99cr.\n*>\n 01  line-6.\n     03  filler          pic xxx         value spaces.\n     03  filler          pic x(10)       value \"    Total\".\n     03  l6-lit          pic x(18).\n     03  l6-goods        pic z(6)9.99cr.\n     03  l6-carr         pic z(6)9.99cr.\n     03  l6-net          pic z(6)9.99cr.\n     03  l6-vat          pic z(6)9.99cr.\n     03  l6-gross        pic z(6)9.99cr.\n     03  l6-ded          pic z(6)9.99cr.\n*>\n 01  line-7.\n     03  filler          pic x(36)      value spaces.\n     03  filler          pic x(66)      value\n     \"Goods    Carriage         Net         Vat       Gross  Prompt Pay\".\n*> \"\n 01  line-8.\n     03  filler          pic x(9)        value \"Vat Code\".\n     03  l8-vat-code     pic 9.\n     03  filler          pic xxx         value spaces.\n     03  l8-vat-rate     pic z9.99.\n     03  filler          pic x(5)        value \"%\".\n     03  l8-amount1      pic z(7)9.99cr.\n     03  l8-amount2      pic z(9)9.99cr.\n     03  l8-amount3      pic z(9)9.99cr.\n*>\n 01  line-9.\n     03  filler          pic x(70)       value\n         \"V.A.T. Reconciliation       Receipts       Invoices   Credit Notes\".\n*>\n 01  line-a.\n     03  filler          pic x(46)       value spaces.\n     03  la-a            pic x(12).\n     03  la-code         pic x(6).\n     03  la-b            pic x(8).\n     03  la-amount       pic z(6)9.99cr.\n     03  filler          pic x(2)        value spaces.\n     03  la-c            pic x(9).\n     03  la-vat          pic 9.\n*>\n 01  line-b.\n     03  filler          pic x(46)       value spaces.\n     03  lb-a            pic x(12)       value spaces.\n     03  lb-code         pic x(6).\n     03  lb-b            pic x(8)        value spaces.\n     03  lb-amount       pic z(6)9.99cr.\n*>\n 01  line-d.\n     03  filler          pic x(46)       value spaces.\n     03  ld-a            pic x(12).\n     03  ld-code         pic x(6)        value spaces.\n     03  ld-b            pic x(8)        value spaces.\n     03  ld-amount       pic z(6)9.99cr.\n     03  filler          pic x(2)        value spaces.\n     03  ld-c            pic x(9).\n     03  ld-vat          pic 9.\n*>\n linkage section.\n*>***************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n     move     Print-Spool-Name to PSN.\n     move     spaces to print-out.\n     perform  varying a from 1 by 1 until a > 3\n              initialize Total-Group (a)\n     end-perform\n*>\n     move     prog-name to l1-version.\n     perform  zz070-Convert-Date.\n     move     ws-date to l1-date.\n     move     1  to File-Key-No.\n*>\n Menu-Return.\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Purchase Orders Proof Report\" at 0128  with foreground-color 2.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-26\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    display PL120   at 0501 with foreground-color 4\n                    if     WS-Caller not = \"xl150\"\n                           accept ws-reply at 0563 with foreground-color 6\n                    end-if\n                    goback.                         *> As no transactions.\n*>\n     perform  Purch-Open-Input.   *> open     input  purchase-file  invoice-file.\n     perform  PInvoice-Open-Input.\n     open     output print-file.\n*>\n     move     zero  to  j.\n     perform  headings.\n*>\n loop.\n     perform  PInvoice-Read-Next.  *> read     invoice-file  next record  at end\n     if       FS-Reply not = zero\n              go to  main-end.\n*>\n     move     WS-PInvoice-Record  to  PInvoice-Header.\n*>\n     if       ih-test not = zero\n              go to  loop.\n*>\n*> trap transactions which are already on the sales ledger.\n*>\n     if       applied\n              go to  loop.\n     move     zero  to l.\n     move     ih-supplier  to  WS-Purch-Key  l5-cust.\n*>\n     move     space to ws-reply.\n     perform  Purch-Read-Indexed.  *> read     purchase-file   record invalid key\n     if       FS-Reply not = zero\n              move \"X\" to ws-reply.\n*>\n     if       ws-reply = \"X\"\n              move \"Supplier Unknown\" to l5-name\n              move 1 to ws-error\n     else     move purch-name  to  l5-name.\n*>\n     move     ih-invoice  to  l5-nos.\n     move     ih-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date  to  l5-date.\n*>\n     move     ih-deduct-amt to ws-deduct-amt.\n*>\n     if       ih-type = 3\n              multiply -1 by ih-net\n              multiply -1 by ih-carriage\n              multiply -1 by ih-vat\n              multiply -1 by ih-c-vat.\n*>\n     if       ih-type = 2\n              multiply -1 by ws-deduct-amt.\n*>\n     if       ws-deduct-amt = zero\n              move  spaces  to  lb-a  lb-code\n              move  zero    to  lb-amount\n     else\n              move  \"Prompt Pay  \"  to  lb-a\n              move  spaces          to  lb-code\n              move  ws-deduct-amt   to  lb-amount.\n*>\n     if       ih-carriage = zero\n              move  spaces to ld-a  ld-code  ld-c\n              move  zero   to ld-amount  ld-vat\n     else\n              move  \"Carriage    \"  to  ld-a\n              move  spaces          to  ld-code  ld-c\n              move  ih-carriage     to  ld-amount\n              if    ih-c-vat = zero\n                    move  zero  to  ld-vat\n              else\n                    move  1  to  ld-vat.\n*>\n     move     ih-type to a.\n*>\n     if       ih-type = 1\n              move  \"Receipt\"  to  l5-type\n     else\n              if    ih-type = 2\n                    move  \"Invoice\"  to  l5-type\n              else\n                    move  \"Cr. Note\" to  l5-type.\n*>\n     add      ih-c-vat to total-cvat (a, 1).\n*>\n     move     ih-net  to  l5-goods.\n     add      ih-vat ih-c-vat giving  l5-vat.\n     add      ih-net ih-carriage giving  l5-net.\n     add      ih-vat ih-c-vat ih-net ih-carriage giving l5-gross.\n*>\n     add      ih-net  to  total-gds (a).\n     add      ws-deduct-amt to total-ded (a).\n     add      ih-carriage  to  total-car (a).\n     add      ih-vat  ih-c-vat  to  total-vat (a).\n     add      ih-net ih-carriage to  total-net (a).\n     add      ih-vat ih-c-vat ih-net ih-carriage to total-grs (a).\n*>\n     if       line-cnt > Page-Lines\n              perform headings.\n*>\n     write    print-record  from  line-5 after 2  lines.\n     add      2 to line-cnt.\n*>\n     move     \"Y\" to Print-Out.\n     move     \"Y\" to first-time.\n     perform  analysis-print  ih-lines times.\n     perform  extra-analysis.\n     go       to loop.\n*>\n main-end.\n*>\n     perform  Purch-Close.   *> close    purchase-file invoice-file.\n     perform  PInvoice-Close.\n*>\n     perform  main12 in headings.\n     write    print-record from line-7 after 2.\n     move     spaces to print-record.\n     write    print-record after 1.\n     move     zero to a.\n     perform  total-report 3 times.\n*>\n     if       purchase-missing\n              move \"Warning: Record/s missing in Purchase File\" to print-record\n              write print-record after 2\n              move \"Y\" to Print-Out.\n*>\n     write    print-record from line-9 after 5.\n     move     spaces to print-record.\n     write    print-record after 1.\n     perform  compute-vatcodes 3 times.\n     close    print-file.\n     if       Print-Out = \"Y\"\n              call   \"SYSTEM\" using Print-Report.\n*>\n menu-call.\n     exit     program.\n*>\n headings section.\n*>***************\n*>\n main12.\n*>\n     add      1  to  j.\n     move     j  to  l3-page.\n*>\n     move     usera to  l3-user.\n     if       j not = 1\n              write print-record from line-1 after page\n              write print-record from line-2 after 1\n              move spaces to print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if.\n*>\n cont-hds.\n*>\n     write    print-record  from  line-4 after 1.\n     move     spaces  to  print-record.\n     write    print-record after 1.\n     move     5 to line-cnt.\n*>\n analysis-print          section.\n*>==============================\n*>\n     perform  PInvoice-Read-Next. *> read     invoice-file  next record.\n*>\n     move     WS-PInvoice-Record  to  invoice-line (1).\n     move     il-product (1)  to  test-product.\n     if       il-comment\n              go to  main-exit.\n*>\n     if       ih-type = 3\n              multiply -1 by il-vat (1)\n              multiply -1 by il-net (1).\n*>\n     move     il-pa (1)   to  la-code.\n     move     il-net (1)  to  la-amount.\n     move     il-vat-code (1) to k   la-vat.\n     if       k > zero\n              add il-vat (1) to total-cvat (a, k).\n*>\n     if       first-time = \"Y\"\n              move  \"Analysis\"  to  la-a\n              move  \"Value\"     to  la-b\n              move  \"Vat Code\"  to  la-c\n              move  \"N\"         to  first-time\n     else\n              move  spaces      to  la-a  la-b  la-c.\n*>\n     write    print-record  from  line-a after 1.\n     add      1 to line-cnt.\n     if       line-cnt > Page-Lines\n              perform headings.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n extra-analysis section.\n*>=====================\n*>\n     if       line-cnt > Page-Lines - 2\n              perform headings.\n*>\n     if       lb-a not = spaces\n              write  print-record  from  line-b after 1\n              add 1 to line-cnt\n              move  spaces  to  lb-a.\n*>\n     if       ld-a not = spaces\n              write  print-record  from  line-d after 1\n              add 1 to line-cnt\n              move  spaces  to  ld-a.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n total-report section.\n*>*******************\n*>\n     add      1 to a.\n     move     zero to i.\n     move     total-gds (a) to  l6-goods.\n     move     total-car (a) to  l6-carr.\n     move     total-net (a) to  l6-net.\n     move     total-vat (a) to  l6-vat.\n     move     total-grs (a) to  l6-gross.\n     move     total-ded (a) to  l6-ded.\n     move     ws-lit (a)    to  l6-lit.\n     add      1 to line-cnt.\n     write    print-record from line-6 after 1.\n*>\n compute-vatcodes section.\n*>***********************\n*>\n     add      1 to i.\n     move     i to l8-vat-code.\n     move     vat-rate (i) to l8-vat-rate.\n     move     total-cvat (1, i) to l8-amount1.\n     move     total-cvat (2, i) to l8-amount2.\n     move     total-cvat (3, i) to l8-amount3.\n     write    print-record from line-8 after 1.\n     add      1 to line-cnt.\n*>\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 54
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 5,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 61,
      "totalOperators": 47,
      "totalOperands": 94,
      "vocabulary": 62,
      "length": 141,
      "volume": 839.5416797645494
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
