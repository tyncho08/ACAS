{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/general/gl051.cbl",
  "fileName": "gl051.cbl",
  "timestamp": "2025-09-15T16:25:32.325Z",
  "programId": "gl051",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 104
      },
      {
        "name": "file",
        "line": 117
      },
      {
        "name": "working-storage",
        "line": 124
      },
      {
        "name": "linkage",
        "line": 345
      },
      {
        "name": "gl051-Main",
        "line": 360
      },
      {
        "name": "proof-all",
        "line": 475
      },
      {
        "name": "gl050c",
        "line": 497
      },
      {
        "name": "batch-amendment",
        "line": 826
      },
      {
        "name": "gl050d",
        "line": 962
      },
      {
        "name": "batch-print",
        "line": 1000
      },
      {
        "name": "zz050-Validate-Date",
        "line": 1170
      },
      {
        "name": "exit",
        "line": 1207
      },
      {
        "name": "zz060-Convert-Date",
        "line": 1209
      },
      {
        "name": "exit",
        "line": 1242
      },
      {
        "name": "zz070-Convert-Date",
        "line": 1244
      },
      {
        "name": "exit",
        "line": 1272
      },
      {
        "name": "maps03",
        "line": 1274
      },
      {
        "name": "exit",
        "line": 1280
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 107
      },
      {
        "name": "file-defs",
        "line": 357
      },
      {
        "name": "Menu-Input",
        "line": 363
      },
      {
        "name": "menu-exit",
        "line": 420
      },
      {
        "name": "goback",
        "line": 421
      },
      {
        "name": "get-batch",
        "line": 427
      },
      {
        "name": "end-get-batch",
        "line": 442
      },
      {
        "name": "exit",
        "line": 443
      },
      {
        "name": "accept-money8s2",
        "line": 445
      },
      {
        "name": "accept-money9",
        "line": 455
      },
      {
        "name": "accept-account",
        "line": 465
      },
      {
        "name": "loop",
        "line": 478
      },
      {
        "name": "define-vat-rate",
        "line": 513
      },
      {
        "name": "loop",
        "line": 552
      },
      {
        "name": "read-loop",
        "line": 573
      },
      {
        "name": "accept-date",
        "line": 583
      },
      {
        "name": "get-account",
        "line": 611
      },
      {
        "name": "accept-p-c",
        "line": 632
      },
      {
        "name": "accept-amount",
        "line": 651
      },
      {
        "name": "accept-vat",
        "line": 680
      },
      {
        "name": "vat-amount-input",
        "line": 715
      },
      {
        "name": "accept-narative",
        "line": 738
      },
      {
        "name": "loop-end",
        "line": 759
      },
      {
        "name": "help-outline",
        "line": 765
      },
      {
        "name": "h-o-loop2",
        "line": 773
      },
      {
        "name": "h-o-data",
        "line": 783
      },
      {
        "name": "net",
        "line": 789
      },
      {
        "name": "gross",
        "line": 794
      },
      {
        "name": "get-description",
        "line": 800
      },
      {
        "name": "main-exit",
        "line": 817
      },
      {
        "name": "batch-outline",
        "line": 839
      },
      {
        "name": "b-o-loop2",
        "line": 846
      },
      {
        "name": "b-o-data",
        "line": 856
      },
      {
        "name": "cycle-in",
        "line": 869
      },
      {
        "name": "items-in",
        "line": 890
      },
      {
        "name": "gross-in",
        "line": 902
      },
      {
        "name": "vat-in",
        "line": 913
      },
      {
        "name": "desc-in",
        "line": 927
      },
      {
        "name": "detail-query",
        "line": 940
      },
      {
        "name": "disp-head-skip",
        "line": 979
      },
      {
        "name": "main-exit",
        "line": 986
      },
      {
        "name": "loop",
        "line": 1006
      },
      {
        "name": "get-a-batch",
        "line": 1068
      },
      {
        "name": "headings",
        "line": 1075
      },
      {
        "name": "end-batch",
        "line": 1097
      },
      {
        "name": "get-description",
        "line": 1137
      },
      {
        "name": "zz050-test-date",
        "line": 1201
      },
      {
        "name": "zz050-exit",
        "line": 1206
      },
      {
        "name": "zz060-Exit",
        "line": 1241
      },
      {
        "name": "zz070-Exit",
        "line": 1271
      },
      {
        "name": "maps04-exit",
        "line": 1279
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "maps04",
        "line": 571,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      },
      {
        "target": "SYSTEM",
        "line": 992,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "maps04",
        "line": 1277,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 94,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 103,
        "replacing": null
      },
      {
        "name": "seledger",
        "line": 110,
        "replacing": null
      },
      {
        "name": "selbatch",
        "line": 111,
        "replacing": null
      },
      {
        "name": "selpost",
        "line": 112,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 113,
        "replacing": null
      },
      {
        "name": "fdledger",
        "line": 120,
        "replacing": null
      },
      {
        "name": "fdbatch",
        "line": 121,
        "replacing": null
      },
      {
        "name": "fdpost",
        "line": 122,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 123,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 128,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 129,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 130,
        "replacing": null
      },
      {
        "name": "wsledger",
        "line": 131,
        "replacing": null
      },
      {
        "name": "wsbatch",
        "line": 132,
        "replacing": null
      },
      {
        "name": "wspost",
        "line": 133,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 159,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 162,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 348,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 349,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 350,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 1282,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-convert-date",
        "thru": null,
        "line": 370
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 390
      },
      {
        "target": "get-batch",
        "thru": null,
        "line": 393
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 395
      },
      {
        "target": "gl050c",
        "thru": null,
        "line": 399
      },
      {
        "target": "gl050d",
        "thru": null,
        "line": 402
      },
      {
        "target": "proof-all",
        "thru": null,
        "line": 405
      },
      {
        "target": "gl050d",
        "thru": null,
        "line": 411
      },
      {
        "target": "GL-Batch-Rewrite",
        "thru": null,
        "line": 416
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 417
      },
      {
        "target": "GL-Batch-Read-Indexed",
        "thru": null,
        "line": 438
      },
      {
        "target": "GL-Batch-Read-Next",
        "thru": null,
        "line": 481
      },
      {
        "target": "gl050d",
        "thru": null,
        "line": 491
      },
      {
        "target": "GL-Batch-Rewrite",
        "thru": null,
        "line": 492
      },
      {
        "target": "zz070-convert-date",
        "thru": null,
        "line": 502
      },
      {
        "target": "help-outline",
        "thru": null,
        "line": 505
      },
      {
        "target": "batch-amendment",
        "thru": null,
        "line": 506
      },
      {
        "target": "GL-Nominal-Open-Input",
        "thru": null,
        "line": 511
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 550
      },
      {
        "target": "GL-Posting-Read-Next",
        "thru": null,
        "line": 576
      },
      {
        "target": "zz050-Validate-Date",
        "thru": null,
        "line": 594
      },
      {
        "target": "accept-account",
        "thru": null,
        "line": 615
      },
      {
        "target": "get-description",
        "thru": null,
        "line": 628
      },
      {
        "target": "accept-money8s2",
        "thru": null,
        "line": 663
      },
      {
        "target": "net",
        "thru": null,
        "line": 701
      },
      {
        "target": "gross",
        "thru": null,
        "line": 705
      },
      {
        "target": "accept-money8s2",
        "thru": null,
        "line": 720
      },
      {
        "target": "GL-Posting-Rewrite",
        "thru": null,
        "line": 762
      },
      {
        "target": "GL-Nominal-Read-Indexed",
        "thru": null,
        "line": 807
      },
      {
        "target": "GL-Nominal-Close",
        "thru": null,
        "line": 820
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 821
      },
      {
        "target": "accept-money9",
        "thru": null,
        "line": 907
      },
      {
        "target": "accept-money9",
        "thru": null,
        "line": 921
      },
      {
        "target": "help-outline",
        "thru": null,
        "line": 956
      },
      {
        "target": "zz070-convert-date",
        "thru": null,
        "line": 974
      },
      {
        "target": "GL-Nominal-Open-Input",
        "thru": null,
        "line": 981
      },
      {
        "target": "GL-Posting-Open-Input",
        "thru": null,
        "line": 982
      },
      {
        "target": "batch-print",
        "thru": null,
        "line": 984
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 990
      },
      {
        "target": "GL-Nominal-Close",
        "thru": null,
        "line": 991
      },
      {
        "target": "headings",
        "thru": null,
        "line": 1003
      },
      {
        "target": "GL-Posting-Read-Next",
        "thru": null,
        "line": 1009
      },
      {
        "target": "get-a-batch",
        "thru": null,
        "line": 1019
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 1021
      },
      {
        "target": "get-description",
        "thru": null,
        "line": 1055
      },
      {
        "target": "headings",
        "thru": null,
        "line": 1062
      },
      {
        "target": "GL-Batch-Read-Indexed",
        "thru": null,
        "line": 1071
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 1083
      },
      {
        "target": "headings",
        "thru": null,
        "line": 1113
      },
      {
        "target": "GL-Nominal-Read-Indexed",
        "thru": null,
        "line": 1143
      },
      {
        "target": "GL-Nominal-Read-Indexed",
        "thru": null,
        "line": 1157
      },
      {
        "target": "maps03",
        "thru": null,
        "line": 1204
      },
      {
        "target": "maps03",
        "thru": null,
        "line": 1218
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "RRN",
        "to": "POST-RRN BEFORE PROCESSING             *\n*> The whole issue regarding using RRN needs to be      *\n*>  examined to see if a replacement key should be used *\n*> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ *\n*>  THIS WILL APPLY TO OTHER PROGRAMS THAT USE THE      =\n*>     POSTING FILE {gl050 ]                            =\n*>                                                      *\n*>*******************************************************\n*>\n identification          division",
        "line": 8
      },
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 369
      },
      {
        "from": "ws-date",
        "to": "l3-date",
        "line": 371
      },
      {
        "from": "usera",
        "to": "l3-user",
        "line": 372
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 373
      },
      {
        "from": "zero",
        "to": "z",
        "line": 375
      },
      {
        "from": "zero",
        "to": "save-batch\n              move 1  to  batch-start\n              move 99  to  z\n              perform gl050d",
        "line": 408
      },
      {
        "from": "u-bin",
        "to": "proofed",
        "line": 414
      },
      {
        "from": "1",
        "to": "WS-Ledger ",
        "line": 430
      },
      {
        "from": "amt-wk-pence8s",
        "to": "ws-pence8s",
        "line": 448
      },
      {
        "from": "amt-wk-pds8s",
        "to": "ws-pound8s",
        "line": 449
      },
      {
        "from": "ws-pound8s",
        "to": "amt-wk-pds8s",
        "line": 452
      },
      {
        "from": "ws-pence8s",
        "to": "amt-wk-pence8s",
        "line": 453
      },
      {
        "from": "amt-wk-pds9",
        "to": "ws-pound9",
        "line": 458
      },
      {
        "from": "amt-wk-pence9",
        "to": "ws-pence9",
        "line": 459
      },
      {
        "from": "ws-pound9",
        "to": "amt-wk-pds9",
        "line": 462
      },
      {
        "from": "ws-pence9",
        "to": "amt-wk-pence9",
        "line": 463
      },
      {
        "from": "acc-wk-main",
        "to": "ws-main",
        "line": 468
      },
      {
        "from": "acc-wk-sub",
        "to": "ws-sub",
        "line": 469
      },
      {
        "from": "ws-main",
        "to": "acc-wk-main\n     move     ws-sub   to acc-wk-sub",
        "line": 472
      },
      {
        "from": "1",
        "to": "v",
        "line": 516
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 527
      },
      {
        "from": "entered",
        "to": "u-bin",
        "line": 570
      },
      {
        "from": "post-date",
        "to": "ws-test-date",
        "line": 593
      },
      {
        "from": "ws-test-date",
        "to": "post-date",
        "line": 595
      },
      {
        "from": "zero",
        "to": "trutht\n              display GL011 at 0636 with foreground-color 4\n              go to accept-date",
        "line": 598
      },
      {
        "from": "dr-pc",
        "to": "array-pc\n     else\n              divide post-cr by 100 giving acc-ok\n              move  cr-pc    to  array-pc",
        "line": 606
      },
      {
        "from": "0817",
        "to": "curs2",
        "line": 614
      },
      {
        "from": "acc-ok",
        "to": "account-in",
        "line": 616
      },
      {
        "from": "array-pc",
        "to": "dr-pc\n     else\n              multiply account-in by 100 giving post-cr\n              move  array-pc    to  cr-pc",
        "line": 656
      },
      {
        "from": "1217",
        "to": "curs2",
        "line": 661
      },
      {
        "from": "post-amount",
        "to": "amt-ok8s",
        "line": 662
      },
      {
        "from": "amt-ok8s",
        "to": "post-amount",
        "line": 664
      },
      {
        "from": "space",
        "to": "array-vat",
        "line": 686
      },
      {
        "from": "zero",
        "to": "vat-amount\n              go to accept-narative",
        "line": 709
      },
      {
        "from": "1617",
        "to": "curs2",
        "line": 718
      },
      {
        "from": "vat-amount",
        "to": "amt-ok8s",
        "line": 719
      },
      {
        "from": "amt-ok8s",
        "to": "vat-amount",
        "line": 728
      },
      {
        "from": "14",
        "to": "lin",
        "line": 768
      },
      {
        "from": "54",
        "to": "cole",
        "line": 769
      },
      {
        "from": "54",
        "to": "cole",
        "line": 776
      },
      {
        "from": "80",
        "to": "cole",
        "line": 778
      },
      {
        "from": "zero",
        "to": "we-error",
        "line": 803
      },
      {
        "from": "array-pc",
        "to": "ledger-pc",
        "line": 805
      },
      {
        "from": "255",
        "to": "we-error",
        "line": 809
      },
      {
        "from": "0",
        "to": "trutht\n              display \"Invalid A/C number\" at 0826 with foreground-color 2",
        "line": 814
      },
      {
        "from": "\"N\"",
        "to": "ws-reply",
        "line": 830
      },
      {
        "from": "0",
        "to": "trutht\n              display \" \" at 0801 with erase eol\n              go to  main-exit",
        "line": 835
      },
      {
        "from": "15",
        "to": "lin",
        "line": 842
      },
      {
        "from": "1",
        "to": "cole",
        "line": 849
      },
      {
        "from": "46",
        "to": "cole",
        "line": 851
      },
      {
        "from": "WS-Batch-Nos",
        "to": "display-batch",
        "line": 860
      },
      {
        "from": "0",
        "to": "trutht\n              go to  main-exit",
        "line": 876
      },
      {
        "from": "2020",
        "to": "curs2",
        "line": 905
      },
      {
        "from": "input-gross",
        "to": "amt-ok9",
        "line": 906
      },
      {
        "from": "amt-ok9",
        "to": "input-gross",
        "line": 908
      },
      {
        "from": "2120",
        "to": "curs2",
        "line": 919
      },
      {
        "from": "input-vat",
        "to": "amt-ok9",
        "line": 920
      },
      {
        "from": "amt-ok9",
        "to": "input-vat",
        "line": 922
      },
      {
        "from": "\"N\"",
        "to": "ws-reply",
        "line": 944
      },
      {
        "from": "1",
        "to": "trutht\n     else\n              move   0  to  trutht",
        "line": 948
      },
      {
        "from": "1",
        "to": "cole",
        "line": 953
      },
      {
        "from": "15",
        "to": "lin",
        "line": 954
      },
      {
        "from": "prog-name",
        "to": "l1-prog",
        "line": 965
      },
      {
        "from": "zero",
        "to": "page-nos",
        "line": 967
      },
      {
        "from": "1",
        "to": "trutht",
        "line": 968
      },
      {
        "from": "1",
        "to": "first-time-flag",
        "line": 977
      },
      {
        "from": "zero",
        "to": "actual-gross actual-vat",
        "line": 983
      },
      {
        "from": "1",
        "to": "WS-Ledger",
        "line": 1004
      },
      {
        "from": "batch",
        "to": "l4-batch save-batch WS-Batch-Nos\n              perform get-a-batch\n              move  entered  to  u-bin\n              perform zz060-Convert-Date\n              move ws-date  to  l4-date\n              move description to l4-desc\n              write  print-record  from  line-4  after  2\n              add 2 to line-cnt\n     else\n      if      z = 99\n              then next sentence\n      else\n        if    batch not = WS-Batch-Nos\n              go to  loop",
        "line": 1018
      },
      {
        "from": "post-number",
        "to": "l7-number",
        "line": 1033
      },
      {
        "from": "post-date",
        "to": "l7-date",
        "line": 1035
      },
      {
        "from": "dr-pc",
        "to": "l7-dr-pc",
        "line": 1037
      },
      {
        "from": "cr-pc",
        "to": "l7-cr-pc",
        "line": 1039
      },
      {
        "from": "post-amount",
        "to": "l7-amount",
        "line": 1040
      },
      {
        "from": "vat-amount",
        "to": "l7-vat",
        "line": 1041
      },
      {
        "from": "zero",
        "to": "l7-vat-ac  l7-vat-pc\n     move     spaces       to  l7-side",
        "line": 1042
      },
      {
        "from": "vat-pc",
        "to": "l7-vat-pc",
        "line": 1046
      },
      {
        "from": "post-vat-side",
        "to": "l7-side",
        "line": 1049
      },
      {
        "from": "post-legend",
        "to": "l7-legend",
        "line": 1051
      },
      {
        "from": "99999",
        "to": "WS-Batch-Nos",
        "line": 1073
      },
      {
        "from": "page-nos",
        "to": "l1-page",
        "line": 1079
      },
      {
        "from": "WS-Batch-Nos",
        "to": "l4-batch",
        "line": 1080
      },
      {
        "from": "description",
        "to": "l4-desc",
        "line": 1081
      },
      {
        "from": "entered",
        "to": "u-bin",
        "line": 1082
      },
      {
        "from": "ws-date",
        "to": "l4-date",
        "line": 1084
      },
      {
        "from": "6",
        "to": "line-cnt",
        "line": 1088
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 1094
      },
      {
        "from": "0",
        "to": "batch-status\n              go to  main-exit",
        "line": 1103
      },
      {
        "from": "input-vat",
        "to": "l9-vat",
        "line": 1107
      },
      {
        "from": "actual-gross",
        "to": "l10-amount",
        "line": 1108
      },
      {
        "from": "actual-vat",
        "to": "l10-vat",
        "line": 1109
      },
      {
        "from": "1",
        "to": "batch-status\n     else\n              move  0  to  batch-status",
        "line": 1120
      },
      {
        "from": "\"*********************\"",
        "to": "l11-status",
        "line": 1124
      },
      {
        "from": "\"*********************\"",
        "to": "l11-status",
        "line": 1133
      },
      {
        "from": "zero",
        "to": "we-error",
        "line": 1139
      },
      {
        "from": "post-dr",
        "to": "WS-Ledger-Nos",
        "line": 1140
      },
      {
        "from": "dr-pc",
        "to": "ledger-pc",
        "line": 1141
      },
      {
        "from": "1",
        "to": "we-error",
        "line": 1145
      },
      {
        "from": "spaces",
        "to": "dr-error\n     else\n              move  \"^^^^^^^^^^\"  to  dr-error\n              move  0  to  trutht",
        "line": 1148
      },
      {
        "from": "zero",
        "to": "we-error",
        "line": 1153
      },
      {
        "from": "post-cr",
        "to": "WS-Ledger-Nos",
        "line": 1154
      },
      {
        "from": "cr-pc",
        "to": "ledger-pc",
        "line": 1155
      },
      {
        "from": "1",
        "to": "we-error",
        "line": 1159
      },
      {
        "from": "spaces",
        "to": "cr-error\n     else\n              move  \"^^^^^^^^^^\"  to  cr-error\n              move  0  to  trutht",
        "line": 1162
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 1183
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1185
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 1189
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 1196
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 1202
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 1203
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 1220
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 1222
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1225
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 1229
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1236
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 1252
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1255
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 1259
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1266
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "a replacement key should be used *\n*> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ *\n*>  THIS WILL APPLY TO OTHER PROGRAMS THAT USE THE      =\n*>     POSTING FILE {gl050 ]                            =\n*>                                                      *\n*>*******************************************************\n*>\n identification          division.\n*>===============================\n*>\n*>**\n      Program-Id.         gl051.\n*>**\n*>    Author.             GL was written by Simon Whine MBCS, on behalf of\n*>                        Applewood Computers and its group of Companies.\n*>                        All changes/migrations by:\n*>                        Vincent B. Coen FBCS, FIDM, FIDPM.\n*>                        Converted To Cis December 84,\n*>                        For Applewood Computers.\n*>                        Written to supplement IRS to support larger numbers for\n*>                        accounts to 10 digits nominal and subnominals and money\n*>                        amounts to 100M - 1 for customers requiring a\n*>                        comparable? but cheaper product than Oracle financials.\n*>                        Reduced down some point later in time for accnts 6\n*>                        digits and reduced money amounts.\n*>**\n*>    Security.           Copyright (C) 1976-2025 & later, Vincent Bryan Coen.\n*>                        Distributed under the GNU General Public License.\n*>                        See the file COPYING for details.\n*>**\n*>    Remarks.            Batch/Posting Amendment/Reporting.\n*>**\n*>    Version.            See Prog-Name In Ws.\n*>**\n*>    Modules Called.     maps04.\n*>**\n*>    Error messages used.\n*>                        GL011 Invalid Date\n*> Module specific:\n*>                        GL052 Invalid. Too early\n*>                        GL053 Invalid. Too forward\n*>                        GL054 No check on items\n*>                        GL055 Invalid code\n*>**\n*>    Changes:\n*> 29/01/09 vbc - Migration to Open Cobol.\n*> 29/05/09 vbc - Support for Page-Lines instead of fixed number.\n*> 07/09/10 vbc - .03 Mod lpr.\n*> 19/12/11 vbc - .04 Support for dates other than UK & clean up msgs\n*>                    Error msgs to GLnnn,\n*>                    Support for path+filenames.\n*> 24/10/16 vbc - .   ALL programs now using wsnames.cob in copybooks\n*> 13/01/18 vbc - .05 Updated for v3.02 & FH & DALs.\n*> 30/05/18 vbc - .06 Renamed all warning & error msgs also in Manual.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>------------\n*>\n*> copy \"seledger.cob\".\n*> copy \"selbatch.cob\".\n*> copy \"selpost.cob\".\n copy \"selprint.cob\".\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdledger.cob\".\n*> copy \"fdbatch.cob\".\n*> copy \"fdpost.cob\".\n copy \"fdprint.cob\".\n working-storage section.\n*>----------------------\n*>\n 77  prog-name           pic x(15)    value \"gl051 (3.02.06)\".\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n copy \"wsledger.cob\".\n copy \"wsbatch.cob\".\n copy \"wspost.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n*>     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n*>     03  WS-Ledger-Record       pic x.\n*>     03  WS-Posting-Record      pic x.\n*>     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  accept-terminator-array pic 9(4).\n         copy \"screenio.cpy\".\n 01  filler.\n     03  ws-menu             pic 9.\n     03  display-batch       pic z(4)9.\n     03  display-vat         pic z9.99.\n     03  line-cnt            binary-char      value zero.\n     03  page-nos            binary-char      value zero.\n     03  batch-in            pic 9(5).\n     03  a                   pic 99.\n     03  v                   pic 9.\n     03  y                   pic 99.\n     03  z                   pic 99.\n     03  first-time-flag     pic 9            value zero.\n     03  save-batch          pic 9(5)   comp  value zero.\n     03  trutht              pic 9.\n         88  falset                           value zero.\n         88  truet                            value 1.\n     03  account-in          pic 9(4)v99.\n     03  array-pc            pic 99.\n     03  array-vat           pic x.\n     03  ws-reply            pic x.\n     03  display-amt         pic 9(8).99-.\n     03  ws-vat-rate         pic 99v99  comp   value zero.\n     03  vat-flag            pic 9             value zero.\n     03  vat-flag-2          pic 9             value zero.\n 01  ws-account-screen-display.\n     03  ws-maind        pic 9(4).\n     03  ws-period1      pic x     value \".\".\n     03  ws-subd         pic v99.\n 01  ws-account-screen-accept redefines ws-account-screen-display.\n     03  ws-main         pic 9(4).\n     03  filler          pic x.\n     03  ws-sub          pic v99.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n*>    03  GL010           pic x(16) value \"GL010 Hit Return\".\n     03  GL011          pic x(18) value \"GL011 Invalid Date\".\n*> Module specific\n    03  GL052           pic x(24) value \"GL052 Invalid. Too early\".\n    03  GL053           pic x(26) value \"GL053 Invalid. Too forward\".\n    03  GL054           pic x(24) value \"GL054 No check on items.\".\n    03  GL055           pic x(22) value \"GL055 Invalid VAT Code\".\n*>\n 01  ws-account-work.\n     03  acc-wk-main     pic 9(4).\n     03  acc-wk-sub      pic v99.\n 01  ws-account-ok redefines ws-account-work.\n     03  acc-ok          pic 9(4)v99.\n*>\n 01  ws-amount-screen-display8s.\n     03  ws-poundsd8s    pic 9(8).\n     03  ws-period8s     pic x     value \".\".\n     03  ws-penced8s     pic v99.\n 01  ws-amount-screen-accept8s redefines ws-amount-screen-display8s.\n     03  ws-pound8s      pic 9(8).\n     03  filler          pic x.\n     03  ws-pence8s      pic v99.\n*>\n 01  ws-amount-work8s.\n     03  amt-wk-pds8s    pic 9(8).\n     03  amt-wk-pence8s  pic v99.\n 01  ws-amount-ok8s redefines ws-amount-work8s.\n     03  amt-ok8s        pic 9(8)v99.\n*>\n 01  ws-amount-screen-display9.\n     03  ws-poundsd9     pic 9(9).\n     03  ws-period9      pic x     value \".\".\n     03  ws-penced9      pic v99.\n 01  ws-amount-screen-accept9 redefines ws-amount-screen-display9.\n     03  ws-pound9       pic 9(9).\n     03  filler          pic x.\n     03  ws-pence9       pic v99.\n*>\n 01  ws-amount-work9.\n     03  amt-wk-pds9     pic 9(9).\n     03  amt-wk-pence9   pic v99.\n 01  ws-amount-ok9 redefines ws-amount-work9.\n     03  amt-ok9         pic 9(9)v99.\n*>\n 01  display-plus-31                value all \"+\".\n     03  display-plus-27 pic x(27).\n     03  display-plus-4  pic xxxx.\n*>\n 01  display-star-46     pic x(46)  value all \"*\".\n 01  ws-spaces              value spaces.\n     03  ws-space-29     pic x(29).\n     03  ws-space-f      pic x(51).\n*>\n 01  line-1.\n     03  l1-prog             pic x(14).\n     03  filler              pic x(41)   value spaces.\n     03  filler              pic x(24)   value \"Transaction Proof Report\".\n     03  filler              pic x(45)   value spaces.\n     03  filler              pic x(6)    value \"Page  \".\n     03  l1-page             pic z9.\n*>\n 01  line-3.\n     03  l3-user             pic x(32).\n     03  filler              pic x(90)   value spaces.\n     03  l3-date             pic x(10).\n*>\n 01  line-4.\n     03  filler              pic x(8)    value \"Batch - \".\n     03  l4-batch            pic z(4)9.\n     03  filler              pic x(8)    value spaces.\n     03  l4-desc             pic x(24).\n     03  filler              pic x(20)   value \"    Date Entered - \".\n     03  l4-date             pic x(10).\n*>\n 01  line-5.\n     03  filler              pic x(110)  value \"Number  Code  ---Date--- --Debit--   --Credit-    Net\" &\n                                               \" Amount    VAT Amount  VAT Account  VAT Side   ----------\".\n     03  filler              pic x(22)   value \"--Narative------------\".\n*>\n 01  line-6.\n     03  filler              pic x(97)   value \"------  ----              A/C  P/C    A/C  P/C    ---\" &\n                                               \"-------    ----------    A/C  P/C   --------\".\n*>\n 01  line-7         value spaces.\n     03  l7-number           pic z(4)9b(4).\n     03  l7-code             pic x(5).\n     03  l7-date             pic x(12).\n     03  l7-dr               pic zzz9.99b.\n     03  l7-dr-pc            pic 99bb.\n     03  l7-cr               pic zzz9.99b.\n     03  l7-cr-pc            pic 99bb.\n     03  l7-amount           pic z(8)9.99bb.\n     03  l7-vat              pic z(8)9.99bb.\n     03  l7-vat-ac           pic zzz9.99  blank when zero.\n     03  l7-vat-pc           pic bz9bbbbbb blank when zero.\n     03  l7-side             pic x(8).\n     03  l7-legend           pic x(32).\n*>\n 01 line-error.\n     03  filler              pic x(24)  value spaces.\n     03  dr-error            pic x(12).\n     03  cr-error            pic x(12).\n*>\n 01  line-8.\n     03  filler              pic x(20)   value spaces.\n     03  filler              pic x(45)   value \"Batch              ----Net----    ----VAT----\".\n*>\n 01  line-9.\n     03  filler              pic x(20)   value spaces.\n     03  filler              pic x(17)   value \"Header\".\n     03  l9-amount           pic z(9)9.99bb.\n     03  l9-vat              pic z(9)9.99bb.\n*>\n 01  line-10.\n     03  filler              pic x(20)   value spaces.\n     03  filler              pic x(17)   value \"Actual\".\n     03  l10-amount          pic z(9)9.99bb.\n     03  l10-vat             pic z(9)9.99bb.\n*>\n 01  line-11.\n     03  filler              pic x(20)   value spaces.\n     03  l11-status          pic x(30).\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n gl051-Main section.\n*>*****************\n*>\n Menu-Input.\n*>*********\n*>\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n     move     Print-Spool-Name to PSN.\n     perform  zz070-convert-date.\n     move     ws-date to l3-date.\n     move     usera to l3-user.\n     move     1  to File-Key-No.\n*>\n     move     zero to z.\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Batch Amendment / Reporting Functions\" at 0123 with foreground-color 2.\n     display  ws-date at 0171 with foreground-color 2.\n     display  usera at 0301 with foreground-color 2.\n     display  \"Select one of the following by number :- [ ]\" at 0801 with foreground-color 2.\n     display  \"(1)  Amend existing Batch\" at 1001        with foreground-color 2.\n     display  \"(2)  Print Proof Reports - All Batches\" at 1101 with foreground-color 2.\n     display  \"(3)  Print Proof Reports - One Batch\" at 1201   with foreground-color 2.\n     display  \"(4)  Print all Transactions\" at 1301  with foreground-color 2.\n     display  \"(9)  Exit to system menu\" at 1601     with foreground-color 2.\n     accept   ws-menu at 0843 with foreground-color 6.\n*>\n     if       ws-menu = 9\n              go to  menu-exit.\n     perform  GL-Batch-Open.           *> open  i-o batch-file.\n*>\n     if       ws-menu = 1  or  3\n              perform  get-batch\n              if    WS-Batch-Nos = zero\n                     perform  GL-Batch-Close                *> close  batch-file\n                     go to  menu-input.\n*>\n     if       ws-menu = 1\n              perform gl050c.\n*>\n     if       ws-menu = 3\n              perform gl050d.\n*>\n     if       ws-menu = 2\n              perform  proof-all.\n*>\n     if       ws-menu = 4\n              move zero to save-batch\n              move 1  to  batch-start\n              move 99  to  z\n              perform gl050d.\n*>\n     if       ws-menu not = 1\n              move  u-bin  to  proofed.\n*>\n     perform  GL-Batch-Rewrite.                *> rewrite  batch-record..\n     perform  GL-Batch-Close.                  *> close    batch-file.\n     go       to menu-input.\n*>\n menu-exit.\n     goback.\n*>\n*>**********************************************\n*>           P R O C E D U R E S               *\n*>**********************************************\n*>\n get-batch.\n*>********\n*>\n     move     1 to  WS-Ledger .\n*>\n     display  \"Enter Batch Number :- [     ]\" at 1801 with foreground-color 2.\n     accept   WS-Batch-Nos at 1824 with foreground-color 6 update.\n*>\n     if       WS-Batch-Nos = zero\n              go to  end-get-batch.\n*>\n     perform  GL-Batch-Read-Indexed.   *> read batch-file  record  invalid key\n     if       fs-reply = 21\n              go to  get-batch.\n*>\n end-get-batch.\n     exit.\n*>\n accept-money8s2.\n*>--------------\n*>\n     move     amt-wk-pence8s to ws-pence8s.\n     move     amt-wk-pds8s   to ws-pound8s.\n     display  ws-amount-screen-display8s at curs2  with foreground-color 3.\n     accept   ws-amount-screen-accept8s at curs2  with foreground-color 3 update.\n     move     ws-pound8s to amt-wk-pds8s.\n     move     ws-pence8s to amt-wk-pence8s.\n*>\n accept-money9.\n*>------------\n*>\n     move     amt-wk-pds9   to ws-pound9.\n     move     amt-wk-pence9 to ws-pence9.\n     display  ws-amount-screen-display9 at curs2 with foreground-color 3.\n     accept   ws-amount-screen-accept9 at curs2  with foreground-color 3 update.\n     move     ws-pound9 to amt-wk-pds9.\n     move     ws-pence9 to amt-wk-pence9.\n*>\n accept-account.\n*>-------------\n*>\n     move     acc-wk-main to ws-main.\n     move     acc-wk-sub  to ws-sub.\n     display  ws-account-screen-display at curs2 with foreground-color 3.\n     accept   ws-account-screen-accept at curs2 with foreground-color 3 update.\n     move     ws-main  to acc-wk-main\n     move     ws-sub   to acc-wk-sub.\n*>\n proof-all               section.\n*>------------------------------\n*>\n loop.\n*>***\n*>\n     perform  GL-Batch-Read-Next.   *> read batch-file  next record  at end\n     if       fs-reply = 10\n              go to  proof-end.\n*>\n     if       bcycle of WS-Batch-Record not = scycle of system-record\n              go to  loop.\n*>\n     if       not  waiting\n              go to  loop.\n*>\n     perform  gl050d.\n     perform  GL-Batch-Rewrite.                *> rewrite  batch-record..\n     go       to loop.\n*>\n proof-end.   exit section.\n*>\n gl050c section.\n*>*************\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"General Ledger - Batch Amendment\" at 0126 with foreground-color 2.\n     perform  zz070-convert-date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n     perform  help-outline  through  h-o-data.\n     perform  batch-amendment.\n*>\n     if       truet\n              go to  main-exit.\n*>\n     perform  GL-Nominal-Open-Input.          *> open input ledger-file.\n*>\n define-vat-rate.\n*>**************\n*>\n     move     1  to  v.\n     display  \"VAT Rate :- [1]\" at 0401 with foreground-color 2.\n     accept   v at 0414 with foreground-color 3 update.\n*>\n     if       v  <  1  or  >  3\n              go to  define-vat-rate.\n*>\n     move     vat-rate (v)  to  display-vat ws-vat-rate.\n     display  display-vat at 0417 with foreground-color 2.\n     display  \"% ok (Y/N) :- [Y]\" at 0422 with foreground-color 6.\n*>\n     move     \"Y\"  to  ws-reply.\n     accept   ws-reply at 0437 with foreground-color 3.\n*>\n     if       ws-reply = \"N\"  or  \"n\"\n              go to  define-vat-rate.\n*>\n     display  \"Batch      - \"  at 0456 with foreground-color 2.\n     display  display-batch    at 0469 with foreground-color 2.\n     display \"/\"               at 0474 with foreground-color 2.\n     display  \"Default    - \"  at 0656 with foreground-color 2.\n     display  bdefault         at 0669 with foreground-color 2.\n     display  \"Contra A/C - \"  at 0856 with foreground-color 2.\n     display  batch-def-ac     at 0869 with foreground-color 2.\n*>\n     if       batch-def-pc not = zero\n              display \"/\"          at 0875 with foreground-color 2\n              display batch-def-pc at 0876 with foreground-color 2.\n*>\n     display  \"Vat A/C    - \" at 1056 with foreground-color 2.\n     display  batch-def-vat   at 1069 with foreground-color 2.\n     display  \"Convention - \" at 1256 with foreground-color 2.\n     display  convention      at 1269 with foreground-color 2.\n*>\n     perform  GL-Posting-Open.            *> open i-o posting-file.\n*>\n loop.\n*>***\n*>\n     display  \"Date           [          ]\"  at 0601  with foreground-color 2.\n     display  \"Account        [       ]\"     at 0801     with foreground-color 2.\n     if       profit-centres\n              display \"Profit Centre  [  ]\"  at 1001  with foreground-color 2.\n     if       branches\n              display \"Branch         [  ]\"  at 1001  with foreground-color 2.\n     display  \"Amount         [           ]\" at 1201 with foreground-color 2.\n     if       auto-vat\n              display \"VAT Code       [ ]  {P or M or space}\"\n                                             at 1401 with foreground-color 2.\n*>\n     display  \"VAT Amount     [           ]\" at 1601 with foreground-color 2.\n     display  \"Narrative      [\"             at 1801 with foreground-color 2.\n     display  \"]\"                            at 1849 with foreground-color 2.\n*>\n*>    move     entered  to  u-bin.\n*>    call     \"maps04\"  using  maps03-ws.\n*>\n read-loop.\n*>********\n*>\n     perform  GL-Posting-Read-Next.      *> read     posting-file  next record  at end\n     if       fs-reply = 10\n              go to  main-exit.\n*>\n     if       batch not = WS-Batch-Nos\n              go to  read-loop.\n*>\n accept-date.\n*>-----------\n*>\n *>    display  post-date at 0617 with foreground-color 3.\n     accept   post-date at 0617 with foreground-color 3 update.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  or  \"q\"\n              go to  main-exit.\n*>\n     move     post-date  to  ws-test-date.\n     perform  zz050-Validate-Date.\n     move     ws-test-date  to  post-date.\n*>\n     if       u-bin = zero\n              move   zero  to  trutht\n              display GL011 at 0636 with foreground-color 4\n              go to accept-date.\n*>\n     display  ws-space-29 at 0626.\n*>\n     if       convention = \"DR\"\n              divide post-dr by 100 giving acc-ok\n              move  dr-pc    to  array-pc\n     else\n              divide post-cr by 100 giving acc-ok\n              move  cr-pc    to  array-pc.\n*>\n get-account.\n*>----------\n*>\n     move     0817 to curs2.\n     perform  accept-account.\n     move     acc-ok to account-in.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP\n                        or = COB-SCR-PAGE-DOWN or COB-SCR-KEY-DOWN\n*> escape-code = \"B\"  or  \"F\"\n       or     z not = zero\n              go to  accept-date.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n     perform  get-description.\n     if       we-error not = zero\n              go to get-account.\n*>\n accept-p-c.\n*>---------\n*>\n     if       not  profit-centres\n       and    not  branches\n              go to  accept-amount.\n*>\n *>    display  array-pc at 1017 with foreground-color 3.\n     accept   array-pc at 1017 with foreground-color 3 update.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP\n           or COB-SCR-KEY-UP\n*> escape-code = \"B\"\n              go to  get-account.\n*>\n     if       cob-crt-status = cob-scr-esc\n*>escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n accept-amount.\n*>------------\n*>\n     if       convention = \"DR\"\n              multiply account-in by 100 giving post-dr\n              move  array-pc    to  dr-pc\n     else\n              multiply account-in by 100 giving post-cr\n              move  array-pc    to  cr-pc.\n*>\n     move     1217 to curs2.\n     move     post-amount to amt-ok8s.\n     perform  accept-money8s2.\n     move     amt-ok8s to post-amount.\n*>\n     if       (cob-crt-status = COB-SCR-PAGE-UP\n           or COB-SCR-KEY-UP)\n*>escape-code = \"B\"\n       and    (not profit-centres  and  not branches)\n              go to  get-account.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP\n*> escape-code = \"B\"\n              go to  accept-p-c.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n accept-vat.\n*>---------\n*>\n     if       not auto-vat\n              go to  vat-amount-input.\n*>\n     move     space  to  array-vat.\n     display  array-vat at 1417 with foreground-color 3.\n     accept   array-vat at 1417 with foreground-color 3 update.\n     move     function upper-case (array-vat) to array-vat.\n     display  \"                  \" at 1439.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP\n*> escape-code = \"B\"\n              go to  accept-amount.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n     if       array-vat = \"P\"\n              perform  net\n              go to vat-amount-input.\n*>\n     if       array-vat = \"M\"\n              perform  gross\n              go to vat-amount-input.\n*>\n     if       array-vat = space\n              move zero to vat-amount\n              go to accept-narative.\n*>\n     display  GL055 at 1439 with foreground-color 2.\n     go       to accept-vat.\n*>\n vat-amount-input.\n*>***************\n*>\n     move     1617 to curs2.\n     move     vat-amount to amt-ok8s.\n     perform  accept-money8s2.\n*>\n     if       amt-ok8s not = vat-amount\n        and   post-amount not = zero\n        and   array-vat = \"M\"\n              add vat-amount to post-amount\n              subtract amt-ok8s from post-amount.\n*>\n     move     amt-ok8s to vat-amount.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP\n*> escape-code = \"B\"\n              go to  accept-vat.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n accept-narative.\n*>\n*>  test for zeros in post & vat,if so kill record ???????\n*>\n     display  \"                  \" at 1439.\n     display  post-legend at 1817 with foreground-color 3.\n     accept   post-legend  at 1817 with foreground-color 3 update.\n*>\n     if       (cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP)\n*> escape-code = \"B\"\n       and    auto-vat\n              go to  accept-vat.\n*>\n     if       cob-crt-status = COB-SCR-PAGE-UP or COB-SCR-KEY-UP\n*> escape-code = \"B\"\n              go to  accept-amount.\n*>\n     if       cob-crt-status = cob-scr-esc\n*> escape-code = \"E\"  OR  \"Q\"\n              go to  main-exit.\n*>\n loop-end.\n*>*******\n*>\n     perform  GL-Posting-Rewrite.           *> rewrite WS-Posting-Record.\n     go       to loop.\n*>\n help-outline.\n*>===========\n*>\n     move     14  to  lin.\n     move     54  to  cole.\n     display  display-plus-27 at 1454.\n     display  display-plus-27 at 2354.\n*>\n h-o-loop2.\n*>\n     add      1  to  lin.\n     move     54 to cole.\n     display  \"+\" at curs with foreground-color 2.\n     move     80 to cole.\n     display  \"+\" at curs with foreground-color 2.\n     if       lin  <  22\n              go to  h-o-loop2.\n*>\n h-o-data.\n*>\n     display  \"Option :- [ ]\" at 1656 with foreground-color 2.\n     display  \"B - Back-up one field\" at 1856 with foreground-color 2.\n     display  \"E - End\" at 1956 with foreground-color 2.\n*>\n net.\n*>==\n*>\n     compute  vat-amount rounded = post-amount * ws-vat-rate / 100.\n*>\n gross.\n*>====\n*>\n     compute  vat-amount rounded = post-amount - (post-amount / ((ws-vat-rate + 100) / 100)).\n     subtract vat-amount  from  post-amount.\n*>\n get-description.\n*>--------------\n*>\n     move     zero  to  we-error.\n     multiply account-in by 100 giving WS-Ledger-Nos.\n     move     array-pc    to  ledger-pc.\n*>\n     perform  GL-Nominal-Read-Indexed.   *> read ledger-file  record  invalid key\n     if       fs-reply = 21\n              move  255  to  we-error.\n*>\n     if       we-error = zero\n              display ledger-name at 0826 with foreground-color 3\n     else\n              move  0  to  trutht\n              display \"Invalid A/C number\" at 0826 with foreground-color 2.\n*>\n main-exit.\n*>********\n*>\n     perform  GL-Nominal-Close.         *> close ledger-file posting-file.\n     perform  GL-Posting-Close.\n*>\n end-routine. exit section.\n*>**********  ****\n*>\n batch-amendment             section.\n*>----------------------------------\n*>\n     display  \"Amend Batch Header ? (Y/N) :- [N]\" at 0801 with foreground-color 2.\n     move     \"N\" to ws-reply.\n     accept   ws-reply at 0832 with foreground-color 6 update.\n     move     function upper-case (ws-reply) to ws-reply.\n*>\n     if       ws-reply = \"N\"\n              move   0  to  trutht\n              display \" \" at 0801 with erase eol\n              go to  main-exit.\n*>\n batch-outline.\n*>============\n*>\n     move     15  to  lin.\n     display  display-star-46 at 1501.\n     display  display-star-46 at 2301.\n*>\n b-o-loop2.\n*>\n     add      1  to  lin.\n     move     1 to cole.\n     display  \"*\" at curs with foreground-color 2.\n     move     46 to cole.\n     display  \"*\" at curs with foreground-color 2.\n     if       lin  <  23\n              go to  b-o-loop2.\n*>\n b-o-data.\n*>\n     display  \"Batch Data\" at 1618 with foreground-color 2.\n     display  \"Batch         :- {     }\"        at 1702 with foreground-color 2.\n     move     WS-Batch-Nos to  display-batch.\n     display  display-batch                     at 1720 with foreground-color 2.\n     display  \"Cycle         :- [  ]\"           at 1802 with foreground-color 2.\n     display  \"Items         :- [  ]\"           at 1902 with foreground-color 2.\n     display  \"Gross Value   :- [            ]\" at 2002 with foreground-color 2.\n     display  \"VAT Value     :- [            ]\" at 2102 with foreground-color 2.\n     display  \"Description   :- [\"              at 2202 with foreground-color 2.\n     display  \"]\"                               at 2244 with foreground-color 2.\n*>\n cycle-in.\n*>*******\n*>\n *>    display  bcycle of WS-Batch-Record at 1820  with foreground-color 3.\n     accept   bcycle of WS-Batch-Record at 1820  with foreground-color 3 update.\n*>\n     if       cob-crt-status = cob-scr-esc\n              move   0  to  trutht\n              go to  main-exit.\n*>\n     if       bcycle of WS-Batch-Record <  scycle of system-record\n              display GL052 at 1824 with foreground-color 2\n              go to cycle-in.\n*>\n     subtract scycle of system-record from bcycle of WS-Batch-Record  giving  y.\n*>\n     if       y  >  1\n              display GL053 at 1824  with foreground-color 2\n              go to cycle-in.\n     display  \"                           \" at 1824.\n*>\n items-in.\n*>*******\n*>\n *>    display  items at 1920 with foreground-color 3.\n     accept   items at 1920 with foreground-color 3 update.\n*>\n     if       cob-crt-status = cob-scr-esc\n              go to  cycle-in.\n*>\n     if       items = zero\n              display GL054 at 1924 with foreground-color 2.\n*>\n gross-in.\n*>*******\n*>\n     move     2020 to curs2.\n     move     input-gross to amt-ok9.\n     perform  accept-money9.\n     move     amt-ok9 to input-gross.\n*>\n     if       cob-crt-status = cob-scr-esc\n              go to  items-in.\n*>\n vat-in.\n*>*****\n*>\n     if       not  auto-vat\n              go to  desc-in.\n*>\n     move     2120 to curs2.\n     move     input-vat to amt-ok9.\n     perform  accept-money9.\n     move     amt-ok9 to input-vat.\n*>\n     if       cob-crt-status = cob-scr-esc\n              go to  gross-in.\n*>\n desc-in.\n*>******\n*>\n *>   display  description at 2220 with foreground-color 3.\n     accept   description at 2220 with foreground-color 3 update.\n*>\n     if       cob-crt-status not = cob-scr-esc\n              go to  detail-query.\n     if       auto-vat\n              go to  vat-in\n     else\n              go to  gross-in.\n*>\n detail-query.\n*>***********\n*>\n     display  \"Amend Batch Details? (Y/N) :- [N]\" at 0801 with foreground-color 2.\n     move     \"N\" to ws-reply.\n     accept   ws-reply  at 0832 with foreground-color 6 update.\n     move     function upper-case (ws-reply) to ws-reply.\n     if       ws-reply = \"N\"\n              move   1  to  trutht\n     else\n              move   0  to  trutht.\n*>\n     display  \" \" at 0801 with erase eol.\n     move     1 to cole.\n     move     15 to lin.\n     display  \" \" at curs with erase eos.\n     perform  help-outline  through  h-o-data.\n     go to    main-exit.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n gl050d section.\n*>*************\n*>\n     move     prog-name to l1-prog.\n     open     output  print-file.\n     move     zero  to  page-nos.\n     move     1     to  trutht.\n     if       first-time-flag not = zero\n              go to disp-head-skip.\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"General Ledger - Proof Report\" at 0127  with foreground-color 2.\n     perform  zz070-convert-date.\n     display  ws-date at 0171 with foreground-color 2.\n     if       ws-menu = 2\n              move 1 to first-time-flag.\n*>\n disp-head-skip.\n*>\n     perform  GL-Nominal-Open-Input.      *> open input  posting-file ledger-file.\n     perform  GL-Posting-Open-Input.\n     move     zero  to  actual-gross actual-vat.\n     perform  batch-print.\n*>\n main-exit.\n*>********\n*>\n     close    print-file.\n     perform  GL-Posting-Close.          *> close posting-file ledger-file.\n     perform  GL-Nominal-Close.\n     call     \"SYSTEM\" using Print-Report.\n*>\n end-routine. exit section.\n*>\n*>******************************************************\n*>                     Procedures                      *\n*>******************************************************\n*>\n batch-print                 section.\n*>**********************************\n*>\n     perform  headings.\n     move     1 to WS-Ledger.\n*>\n loop.\n*>***\n*>\n     perform  GL-Posting-Read-Next.            *> read posting-file  next record  at end\n     if       fs-reply = 10\n              go to  end-batch.\n*>\n     if       batch = zero\n              go to  loop.\n*>\n     if       z = 99\n       and    save-batch not = batch\n              move   batch  to  l4-batch save-batch WS-Batch-Nos\n              perform get-a-batch\n              move  entered  to  u-bin\n              perform zz060-Convert-Date\n              move ws-date  to  l4-date\n              move description to l4-desc\n              write  print-record  from  line-4  after  2\n              add 2 to line-cnt\n     else\n      if      z = 99",
        "line": 10
      },
      {
        "type": "IF",
        "condition": "batch not = WS-Batch-Nos\n              go to  loop.\n*>\n     move     post-number  to  l7-number.\n     move     post-code in WS-Posting-Record   to  l7-code.\n     move     post-date    to  l7-date.\n     divide   post-dr  by  100  giving  l7-dr.\n     move     dr-pc        to  l7-dr-pc.\n     divide   post-cr  by  100  giving  l7-cr.\n     move     cr-pc        to  l7-cr-pc.\n     move     post-amount  to  l7-amount.\n     move     vat-amount   to  l7-vat.\n     move     zero         to  l7-vat-ac  l7-vat-pc\n     move     spaces       to  l7-side.\n*>\n     divide   vat-ac of WS-Posting-Record by 100 giving l7-vat-ac.\n     move     vat-pc  to  l7-vat-pc.\n*>\n     if       vat-ac of WS-Posting-Record not equal  zero\n              move    post-vat-side  to  l7-side.\n*>\n     move     post-legend  to  l7-legend.\n*>\n     write    print-record  from  line-7 after 1.\n     add      1 to line-cnt.\n     perform  get-description.\n*>\n     if       cr-error not = spaces\n       or     dr-error not = spaces\n              write print-record from line-error after 1\n              add 1 to line-cnt.\n     if       line-cnt > Page-Lines - 6\n              perform  headings.\n*>\n     add      post-amount  to  actual-gross.\n     add      vat-amount   to  actual-vat.\n     go       to loop.\n*>\n get-a-batch.\n*>**********\n*>\n     perform  GL-Batch-Read-Indexed.       *> read  batch-file invalid key\n     if       fs-reply = 21\n              move 99999 to WS-Batch-Nos.\n*>\n headings.\n*>*******\n*>\n     add      1          to  page-nos.\n     move     page-nos   to  l1-page.\n     move     WS-Batch-Nos  to  l4-batch.\n     move     description  to  l4-desc.\n     move     entered  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date  to  l4-date.\n*>\n     write    print-record  from  line-1 after 1.\n     write    print-record  from  line-3 after 1.\n     move     6 to line-cnt.\n     if       z not = 99\n              write  print-record  from  line-4 after 2\n              add 2 to line-cnt.\n     write    print-record  from  line-5 after 2.\n     write    print-record  from  line-6 after 1.\n     move     spaces  to  print-record.\n     write    print-record after 1.\n*>\n end-batch.\n*>********\n*>\n     if       z = 99\n              go to  main-exit.\n     if       not truet\n              move  0  to  batch-status\n              go to  main-exit.\n*>\n     subtract input-vat  from  input-gross  giving  l9-amount.\n     move     input-vat    to  l9-vat.\n     move     actual-gross to  l10-amount.\n     move     actual-vat   to  l10-vat.\n     add      actual-vat   to  actual-gross.\n*>\n     if       line-cnt > Page-Lines - 12\n              perform headings.\n     write    print-record  from  line-8 after 3.\n     write    print-record  from  line-9 after 2.\n     write    print-record  from  line-10 after 2.\n*>\n     if       input-gross = actual-gross\n       and    input-vat   = actual-vat\n              move  1  to  batch-status\n     else\n              move  0  to  batch-status.\n*>\n     move     \"*********************\"  to  l11-status.\n     write    print-record  from  line-11 after 3.\n*>\n     if       batch-status = 1\n              move  \"* Batch Verified Ok *\"  to  l11-status\n     else\n              move  \"*  Batch In ERROR   *\"  to  l11-status.\n*>\n     write    print-record  from  line-11 after 1.\n     move     \"*********************\"  to  l11-status.\n     write    print-record  from  line-11 after 1.\n     go       to main-exit.\n*>\n get-description.\n*>\n     move     zero         to  we-error.\n     move     post-dr      to  WS-Ledger-Nos.\n     move     dr-pc        to  ledger-pc.\n*>\n     perform  GL-Nominal-Read-Indexed.      *> read     ledger-file  invalid key\n     if       fs-reply = 21\n              move  1  to  we-error.\n*>\n     if       we-error = zero\n              move  spaces  to  dr-error\n     else\n              move  \"^^^^^^^^^^\"  to  dr-error\n              move  0  to  trutht.\n*>\n     move     zero         to  we-error.\n     move     post-cr      to  WS-Ledger-Nos.\n     move     cr-pc        to  ledger-pc.\n*>\n     perform  GL-Nominal-Read-Indexed.      *> read     ledger-file  invalid key\n     if       fs-reply = 21\n              move  1  to  we-error.\n*>\n     if       we-error = zero\n              move  spaces  to  cr-error\n     else\n              move  \"^^^^^^^^^^\"  to  cr-error\n              move  0  to  trutht.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     inspect  ws-test-date replacing all \".\" by \"/\".\n     inspect  ws-test-date replacing all \",\" by \"/\".\n     inspect  ws-test-date replacing all \"-\" by \"/\".\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps03.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps03.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps03       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 1030
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 6,
    "cognitive": 2,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 133,
      "totalOperators": 120,
      "totalOperands": 240,
      "vocabulary": 134,
      "length": 360,
      "volume": 2543.792108564798
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
