{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl910.cbl",
  "fileName": "sl910.cbl",
  "timestamp": "2025-09-15T16:25:30.511Z",
  "programId": "sl910",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "Input-output",
        "line": 304
      },
      {
        "name": "file",
        "line": 315
      },
      {
        "name": "working-storage",
        "line": 321
      },
      {
        "name": "linkage",
        "line": 647
      },
      {
        "name": "Init01",
        "line": 662
      },
      {
        "name": "Running-Totals",
        "line": 776
      },
      {
        "name": "exit",
        "line": 804
      },
      {
        "name": "Write-Details",
        "line": 806
      },
      {
        "name": "exit",
        "line": 838
      },
      {
        "name": "Update-Stock-n-Audit",
        "line": 840
      },
      {
        "name": "exit",
        "line": 994
      },
      {
        "name": "Eval-Status",
        "line": 996
      },
      {
        "name": "exit",
        "line": 1004
      },
      {
        "name": "comm-routines",
        "line": 1006
      },
      {
        "name": "exit",
        "line": 1044
      },
      {
        "name": "Inv-Level-1",
        "line": 1046
      },
      {
        "name": "exit",
        "line": 1095
      },
      {
        "name": "Get-Data-1",
        "line": 1097
      },
      {
        "name": "exit",
        "line": 1197
      },
      {
        "name": "Inv-Level-2",
        "line": 1199
      },
      {
        "name": "exit",
        "line": 1264
      },
      {
        "name": "Get-Data-2",
        "line": 1266
      },
      {
        "name": "exit",
        "line": 1706
      },
      {
        "name": "End-Totals",
        "line": 1708
      },
      {
        "name": "exit",
        "line": 1826
      },
      {
        "name": "Total-Screen",
        "line": 1828
      },
      {
        "name": "exit",
        "line": 1983
      },
      {
        "name": "Invoice-Details",
        "line": 1985
      },
      {
        "name": "exit",
        "line": 2234
      },
      {
        "name": "Get-a-Deleted-Invoice",
        "line": 2236
      },
      {
        "name": "exit",
        "line": 2281
      },
      {
        "name": "CR-Note",
        "line": 2283
      },
      {
        "name": "exit",
        "line": 2370
      },
      {
        "name": "Program-Start",
        "line": 2372
      },
      {
        "name": "exit",
        "line": 2463
      },
      {
        "name": "zz050-Validate-Date",
        "line": 2465
      },
      {
        "name": "exit",
        "line": 2502
      },
      {
        "name": "zz060-Convert-Date",
        "line": 2504
      },
      {
        "name": "exit",
        "line": 2537
      },
      {
        "name": "zz070-Convert-Date",
        "line": 2539
      },
      {
        "name": "exit",
        "line": 2567
      },
      {
        "name": "zz080-Close-All-Files",
        "line": 2569
      },
      {
        "name": "exit",
        "line": 2586
      },
      {
        "name": "zz100-Read-System-Record",
        "line": 2590
      },
      {
        "name": "exit",
        "line": 2605
      },
      {
        "name": "zz110-Write-System-Record",
        "line": 2607
      },
      {
        "name": "exit",
        "line": 2633
      },
      {
        "name": "zz120-Build-BO-Record",
        "line": 2635
      },
      {
        "name": "exit",
        "line": 2685
      },
      {
        "name": "zz200-Build-From-BO",
        "line": 2687
      },
      {
        "name": "exit",
        "line": 3325
      },
      {
        "name": "zz210-Delete-BO-Records",
        "line": 3327
      },
      {
        "name": "exit",
        "line": 3349
      },
      {
        "name": "zz300-Display-Outline-2",
        "line": 3351
      },
      {
        "name": "exit",
        "line": 3361
      },
      {
        "name": "maps04",
        "line": 3364
      },
      {
        "name": "exit",
        "line": 3370
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 307
      },
      {
        "name": "file-defs",
        "line": 659
      },
      {
        "name": "SInvoice-Bodies",
        "line": 719
      },
      {
        "name": "Main",
        "line": 725
      },
      {
        "name": "SInvoice-Header",
        "line": 727
      },
      {
        "name": "Data-Input",
        "line": 738
      },
      {
        "name": "SInvoice-Bodies",
        "line": 740
      },
      {
        "name": "More-Data",
        "line": 754
      },
      {
        "name": "sih-VAT",
        "line": 781
      },
      {
        "name": "Main-Exit",
        "line": 803
      },
      {
        "name": "Main-Exit",
        "line": 837
      },
      {
        "name": "WS-Temp-Stock-Key",
        "line": 862
      },
      {
        "name": "end-if",
        "line": 991
      },
      {
        "name": "Update-Stock-Exit",
        "line": 993
      },
      {
        "name": "Main-Exit",
        "line": 1003
      },
      {
        "name": "Accept-Money6a",
        "line": 1009
      },
      {
        "name": "Accept-Money6b",
        "line": 1012
      },
      {
        "name": "Accept-Money6c",
        "line": 1018
      },
      {
        "name": "Accept-Money7a",
        "line": 1026
      },
      {
        "name": "Accept-Money7b",
        "line": 1029
      },
      {
        "name": "Accept-Money7c",
        "line": 1035
      },
      {
        "name": "comm-exit",
        "line": 1043
      },
      {
        "name": "Loop",
        "line": 1060
      },
      {
        "name": "Main-Exit",
        "line": 1094
      },
      {
        "name": "Get-Data-1-Main",
        "line": 1102
      },
      {
        "name": "Get-Code",
        "line": 1112
      },
      {
        "name": "Get-Net",
        "line": 1156
      },
      {
        "name": "Get-Vat-Code",
        "line": 1163
      },
      {
        "name": "Get-VAT-Rate",
        "line": 1181
      },
      {
        "name": "Main-Exit",
        "line": 1196
      },
      {
        "name": "loop",
        "line": 1221
      },
      {
        "name": "Main-Exit",
        "line": 1263
      },
      {
        "name": "Get-Data-2-Main",
        "line": 1285
      },
      {
        "name": "Get-Product",
        "line": 1294
      },
      {
        "name": "Bypass-Product-Space-Tests",
        "line": 1319
      },
      {
        "name": "WS-Temp-Stock-Key",
        "line": 1323
      },
      {
        "name": "end-if",
        "line": 1438
      },
      {
        "name": "Get-Simple-Stock",
        "line": 1440
      },
      {
        "name": "end-if",
        "line": 1456
      },
      {
        "name": "GSS-End",
        "line": 1458
      },
      {
        "name": "Process-Stock-Record",
        "line": 1471
      },
      {
        "name": "Get-Code",
        "line": 1506
      },
      {
        "name": "Get-Desc",
        "line": 1530
      },
      {
        "name": "Get-Qty",
        "line": 1558
      },
      {
        "name": "Get-Unit",
        "line": 1588
      },
      {
        "name": "Recomp-Net",
        "line": 1595
      },
      {
        "name": "Get-Disc",
        "line": 1635
      },
      {
        "name": "Get-Vat-Code",
        "line": 1656
      },
      {
        "name": "Jump-Totals",
        "line": 1690
      },
      {
        "name": "Test-For-Read-Stock",
        "line": 1695
      },
      {
        "name": "end-if",
        "line": 1703
      },
      {
        "name": "Main-Exit",
        "line": 1705
      },
      {
        "name": "End-Totals-Main",
        "line": 1711
      },
      {
        "name": "Confirmation",
        "line": 1742
      },
      {
        "name": "Retry-Write-PInv-Rec",
        "line": 1763
      },
      {
        "name": "ET-Print",
        "line": 1804
      },
      {
        "name": "file-defs",
        "line": 1822
      },
      {
        "name": "Main-Exit",
        "line": 1825
      },
      {
        "name": "Get-Days",
        "line": 1877
      },
      {
        "name": "Get-Extra",
        "line": 1892
      },
      {
        "name": "Get-Extra-VAT",
        "line": 1907
      },
      {
        "name": "Get-Carriage",
        "line": 1926
      },
      {
        "name": "Get-Carriage-VAT",
        "line": 1934
      },
      {
        "name": "Get-Deduct-Amt",
        "line": 1941
      },
      {
        "name": "Get-Deduct-VAT",
        "line": 1963
      },
      {
        "name": "Get-Deduct-Days",
        "line": 1976
      },
      {
        "name": "Main-Exit",
        "line": 1982
      },
      {
        "name": "Invoice-Details-Main",
        "line": 1988
      },
      {
        "name": "Date-Input",
        "line": 2003
      },
      {
        "name": "Customer-Input",
        "line": 2023
      },
      {
        "name": "end-if",
        "line": 2033
      },
      {
        "name": "Customer-Test",
        "line": 2035
      },
      {
        "name": "Get-inv",
        "line": 2075
      },
      {
        "name": "try-again",
        "line": 2080
      },
      {
        "name": "Jump-1",
        "line": 2090
      },
      {
        "name": "Customer-Setup",
        "line": 2105
      },
      {
        "name": "Customer-display",
        "line": 2108
      },
      {
        "name": "ref-input",
        "line": 2140
      },
      {
        "name": "order-input",
        "line": 2144
      },
      {
        "name": "type-input",
        "line": 2147
      },
      {
        "name": "Cob-Crt-Status",
        "line": 2211
      },
      {
        "name": "New-Customer",
        "line": 2214
      },
      {
        "name": "Main-Exit",
        "line": 2233
      },
      {
        "name": "l70ab-Read",
        "line": 2241
      },
      {
        "name": "l70ab-Read-2",
        "line": 2254
      },
      {
        "name": "l70ac-Close",
        "line": 2266
      },
      {
        "name": "l70ad-Terminate",
        "line": 2275
      },
      {
        "name": "l70ae-Exit",
        "line": 2280
      },
      {
        "name": "main",
        "line": 2288
      },
      {
        "name": "main-input",
        "line": 2295
      },
      {
        "name": "No-Inv-Restart",
        "line": 2366
      },
      {
        "name": "Main-Exit",
        "line": 2369
      },
      {
        "name": "end-if",
        "line": 2460
      },
      {
        "name": "Main-Exit",
        "line": 2462
      },
      {
        "name": "zz050-test-date",
        "line": 2496
      },
      {
        "name": "zz050-exit",
        "line": 2501
      },
      {
        "name": "zz060-Exit",
        "line": 2536
      },
      {
        "name": "zz070-Exit",
        "line": 2566
      },
      {
        "name": "zz080-Exit",
        "line": 2585
      },
      {
        "name": "zz100-Exit",
        "line": 2604
      },
      {
        "name": "end-if",
        "line": 2618
      },
      {
        "name": "File-Duplicates-In-Use",
        "line": 2623
      },
      {
        "name": "zz110-Exit",
        "line": 2632
      },
      {
        "name": "end-if",
        "line": 2682
      },
      {
        "name": "zz120-Exit",
        "line": 2684
      },
      {
        "name": "end-perform",
        "line": 2736
      },
      {
        "name": "end-perform",
        "line": 2743
      },
      {
        "name": "BO-Invoiced-Used",
        "line": 2745
      },
      {
        "name": "end-perform",
        "line": 2774
      },
      {
        "name": "end-if",
        "line": 2821
      },
      {
        "name": "end-if",
        "line": 2944
      },
      {
        "name": "BO-Table-Cnt",
        "line": 2978
      },
      {
        "name": "end-perform",
        "line": 3322
      },
      {
        "name": "zz200-Exit",
        "line": 3324
      },
      {
        "name": "end-perform",
        "line": 3346
      },
      {
        "name": "zz210-Exit",
        "line": 3348
      },
      {
        "name": "zz300-Exit",
        "line": 3360
      },
      {
        "name": "maps04-exit",
        "line": 3369
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "scr_dump",
        "line": 695,
        "type": "DYNAMIC",
        "using": [
          "wScreenName",
          "returning",
          "wInt",
          "*>",
          "perform",
          "abc",
          "*>",
          "call",
          "\"scr_restore\"",
          "using",
          "wScreenName",
          "returning",
          "wInt",
          "*>",
          "call",
          "\"CBL_DELETE_FILE\"",
          "using",
          "Path-Work",
          "*>",
          "go",
          "to",
          "xxx"
        ]
      },
      {
        "target": "sl930",
        "line": 1819,
        "type": "DYNAMIC",
        "using": [
          "WS-calling-data",
          "system-record",
          "to-day",
          "file-defs"
        ]
      },
      {
        "target": "sl960",
        "line": 2229,
        "type": "DYNAMIC",
        "using": [
          "WS-calling-data",
          "system-record",
          "to-day"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 2383,
        "type": "DYNAMIC",
        "using": [
          "File-15",
          "*>",
          "Analysis",
          "File-Info",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "move",
          "1",
          "to",
          "WS-Process-Func",
          "WS-Sub-Function",
          "call",
          "\"sl070\"",
          "using",
          "WS-calling-data",
          "*>",
          "Create",
          "Anal",
          "default",
          "recs",
          "system-record",
          "to-day",
          "file-defs",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-15",
          "*>",
          "Only",
          "If",
          "the",
          "call",
          "failed",
          "File-Info",
          "*>",
          "SHOULD",
          "NEVER",
          "happen",
          "but",
          "JIC",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "SL186",
          "at",
          "2301",
          "display",
          "SL003",
          "at",
          "2401",
          "accept",
          "WS-Reply",
          "at",
          "2430",
          "end-if",
          "end-if",
          "end-if",
          "*>",
          "perform",
          "Sales-Open"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 2417,
        "type": "DYNAMIC",
        "using": [
          "File-16",
          "*>",
          "Invoice",
          "File-Info",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Invoice-Open-Output",
          "perform",
          "Invoice-Close",
          "end-if",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-19",
          "*>",
          "create",
          "ITM3",
          "If",
          "not",
          "exist",
          "File-Info",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "OTM3-Open-Output",
          "perform",
          "OTM3-Close",
          "end-if",
          "end-if",
          "*>",
          "move",
          "zero",
          "to",
          "menu-reply"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 2441,
        "type": "DYNAMIC",
        "using": [
          "File-11",
          "*>",
          "Stock",
          "file",
          "File-Info",
          "end-call",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Stock-Open-Output",
          "perform",
          "Stock-Close",
          "end-if",
          "perform",
          "Stock-Open",
          "*>",
          "open",
          "I-o",
          "stock-file",
          "Thats",
          "ok",
          "we",
          "just",
          "wont",
          "find",
          "any",
          "Items",
          "If",
          "Stk-Audit-Used",
          "=",
          "1",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-10",
          "*>",
          "Stock",
          "audit",
          "file",
          "File-Info",
          "end-call",
          "If",
          "return-Code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Stock-Audit-Open-Output",
          "else",
          "perform",
          "Stock-Audit-Open-Extend",
          "end-if",
          "end-if",
          "end-if",
          "end-if"
        ]
      },
      {
        "target": "maps04",
        "line": 3367,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "block",
        "line": 177,
        "replacing": null
      },
      {
        "name": "of",
        "line": 185,
        "replacing": null
      },
      {
        "name": "of",
        "line": 293,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 302,
        "replacing": null
      },
      {
        "name": "selboitm",
        "line": 310,
        "replacing": null
      },
      {
        "name": "fdboitm",
        "line": 319,
        "replacing": null
      },
      {
        "name": "books",
        "line": 622,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 624,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 625,
        "replacing": null
      },
      {
        "name": "slwsinv",
        "line": 626,
        "replacing": null
      },
      {
        "name": "slwsinv2",
        "line": 627,
        "replacing": null
      },
      {
        "name": "slwsoi3",
        "line": 631,
        "replacing": null
      },
      {
        "name": "wsanal",
        "line": 632,
        "replacing": null
      },
      {
        "name": "wsaudit",
        "line": 633,
        "replacing": null
      },
      {
        "name": "wsdel",
        "line": 634,
        "replacing": null
      },
      {
        "name": "wsdnos",
        "line": 635,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 636,
        "replacing": null
      },
      {
        "name": "wsstock",
        "line": 637,
        "replacing": null
      },
      {
        "name": "wsboitm",
        "line": 640,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 643,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 645,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 650,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 651,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 652,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 1000,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 3372,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 677
      },
      {
        "target": "abc",
        "thru": null,
        "line": 696
      },
      {
        "target": "Program-Start",
        "thru": null,
        "line": 704
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 713
      },
      {
        "target": "zz200-Build-From-BO",
        "thru": null,
        "line": 721
      },
      {
        "target": "Invoice-Details",
        "thru": null,
        "line": 728
      },
      {
        "target": "Inv-Level-1",
        "thru": null,
        "line": 745
      },
      {
        "target": "Inv-Level-2",
        "thru": null,
        "line": 747
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 752
      },
      {
        "target": "zz080-Close-All-Files",
        "thru": null,
        "line": 769
      },
      {
        "target": "varying",
        "thru": null,
        "line": 783
      },
      {
        "target": "*>",
        "thru": null,
        "line": 786
      },
      {
        "target": "Invoice-Write",
        "thru": null,
        "line": 814
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 816
      },
      {
        "target": "Update-Stock-n-Audit",
        "thru": null,
        "line": 835
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 880
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 888
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 899
      },
      {
        "target": "Stock-Rewrite",
        "thru": null,
        "line": 961
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 969
      },
      {
        "target": "Stock-Audit-Write",
        "thru": null,
        "line": 982
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 984
      },
      {
        "target": "varying",
        "thru": null,
        "line": 1061
      },
      {
        "target": "*>",
        "thru": null,
        "line": 1073
      },
      {
        "target": "Get-Data-1",
        "thru": null,
        "line": 1083
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 1147
      },
      {
        "target": "Accept-Money7a",
        "thru": "Accept-Money7b",
        "line": 1158
      },
      {
        "target": "Accept-Money6c",
        "thru": null,
        "line": 1183
      },
      {
        "target": "Running-Totals",
        "thru": null,
        "line": 1190
      },
      {
        "target": "varying",
        "thru": null,
        "line": 1222
      },
      {
        "target": "*>",
        "thru": null,
        "line": 1234
      },
      {
        "target": "Get-Data-2",
        "thru": null,
        "line": 1252
      },
      {
        "target": "Stock-Start",
        "thru": null,
        "line": 1348
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1354
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1366
      },
      {
        "target": "Stock-Start",
        "thru": null,
        "line": 1388
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1394
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1419
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 1451
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 1462
      },
      {
        "target": "Test-For-Read-Stock",
        "thru": null,
        "line": 1469
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 1525
      },
      {
        "target": "Accept-Money7a",
        "thru": "Accept-Money7b",
        "line": 1590
      },
      {
        "target": "zz120-Build-BO-Record",
        "thru": null,
        "line": 1602
      },
      {
        "target": "Running-Totals",
        "thru": null,
        "line": 1688
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 1697
      },
      {
        "target": "Total-Screen",
        "thru": null,
        "line": 1713
      },
      {
        "target": "Invoice-Write",
        "thru": null,
        "line": 1764
      },
      {
        "target": "zz100-Read-System-Record",
        "thru": null,
        "line": 1766
      },
      {
        "target": "zz110-Write-System-Record",
        "thru": null,
        "line": 1770
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 1774
      },
      {
        "target": "Write-Details",
        "thru": null,
        "line": 1784
      },
      {
        "target": "DelInvNos-Delete",
        "thru": null,
        "line": 1793
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 1805
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 1806
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 1808
      },
      {
        "target": "Delivery-Close",
        "thru": null,
        "line": 1809
      },
      {
        "target": "DelInvNos-Close",
        "thru": null,
        "line": 1810
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 1811
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 1813
      },
      {
        "target": "Stock-Audit-Close",
        "thru": null,
        "line": 1814
      },
      {
        "target": "Accept-Money7c",
        "thru": null,
        "line": 1904
      },
      {
        "target": "Accept-Money6c",
        "thru": null,
        "line": 1915
      },
      {
        "target": "Accept-Money7a",
        "thru": "Accept-Money7b",
        "line": 1928
      },
      {
        "target": "Accept-Money6c",
        "thru": null,
        "line": 1936
      },
      {
        "target": "Accept-Money7c",
        "thru": null,
        "line": 1960
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 1991
      },
      {
        "target": "zz050-Validate-Date",
        "thru": null,
        "line": 2013
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 2048
      },
      {
        "target": "Get-a-Deleted-Invoice",
        "thru": null,
        "line": 2064
      },
      {
        "target": "zz100-Read-System-Record",
        "thru": null,
        "line": 2066
      },
      {
        "target": "zz110-Write-System-Record",
        "thru": null,
        "line": 2070
      },
      {
        "target": "Invoice-Read-Indexed",
        "thru": null,
        "line": 2084
      },
      {
        "target": "Delivery-Read-Indexed",
        "thru": null,
        "line": 2097
      },
      {
        "target": "cr-note",
        "thru": null,
        "line": 2164
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 2215
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 2216
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 2218
      },
      {
        "target": "DelInvNos-Close",
        "thru": null,
        "line": 2219
      },
      {
        "target": "Delivery-Close",
        "thru": null,
        "line": 2220
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 2221
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 2223
      },
      {
        "target": "Stock-Audit-Close",
        "thru": null,
        "line": 2225
      },
      {
        "target": "Program-Start",
        "thru": null,
        "line": 2230
      },
      {
        "target": "DelInvNos-Start",
        "thru": null,
        "line": 2249
      },
      {
        "target": "DelInvNos-Read-Next",
        "thru": null,
        "line": 2255
      },
      {
        "target": "DelInvNos-Close",
        "thru": null,
        "line": 2271
      },
      {
        "target": "DelInvNos-Open-Output",
        "thru": null,
        "line": 2272
      },
      {
        "target": "OTM3-Read-Indexed",
        "thru": null,
        "line": 2321
      },
      {
        "target": "main",
        "thru": null,
        "line": 2367
      },
      {
        "target": "Sales-Open",
        "thru": null,
        "line": 2402
      },
      {
        "target": "Delivery-Open",
        "thru": null,
        "line": 2403
      },
      {
        "target": "Analysis-Open",
        "thru": null,
        "line": 2404
      },
      {
        "target": "Invoice-Open-Output",
        "thru": null,
        "line": 2420
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 2421
      },
      {
        "target": "OTM3-Open-Output",
        "thru": null,
        "line": 2426
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 2427
      },
      {
        "target": "Invoice-Open",
        "thru": null,
        "line": 2432
      },
      {
        "target": "OTM3-Open-Input",
        "thru": null,
        "line": 2433
      },
      {
        "target": "DelInvNos-Open",
        "thru": null,
        "line": 2434
      },
      {
        "target": "Stock-Open-Output",
        "thru": null,
        "line": 2445
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 2446
      },
      {
        "target": "Stock-Open",
        "thru": null,
        "line": 2448
      },
      {
        "target": "Stock-Audit-Open-Output",
        "thru": null,
        "line": 2454
      },
      {
        "target": "Stock-Audit-Open-Extend",
        "thru": null,
        "line": 2456
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 2499
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 2513
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 2572
      },
      {
        "target": "Delivery-Close",
        "thru": null,
        "line": 2573
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 2574
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 2576
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 2577
      },
      {
        "target": "DelInvNos-Close",
        "thru": null,
        "line": 2578
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 2581
      },
      {
        "target": "Stock-Audit-Close",
        "thru": null,
        "line": 2582
      },
      {
        "target": "System-Open-Input",
        "thru": null,
        "line": 2598
      },
      {
        "target": "System-Read-Indexed",
        "thru": null,
        "line": 2601
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 2602
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 2614
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 2616
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 2617
      },
      {
        "target": "System-Open",
        "thru": null,
        "line": 2627
      },
      {
        "target": "System-Rewrite",
        "thru": null,
        "line": 2629
      },
      {
        "target": "System-Close",
        "thru": null,
        "line": 2630
      },
      {
        "target": "until",
        "thru": null,
        "line": 2663
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2667
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 2670
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2678
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 2680
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2681
      },
      {
        "target": "move",
        "thru": null,
        "line": 2725
      },
      {
        "target": "varying",
        "thru": null,
        "line": 2731
      },
      {
        "target": "varying",
        "thru": null,
        "line": 2737
      },
      {
        "target": "until",
        "thru": null,
        "line": 2753
      },
      {
        "target": "end-read",
        "thru": null,
        "line": 2755
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2758
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2769
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 2773
      },
      {
        "target": "until",
        "thru": null,
        "line": 2797
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2806
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 2819
      },
      {
        "target": "*>",
        "thru": null,
        "line": 2820
      },
      {
        "target": "varying",
        "thru": null,
        "line": 2833
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 2837
      },
      {
        "target": "Test-For-Read-Stock",
        "thru": null,
        "line": 2839
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2841
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 2849
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2850
      },
      {
        "target": "until",
        "thru": null,
        "line": 2913
      },
      {
        "target": "*>",
        "thru": null,
        "line": 2919
      },
      {
        "target": "*>",
        "thru": null,
        "line": 2936
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 2941
      },
      {
        "target": "display",
        "thru": null,
        "line": 2942
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 2948
      },
      {
        "target": "zz080-Close-All-Files",
        "thru": null,
        "line": 2950
      },
      {
        "target": "until",
        "thru": null,
        "line": 2979
      },
      {
        "target": "add",
        "thru": null,
        "line": 2979
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 2983
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 2997
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 3001
      },
      {
        "target": "Get-a-Deleted-Invoice",
        "thru": null,
        "line": 3008
      },
      {
        "target": "until",
        "thru": null,
        "line": 3011
      },
      {
        "target": "zz100-Read-System-Record",
        "thru": null,
        "line": 3013
      },
      {
        "target": "zz110-Write-System-Record",
        "thru": null,
        "line": 3017
      },
      {
        "target": "Invoice-Read-Indexed",
        "thru": null,
        "line": 3021
      },
      {
        "target": "else",
        "thru": null,
        "line": 3023
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 3026
      },
      {
        "target": "*>",
        "thru": null,
        "line": 3028
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 3038
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 3058
      },
      {
        "target": "Customer-Display",
        "thru": null,
        "line": 3060
      },
      {
        "target": "zz300-Display-Outline-2",
        "thru": null,
        "line": 3074
      },
      {
        "target": "until",
        "thru": null,
        "line": 3084
      },
      {
        "target": "*>",
        "thru": null,
        "line": 3087
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3090
      },
      {
        "target": "add",
        "thru": null,
        "line": 3091
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 3110
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 3151
      },
      {
        "target": "zz210-Delete-BO-Records",
        "thru": null,
        "line": 3152
      },
      {
        "target": "exit",
        "thru": null,
        "line": 3154
      },
      {
        "target": "*>",
        "thru": null,
        "line": 3155
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3160
      },
      {
        "target": "if",
        "thru": null,
        "line": 3162
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3166
      },
      {
        "target": "Running-Totals",
        "thru": null,
        "line": 3274
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3290
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 3296
      },
      {
        "target": "zz210-Delete-BO-Records",
        "thru": null,
        "line": 3297
      },
      {
        "target": "exit",
        "thru": null,
        "line": 3299
      },
      {
        "target": "*>",
        "thru": null,
        "line": 3300
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 3305
      },
      {
        "target": "zz210-Delete-BO-Records",
        "thru": null,
        "line": 3306
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3308
      },
      {
        "target": "if",
        "thru": null,
        "line": 3310
      },
      {
        "target": "get",
        "thru": null,
        "line": 3311
      },
      {
        "target": "cycle",
        "thru": null,
        "line": 3312
      },
      {
        "target": "move",
        "thru": null,
        "line": 3314
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3316
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 3320
      },
      {
        "target": "varying",
        "thru": null,
        "line": 3334
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "WS-env-lines WS-lines\n     else\n              move  WS-env-lines   to WS-lines\n     end-if\n     subtract 1 from WS-lines giving WS-23-lines",
        "line": 667
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 678
      },
      {
        "from": "spaces",
        "to": "Path-Work",
        "line": 683
      },
      {
        "from": "z\"sl-temp.scr\"",
        "to": "wScreenName\n *>             call     \"scr_dump\"    using wScreenName returning wInt\n *>             perform  abc\n *>             call     \"scr_restore\" using wScreenName returning wInt\n *>             call     \"CBL_DELETE_FILE\" using Path-Work\n *>             go to xxx",
        "line": 694
      },
      {
        "from": "zero",
        "to": "WS-delinv",
        "line": 706
      },
      {
        "from": "zero",
        "to": "Return-Code",
        "line": 716
      },
      {
        "from": "16",
        "to": "lin",
        "line": 734
      },
      {
        "from": "1",
        "to": "cole",
        "line": 735
      },
      {
        "from": "zero",
        "to": "I",
        "line": 742
      },
      {
        "from": "zero",
        "to": "Cob-Crt-Status",
        "line": 756
      },
      {
        "from": "\"Y\"",
        "to": "WS-reply",
        "line": 757
      },
      {
        "from": "zero",
        "to": "sih-Net\n                        sih-VAT",
        "line": 780
      },
      {
        "from": "sih-Net",
        "to": "Display-9",
        "line": 788
      },
      {
        "from": "sih-VAT",
        "to": "Display-9",
        "line": 792
      },
      {
        "from": "sih-invoice",
        "to": "Sil-invoice (J)",
        "line": 810
      },
      {
        "from": "J",
        "to": "Sil-line (J)",
        "line": 811
      },
      {
        "from": "sih-type",
        "to": "Sil-type (J)",
        "line": 812
      },
      {
        "from": "Sih-Customer",
        "to": "BO-Stk-Cust-No\n              move     Sil-Product (J) to BO-Stk-Item-No\n              delete   BO-Stk-Itm-File record",
        "line": 831
      },
      {
        "from": "3",
        "to": "Audit-Type",
        "line": 858
      },
      {
        "from": "Sih-Invoice",
        "to": "Audit-Invoice-PO",
        "line": 859
      },
      {
        "from": "WS-Date",
        "to": "Audit-Process-Date",
        "line": 860
      },
      {
        "from": "zero",
        "to": "Audit-Unit-Cost",
        "line": 865
      },
      {
        "from": "5",
        "to": "Audit-Type\n              move 1      to Audit-Reverse-Transaction\n              move Sih-cr to Audit-Cr-for-Invoice\n     else\n              move zero to Audit-Reverse-Transaction\n     end-if\n     move     Stk-Audit-No        to Audit-No",
        "line": 867
      },
      {
        "from": "WS-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              perform Stock-Read-Indexed      *> read Stock-File record key WS-Stock-Abrev-Key Invalid key\n              If   FS-Reply = 21\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move  1 to File-Key-No\n              perform Stock-Read-Indexed    *> read Stock-File key WS-Stock-Key Invalid key\n              If   FS-Reply = 21\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if\n     end-if\n*>\n*> As stock Items are checked this should not happen\n*>     but It Is a multi user system\n*>\n     If       fs-reply not = zero\n              perform Eval-Status\n              display SL194           at line WS-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply        at line WS-23-lines col 16 with foreground-color 3\n              display exception-msg   at line WS-23-lines col 19 with foreground-color 3\n              display WS-Stock-Key       at 2064 with foreground-color 3\n              display sl006           at line WS-lines col 01 with foreground-color 3\n              accept  WS-reply        at line WS-lines col 44\n              display \" \"             at line WS-23-lines col 1 with erase eos\n     end-if\n*>\n*> If we have great, but If not Stock-Cost Is zero which helps It\n*>          show up In proof reports (Sil-type same as sih-type so use later - less ram)\n*>\n     If       WS-Stock-Key not = spaces\t\t*> we have a stock rec",
        "line": 878
      },
      {
        "from": "zero",
        "to": "Stock-Held\n              end-if\n              If       Stock-Held > zero\n                 and   Stock-Services-Flag not = \"Y\"\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) Invoices but reversed",
        "line": 933
      },
      {
        "from": "1",
        "to": "File-Key-No\n              perform  Stock-Rewrite\n              If       FS-Reply = 21\n                       display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                       display SL006    at line WS-lines col 1\n                       accept WS-reply  at line WS-lines col 45\n              end-if\n              If       fs-reply not = zero\n                       perform Eval-Status\n                       display SL195         at line WS-23-lines col 1 with erase eol foreground-color 4\n                       display fs-reply      at line WS-23-lines col 22 with foreground-color 3\n                       display exception-msg at line WS-23-lines col 25 with foreground-color 3\n                       display WS-Stock-Key  at 2064 with foreground-color 3\n                       display sl006         at line WS-lines col 01 with foreground-color 3\n                       accept  WS-reply      at line WS-lines col 44\n                       display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n     end-if\n*>\n     If       Stk-Audit-Used = 1\n              move zero to Stk-Activity-Rep-Run\t   *> Need to run audit report\n              perform  Stock-Audit-Write\n              If       fs-reply not = zero\n                       perform Eval-Status\n                       display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                       display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                       display SL006         at line WS-lines col 1\n                       accept WS-reply       at line WS-lines col 45\n              end-if\n     end-if",
        "line": 960
      },
      {
        "from": "spaces",
        "to": "exception-msg",
        "line": 999
      },
      {
        "from": "zero",
        "to": "WS-poundsd6 WS-penced6 amt-ok6",
        "line": 1010
      },
      {
        "from": "WS-pound6",
        "to": "amt-wk-pds6",
        "line": 1015
      },
      {
        "from": "WS-pence6",
        "to": "amt-wk-pence6",
        "line": 1016
      },
      {
        "from": "amt-wk-pence6",
        "to": "WS-pence6",
        "line": 1019
      },
      {
        "from": "amt-wk-pds6",
        "to": "WS-pound6",
        "line": 1020
      },
      {
        "from": "WS-pound6",
        "to": "amt-wk-pds6",
        "line": 1023
      },
      {
        "from": "WS-pence6",
        "to": "amt-wk-pence6",
        "line": 1024
      },
      {
        "from": "zero",
        "to": "WS-poundsd7 WS-penced7 amt-ok7",
        "line": 1027
      },
      {
        "from": "WS-pound7",
        "to": "amt-wk-pds7",
        "line": 1032
      },
      {
        "from": "WS-pence7",
        "to": "amt-wk-pence7",
        "line": 1033
      },
      {
        "from": "amt-wk-pence7",
        "to": "WS-pence7",
        "line": 1036
      },
      {
        "from": "amt-wk-pds7",
        "to": "WS-pound7",
        "line": 1037
      },
      {
        "from": "WS-pound7",
        "to": "amt-wk-pds7",
        "line": 1040
      },
      {
        "from": "WS-pence7",
        "to": "amt-wk-pence7",
        "line": 1041
      },
      {
        "from": "1",
        "to": "cole\n              display  \"(\" at curs with erase eol foreground-color 2\n              move     2 to cole\n              display  I at curs with foreground-color 2\n              move     4 to cole\n              display  \") [  ]\" at curs with foreground-color 2\n              move     36 to cole\n              display  \"[          ] [ ]   {         } (\" at curs with foreground-color 2\n              move     78 to cole\n              display  \")\" at curs       with foreground-color 2\n     end-perform\n*>\n*> I = no",
        "line": 1063
      },
      {
        "from": "1",
        "to": "I ?????\n*>\n*>     subtract 16 from WS-23-lines giving m",
        "line": 1076
      },
      {
        "from": "1",
        "to": "I\n     subtract WS-Accept-Body  from  I",
        "line": 1078
      },
      {
        "from": "1",
        "to": "J",
        "line": 1080
      },
      {
        "from": "zero",
        "to": "Cob-Crt-Status",
        "line": 1082
      },
      {
        "from": "1",
        "to": "new-screen\n              go to  Main-Exit",
        "line": 1107
      },
      {
        "from": "zero",
        "to": "new-screen",
        "line": 1110
      },
      {
        "from": "1",
        "to": "I",
        "line": 1118
      },
      {
        "from": "7",
        "to": "cole",
        "line": 1120
      },
      {
        "from": "WS-PA",
        "to": "Sil-PA (I) pa-group",
        "line": 1123
      },
      {
        "from": "spaces",
        "to": "Sil-Description (I)",
        "line": 1124
      },
      {
        "from": "\"S\"",
        "to": "pa-system",
        "line": 1144
      },
      {
        "from": "11",
        "to": "cole",
        "line": 1145
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1146
      },
      {
        "from": "pa-Desc",
        "to": "Sil-Description (I)",
        "line": 1154
      },
      {
        "from": "37",
        "to": "cole",
        "line": 1157
      },
      {
        "from": "amt-ok7",
        "to": "Sil-Net (I) WS-Net",
        "line": 1161
      },
      {
        "from": "50",
        "to": "cole",
        "line": 1168
      },
      {
        "from": "Vat-Code",
        "to": "Sil-Vat-Code (I)",
        "line": 1174
      },
      {
        "from": "zero",
        "to": "amt-ok6\n       else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute amt-ok6 rounded =  (WS-Net * WS-VAT-Rate) / 100",
        "line": 1176
      },
      {
        "from": "56",
        "to": "cole",
        "line": 1182
      },
      {
        "from": "amt-ok6",
        "to": "Sil-VAT (I) WS-VAT",
        "line": 1184
      },
      {
        "from": "68",
        "to": "cole",
        "line": 1187
      },
      {
        "from": "1",
        "to": "cole\n              If      SL-Stock-Link = \"N\"\t\t*> No stock then process PA code\n                      display \"[             ][  ][\" at curs with foreground-color 2 erase eol\n                      move    51 to cole\n                      display   \"][     ][          ][     ][ ]\" at curs  with foreground-color 2\n              else\t\t\t\t*> Ignore PA\n                      display \"[             ][\" at curs with foreground-color 2 erase eol\n                      move    49 to cole\n                      display \"]  [     ][          ][     ][ ]\" at curs  with foreground-color 2\n              end-if\n     end-perform\n*>\n*> This Is what the Item capture displays look like & 1st Is for non-linked\n*>   stock Control:\n*>\n*>    Product    Code <---------Description-------->   Qty   Unit Price  Disc",
        "line": 1224
      },
      {
        "from": "1",
        "to": "I = pos",
        "line": 1245
      },
      {
        "from": "1",
        "to": "J",
        "line": 1248
      },
      {
        "from": "1",
        "to": "new-screen\n              go to  Main-Exit",
        "line": 1289
      },
      {
        "from": "zero",
        "to": "new-screen",
        "line": 1292
      },
      {
        "from": "1",
        "to": "I",
        "line": 1300
      },
      {
        "from": "2",
        "to": "cole",
        "line": 1302
      },
      {
        "from": "spaces",
        "to": "Sil-Description (I)",
        "line": 1307
      },
      {
        "from": "WS-product",
        "to": "Sil-product (I)\n                            test-product\n                            WS-Temp-Stock-Key",
        "line": 1321
      },
      {
        "from": "zero",
        "to": "WS-Net WS-Unit WS-Qty\n              go to  Get-Desc",
        "line": 1326
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1335
      },
      {
        "from": "WS-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              set fn-not-less-than to true\n              perform Stock-Start              *> start Stock-File key not < WS-Stock-Abrev-Key Invalid key\n              If    FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n     If       Cob-Crt-Status = cob-scr-F2                *> read next record\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n*> Search on Desc",
        "line": 1345
      },
      {
        "from": "WS-Description",
        "to": "WS-Stock-Desc\n              move  3 to File-Key-No         *> start Stock-File key not < WS-Stock-Desc Invalid key\n              set fn-not-less-than to true\n              perform Stock-Start\n              If    FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              If       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              display \"Hit return (for testing)\" at 2401  *> TESTING ONLY\n              accept WS-reply at 2425            *> TESTING ONLY\n              display \" \" at 2401 with erase eol *> TESTING ONLY\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if\n*>\n     If       Cob-Crt-Status = cob-scr-F5      *> Read next on Desc",
        "line": 1385
      },
      {
        "from": "SL196",
        "to": "WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              If       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if",
        "line": 1421
      },
      {
        "from": "WS-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move 2 to File-Key-No\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move 1 to File-Key-No\n     end-if\n     perform  Stock-Read-Indexed\n     If       FS-Reply = 21 or = 23\n              move SL196 to WS-Stock-Desc\n              display WS-Stock-Desc at curs with foreground-color 4\n              go to Get-Product\n     end-if",
        "line": 1445
      },
      {
        "from": "SL196",
        "to": "WS-Stock-Desc\n *>                  display WS-Stock-Desc at curs with foreground-color 4\n *>                  go to Get-Product\n *>             end-if\n *>    end-if\n     perform  Test-For-Read-Stock",
        "line": 1464
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1475
      },
      {
        "from": "Stock-SA-Group",
        "to": "WS-PA\n                                pa-group\n                                Sil-PA (I)",
        "line": 1476
      },
      {
        "from": "WS-Stock-Desc",
        "to": "WS-Description\n                               Sil-Description (I)",
        "line": 1480
      },
      {
        "from": "Stock-Retail",
        "to": "amt-ok7",
        "line": 1482
      },
      {
        "from": "Stock-Retail",
        "to": "WS-Unit",
        "line": 1483
      },
      {
        "from": "amt-wk-pds7",
        "to": "WS-pound7",
        "line": 1484
      },
      {
        "from": "amt-wk-pence7",
        "to": "WS-pence7",
        "line": 1485
      },
      {
        "from": "Stock-Held",
        "to": "WS-Qty",
        "line": 1487
      },
      {
        "from": "1",
        "to": "WS-Qty\n     end-if\n     go       to Get-Qty",
        "line": 1489
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1512
      },
      {
        "from": "spaces",
        "to": "Sil-Description (I)",
        "line": 1516
      },
      {
        "from": "WS-PA",
        "to": "pa-group Sil-PA (I)",
        "line": 1521
      },
      {
        "from": "\"S\"",
        "to": "pa-system",
        "line": 1522
      },
      {
        "from": "21",
        "to": "cole",
        "line": 1523
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1524
      },
      {
        "from": "17",
        "to": "cole\n     else\n              move 21 to cole",
        "line": 1537
      },
      {
        "from": "WS-Description",
        "to": "Sil-Description (I)",
        "line": 1544
      },
      {
        "from": "\"B\"",
        "to": "escape-Code\n     else\n              move space to escape-Code",
        "line": 1546
      },
      {
        "from": "zero",
        "to": "WS-Qty",
        "line": 1560
      },
      {
        "from": "53",
        "to": "cole",
        "line": 1561
      },
      {
        "from": "1",
        "to": "WS-Qty\n     end-if\n     display  WS-Qty at curs with foreground-color 3",
        "line": 1563
      },
      {
        "from": "\"Y\"",
        "to": "WS-BO-Can-Be-Used",
        "line": 1574
      },
      {
        "from": "Stock-Held",
        "to": "WS-Qty   *> max value Is stock held\n              display  SL201 at line WS-23-lines col 1 with foreground-color 4 highlight\n              go to Get-Qty\n     else\n              display \" \" at line WS-23-lines col 1 with erase eol",
        "line": 1579
      },
      {
        "from": "60",
        "to": "cole",
        "line": 1589
      },
      {
        "from": "amt-ok7",
        "to": "WS-Unit",
        "line": 1593
      },
      {
        "from": "zero",
        "to": "WS-Temp-Invoice\n              end-if\n              perform  zz120-Build-BO-Record   *> but not for credit notes\n              move     Stock-Held to WS-Qty\n              display  SL205 at line ws-23-Lines col 1 with foreground-color 4 highlight beep\n              If       WS-Qty = zero\n                       If       I > zero   *> JIC\n                                Initialise Invoice-Lines (I) *> clear down any above entered data for Item line\n                                if  I > 1\n                                    subtract 1 from I\n                                    if  I = zero\n                                        move 1 to I\n                                    end-if\n                                end-if\n                       end-if\n                       move    15 to cole\n                       display \"][\" at curs with foreground-color 2 erase eol\n                       move    49 to cole\n                       display \"]  [     ][          ][     ][ ]\" at curs  with foreground-color 2\n                       go to Get-Data-2",
        "line": 1600
      },
      {
        "from": "WS-Net",
        "to": "Display-9 Sil-Net (I)",
        "line": 1630
      },
      {
        "from": "WS-Qty",
        "to": "Sil-Qty (I)",
        "line": 1631
      },
      {
        "from": "WS-Unit",
        "to": "Sil-Unit (I)",
        "line": 1632
      },
      {
        "from": "Sales-Discount",
        "to": "WS-discount",
        "line": 1636
      },
      {
        "from": "72",
        "to": "cole",
        "line": 1637
      },
      {
        "from": "WS-disc-wka",
        "to": "WS-disca1",
        "line": 1638
      },
      {
        "from": "WS-disc-wkb",
        "to": "WS-disca3",
        "line": 1639
      },
      {
        "from": "WS-discb1",
        "to": "WS-disc-wka",
        "line": 1642
      },
      {
        "from": "WS-discb3",
        "to": "WS-disc-wkb",
        "line": 1643
      },
      {
        "from": "WS-discount",
        "to": "work-d Sil-discount (I)",
        "line": 1645
      },
      {
        "from": "WS-Net",
        "to": "work-n",
        "line": 1646
      },
      {
        "from": "WS-Net",
        "to": "Sil-Net (I) Display-9",
        "line": 1653
      },
      {
        "from": "\"S\"",
        "to": "Vat-Code-X",
        "line": 1657
      },
      {
        "from": "79",
        "to": "cole",
        "line": 1658
      },
      {
        "from": "1",
        "to": "Vat-Code\n      else\n       If     Vat-Code-X = \"R\"                   *> Reduced  code 2 (05% - 01/01/17)\n              move 2 to Vat-Code\n        else\n         If   Vat-Code-X = \"Z\"                   *> Zero     code 3 (00% - 01/01/17)\n              move 3 to Vat-Code",
        "line": 1665
      },
      {
        "from": "Vat-Code",
        "to": "SIl-Vat-Code (I)",
        "line": 1676
      },
      {
        "from": "zero",
        "to": "WS-VAT\n     else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute  WS-VAT rounded = (WS-Net * WS-VAT-Rate) / 100",
        "line": 1679
      },
      {
        "from": "WS-VAT",
        "to": "Display-9\n                         SIl-VAT (I)",
        "line": 1684
      },
      {
        "from": "zero",
        "to": "Cob-Crt-Status",
        "line": 1712
      },
      {
        "from": "15",
        "to": "lin",
        "line": 1722
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1723
      },
      {
        "from": "\"Y\"",
        "to": "WS-reply",
        "line": 1743
      },
      {
        "from": "\"P\"",
        "to": "sih-status",
        "line": 1756
      },
      {
        "from": "space",
        "to": "sih-status-P",
        "line": 1757
      },
      {
        "from": "I",
        "to": "sih-lines",
        "line": 1759
      },
      {
        "from": "SInvoice-Header",
        "to": "WS-Invoice-Record",
        "line": 1761
      },
      {
        "from": "Next-Invoice",
        "to": "Ih-Invoice\n                                       Sih-Invoice  *> details recs updated\n              add      1 to Next-Invoice\n              perform  zz110-Write-System-Record\n              go to    Retry-Write-PInv-Rec\n     end-if\n     If       fs-reply not = zero\n              perform Eval-Status\n              display sl180         at line WS-23-lines col  1 with erase eol foreground-color 4\n              display fs-reply      at line WS-23-lines col 36 with foreground-color 3\n              display exception-msg at line WS-23-lines col 39 with foreground-color 3\n              display Invoice-key   at line WS-23-lines col 64 with foreground-color 3\n              display sl006         at line WS-lines    col  1 with foreground-color 3\n              accept  WS-reply      at line WS-lines    col 44\n              display \" \"           at line WS-23-lines col  1 with erase eos",
        "line": 1767
      },
      {
        "from": "zero",
        "to": "J",
        "line": 1783
      },
      {
        "from": "sih-invoice",
        "to": "First-SL-Inv",
        "line": 1790
      },
      {
        "from": "1",
        "to": "S-Flag-I",
        "line": 1798
      },
      {
        "from": "11",
        "to": "lin",
        "line": 1799
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1800
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1831
      },
      {
        "from": "11",
        "to": "lin",
        "line": 1832
      },
      {
        "from": "1",
        "to": "menu-reply\n     else\n              move  2  to  menu-reply",
        "line": 1837
      },
      {
        "from": "sih-Net",
        "to": "Display-9",
        "line": 1868
      },
      {
        "from": "sih-VAT",
        "to": "Display-8",
        "line": 1871
      },
      {
        "from": "zero",
        "to": "sih-days sih-carriage",
        "line": 1878
      },
      {
        "from": "sales-credit",
        "to": "sih-days\n     else If  sih-type = 4\n              move pf-retention to sih-days",
        "line": 1880
      },
      {
        "from": "sih-days",
        "to": "WS-Dayes",
        "line": 1883
      },
      {
        "from": "WS-Dayes",
        "to": "sih-days",
        "line": 1890
      },
      {
        "from": "zero",
        "to": "sih-extra sih-e-VAT\n              go to Get-Carriage",
        "line": 1894
      },
      {
        "from": "zero",
        "to": "sih-extra",
        "line": 1900
      },
      {
        "from": "1526",
        "to": "curs",
        "line": 1902
      },
      {
        "from": "sih-extra",
        "to": "amt-ok7",
        "line": 1903
      },
      {
        "from": "amt-ok7",
        "to": "sih-extra",
        "line": 1905
      },
      {
        "from": "zero",
        "to": "sih-e-VAT\n              go to Get-Carriage",
        "line": 1909
      },
      {
        "from": "1541",
        "to": "curs",
        "line": 1914
      },
      {
        "from": "amt-ok6",
        "to": "sih-e-VAT",
        "line": 1916
      },
      {
        "from": "1626",
        "to": "curs",
        "line": 1927
      },
      {
        "from": "amt-ok7",
        "to": "sih-carriage",
        "line": 1929
      },
      {
        "from": "1641",
        "to": "curs",
        "line": 1935
      },
      {
        "from": "amt-ok6",
        "to": "sih-c-VAT",
        "line": 1937
      },
      {
        "from": "\"Z\"",
        "to": "WS-named",
        "line": 1946
      },
      {
        "from": "zero",
        "to": "sih-deduct-amt sih-deduct-VAT sih-deduct-days\n              go to  Main-Exit",
        "line": 1951
      },
      {
        "from": "4",
        "to": "amt-ok7",
        "line": 1957
      },
      {
        "from": "1726",
        "to": "curs",
        "line": 1959
      },
      {
        "from": "amt-ok7",
        "to": "sih-deduct-amt",
        "line": 1961
      },
      {
        "from": "zeros",
        "to": "sih-deduct-VAT",
        "line": 1964
      },
      {
        "from": "sih-days",
        "to": "WS-Dayes",
        "line": 1977
      },
      {
        "from": "WS-Dayes",
        "to": "sih-deduct-days",
        "line": 1980
      },
      {
        "from": "1",
        "to": "z\n              go to  Main-Exit",
        "line": 2009
      },
      {
        "from": "WS-date",
        "to": "WS-test-date",
        "line": 2012
      },
      {
        "from": "WS-test-date",
        "to": "WS-date",
        "line": 2020
      },
      {
        "from": "u-bin",
        "to": "sih-date",
        "line": 2021
      },
      {
        "from": "spaces",
        "to": "sih-Customer",
        "line": 2024
      },
      {
        "from": "zero",
        "to": "Cob-Crt-Status",
        "line": 2025
      },
      {
        "from": "\"Y\"",
        "to": "WS-Show-Delivery\n     else\n              move \"N\" to WS-Show-Delivery\n     end-if",
        "line": 2030
      },
      {
        "from": "\"Q\"",
        "to": "escape-Code\n              go to  Main-Exit",
        "line": 2041
      },
      {
        "from": "1",
        "to": "C-Check",
        "line": 2044
      },
      {
        "from": "sih-Customer",
        "to": "WS-Sales-Key",
        "line": 2045
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2047
      },
      {
        "from": "zero",
        "to": "C-Check",
        "line": 2050
      },
      {
        "from": "zeros",
        "to": "Sih-Invoice",
        "line": 2062
      },
      {
        "from": "next-invoice",
        "to": "sih-invoice\n                                     WS-Temp-Invoice\n              add  1 to Next-Invoice          *> Remove same code else where <<\n              perform zz110-Write-System-Record",
        "line": 2067
      },
      {
        "from": "zero",
        "to": "sih-test",
        "line": 2081
      },
      {
        "from": "sih-invoice",
        "to": "Invoice-nos",
        "line": 2082
      },
      {
        "from": "sih-test",
        "to": "Item-nos",
        "line": 2083
      },
      {
        "from": "\"D\"",
        "to": "WS-Deliv-Key-Type",
        "line": 2095
      },
      {
        "from": "WS-Sales-Key",
        "to": "WS-Deliv-Sales-Key",
        "line": 2096
      },
      {
        "from": "zero",
        "to": "delivery-tag\n              go to  Customer-Setup",
        "line": 2099
      },
      {
        "from": "deliv-address",
        "to": "address-a",
        "line": 2102
      },
      {
        "from": "sales-address",
        "to": "address-a",
        "line": 2106
      },
      {
        "from": "1",
        "to": "Z",
        "line": 2114
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2119
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2124
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2129
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2134
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2138
      },
      {
        "from": "spaces",
        "to": "sih-ref sih-order",
        "line": 2141
      },
      {
        "from": "zero",
        "to": "sih-type",
        "line": 2148
      },
      {
        "from": "space",
        "to": "WS-named",
        "line": 2150
      },
      {
        "from": "zero",
        "to": "sih-cr",
        "line": 2162
      },
      {
        "from": "zero",
        "to": "Z",
        "line": 2168
      },
      {
        "from": "zero",
        "to": "we-error",
        "line": 2175
      },
      {
        "from": "999",
        "to": "we-error",
        "line": 2183
      },
      {
        "from": "998",
        "to": "we-error",
        "line": 2187
      },
      {
        "from": "997",
        "to": "we-error",
        "line": 2192
      },
      {
        "from": "zero",
        "to": "Z",
        "line": 2207
      },
      {
        "from": "1",
        "to": "z\n                        Cob-Crt-Status",
        "line": 2210
      },
      {
        "from": "zeros",
        "to": "WS-Del-Inv-Nos",
        "line": 2245
      },
      {
        "from": "zeros",
        "to": "sih-invoice",
        "line": 2246
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2247
      },
      {
        "from": "\"N\"",
        "to": "WS-Using-Del-Inv-No\n              go to l70ac-Close",
        "line": 2257
      },
      {
        "from": "WS-Del-Inv-Nos",
        "to": "sih-invoice",
        "line": 2261
      },
      {
        "from": "\"Y\"",
        "to": "WS-Using-Del-Inv-No",
        "line": 2263
      },
      {
        "from": "next-invoice",
        "to": "sih-invoice",
        "line": 2277
      },
      {
        "from": "zero",
        "to": "WS-delinv",
        "line": 2278
      },
      {
        "from": "zero",
        "to": "WS-CR",
        "line": 2298
      },
      {
        "from": "\"Q\"",
        "to": "escape-Code\n              go to Main-Exit",
        "line": 2302
      },
      {
        "from": "WS-CR",
        "to": "sih-cr",
        "line": 2304
      },
      {
        "from": "\"Z\"",
        "to": "WS-named\n              go to  no-inv-restart\n     else\n              move  space  to  WS-named",
        "line": 2306
      },
      {
        "from": "\"Q\"",
        "to": "escape-Code\n              go to Main-Exit\n     else\n              move space to escape-Code",
        "line": 2312
      },
      {
        "from": "sih-cr",
        "to": "oi3-invoice",
        "line": 2317
      },
      {
        "from": "sih-Customer",
        "to": "oi3-Customer",
        "line": 2318
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2320
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 2344
      },
      {
        "from": "\"A\"",
        "to": "WS-named",
        "line": 2347
      },
      {
        "from": "oi-discount",
        "to": "Display-9",
        "line": 2355
      },
      {
        "from": "oi-deduct-amt",
        "to": "Display-8",
        "line": 2357
      },
      {
        "from": "to-day",
        "to": "u-date",
        "line": 2376
      },
      {
        "from": "SL-BO-Flag",
        "to": "WS-SL-BO-Flag",
        "line": 2380
      },
      {
        "from": "1",
        "to": "WS-Process-Func\n                              WS-Sub-Function\n                    call \"sl070\" using WS-calling-data  *> Create Anal default recs\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15   *> Only If the call failed\n                                                       File-Info *> SHOULD NEVER happen but JIC\n                    If    return-Code not = zero          *> not = zero - No file found\n                          display   SL186 at 2301\n                          display   SL003 at 2401\n                          accept WS-Reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n     perform  Sales-Open",
        "line": 2386
      },
      {
        "from": "zero",
        "to": "menu-reply",
        "line": 2431
      },
      {
        "from": "1",
        "to": "WS-delinv",
        "line": 2435
      },
      {
        "from": "WS-test-date",
        "to": "WS-date",
        "line": 2474
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month    *> done again for UK - but JIC\n              move 1 to Date-Form",
        "line": 2476
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n              go to zz050-test-date",
        "line": 2479
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap  to WS-month\n              move WS-Month to WS-Inv-Month\n              go to zz050-test-date",
        "line": 2482
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "WS-date",
        "line": 2490
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n     move     WS-test-date (9:2) to WS-Days",
        "line": 2493
      },
      {
        "from": "WS-date",
        "to": "u-date",
        "line": 2497
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 2498
      },
      {
        "from": "spaces",
        "to": "WS-Date\n              go to zz060-Exit",
        "line": 2515
      },
      {
        "from": "u-date",
        "to": "WS-date",
        "line": 2517
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 2520
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz060-Exit",
        "line": 2524
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "WS-date",
        "line": 2531
      },
      {
        "from": "to-day",
        "to": "WS-date",
        "line": 2547
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 2550
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz070-Exit",
        "line": 2554
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "WS-date",
        "line": 2561
      },
      {
        "from": "zero",
        "to": "Pass-Value",
        "line": 2579
      },
      {
        "from": "zeros",
        "to": "File-System-Used\n                       File-Duplicates-In-Use",
        "line": 2593
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 2595
      },
      {
        "from": "Pass-Value",
        "to": "WS-Pass-Value",
        "line": 2596
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2597
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2600
      },
      {
        "from": "\"66\"",
        "to": "FA-RDBMS-Flat-Statuses\n              move     1 to File-Key-No\n              move     WS-Pass-Value to Pass-Value  *> restore it\n              perform  System-Open\n              move     1 to File-Key-No\n              perform  System-Rewrite\n              perform  System-Close\n     end-if",
        "line": 2611
      },
      {
        "from": "zeros",
        "to": "File-System-Used\n                       File-Duplicates-In-Use",
        "line": 2622
      },
      {
        "from": "\"00\"",
        "to": "FA-RDBMS-Flat-Statuses",
        "line": 2624
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2625
      },
      {
        "from": "WS-Pass-Value",
        "to": "Pass-Value",
        "line": 2626
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2628
      },
      {
        "from": "zero",
        "to": "Return-Code",
        "line": 2644
      },
      {
        "from": "Sih-Customer",
        "to": "BO-Stk-Cust-No",
        "line": 2650
      },
      {
        "from": "zero",
        "to": "BO-Serial",
        "line": 2652
      },
      {
        "from": "Sih-Type",
        "to": "BO-Stk-Inv-Type",
        "line": 2653
      },
      {
        "from": "Sih-Order",
        "to": "BO-Stk-PO",
        "line": 2654
      },
      {
        "from": "Sih-Ref",
        "to": "BO-Stk-Ref",
        "line": 2655
      },
      {
        "from": "WS-Temp-Invoice",
        "to": "BO-Stk-Orig-Inv-No",
        "line": 2656
      },
      {
        "from": "Stock-Order-Due",
        "to": "BO-Stk-BO-Arr-Date",
        "line": 2658
      },
      {
        "from": "Sih-Date",
        "to": "BO-Stk-Order-Date",
        "line": 2659
      },
      {
        "from": "Stock-Retail",
        "to": "BO-Stk-Price",
        "line": 2660
      },
      {
        "from": "4",
        "to": "Return-Code\n                                exit perform\n                       end-if\n                       exit perform cycle\n              end-perform\n     end-if",
        "line": 2677
      },
      {
        "from": "low-values",
        "to": "BO-Cust-Itm-No",
        "line": 2722
      },
      {
        "from": "zeros",
        "to": "BO-Table-Used  *> active table in use count\n                        Return-Code",
        "line": 2723
      },
      {
        "from": "spaces",
        "to": "WS-Temp-Cust",
        "line": 2726
      },
      {
        "from": "high-values",
        "to": "BOT-Cust-Itm-No (BO-Table-Cnt)\n     end-perform",
        "line": 2735
      },
      {
        "from": "space",
        "to": "WS-Date-Flag     (WS-Item-Table-Used)\n              move     zeros  to WS-Total-Ordered (WS-Item-Table-Used)\n                                 WS-Stock-Held    (WS-Item-Table-Used)\n     end-perform",
        "line": 2740
      },
      {
        "from": "zero",
        "to": "WS-Item-Table-Used\n                        BO-Invoiced-Used",
        "line": 2744
      },
      {
        "from": "zero",
        "to": "BO-Table-Cnt",
        "line": 2746
      },
      {
        "from": "spaces",
        "to": "WS-Temp-Stock-Key",
        "line": 2747
      },
      {
        "from": "4",
        "to": "Return-Code\n                                exit perform\n                       end-if\n                       move     BO-Stk-Itm-Record to BOT-Record (BO-Table-Used)\n              end-if\n              exit     perform cycle\n     end-perform",
        "line": 2768
      },
      {
        "from": "\"N\"",
        "to": "WS-BO-Processing\n              go to    zz200-Exit",
        "line": 2779
      },
      {
        "from": "\"N\"",
        "to": "WS-BO-Processing\n              go to    zz200-Exit",
        "line": 2783
      },
      {
        "from": "zero",
        "to": "Return-Code",
        "line": 2788
      },
      {
        "from": "1",
        "to": "WS-Item-Table-Used\n              move     BOT-Stk-Item-No (1) to WS-Item-No (1)\n              move     BOT-Stk-BO-Qty  (1) to WS-Total-Ordered (1)\n     else\n              sort     BOT-Record on ascending key BOT-Stk-Item-No\n              move     zero   to BO-Table-Cnt\n                                 WS-Item-Table-Used\n              perform  until BO-Table-Cnt not < BO-Table-Used\n                       add      1  to BO-Table-Cnt\n                       if       BO-Table-Cnt > BO-Table-Used\n                                display  \" \" at 0101 with erase eos\n                                display  SL213 at 1201 with foreground-color 4 highlight beep\n                                display  SL208 at 1401 with foreground-color 2\n                                display  SL006 at 1501 with foreground-color 2\n                                accept   WS-Reply at 1545\n                                move     4 to Return-Code\n                                exit perform\n                       end-if\n                       if       WS-Temp-Stock-Key not = BOT-Stk-Item-No (BO-Table-Cnt)\n                                add      1  to WS-Item-Table-Used\n                                move     BOT-Stk-Item-No (BO-Table-Cnt)\n                                                      to WS-Temp-Stock-Key\n                                                         WS-Item-No (WS-Item-Table-Used)\n                                move     BOT-Stk-BO-Qty  (BO-Table-Cnt)\n                                                      to WS-Total-Ordered (WS-Item-Table-Used)\n                       else\n                                add      BOT-Stk-BO-Qty  (BO-Table-Cnt)\n                                                      to WS-Total-Ordered (WS-Item-Table-Used)\n                       end-if\n                       exit perform cycle\n              end-perform   *> Table holds total back ordered per item #\n     end-if",
        "line": 2790
      },
      {
        "from": "\"N\"",
        "to": "WS-BO-Processing\n              go to    zz200-Exit",
        "line": 2823
      },
      {
        "from": "zero",
        "to": "Return-Code",
        "line": 2831
      },
      {
        "from": "1",
        "to": "File-Key-No\n                       perform  Stock-Read-Indexed\n                       If       FS-Reply not = zeros   *> Should not really happen but ",
        "line": 2836
      },
      {
        "from": "8",
        "to": "Return-Code\n                                exit perform\n                       end-if\n                       move     Stock-Held to WS-Stock-Held (WS-Item-Table-Cnt)\n                       if       WS-Total-Ordered (WS-Item-Table-Cnt) > WS-Stock-Held (WS-Item-Table-Cnt)\n                                move     \"Y\" to WS-BO-Date-Order-Processing\n                                                WS-Date-Flag (WS-Item-Table-Cnt)\n                                add      1 to WS-BO-Date-Cnt\n                       end-if\n                       exit     perform cycle\n              end-perform\n     end-if\n     if       Return-Code = 8              *> bad status reading stock record so quit\n              move     \"N\" to WS-BO-Processing\n              go to zz200-Exit",
        "line": 2840
      },
      {
        "from": "\"Y\"",
        "to": "WS-BO-Processing\n     end-if\n*>\n*> Also see further down for question and test",
        "line": 2861
      },
      {
        "from": "BO-Table-Used",
        "to": "WS-Display3-1",
        "line": 2885
      },
      {
        "from": "\"Y\"",
        "to": "WS-Reply",
        "line": 2888
      },
      {
        "from": "\"N\"",
        "to": "WS-BO-Processing\n              go to zz200-Exit",
        "line": 2891
      },
      {
        "from": "\"Y\"",
        "to": "WS-Reply",
        "line": 2895
      },
      {
        "from": "zero",
        "to": "WS-Item-Table-Cnt\n              move     5    to Lin\n              Initialize SInvoice-Header\n              Initialize SInvoice-Bodies\n              perform  until exit\n                       add      1 to WS-Item-Table-Cnt\n                       if       WS-Item-Table-Cnt > WS-Item-Table-Used\n                                display  SL006    at line WS-23-Lines col 1 with foreground-color 2\n                                move     space to WS-Reply\n                                accept   WS-Reply at line WS-23-Lines col 45 with foreground-color 2\n                                exit perform   *> List finished as all displayed\n                       end-if\n                       add      1 to Lin\n                       move     WS-Stock-Held    (WS-Item-Table-Cnt) to WS-Display6-1\n                       move     WS-Total-Ordered (WS-Item-Table-Cnt) to WS-Display6-2\n                       display  WS-Item-No   (WS-Item-Table-Cnt) at line Lin col 01 with foreground-color 2\n                       display  WS-Display6-1                    at line Lin col 16 with foreground-color 2\n                       display  WS-Display6-2                    at line Lin col 23 with foreground-color 2\n                       if       WS-Date-Flag (WS-Item-Table-Cnt) = \"Y\"\n                                display  WS-Display6-1           at line Lin col 16 with foreground-color 3 HIGHLIGHT\n                                display  \"YES\"                   at line Lin col 32 with foreground-color 3 HIGHLIGHT\n                       end-if\n                       if       Lin = WS-22-Lines\n                                display  SL006    at line WS-23-Lines col 1 with foreground-color 2\n                                move     space to WS-Reply\n                                accept   WS-Reply at line WS-23-Lines col 45 with foreground-color 2\n                                if       WS-Item-Table-Cnt not < WS-Item-Table-Used\n                                         exit perform         *> stops dup SL006 etc as could happen",
        "line": 2909
      },
      {
        "from": "5",
        "to": "Lin\n                                display  space at 0601 with erase eos\n                       end-if\n                       exit perform cycle\n              end-perform\n              display  space at 0401 with erase eos\n     end-if",
        "line": 2938
      },
      {
        "from": "To-Day",
        "to": "U-Date",
        "line": 2946
      },
      {
        "from": "zero",
        "to": "U-Bin",
        "line": 2947
      },
      {
        "from": "WS-BO-Date-Cnt",
        "to": "WS-Display3-1\n              move     WS-Item-Table-Used to WS-Display3-2\n              display  SL216    at 0401 with erase eos foreground-color 2\n              display  WS-Display3-1 at 0411  with foreground-color 3\n              display  WS-Display3-2 at 0417  with foreground-color 3\n              display  SL217         at 0601  with foreground-color 2\n              move     space to WS-Reply\n              accept   WS-Reply at 0671 with foreground-color 3 UPPER\n              if       WS-Reply = \"Y\"\n                       move     \"N\" to WS-BO-Date-Order-Processing\n                       sort     BOT-Record on ascending key BOT-Cust-Itm-No\n                       move     \"Y\" to WS-BO-Processing\n              end-if\n     end-if\n*>\n*> Start of Primary BO Item processing\n*>\n     move     zero to Return-Code\n                      BO-Invoiced-Used\n                      BO-Invoiced-Cnt   *> so far not used\n                      BO-Table-Cnt",
        "line": 2958
      },
      {
        "from": "\"N\"",
        "to": "WS-BO-Processing\n                       exit perform\n              end-if\n              If       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                       move     BOT-Stk-Cust-No (BO-Table-Cnt) to WS-Temp-Cust   *> save for compare against change of cust\n              end-if\n*>\n*> Create header rec based In Invoice-Details\n*>\n              Initialize SInvoice-Header with filler\n              move     U-Bin            to Sih-Date\n              move     BOT-Stk-Cust-No (BO-Table-Cnt)  to Sih-Customer\n                                                          WS-Sales-Key\n              move     1  to C-Check\n              move     1  to File-Key-No\n              perform  Sales-Read-Indexed    *> JIC Cust",
        "line": 2982
      },
      {
        "from": "zeros",
        "to": "Sih-Invoice\n              If       Del-Exists\n                       perform  Get-a-Deleted-Invoice\n              end-if\n              move     zero         to Sih-Test\n              perform  until exit  *> Get a new Invoice # if sih-invoice = 0 (no deleted invoices)\n                       If       Sih-Invoice = zeros\n                                perform  zz100-Read-System-Record\n                                move     next-invoice  to  sih-invoice\n                                                           WS-Temp-Invoice\n                                add      1 to Next-Invoice          *> Remove same code else where\n                                perform  zz110-Write-System-Record\n                       end-if\n                       move     sih-invoice  to  Invoice-nos\n                       move     sih-test     to  Item-nos\n                       perform  Invoice-Read-Indexed\n                       If       fs-reply not = zero   *> Rec not present thats good\n                                exit perform\n                       else\n                                move     zero to Sih-Invoice\n                                exit     perform cycle  *> get next Inv # as It is present\n                       end-if\n              end-perform\n*>\n*> Have a good Invoice # in Sih_invoice\n*>\n              move     BOT-Stk-PO       (BO-Table-Cnt) to Sih-Order\n              move     BOT-Stk-Ref      (BO-Table-Cnt) to Sih-Ref\n              move     BOT-Stk-Inv-Type (BO-Table-Cnt) to Sih-Type\n              Initialise SInvoice-Bodies  *> No Filler present\n*>\n              display  prog-name at 0101 with foreground-color 2 erase eos\n              perform  zz070-Convert-Date\n              display  WS-date at 0171 with foreground-color 2\n              display  \"Back Order Processing\" at 0229 with foreground-color 2\n              display  \"****************************************\" at 0441 with foreground-color 2\n              display  \"*                  *                   *\" at 0541 with foreground-color 2\n              display  \"*A/C Nos  <       >*Ref    [          ]*\" at 0641 with foreground-color 2\n              display  \"*Invoice <        >*Order  [          ]*\" at 0741 with foreground-color 2\n              display  \"****************************************\" at 0841 with foreground-color 2\n              display  \"Type [ ]  <1> = Receipt; <2> = Account; <4> = Pro-Forma\"\n                                                         at 1001  with foreground-color 2\n*>\n              display  Sih-Customer at 0652 with foreground-color 3\n              display  Sih-Invoice  at 0751 with foreground-color 3\n              display  Sih-Ref      at 0669 with foreground-color 3\n              display  Sih-Order    at 0769 with foreground-color 3\n              display  Sih-Type     at 1007 with foreground-color 3\n              display  ws-dash      at 1101 with foreground-color 2\n*>\n              move     Sih-Customer  to WS-Sales-Key\n              move     1 to File-Key-No\n              perform  Sales-Read-Indexed\n              move     Sales-Address  to  Address-A\n              perform  Customer-Display  *> Display  name & address\n*>\n              display  \"Stock Linked\" at 1201 with foreground-color 2\n              display  \"Line - \"               at 1216 with foreground-color 2\n              display  \"Net <          >\"      at 1227 with foreground-color 2\n              display  \"Vat <          >\"      at 1244 with foreground-color 2\n              display  \"Invoice <          >\"  at 1261 with foreground-color 2\n              display  \"Product     <----------Description--------->    Qty   Unit Price  Disc",
        "line": 3006
      },
      {
        "from": "zero",
        "to": "I\n              perform  zz300-Display-Outline-2 varying lin from 16 by 1\n                                                until lin not < ws-23-lines\n              subtract WS-Accept-Body from I                    *> M = WS-accept-body\n              move     1  to  J\n              add      J  14  giving  lin  *> minus 1 to allow for the ADD\n*>\n              move     1 to I\n*>\n              display  I at 1223 with foreground-color 3  *> Line # for item #\n*>   Get-data-2-main\n              perform  until exit\n                       if       BO-Table-Cnt > BO-Table-Used\n                                move     \"N\" to WS-BO-Processing\n                                exit perform   *> Ditto ^^\n                       end-if\n                       if       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                                exit perform\n                       end-if                *> Should never happen as tested 1st level perform\n                       add      1 to Lin\n                       move     2 to cole\n                       move     BOT-Stk-Item-No (BO-Table-Cnt)  to WS-Product\n                                                                   Sil-Product (I)\n                                                                   Test-Product\n                                                                   WS-Temp-Stock-Key\n                       display  WS-Product at curs with foreground-color 2\n*>\n*>   Get stock rec (Get-Simple-Stock)\n*>\n                       move     spaces  to  Sil-Description (I)\n                       If       WS-Stock-No-Long = spaces\n                                move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                                move 2 to File-Key-No\n                       else\n                                move WS-Temp-Stock-Key to WS-Stock-Key\n                                move 1 to File-Key-No\n                       end-if\n                       perform  Stock-Read-Indexed\n                       If       FS-Reply = 21 or = 23   *> Should never happen - BUT JIC\n                                move SL196 to WS-Stock-Desc\n                                move     spaces         to WS-PA\n                                                           PA-group\n                                                           Sil-PA (I)\n                       else\n                                move     Stock-SA-Group to WS-PA\n                                                           PA-group\n                                                           Sil-PA (I)\n                       end-if\n*>\n                       move     17 to cole        *> Desc\n                       display  WS-Stock-Desc   at curs with foreground-color 3\n                       move     WS-Stock-Desc to WS-Description\n                                                 Sil-Description (I)\n                       move     BOT-Stk-BO-Qty (BO-Table-Cnt) to WS-Qty\n                       move     53 to cole        *> QTY\n                       If       Stock-Services-Flag = \"Y\"\n                                move 1 to WS-Qty\n                       end-if\n *>                      display  WS-Qty at curs with foreground-color 3\n                       accept   WS-Qty at curs with foreground-color 3 update\n                       If       WS-Qty = zero       *> Cancel/Ignore BO transaction on zero or Escape\n                         OR     Cob-Crt-Status = Cob-Scr-Esc\n                                If       I > zero   *> JIC\n                                         move     \"S\" to WS-Reply     *> Skip this time\n                                         display  SL220 at line WS-23-Lines col 1 with foreground-color 4 with erase eos\n                                         display  SL221 at line WS-Lines col 5 with foreground-color 3 Highlight\n                                         accept   WS-Reply at line WS-23-Lines col 72\n                                                           with foreground-color 3 UPPER UPDATE\n                                         if       WS-Reply = \"D\"\n                                                  move BOT-Cust-Itm-No (BO-Invoiced-Cnt)  to BO-Cust-Itm-No\n                                                  delete   BO-Stk-Itm-File record  *> Dont care if invalid, hopefully\n                                         end-if  *> otherwise, it is Skip it, this time\n                                         display  space at line WS-23-Lines col 1 with erase eos\n                                         Initialise Invoice-Lines (I)  *> clear down any above entered data\n                                         subtract 1 from I             *>  for Item line\n                                end-if\n                                if       BO-Table-Cnt + 1 > BO-Table-Used\n                                         if       I > 1\n                                                  perform  End-Totals  *> does P&P etc",
        "line": 3073
      },
      {
        "from": "2",
        "to": "Return-Code  *> exit top perform\n                                         exit     perform   *> I = 1 = no transactions\n                                end-if\n                                add      1 to BO-Table-Cnt\n                                if       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                                         move     1 to Return-Code\n                                         exit     perform\n                                end-if\n                       end-if                *> Should never happen as tested 1st level perform\n                       if       BO-Table-Cnt > BO-Table-Used\n                                move     \"N\" to WS-BO-Processing\n                                move     2 to Return-Code\n                                exit perform\n                       end-if\n*>\n                       move     60 to cole  *> Unit Price\n                       move     Stock-Retail to WS-Tmp-Stk-Price\n*>\n*>  What to do If BO price and stock not the same  ??\n*>\n                       move     \"B\" to WS-Reply\n*>\n*> Set default as using BO price, Reply = B or S = Stock price\n*>\n                       If       BOT-Stk-Price (BO-Table-Cnt) not = Stock-Retail\n                                move     BOT-Stk-Price (BO-Table-Cnt) to WS-Tmp-BO-Price\n                                move     Stock-Retail to WS-Tmp-Stk-Price\n                                display  SL209 at line WS-23-Lines col 1 with foreground-color 4\n                                                                         highlight beep erase eol\n                                display  SL003 at line WS-Lines  col 1   with foreground-color 2\n                                accept   WS-Reply at line WS-Lines col 30 with foreground-color 3\n                                                                               UPDATE\n                                display  \"BO Price - \"    at line WS-23-Lines col 1\n                                                             with foreground-color 2 erase eos\n                                display  WS-Tmp-BO-Price  at line WS-23-Lines col 12\n                                                             with foreground-color 2\n                                display  \"Stock Price - \" at line WS-23-Lines col 35\n                                                             with foreground-color 2\n                                display  WS-Tmp-Stk-Price at line WS-23-Lines col 49\n                                display  SL210 at line WS-Lines col 1 with foreground-color 2\n                                If       BOT-Stk-Inv-Type (BO-Table-Cnt) not = 1 and not = 2\n                                         move     \"S\" to WS-Reply  *> Using stock price for proformas else BO rec price\n                                else\n                                         move     \"B\" to WS-Reply\n                                end-if\n                                accept   WS-Reply at line WS-Lines col 45 with foreground-color 3\n                                                                               UPPER UPDATE\n*>  NET\n                                If       WS-Reply = \"B\"\n                                         multiply WS-Qty by BOT-Stk-Price (BO-Table-Cnt) giving WS-Net\n                                         display  WS-Tmp-BO-Price at curs with foreground-color 3\n                                         move     BOT-Stk-Price (BO-Table-Cnt) to WS-Unit\n                                else\n                                         multiply WS-Qty by Stock-Retail giving WS-Net\n                                         display  WS-Tmp-Stk-Price at curs with foreground-color 3\n                                         move     Stock-Retail to WS-Unit\n                                end-if\n                       else             *> BO and Stock price the same\n                                multiply WS-Qty by Stock-Retail giving WS-Net\n                                move     Stock-Retail to WS-Unit\n                                display  WS-Tmp-Stk-Price at curs with foreground-color 3\n                       end-if\n                       move     WS-Qty  to Sil-Qty (I)\n                       move     WS-Net  to Sil-Net (I)\n                                           Display-9\n                       move     WS-Unit to Sil-Unit (I)\n                       display  Display-9 at 1232 with foreground-color 3\n*>\n*>  Discount\n*>\n                       move     Sales-Discount  to  WS-discount\n                       move     72 to cole\n                       move     WS-disc-wka to WS-disca1\n                       move     WS-disc-wkb to WS-disca3\n                       display  WS-discount-display at curs with foreground-color 3\n                       accept   WS-discount-accept  at curs with foreground-color 3 update\n                       move     WS-discb1 to WS-disc-wka\n                       move     WS-discb3 to WS-disc-wkb\n                       move     WS-discount to  work-d Sil-discount (I)\n                       move     WS-Net to  work-n\n                       multiply work-n by work-d giving work-1\n                       divide   work-1 by 100    giving work-1\n                       subtract work-1  from  WS-Net\n                       move     WS-Net to Sil-Net (I) Display-9\n                       display  Display-9 at 1232 with foreground-color 3\n*>\n*>   VAT\n*>\n                       move     \"S\" to Vat-Code-X  *> 17/2/23  for Standard rate\n                       move     79 to cole\n                       display  Vat-Code-X at curs with foreground-color 3\n                       accept   Vat-Code-X at curs with foreground-color 3 update\n*>\n                       If       Vat-Code-X = \"S\"    *> Standard code 1\n                                move 1 to Vat-Code\n                        else\n                         If     Vat-Code-X = \"R\"    *> Reduced  code 2\n                                move 2 to Vat-Code\n                          else\n                           If   Vat-Code-X = \"Z\"    *> Zero     code 3\n                                move 3 to Vat-Code\n                           end-if\n                         end-if\n                       end-if  *> Otherwise assuming it is 1, 2 or 3 but could be 4 or 5 for say USA\n*> using 1st three as last 2 are Sales tax, Not 4 UK but used outside UK, EU & AUZ etc so supported\n                       If       Vat-Code < 1 or > 5  *> so change test for 'not\n                                move 3 to Vat-Code   *> = 4 or 5' Instead of '> 3'\n                       end-if\n                       move     Vat-Code  to  Sil-Vat-Code (I)\n*>\n                       If       Vat-Code = zero\n                                move  zero  to  WS-VAT\n                       else\n                                move VAT-Rate (Vat-Code) to WS-VAT-Rate\n                                compute  WS-VAT rounded = (WS-Net * WS-VAT-Rate) / 100\n                       end-if\n*>\n                       move     WS-VAT to  Display-9\n                                           Sil-VAT (I)\n                       display  Display-9 at 1249 with foreground-color 3\n                       perform  Running-Totals    *> GOOD for Inline so display for line 12\n*>\n                       add      1  to  J  *> Display line\n                       add      1  to  I  *> inv body no\n*>\n                       add      1  to  BO-Invoiced-Used\n                       if       BO-Invoiced-Used > BO-Invoiced-Size   *> size 50 for 1 cust, should never happen but JIC\n                                display  \" \" at 0101 with erase eos\n                                display  SL218 at 1201 with foreground-color 4 highlight beep\n                                display  \"(\"   at 1265 with foreground-color 4\n                                display  BO-Invoiced-Size at 1266 with foreground-color 4\n                                display  \")\"   at 1268 with foreground-color 4\n                                display  SL208 at 1401 with foreground-color 2\n                                display  SL006 at 1501 with foreground-color 2\n                                accept   WS-Reply at 1545\n                                move     8 to Return-Code\n                                exit perform\n                       end-if\n                       move     BOT-Cust-Itm-No (BO-Table-Cnt) to BO-Invoiced-Record (BO-Invoiced-Used)\n*>\n                       if       BO-Table-Cnt + 1 > BO-Table-Used\n                                if       I > 1\n                                         perform  End-Totals\n                                         perform  zz210-Delete-BO-Records\n                                end-if\n                                move     2 to Return-Code  *> exit top perform\n                                exit     perform   *> I = 1 = no transactions\n                       end-if\n\n                        if      BOT-Stk-Cust-No (BO-Table-Cnt + 1) not = WS-Temp-Cust\n                          and   I > 1\n                                perform  End-Totals\n                                perform  zz210-Delete-BO-Records\n                                move     1 to Return-Code  *> get next BO table record\n                                exit     perform\n                        end-if\n              end-perform\n              if       Return-Code = 1  *> Top level perform get next BO table rec (& store cust-no -> ws-temp-cust)\n                       exit perform cycle\n              end-if\n              if       Return-Code = 2   *> no more table entries, exit top perform\n                       move     \"N\" to WS-BO-Processing\n                       exit perform\n              end-if\n              if       Return-Code = 8   *> BO-invoiced table exceeded - BO process aborted\n                       move     \"N\" to WS-BO-Processing\n                       exit perform\n              end-if\n     end-perform",
        "line": 3154
      },
      {
        "from": "spaces",
        "to": "Exception-Msg\n                       string   BO-Stk-Cust-No \"/\" BO-Stk-Item-No \"/\" BO-Serial\n                                  into Exception-Msg\n                       display  Exception-Msg  at line  WS-23-Lines col 37 with foreground-color 4\n                       display  SL006          at line  WS-Lines    col 1  with foreground-color 2\n                       accept   WS-Reply at line WS-Lines col 45\n              end-delete\n     end-perform",
        "line": 3339
      },
      {
        "from": "1",
        "to": "cole",
        "line": 3355
      },
      {
        "from": "49",
        "to": "cole",
        "line": 3357
      }
    ],
    "computes": [
      {
        "target": "Audit-Stock-Value-Change",
        "expression": "Audit-Transaction-Qty\n                                    * Stock-Cost * -1\n                       subtract Audit-Transaction-Qty from Stock-Held\n              else\n               If      Sih-Type = 3\t\t*> Credit note\n                 and   Stock-Services-Flag not = \"Y\"\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost\n                       add Audit-Transaction-Qty to Stock-Held\n               end-if\n              end-if\n*>\n*> Should NOT happen as tested In data entry\n*>\n              If       Stock-Held < zero\n                 and   Stock-Services-Flag not = \"Y\"\n                       multiply -1 by Stock-Held\n                       add Stock-Held to Stock-Pre-Sales\n                       move zero to Stock-Held\n              end-if\n              If       Stock-Held > zero\n                 and   Stock-Services-Flag not = \"Y\"\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) Invoices but reversed",
        "line": 915
      },
      {
        "target": "sih-extra",
        "expression": "(sih-Net * extra-rate) / 100\n     else\n              move  zero  to  sih-extra",
        "line": 1898
      },
      {
        "target": "amt-ok6",
        "expression": "sih-extra  *  VAT-Rate-1  /  100",
        "line": 1912
      },
      {
        "target": "amt-ok7",
        "expression": "sih-Net  /  10",
        "line": 1954
      }
    ]
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "needed for BO Table size but should be enough  :-\n*>                  likewise for Item-Table\n*>\n>>DEFINE CONSTANT   X-BO-Table-Size  AS  500   *> # of Back Orders at ANY one time\n>>DEFINE CONSTANT   X-Itm-Table-Size AS  100   *> # of DIFFERENT Stock items on BO\n>>DEFINE CONSTANT   X-BO-Delete-Size AS   50   *> # of BO Delete table entries per invoice\n\n*> End of CDF constants\n*>\n*>  THERE IS TEST CODE IN THIS PROGRAM - REMOVE AFTER see zz210  <<<<<<<<<\n*>         as prevents the deleting of BO records so thay can be reused.\n*>\n*>  This program Is very similar to sl810 (autogen)\n*> so consider any changes to both but not for BO processing as not needed.\n*>\n*>***************************************************\n*>                                                  *\n*>               Invoice  Data  Entry               *\n*>                                                  *\n*>  This program Is used for both Batch & Immediate *\n*>   Invoice printing, Pass-Value = 3 = Immediate   *\n*>",
        "line": 3
      },
      {
        "type": "IF",
        "condition": "Invoice WS-Named On\n*>                Cr. Notes.\n*> 02/05/83 Vbc - #.\n*> 13/10/83 Vbc - Use Deleted Invoice Nos If Available.\n*> 17/11/83 Vbc - Cis Cobol Conversion.\n*> 24/02/84 Vbc - Clear WS-Named Before Usage.\n*> 01/03/84 Vbc - Support Of Sales-Unapplied In Invoice-Details.\n*> 10/03/84 Vbc - Support Of sih-Day-Book-Flag.\n*> 12/05/84 Vbc - Support Of Graphics,If Cn Check Openitm File.\n*> 16/11/84 Vbc - Fix Abort Graphics Screen In Invoice-Details.\n*> 07/01/85 Vbc - Fix Bug Clear Screen In Cr-Notes.\n*> 03/03/09 vbc - .04 Migration to Open Cobol v3.00.00.\n*> 16/03/09 vbc - .05 Bug/Feature 30.1 & 3 escape out at any level.\n*> 04/04/09 vbc - .06 Support for F1 (or NEW) on Customer no. to create new\n*>                    account. Sales & Purchase ledger both match function.\n*>                    Changed usage of deleted folio nos. by\n*>                    deleting record after re-use, matches PL020.\n*> 26/11/11 vbc - .07 Error msgs to SLnnn.Support for dates other than UK\n*> 08/12/11 vbc - .08 Support for path+filenames.\n*> 09/12/11 vbc -     Updated version to 3.01.nn\n*> 11/12/11 vbc - .09 Changed usage of Stk-Date-Form to global Date-Form making former redundent.\n*> 17/04/13 vbc       Note change regarding Invoicer setting = 2 did not reflect sl910 ?\n*>                    Clear display for F1 key after accepting a valid cust no.\n*> 15/05/13 vbc - .10 Add In support for direct link to Stock Control with Stock and Audit files\n*>                    In Inv-Level-2. Changed stk code 12>13, desc 24>32 removing pa code\n*>                    and consider add new display field OS for Out of Stock but on order\n*>                    with delivery expected In 7 days or less\n*>\t\t      MORE?????\n*>                    [all this also In sl920 and need to look at 930 - 960 for any needed changes]\n*> 22/05/13 vbc - .11 Bug fixes from 09/10.\n*>                .12 Ditto, missing stock-value computation.\n*> 24/05/13 vbc - .13 Changed coding to use WS-accept-body Instead of '8' for larger screens\n*>                    than 24 lines. Added Invoice to Audit record.\n*>                    NEED TO CHECK CREDIT NOTE PROCESSING FOR REQUIREMENT FOR AUDIT FILE &\n*>                    STOCK FILE PROCESSING!!\n*> 30/04/15 vbc - .14 Changed file access for delinvoices (and for purchase pl020)\n*>                    to ISAM - other modules need changing?\n*> 24/10/16 vbc - .15 ALL programs now using wsnames.cob In copybooks\n*> 30/10/16 vbc - .16 Support for RDB on  Analysis, Stock & Stock Audit tables\n*>                    Instead of cobol files\n*>                    using acas010, acas011 & acas015. Update version to v3.02\n*>                    more to do, have renamed the calls for acas010,11 & 15\n*>                    Stock-Audit, Stock & Analysis to reduce any coding errors\n*>                    as there will be a lot of them In this module.\n*> 15/01/17 vbc - .17 All programs upgraded to v3.02 for RDB processing.\n*>                    -------------------------------------------------\n*>                    Removed maps99 processing.\n*>                    OTher RDB processing added - still Invoicing O/S.\n*> 17/01/17 vbc - .18 Migrated all but Invoice & ITM3 files to FH & DAL.\n*> 18/01/17 vbc - .19 Support for Vat-Code-X for S(tandard), R(educed), Z(ero)\n*>                    In place of 1, 2, 3.\n*> 20/01/17 vbc - .20 Removed the Letter postfix after Invoice nos when using\n*>                    own Invoice nos, as created for one Customer many years\n*>                    ago, which could cause Issues when posting to ITM3.\n*>                    2 B removed from the Invoice file layout.\n*> 25/01/17 vbc       Dry testing completed.\n*> 10/02/17 vbc - .21 Updated FD/WS for 016,019 and replaced cobol verbs\n*>                    for access to FH/DALs.\n*> 17/04/17 vbc -     Dry checked for slinvoiceMT.\n*> 27/08/17 vbc - .22 Added Message SL194 - Stock Read : {a read error}\n*>                           and    SL195 - Stock Rewrite : {a write error}\n*>                    Instead of embedded msg/s.\n*>                    Using SL194 In Test-For-Read-Stock Instead of embedded.\n*>                    likewise SL196 In place of \"Not Found\" and \"End of file\".\n*> 05/03/18 vbc - .23 Removed unused msgs 187, 188, 189 changed description of some msgs.\n*> 17/03/18 vbc - .24 Added test for type = 4 (proformas) In Update-Stock-n-Audit\n*>                    as we do not want to update stock-held or do audit until\n*>                    It Is amended to a receipt or a Invoice. Matches sl920.\n*> 19/03/18 vbc - .25 Pre-rewrite of update stock-adds/deducts & stock-TD-adds/deds.\n*>                    Similar block must be In sl920 and sl940. Copy block to sl940\n*> 21/04/18 vbc - .26 Updated to support swapout of screen data when F1 Is pressed.\n*>                     a little experimental.\n*>                    With chg to wsfnctn set path of current dir so can del temp\n*>                    screen save file. NOT YET CODED IN and NOT added to sl920.\n*>                .27 No Idea!\n*> 27/01/23 vbc - .28 For SL006 accepts moved loc to 45.\n*>\n*>                    Just above Process-Stock-Record the multi copy of code\n*>                    Is abbreviated as Indexed reads etc for stock or abbrev\n*>                    key can be In a simpler code block now with orig rem.d out\n*>                    ALSO there might be an Issue at Get-Prod-Test If screen\n*>                     Is longer than 24 - TEST THIS. <<<<<<\n*>\n*> 10/12/22 vbc   .29 Added para after some sections 4 GC 3.2 warning msgs.\n*> 17/02/23 vbc   .30 Force VAT rate to S = Standard as default - user can chng.\n*> 09/05/23 vbc - .31 Near end of type-Input changed 2 None Zero or ESC To Abort\n*>                    and next line to start at 40 Instead of 60.\n*> 20/05/23 vbc -     Change WS-Show-Delivery from pic 9 to X.\n*> 06/08/23 vbc   .32 Better support for service Items set default qty = 1.\n*>                    no further checking but check for audit as well.\n*>                    Test for Invoice type < 1 on Invoice Input.\n*> 10/03/24 vbc - .33 When writing out Invoices If status = dup key read system\n*>                    rec & get next-invoice, use It and add 1",
        "line": 108
      },
      {
        "type": "IF",
        "condition": "using a Del Inv. no. as It still\n*>                    has to get done. Yes this progran reads and rewrite system\n*>                    rec.  Need to do same In PL folio creation.  NEEDS TESTING\n*> 17/03/24 vbc - .34 Add support for BO (back orders) providing the param rec\n*>                    field SL-BO-Flag = \"Y\" and only applies to SL Customers\n*>                    with field Sales-Partial-Ship-Flag = \"Y\". [Also for sl920\n*>                    no kill it ].\n*>                    All BO processing here, st020, sl970 Only use File\n*>                    processing and not FH / DAL as only the 3 programs involved.\n*>                    Also BO processing is expected to be temporary in nature.\n*>\n*>                    Added new file bostkitm to process BO records. [zz120]\n*>                    SL192 should be using SL186 - changed and 192 removed.\n*>                    If stock-held = zero & BO not zero use zero for Invoice-no\n*>                    Stock linked MUST be \"Y\" for BO processing.\n*>                    Also see WS-BO-Stocked\n*>                    At start of program run BO file processing if and newly\n*>                    arrived stock\n*>                    Remove all direct file processing using open,close,\n*>                    read etc. NEEDS A CLOSE EXAMININATION.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 19/04/24 vbc   .35 Fix missing code for dealing with BO processing where\n*>                    stock < than needed so needs a new BO record AFTER old\n*>                    deleted. Using a serial no after the cust-itm fields to\n*>                    deal with it allows for up to 10 additions and traps if >\n*>                    10 with err msg Should !, never happen.\n*> 23/04/24 vbc   .36 set I = 1 if zero for get-inv-1 & 2 as runtime test shows\n*>                    it as 0. why has this never shown up before in normal\n*>                    running although possibly as a result of using -D -G for\n*>                    the compile ?\n*>                    In Confirmation remark out add 1 to next-invoice\n*> 25/04/24 vbc - .37 Save and",
        "line": 201
      },
      {
        "type": "IF",
        "condition": "Qty zero and BO active` where\n*>                    a return to get product happens.\n*> 29/04/24 vbc   .39 Chg BO head data from color 1 to 3 - I can't read them.\n*>                    Ditto for Line # change all to 2 (green) as 1 was blue.\n*>                    For BO display cust address etc.\n*> 07/06/24 vbc   .40 Using WS-22-Lines and for accept-body - ws-22-lines\n*>                    instead of 23 so screen size should be > 26 set by user.\n*>                    BO code changes & support sort by date if stock > BO\n*>                    orders AND only one stock item is Back Ordered.\n*> 20/08/24 vbc       Dry testing BO coding.\n*> 11/09/24 vbc   .41 Support for VAT-Rates 4 & 5 + extra coding for BO processing.\n*> 14/09/24 vbc       Finish off coding for BO to remove invoiced BO records\n*>                    currently remarked out to save reinputting test data\n*> 14/09/24 vbc       More new error SL msgs added 201 - 220. Add to manuals\n*> 12/12/24 vbc       Extra code in BO proc. for Qty = zero chk for \"D\"",
        "line": 235
      },
      {
        "type": "IF",
        "condition": "It breaks, you own both pieces but I will endeavour\n*> to fix It, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n*>\n Input-output            section.\n*>------------------------------\n*>\n file-control.\n*>------------\n*>\n copy \"selboitm.cob\".    *> NOT using FH or DAL modules at all.\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>------------\n*>\n  *> This MUST be same content / size as fdboitm.cob and wsboitm.cob, i.e., 72 bytes.\n copy \"fdboitm.cob\".\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"SL910 (3.02.47)\".\n 77  Exception-Msg       pic x(25) value spaces.\n*>\n 01  WS-amount-screen-display6.\n     03  WS-poundsd6     pic 9(6).\n     03  WS-period6      pic x     value \".\".\n     03  WS-penced6      pic v99.\n 01  WS-amount-screen-accept6 redefines WS-amount-screen-display6.\n     03  WS-pound6       pic 9(6).\n     03  filler          pic x.\n     03  WS-pence6       pic v99.\n*>\n 01  WS-amount-work6.\n     03  amt-wk-pds6     pic 9(6).\n     03  amt-wk-pence6   pic v99.\n 01  WS-amount-ok6 redefines WS-amount-work6.\n     03  amt-ok6         pic 9(6)v99.\n*>\n 01  WS-amount-screen-display7.\n     03  WS-poundsd7     pic 9(7).\n     03  WS-period7      pic x     value \".\".\n     03  WS-penced7      pic v99.\n 01  WS-amount-screen-accept7 redefines WS-amount-screen-display7.\n     03  WS-pound7       pic 9(7).\n     03  filler          pic x.\n     03  WS-pence7       pic v99.\n*>\n 01  WS-amount-work7.\n     03  amt-wk-pds7     pic 9(7).\n     03  amt-wk-pence7   pic v99.\n 01  WS-amount-ok7 redefines WS-amount-work7.\n     03  amt-ok7         pic 9(7)v99.\n*>\n 01  WS-discount-display.\n     03  WS-disca1       pic 99.\n     03  WS-disca2       pic x        value \".\".\n     03  WS-disca3       pic v99.\n 01  WS-discount-accept redefines WS-discount-display.\n     03  WS-discb1       pic 99.\n     03  filler          pic x.\n     03  WS-discb3       pic v99.\n 01  WS-discount-work.\n     03  WS-disc-wka     pic 99.\n     03  WS-disc-wkb     pic v99.\n 01  WS-discount redefines WS-discount-work  pic 99v99.\n*>\n*> REMARK OUT, ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n*>     03  System-Record          pic x.  *> added 10/03/24\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n*>     03  WS-Stock-Audit-Record  pic x.\n*>     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n*>     03  WS-Delivery-Record     pic x.\n*>     03  WS-Analysis-Record     pic x.\n*>     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n*>     03  WS-Invoice-Record      pic x.\n*>     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  WS-data.\n     03  test-product.\n         05  filler      pic x.\n             88  Sil-comment              value \"/\".\n         05  filler      pic x(12).\n     03  WS-Pass-Value   pic 9.\n     03  menu-reply      pic 9.\n     03  WS-reply        pic x.\n     03  C-Check         pic 9.\n         88  c-exists                    value  1.\n     03  WS-delinv       pic 9           value zero.\n         88  del-exists                  value 1.\n     03  Address-A       pic x(96).\n     03  address-line.\n         05 add-line1    pic x(15).\n         05 add-line2    pic x(21).\n     03  WS-named        pic x           value \" \".\n     03  WS-dash         pic x(80)       value all \"-\".\n     03  work-1          pic 9(7)v99.\n     03  work-n          pic 9(7)v99.\n     03  work-d          pic 9(7)v99.\n     03  Display-8       pic z(5)9.99.\n     03  Display-9       pic z(6)9.99.\n     03  Vat-Code-X.                           *> this for S, R, Z = Std,Reduced,Zero\n         05  Vat-Code    pic 9.                *> 18/01/17\n     03  I               pic 99.\n     03  J               pic 99.\n     03  K               pic 99.\n     03  M               pic 99.\n     03  Z               pic 99.\n     03  escape-Code     pic x.\n     03  new-screen      pic 9(8).\n     03  altypes         pic x(60)\n          value \"Receipt <<<    Account <<<    Credit Note <<<Pro-Forma <<<\".\n     03  filler redefines altypes.\n         05 D-Types      pic x(15) occurs 4.\n     03  WS-VAT-Rate     pic 99v99.\n     03  WS-PA           pic xx.\n     03  WS-product      pic x(13).\n     03  WS-Temp-Stock-Key                    value spaces.\n         05  WS-Abrev-Stock\n                         pic x(7).\n         05  WS-Stock-No-Long\n                         pic x(6).\n     03  WS-Temp-Invoice pic 9(8).\n     03  WS-Temp-Cust    pic x(7)             value spaces. *> Used for BO processing zz200\n     03  WS-BO-Stk-Item-Cnt\n                         pic 9(4)             value zero. *> Count of # of items on BO now in stock\n     03  WS-Tmp-BO-Price pic z(6)9.99.\n     03  WS-Tmp-Stk-Price\n                         pic z(6)9.99.\n     03  WS-BO-Default-Post\n                         pic 99.99            value zero.\n     03  WS-Description  pic x(32).\n     03  WS-Qty          pic 9(5).\n     03  WS-Net          pic 9(7)v99.\n     03  WS-VAT          pic 9(7)v99.\n     03  WS-Unit         pic 9(7)v99.\n     03  WS-CR           pic 9(8).\n     03  WS-Dayes        pic 99.\n     03  WS-Inv-Month.\n         05  WS-Inv-Mth  pic 99.\n     03  WS-Show-Delivery pic x.\n     03  WS-Using-Del-Inv-No pic x       value space.\n     03  WS-SL-BO-Flag   pic x.\n         88  WS-BO-Used                  value \"Y\".\n     03  WS-BO-Can-Be-Used pic x.\n         88  WS-BO-Usable                value \"Y\".\n*>  NOT CURRENTLY USED\n     03  WS-BO-Stocked   pic x           value \"N\".\n         88  WS-BO-Stock-Avail           value \"Y\".  *> ONLY If BO-Stk file has any recs with BO-Stk-Arrived-Flag = \"Y\"\n*> NOT YET USED\n     03  WS-BO-Processing pic x          value space.\n     03  WS-BO-Date-Order-Processing\n                         pic x           value space.\n         88  WS-BO-Process-By-Date       value \"Y\".   *> stock qty < Back Orders.\n     03  WS-BO-Date-Cnt  pic 999         value zero.\n     03  WS-Display6-1   pic z(5)9.\n     03  WS-Display6-2   pic z(5)9.\n     03  WS-Display3-1   pic zz9.                     *> used in zz200 BO processing\n     03  WS-Display3-2   pic zz9.                     *> used in zz200 BO processing\n     03  WS-Display2-2   pic z9.\n*>\n*> Above also needs SL-BO-Flag = Y (Sales-BO-Set) for Invoice usage.\n*>\n     03  WS-env-lines    pic 999         value zero.\n     03  WS-lines        binary-char unsigned value zero.\n     03  WS-accept-body  binary-char unsigned value 8.         *> set for 24 line screen (-1) but Not yet In use\n     03  WS-22-lines     binary-char unsigned value zero.\n     03  WS-23-lines     binary-char unsigned value zero.\n*>\n*> Table holds BO records that have Arrived = \"Y\" with Quantities on order\n*>  (accumulated for all orders for specific item) and stock held\n*>\n 01  Item-Table.\n     03  WS-Item-Table-Cnt        pic 9(4)    value zero.\n     03  WS-Item-Table-Used       pic 9(4)    value zero.\n     03  WS-Item-Table-Size       pic 999     value X-Itm-Table-Size.\n     03  WS-Item-Table.\n         05  WS-Items                  occurs X-Itm-Table-Size.   *> MUST be same as WS-Item-Table-Size\n             07  WS-Item-No       pic x(13).\n             07  WS-Date-Flag     pic x.\n                 88  WS-Date-Mode            value \"Y\".\n             07  WS-Stock-Held    pic 9(6)  comp.\n             07  WS-Total-Ordered pic 9(6)  comp.\n*>\n*> Holds all valid BO records containing Arrived-Flag = \"Y\"\n*>\n 01  BO-Table.\n     03  BO-Table-Size            pic 9(4)    value X-BO-Table-Size.  *> This MUST be same as the occurs below.\n     03  BO-Table-Used            pic 9(4)    value zero. *> Table active size\n     03  BO-Table-Cnt             pic 9(4)    value zero. *> Table position #\n*>\n     03  BOT-All-Records.  *> This MUST be same content / size as fdboitm.cob and wsboitm.cob, i.e., 72 bytes.\n         05  BOT-Record                occurs X-BO-Table-Size.  *> All recs are 72 chars so all start on word boundary\n             07  BOT-Cust-Itm-No.                   *> Primary Key\n                 09  BOT-Stk-Cust-No  pic x(7).     *> Alt key 2\n                 09  BOT-Stk-Item-No  pic x(13).    *> Alt Key 2\n                 09  BOT-Serial       pic 99.\n             07  BOT-Stk-PO           pic x(10).\n             07  BOT-Stk-Ref          pic x(10).\n             07  BOT-Stk-Orig-Inv-No  pic 9(8).\n             07  BOT-Stk-BO-Qty       pic 9(6).     *> 56\n             07  BOT-Stk-BO-Arr-Date  binary-long.\n             07  BOT-Stk-Order-Date   binary-long.  *> 64\n             07  BOT-Stk-Price        pic 9(7)v99 comp-3.  *> 69\n             07  BOT-Stk-Arrived-Flag pic x.\n             07  BOT-Stk-Inv-Type     pic 9.\n             07  filler               pic x.\n*>\n*> Records invoiced (transactions) for a given invoice #",
        "line": 290
      },
      {
        "type": "IF",
        "condition": "a file exists (only if files are processed against RDBMS\n*>  tables\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  Error-Messages.\n*> System Wide\n     03  SL003          pic x(28) value \"SL003 Hit Return To Continue\".\n     03  SL006          pic x(43) value \"SL006 Note Details & Hit Return to continue\".\n*> Module specific\n     03  SL180          pic x(34) value \"SL180 Err on Invoice Rec. write : \".\n     03  SL181          pic x(46) value \"SL181 Invoice To Credit Does Not Exist On OTM3\".\n     03  SL182          pic x(31) value \"SL182 Invoice To Credit Is Paid\".\n     03  SL183          pic x(42) value \"SL183 Invoice To Credit Has Query Flag Set\".\n     03  SL184          pic x(75) value \"SL184 You Can Only Credit Invoices. Not Receipts, Credit Notes Or Proformas\".\n     03  SL185          pic x(56) value \"SL185 Credit of Prompt Pay/Late Charge will be Automatic\".\n     03  SL186          pic x(30) value \"SL186 P.A. Code Does Not Exist\".\n     03  SL190          pic x(35) value \"SL190 Error on Writing Audit record\".\n     03  SL191          pic x(33) value \"SL191 Error on Stock rec. Rewrite\".\n*>     03  SL192          pic x(06) value \"SL192 \".\n     03  SL193          pic x(65) value \"SL193 You Can Only Credit An Invoice With The Same Account Number\".\n     03  SL194          pic x(19) value \"SL194 Stock Read : \".\n     03  SL195          pic x(22) value \"SL195 Stock Rewrite : \".\n     03  SL196          pic x(22) value \"SL196 Record Not found\".\n     03  SL201          pic x(38) value \"SL201 Customer BO (Back Order) Not Set\".\n     03  SL202          pic x(54) value \"SL202 Creating BO rec & Changed Qty to held on Invoice\".\n     03  SL203          pic x(29) value \"SL203 Err on Bo-Rec. Write : \".\n*> sl204 not used In 910.\n     03  SL205          pic x(41) value \"SL205 Using Stock Held for quantity order\".\n     03  SL206          pic x(50) value \"SL206 Computation overflow - Qty or cost too large\".\n     03  SL207          pic x(54) value \"SL207 BO Table Exceeded - Increase and recompile sl910\".\n     03  SL208          pic x(42) value \"SL208 Aborting BO Invoice build processing\".\n     03  SL209          pic x(38) value \"SL209 BO Price not same as Stock-Price\".\n     03  SL210          pic x(43) value \"SL210 Price to use ? B (BO) or S (Stock) - \".\n     03  SL211          pic x(41) value \"SL211 No such Customer - BO entry ignored\".\n     03  SL212          pic x(49) value \"SL212 WARNING BO records for customer are deleted\".\n     03  SL213          pic x(57) value \"SL213 BO Item Table Exceeded - Increase & recompile sl910\".\n     03  SL214          pic x(53) value \"Process Back Orders as there are nnn to Invoice ? [ ]\". *> nn = cc34\n     03  SL215          pic x(46) value \"Would you like to see a list of BO items ? [ ]\".\n     03  SL216          pic x(65) value \"There are nnn / nnn items that need to be processed in DATE order\".\n     03  SL217          pic x(69) value \"Do you wish to force processing in Customer / item order Only (Y/N) ?\".\n     03  SL218          pic x(63) value \"SL218 BO Invoiced table exceeded - Increase and recompile sl910\".\n     03  SL219          pic x(36) value \"SL219 Delete failed for BO Record - \".\n     03  SL220          pic x(73) value \"SL220 Quantity zero - Select D = Delete BO Rec, or S = Skip this time [ ]\".\n     03  SL221          pic x(66) value \"SL221 Entering D, will delete the BO record so check you want this\".\n*>\n*> 01  Error-Code         pic 999   value zero.   *> NOT used.\n*>\n*> Copy books\n*>\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n copy \"slwsinv.cob\"  replacing Invoice-Line by Invoice-Lines. *> Dup name uses 40 lines In Bodies\n copy \"slwsinv2.cob\".\n*>\n 01  WS-Invoice-Record  redefines Invoice-Record *>  Sinle line\n                                pic x(137).\n copy \"slwsoi3.cob\".\n copy \"wsanal.cob\".\n copy \"wsaudit.cob\".\n copy \"wsdel.cob\".\n copy \"wsdnos.cob\".\n copy \"wssl.cob\".\n copy \"wsstock.cob\".     *> 3.02\n*>\n  *> This MUST be same content / size as fdboitm.cob and BOT Table, i.e., 72 bytes.\n*> copy \"wsboitm.cob\".  *> MIGHT BE NEEDED for BO processing ??? IS IT ? <<\n*>\n 01  All-My-Constants    pic 9(4).\n     copy \"screenio.cpy\".\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using WS-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n Init01 section.\n*>*************\n*>\n     accept   WS-env-lines from lines.\n     If       WS-env-lines < 24\n              move  24 to WS-env-lines WS-lines\n     else\n              move  WS-env-lines   to WS-lines\n     end-if\n     subtract 1 from WS-lines giving WS-23-lines.\n     subtract 2 from WS-lines giving WS-22-lines.\n     subtract 15 from WS-22-Lines giving WS-Accept-Body.\t*> gives no. of Invoice Item lines\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n     perform  zz070-Convert-Date.   *> WS-date now local disp date\n     move     1 to File-Key-No.\n*>\n*>  Set up delete file for screen save/restore. THIS only works for *nix not Windows\n*>   so will need a replacement routines BUT this is not used at this time.\n*>\n     move     spaces to Path-Work.\n     string   ACAS-PAth       delimited by space\n              \"sl-temp.scr\"   delimited by size\n                                 Into Path-Work.\n*>\n*>  Here Is the code for It when ready to cut/paste In.\n*>   BUT only for sl910 not amend sl920.\n*>\n*> Experimental code here\n*>\n *>    If       Cob-Crt-Status = Cob-Scr-F3\n *>             move     z\"sl-temp.scr\"  to wScreenName\n *>             call     \"scr_dump\"    using wScreenName returning wInt\n *>             perform  abc\n *>             call     \"scr_restore\" using wScreenName returning wInt\n *>             call     \"CBL_DELETE_FILE\" using Path-Work\n *>             go to xxx.\n\n*>\n*>  Open files and check & setup If we have any deleted Invoices\n*>\n     perform  Program-Start.\n     If       sl-own-nos = \"Y\"\n              move zero to WS-delinv.\n*>\n*> Process BO records if exists other wise normal Invoice processing\n*>   but first do display head\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Invoicing Data Entry\" at 0132           with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  WS-date at 0171 with foreground-color 2.\n*>\n     move     zero to Return-Code.\n     Initialize\n              SInvoice-Header\n              SInvoice-Bodies.\n*>\n     perform  zz200-Build-From-BO.  *> THIS NEEDS TO BE TESTED <<<<<< >>  STILL IN TEST\n     if       Return-Code > 3       *> test for BO table exceeded so EOJ\n              go to Menu-Exit.\n*>\n Main.\n     Initialize\n              SInvoice-Header.\n     perform  Invoice-Details.\n*>\n     If       Z not = zero\n       or     escape-Code = \"Q\"\n              go to  Menu-Exit.\n*>\n     move     16  to  lin.\n     move     1 to cole.\n     display  \" \" at curs with erase eos.\n*>\n Data-Input.\n     Initialize\n              SInvoice-Bodies.\n*>\n     move     zero to  I.\n*>\n     If       I-level-1\n              perform  Inv-Level-1\n     else\n              perform  Inv-Level-2.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to main.\n*>\n     If       I not = 1\n              perform End-Totals.\n*>\n More-Data.\n     display \"Enter Further Invoices? (Y/N) [Y] \" at line WS-lines col 29 with foreground-color 3.\n     move     zero to Cob-Crt-Status.\n     move     \"Y\" to WS-reply.\n     accept   WS-reply at line WS-lines col 60  with foreground-color 6 update.\n     move     function upper-case (WS-reply) to WS-reply.\n*>\n     display  \" \" at line WS-lines col 01 with erase eol.\n*>\n     If       WS-reply = \"Y\"\n              go to main.\n     If       WS-reply not = \"N\"\n              go to More-Data.\n*>\n Menu-Exit.\t\t\t*> Moved from Program-Start, silly place to have It\n     perform  zz080-Close-All-Files\n     exit     program.\n*>\n*>****************************************************************\n*>                 P R O C E D U R E S                           *\n*>****************************************************************\n*>\n Running-Totals section.\n*>=====================\n*>\n     display  I at 1223 with foreground-color 3.\n     move     zero  to  sih-Net\n                        sih-VAT.\n*>\n     perform  varying K from 1 by 1 until K  >  I\n              add Sil-Net (k) to sih-Net\n              add Sil-VAT (k) to sih-VAT\n     end-perform\n*>\n     move     sih-Net  to  Display-9.\n     If       I-level-1\n              display Display-9 at 1237 with foreground-color 3.\n*>\n     move     sih-VAT  to  Display-9.\n     If       I-level-1\n              display Display-9 at 1255 with foreground-color 3.\n*>\n     add      sih-Net  sih-VAT  giving  Display-9.\n*>\n     If       I-level-1\n              display Display-9 at 1268 with foreground-color 3\n     else\n              display Display-9 at 1270 with foreground-color 3.\n*>\n Main-Exit.\n     exit     section.\n*>\n Write-Details section.\n*>====================\n*>\n     add      1  to  J.\n     move     sih-invoice  to Sil-invoice (J).\n     move     J            to Sil-line (J).\n     move     sih-type     to Sil-type (J).\n     move     Invoice-lines (J)  to  WS-Invoice-Record.  *> was line\n     perform  Invoice-Write.\n     If       fs-reply not = zero\n              perform Eval-Status\n              display sl180         at line WS-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply      at line WS-23-lines col 36 with foreground-color 3\n              display exception-msg at line WS-23-lines col 39 with foreground-color 3\n              display Invoice-key   at line WS-23-lines col 64 with foreground-color 3\n              display sl006         at line WS-lines col 01 with foreground-color 3\n              accept  WS-reply at line WS-lines col 44\n              display \" \" at line WS-23-lines col 1 with erase eos\n     end-if\n*>\n*> Now delete the BO record as completed as invoice is saved 12/04/24\n*>   we can have fails on delete and that is OK\n*>\n     if       BO-Table-Cnt not = zero and\n              WS-BO-Processing = \"Y\"\n              move     Sih-Customer    to BO-Stk-Cust-No\n              move     Sil-Product (J) to BO-Stk-Item-No\n              delete   BO-Stk-Itm-File record.\n*>\n     perform  Update-Stock-n-Audit.\n*>\n Main-Exit.\n     exit     section.\n*>\n Update-Stock-n-Audit section.\n*>===========================\n*>\n*> Only process If linked to Stock Control and not proforma\n*>  This section only creates an Audit record and updates\n*>   Stock record quantity held (Stock-Held) and Stock-Value\n*>\n*>  ALSO UPDATE THE STOCK REC HISTORY CURRENT PERIOD AND BY MONTH ?.\n*>\n     If       SL-Stock-Link not = \"Y\"\n              go to Update-Stock-Exit.\n     If       Sih-Type   = 4\n              go to Update-Stock-Exit.\n*>\n*> Normal for Receipts(1) and Invoices (2) but reverse process for\n*>      Credit Notes (3) AND Proformas are Ignored.\n*>\n     Initialize WS-Stock-Audit-Record.\n     move     3                   to Audit-Type.\n     move     Sih-Invoice         to Audit-Invoice-PO.\n     move     WS-Date             to Audit-Process-Date.\n     move     Sil-Product (J)     to Audit-Stock-Key\n                                     WS-Temp-Stock-Key.\n     move     Sil-Description (J) to Audit-Desc.\n     move     Sil-Qty (J)         to Audit-Transaction-Qty.\n     move     zero                to Audit-Unit-Cost.\n     If       Sil-Type (J) = 3\n              move 5      to Audit-Type\n              move 1      to Audit-Reverse-Transaction\n              move Sih-cr to Audit-Cr-for-Invoice\n     else\n              move zero to Audit-Reverse-Transaction\n     end-if\n     move     Stk-Audit-No        to Audit-No.\n*>\n*> Get the stock record\n*>\n     If       WS-Stock-No-Long = spaces\n              move WS-Abrev-Stock to WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              perform Stock-Read-Indexed      *> read Stock-File record key WS-Stock-Abrev-Key Invalid key\n              If   FS-Reply = 21\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move  1 to File-Key-No\n              perform Stock-Read-Indexed    *> read Stock-File key WS-Stock-Key Invalid key\n              If   FS-Reply = 21\n                   move zero to Stock-Cost\n                   move spaces to WS-Stock-Key\n              end-if\n     end-if\n*>\n*> As stock Items are checked this should not happen\n*>     but It Is a multi user system\n*>\n     If       fs-reply not = zero\n              perform Eval-Status\n              display SL194           at line WS-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply        at line WS-23-lines col 16 with foreground-color 3\n              display exception-msg   at line WS-23-lines col 19 with foreground-color 3\n              display WS-Stock-Key       at 2064 with foreground-color 3\n              display sl006           at line WS-lines col 01 with foreground-color 3\n              accept  WS-reply        at line WS-lines col 44\n              display \" \"             at line WS-23-lines col 1 with erase eos\n     end-if\n*>\n*> If we have great, but If not Stock-Cost Is zero which helps It\n*>          show up In proof reports (Sil-type same as sih-type so use later - less ram)\n*>\n     If       WS-Stock-Key not = spaces\t\t*> we have a stock rec.\n              If       Sih-Type = 1 or = 2\n                 and   Stock-Services-Flag not = \"Y\"\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost * -1\n                       subtract Audit-Transaction-Qty from Stock-Held\n              else\n               If      Sih-Type = 3\t\t*> Credit note\n                 and   Stock-Services-Flag not = \"Y\"\n                       compute  Audit-Stock-Value-Change = Audit-Transaction-Qty\n                                    * Stock-Cost\n                       add Audit-Transaction-Qty to Stock-Held\n               end-if\n              end-if\n*>\n*> Should NOT happen as tested In data entry\n*>\n              If       Stock-Held < zero\n                 and   Stock-Services-Flag not = \"Y\"\n                       multiply -1 by Stock-Held\n                       add Stock-Held to Stock-Pre-Sales\n                       move zero to Stock-Held\n              end-if\n              If       Stock-Held > zero\n                 and   Stock-Services-Flag not = \"Y\"\n                       multiply Stock-Held by Stock-Cost giving Stock-Value\n              else\n                       move zero to Stock-Value\n              end-if\n*>\n*>    Similar for sl920 (amend) and sl940 (Delete) Invoices but reversed.\n*>\n*> Update record period and month In year totals but check that WS-Inv-Mth Is valid.\n*>    [ All values positive ] Note that stock fields are not signed and a credit\n*>                            could be different month - WIP stock Is NOT sold!\n*>\n              If       WS-Inv-Mth not < 1 or > 12\n                If     Sih-Type = 1 or 2                    *> Invoice and Recepts\n                       add Audit-Transaction-Qty to Stock-Deducts\n                       add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                else\n                 If    Sih-Type = 3                         *> Credit Notes\n                       add Audit-Transaction-Qty to Stock-Adds\n                       add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                 end-if\n                end-if\n              end-if\n*>\n              move 1 to File-Key-No\n              perform  Stock-Rewrite\n              If       FS-Reply = 21\n                       display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                       display SL006    at line WS-lines col 1\n                       accept WS-reply  at line WS-lines col 45\n              end-if\n              If       fs-reply not = zero\n                       perform Eval-Status\n                       display SL195         at line WS-23-lines col 1 with erase eol foreground-color 4\n                       display fs-reply      at line WS-23-lines col 22 with foreground-color 3\n                       display exception-msg at line WS-23-lines col 25 with foreground-color 3\n                       display WS-Stock-Key  at 2064 with foreground-color 3\n                       display sl006         at line WS-lines col 01 with foreground-color 3\n                       accept  WS-reply      at line WS-lines col 44\n                       display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n     end-if\n*>\n     If       Stk-Audit-Used = 1\n              move zero to Stk-Activity-Rep-Run\t   *> Need to run audit report\n              perform  Stock-Audit-Write\n              If       fs-reply not = zero\n                       perform Eval-Status\n                       display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                       display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                       display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                       display SL006         at line WS-lines col 1\n                       accept WS-reply       at line WS-lines col 45\n              end-if\n     end-if.\n*>\n Update-Stock-Exit.\n     exit     section.\n*>\n Eval-Status  section.\n*>===================\n*>\n     move     spaces to exception-msg.\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n Main-Exit.\n     exit     section.\n*>\n comm-routines section.\n*>********************\n*>\n Accept-Money6a.\n     move     zero to WS-poundsd6 WS-penced6 amt-ok6.\n*>\n Accept-Money6b.\n     display  WS-amount-screen-display6 at curs  with foreground-color 3.\n     accept   WS-amount-screen-accept6  at curs   with foreground-color 3 update.\n     move     WS-pound6 to amt-wk-pds6.\n     move     WS-pence6 to amt-wk-pence6.\n*>\n Accept-Money6c.\n     move     amt-wk-pence6 to WS-pence6.\n     move     amt-wk-pds6   to WS-pound6.\n     display  WS-amount-screen-display6 at curs  with foreground-color 3.\n     accept   WS-amount-screen-accept6  at curs   with foreground-color 3 update.\n     move     WS-pound6 to amt-wk-pds6.\n     move     WS-pence6 to amt-wk-pence6.\n*>\n Accept-Money7a.\n     move     zero to WS-poundsd7 WS-penced7 amt-ok7.\n*>\n Accept-Money7b.\n     display  WS-amount-screen-display7 at curs  with foreground-color 3.\n     accept   WS-amount-screen-accept7  at curs   with foreground-color 3 update.\n     move     WS-pound7 to amt-wk-pds7.\n     move     WS-pence7 to amt-wk-pence7.\n*>\n Accept-Money7c.\n     move     amt-wk-pence7 to WS-pence7.\n     move     amt-wk-pds7 to WS-pound7.\n     display  WS-amount-screen-display7 at curs with foreground-color 3.\n     accept   WS-amount-screen-accept7  at curs  with foreground-color 3 update.\n     move     WS-pound7 to amt-wk-pds7.\n     move     WS-pence7 to amt-wk-pence7.\n*>\n comm-exit.\n     exit     section.\n*>\n Inv-Level-1  section.\n*>===================\n*>\n*> No one should be using this, so consider scrapping and forcing Invoicer = 2 etc\n*>\n     display  WS-dash        at 1101 with foreground-color 2.\n     display  \"Level 1\"      at 1201 with foreground-color 2.\n     display  \"Line - \"      at 1216 with foreground-color 2.\n     display  \"[          ]\" at 1236 with foreground-color 2.\n     display  \"[          ]\" at 1254 with foreground-color 2.\n     display  \"[          ]\" at 1267 with foreground-color 2.\n     display  \"Code\"         at 1405 with foreground-color 2.\n     display  \"<---Net---->  Vat   Vat Amount  Gross Amount\" at 1436 with foreground-color 2.\n*>\n Loop.\n     perform  varying lin from 16 by 1 until lin not < WS-23-lines\n              add      1  to  I\n              move     1 to cole\n              display  \"(\" at curs with erase eol foreground-color 2\n              move     2 to cole\n              display  I at curs with foreground-color 2\n              move     4 to cole\n              display  \") [  ]\" at curs with foreground-color 2\n              move     36 to cole\n              display  \"[          ] [ ]   {         } (\" at curs with foreground-color 2\n              move     78 to cole\n              display  \")\" at curs       with foreground-color 2\n     end-perform\n*>\n*> I = no. lines on screen for Items,",
        "line": 566
      },
      {
        "type": "IF",
        "condition": "Cob-Crt-Status = Cob-Scr-Esc\n              go to Main-Exit.\n*>\n     If       new-screen = 1\n              go to Loop.\n*>\n     If       Sil-Description (I) not = spaces\n       and    I not = 40\n              go to Loop.\n*>\n Main-Exit.\n     exit     section.\n*>\n Get-Data-1   section.\n*>===================\n*>\n*> No one should be using this consider scrapping and forcing Invoicer = 2 etc\n*>\n Get-Data-1-Main.\n     add      J  15  giving  lin.\n*>\n     If       lin  >  WS-23-lines\n              subtract 1 from I\n              move 1 to new-screen\n              go to  Main-Exit.\n*>\n     move     zero to new-screen.\n*>\n Get-Code.\n     If       I  >  1\n       and    Sil-PA (I) = spaces\n              move  Sil-PA (I - 1)  to  Sil-PA (I).\n*>\n     if       I = zero\n              move  1 to I.\n     move     Sil-PA (I) to WS-PA.\n     move     7 to cole.\n     display  WS-PA at curs with foreground-color 3.\n     accept   WS-PA at curs with foreground-color 3 update.\n     move     WS-PA to Sil-PA (I) pa-group.\n     move     spaces  to  Sil-Description (I).\n*>\n     If       WS-PA = spaces\n              go to  Main-Exit.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to Main-Exit.\n*>\n     If       WS-PA = \"<<\"\n        and   I = 1\n              go to Get-Code.\n*>\n     If       WS-PA = \"<<\"\n              subtract  1  from  lin\n              If    lin  >  15\n                    subtract  1  from  I\n                    subtract 1 from j\n                    go to  Get-Code\n              else\n                    subtract WS-Accept-Body from  I          *> Was 8 Need to follow logic, can we use WS-Accept-Body ??\n                    go to  Get-Data-1-Main.\n     move     \"S\" to pa-system.\n     move     11 to cole.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.\n     If       FS-Reply = 21\n              display SL186 at line WS-23-lines col 1 with foreground-color 4 highlight beep\n              go to  Get-Code.\n     display  \" \" at line WS-23-lines col 1 with erase eol.\n*>\n     display  pa-Desc at curs with foreground-color 3.\n     move     pa-Desc  to  Sil-Description (I).\n*>\n Get-Net.\n     move     37 to cole.\n     perform  Accept-Money7a thru Accept-Money7b.\n     If       amt-ok7 = zero\n              go to Get-Code.\n     move     amt-ok7 to Sil-Net (I) WS-Net.\n*>\n Get-Vat-Code.\n*>\n*>  Only using 1st three as last 2 are for local sales tax but not In UK.\n*>   NOTE that Is Is not currently programmed for (e.g., last 2).\n*>\n     move     50 to cole.\n     accept   Vat-Code at curs with foreground-color 3 update.\n*>\n     If       Vat-Code  >  3\n              go to  Get-Vat-Code.\n*>\n     move     Vat-Code  to  Sil-Vat-Code (I).\n     If       Vat-Code = zero\n              move  zero  to  amt-ok6\n       else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute amt-ok6 rounded =  (WS-Net * WS-VAT-Rate) / 100.\n*>\n Get-VAT-Rate.\n     move     56 to cole.\n     perform  Accept-Money6c.\n     move     amt-ok6 to Sil-VAT (I) WS-VAT.\n*>\n     add      WS-VAT WS-Net giving  Display-9.\n     move     68 to cole.\n     display  Display-9 at curs with foreground-color 3.\n*>\n     perform  Running-Totals.\n*>\n     add      1 to J.\n     add      1  to  I.\n     go       to Get-Data-1-Main.\n*>\n Main-Exit.\n     exit     section.\n*>\n Inv-Level-2  section.\n*>===================\n*>\n*> This, is the default standard and always used with Stock Control where\n*> level 1 does not use it.\n*>\n     display  WS-dash at 1101 with foreground-color 2.\n     If       SL-Stock-Link not = \"Y\"\n              display  \"Level 2\"      at 1201 with foreground-color 2\n     else\n              display  \"Stock Linked\" at 1201 with foreground-color 2.\n     display  \"Line - \"               at 1216 with foreground-color 2.\n     display  \"Net <          >\"      at 1227 with foreground-color 2.\n     display  \"Vat <          >\"      at 1244 with foreground-color 2.\n     display  \"Invoice <          >\"  at 1261 with foreground-color 2.\n     If       SL-Stock-Link = \"N\"\t\t*> No stock",
        "line": 1084
      },
      {
        "type": "IF",
        "condition": "SL-Stock-Link = \"N\"\t\t*> No stock",
        "line": 1225
      },
      {
        "type": "IF",
        "condition": "end-perform\n*>\n*> This Is what the Item capture displays look like & 1st Is for non-linked\n*>   stock Control:\n*>\n*>    Product    Code <---------Description-------->   Qty   Unit Price  Disc. Vat\n*>[      12 >13 ][2 ][        24 >30                ][  5  ][  9>10    ][  5  ][1]\n*> If STOCK LINKED:\n*>    Product     <----------Description--------->    Qty   Unit Price  Disc. Vat\n*>[      12 >13 ][        24 >32                  ]  [  5  ][  9>10    ][  5  ][1]\n*>\n*>     subtract 16 from WS-23-lines giving m.  *> or move 1 to I = pos. In line Item table\n*>\n     subtract WS-Accept-Body from I.                    *> M = WS-accept-body\n     move     1  to  J.\n*>\n     display  I at 1223 with foreground-color 3.\n*>\n     perform  Get-Data-2.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to Main-Exit.\n*>\n     If       new-screen = 1\n              go to  loop.\n*>\n     If       WS-product not = spaces\n       and    I not = 40\t\t\t*> max no. of Items per Invoice\n              go to  loop.\n*>\n Main-Exit.\n     exit     section.\n*>\n Get-Data-2   section.\n*>===================\n*>\n*>**********************************************************************\n*>  This section will accept Invoice line data If SC (stock control)   *\n*>  Is NOT linked In param file. If It Is linked, will only request:   *\n*>  Stock code or If entered chars = 7 or less, Abrev code so can      *\n*>  search same If using F3 to find 1st",
        "line": 1233
      },
      {
        "type": "IF",
        "condition": "lin  > WS-23-lines - 1\n              subtract  1  from  I\n              move  1  to  new-screen\n              go to  Main-Exit.\n*>\n     move     zero  to  new-screen.\n*>\n Get-Product.\n     If       I  >  1\n       and    Sil-product (I) = spaces\n              move  Sil-product (I - 1) to Sil-product (I).  *> display prev entered code for new line\n*>                                                              to save typing\n     if       I = zero\n              move  1 to I.\n     display  I at 1223 with foreground-color 3.             *> disp line # on summary line\n     move     2 to cole.\n     move     Sil-product (I) to WS-product.\n     display  WS-product at curs with foreground-color 3.\n     accept   WS-product at curs with foreground-color 3 update.\n*>\n     move     spaces  to  Sil-Description (I).\n*>\n*> Process description accept & search via start / read next If F6 detected\n*>\n     If       Cob-Crt-Status = cob-scr-F6\n              go to Bypass-Product-Space-Tests.\n*>\n     If       WS-product = spaces\n              go to Main-Exit.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to Main-Exit.\n*>\n Bypass-Product-Space-Tests.\n     move     function upper-case (WS-product) to WS-product.\n     move     WS-product to Sil-product (I)\n                            test-product\n                            WS-Temp-Stock-Key.\n*>\n     If       Sil-comment\n              move zero to WS-Net WS-Unit WS-Qty\n              go to  Get-Desc.\n*>\n     If       WS-product = \"<<           \"\n              subtract  1  from  lin\n              go to Get-Prod-Test.\n*>\n     If       SL-Stock-Link not = \"Y\"    *> continue with old code to accept all data\n              go to Get-Code.\n     move     17 to cole.                *> 4 Desc.\n*>\n*> Search nearest Abrev key and read next ..\n*>  When this Is tested we can wrap this and next together\n*>    with a F3 test",
        "line": 1287
      },
      {
        "type": "IF",
        "condition": "F2 or F3 test\n*>\n     If       Cob-Crt-Status = cob-scr-F3\n *>\n *> Search Abrev",
        "line": 1339
      },
      {
        "type": "IF",
        "condition": "FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n     If       Cob-Crt-Status = cob-scr-F2                *> read next record\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n*> Search on Desc. but has dup keys so disp. Abrev. code\n*>    & F5 for next on description\n*>  When this Is tested we can wrap this and next together with a\n*>      F6 test",
        "line": 1349
      },
      {
        "type": "IF",
        "condition": "F5 or F6 test\n*>\n     If       Cob-Crt-Status = cob-scr-F6\n              move    Sil-Description (I) to WS-Description\n              accept  WS-Description at curs with foreground-color 3 update\n              move WS-Description to WS-Stock-Desc\n              move  3 to File-Key-No         *> start Stock-File key not < WS-Stock-Desc Invalid key\n              set fn-not-less-than to true\n              perform Stock-Start\n              If    FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              If       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              display \"Hit return (for testing)\" at 2401  *> TESTING ONLY\n              accept WS-reply at 2425            *> TESTING ONLY\n              display \" \" at 2401 with erase eol *> TESTING ONLY\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if\n*>\n     If       Cob-Crt-Status = cob-scr-F5      *> Read next on Desc.\n              perform Stock-Read-Next\n              If    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to Sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              If       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if.\n*>\n Get-Simple-Stock.\n*>\n*> So, no special function just search for entered key\n*>\n     If       WS-Stock-No-Long = spaces\n              move WS-Abrev-Stock to WS-Stock-Abrev-Key\n              move 2 to File-Key-No\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move 1 to File-Key-No\n     end-if\n     perform  Stock-Read-Indexed\n     If       FS-Reply = 21 or = 23\n              move SL196 to WS-Stock-Desc\n              display WS-Stock-Desc at curs with foreground-color 4\n              go to Get-Product\n     end-if.\n*>\n GSS-End.\n*> can shorten code now so rem out next block vbc 27/08/17\n*>\n *>    else\n *>             perform Stock-Read-Indexed    *> read Stock-File key WS-Stock-Key Invalid key\n *>             If   FS-Reply = 21\n *>                  move SL196 to WS-Stock-Desc\n *>                  display WS-Stock-Desc at curs with foreground-color 4\n *>                  go to Get-Product\n *>             end-if\n *>    end-if\n     perform  Test-For-Read-Stock.\n*>\n Process-Stock-Record.\n*>\n*>  Have the required Stock record so get and show the desc\n*>\n     move     17 to cole.        *> Desc.\n     move     Stock-SA-Group to WS-PA\n                                pa-group\n                                Sil-PA (I).\n     display  WS-Stock-Desc   at curs with foreground-color 3.\n     move     WS-Stock-Desc to WS-Description\n                               Sil-Description (I).\n     move     Stock-Retail  to amt-ok7.\n     move     Stock-Retail  to WS-Unit.\n     move     amt-wk-pds7   to WS-pound7.\n     move     amt-wk-pence7 to WS-pence7.\n     display  WS-amount-screen-display7 at line lin col 60 with foreground-color 3.\n     move     Stock-Held to WS-Qty.\n     If       Stock-Services-Flag = \"Y\"\n              move 1 to WS-Qty\n     end-if\n     go       to Get-Qty.          *> Bypass manual Input code as comes from stock record\n*>\n Get-Prod-Test.   *> THESE TESTS LOOK WRONG IF SCREEN LONGER THAN 24 LINES <<<<< TEST for this\n     If       I = 1\n              add 1 to lin\n              go to Get-Product.\n*>\n     If       lin  >  15\n              subtract  1  from  I\n              subtract  1  from  j\n              go to  Get-Product\n      else\n              subtract WS-Accept-Body from I           *> Instead of 8 can we use WS-Accept-Body ??\n              go to  Get-Data-2-Main.\n*>\n Get-Code.\n     If       I  >  1\n       and    Sil-PA (I) = spaces\n              move  Sil-PA (I - 1)  to  Sil-PA (I).\n*>\n     move     Sil-PA (I) to WS-PA.\n     move     17 to cole.\n     display  WS-PA at curs with foreground-color 3.\n     accept   WS-PA at curs with foreground-color 3 update.\n*>\n     move     spaces  to  Sil-Description (I).\n*>\n     If       WS-PA = spaces\n              go to  Get-Product.\n*>\n     move     WS-PA to pa-group Sil-PA (I).\n     move     \"S\" to pa-system.\n     move     21 to cole.                         *> disp error In desc.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.\n     If       FS-Reply = 21\n              display SL186 at curs  with foreground-color 4\n              go to  Get-Code.\n*>\n Get-Desc.\n     If       I  >  1\n         and  Sil-Description (I) = spaces\n         and  not  Sil-comment\n              move  Sil-Description (I - 1) to  Sil-Description (I).\n*>\n     If       SL-Stock-Link = \"Y\"\n              move 17 to cole\n     else\n              move 21 to cole.\n     move     Sil-Description (I) to WS-Description.\n     display  WS-Description at curs with foreground-color 3.\n     accept   WS-Description at curs with foreground-color 3 update.\n*>\n     move     WS-Description to Sil-Description (I).\n     If       WS-Description = spaces\n              move \"B\" to escape-Code\n     else\n              move space to escape-Code.\n     If       escape-Code = \"B\"\n         and  Sil-comment\n              go to Get-Product.\n     If       escape-Code = \"B\"\n              go to  Get-Code.\n*>\n     If       Sil-comment\n              go to  Jump-Totals.\n*>\n Get-Qty.\n     If       SL-Stock-Link = \"N\"\t\t*> If It Is shown = current stock\n              move     zero to WS-Qty.\n     move     53 to cole.\n     If       Stock-Services-Flag = \"Y\"\n              move 1 to WS-Qty\n     end-if\n     display  WS-Qty at curs with foreground-color 3.\n     accept   WS-Qty at curs with foreground-color 3 update.\n*>\n     If       WS-Qty = zero\n              go to Get-Desc.\n*>\n     If       Stock-Services-Flag not = \"Y\"\n       and    WS-BO-Used\n       and    Sales-BO-Set\n              move  \"Y\" to WS-BO-Can-Be-Used.  *> Testing use WS-BO-Usable (Y)\n\n     If       SL-Stock-Link = \"Y\"         *> make sure not selling more stock than held\n       and    WS-Qty > Stock-Held\n       and    not WS-BO-Usable\n              move Stock-Held to WS-Qty   *> max value Is stock held\n              display  SL201 at line WS-23-lines col 1 with foreground-color 4 highlight\n              go to Get-Qty\n     else\n              display \" \" at line WS-23-lines col 1 with erase eol.  *> clear any msg SL201\n*>\n     If       SL-Stock-Link = \"Y\"    *> bypass accept unit price\n              go to Recomp-Net.\n*>\n Get-Unit.\n     move     60 to cole.\n     perform  Accept-Money7a thru Accept-Money7b.\n     If       amt-ok7 = zero\n              go to Get-Qty.\n     move     amt-ok7 to WS-Unit.\n*>\n Recomp-Net.\n     If       SL-Stock-Link = \"Y\"         *> make sure not selling more stock than held - 19/03/24\n       and    WS-Qty > Stock-Held\n       and    WS-BO-Usable\n              If       Stock-Held = zero\n                       move     zero to WS-Temp-Invoice\n              end-if\n              perform  zz120-Build-BO-Record   *> but not for credit notes\n              move     Stock-Held to WS-Qty\n              display  SL205 at line ws-23-Lines col 1 with foreground-color 4 highlight beep\n              If       WS-Qty = zero\n                       If       I > zero   *> JIC\n                                Initialise Invoice-Lines (I) *> clear down any above entered data for Item line\n                                if  I > 1\n                                    subtract 1 from I\n                                    if  I = zero\n                                        move 1 to I\n                                    end-if\n                                end-if\n                       end-if\n                       move    15 to cole\n                       display \"][\" at curs with foreground-color 2 erase eol\n                       move    49 to cole\n                       display \"]  [     ][          ][     ][ ]\" at curs  with foreground-color 2\n                       go to Get-Data-2.\n*>\n     multiply WS-Qty by  WS-Unit giving  WS-Net\n           on size error\n              display  \"SizER\" at curs with blink foreground-color 4\n              display  SL206 at line ws-23-Lines col 1 with foreground-color 4 highlight beep\n              go to Get-Qty\n           not on size error\n              display   \"     \" at curs\n              display   \" \" at line ws-23-Lines col 1 with erase eol.\n*>\n     move     WS-Net to  Display-9 Sil-Net (I).\n     move     WS-Qty to Sil-Qty (I).\n     move     WS-Unit to Sil-Unit (I).\n     display  Display-9 at 1232 with foreground-color 3.\n*>\n Get-Disc.\n     move     Sales-Discount  to  WS-discount.\n     move     72 to cole.\n     move     WS-disc-wka to WS-disca1.\n     move     WS-disc-wkb to WS-disca3.\n     display  WS-discount-display at curs with foreground-color 3.\n     accept   WS-discount-accept  at curs with foreground-color 3 update.\n     move     WS-discb1 to WS-disc-wka.\n     move     WS-discb3 to WS-disc-wkb.\n*>\n     move     WS-discount to  work-d Sil-discount (I).\n     move     WS-Net to  work-n.\n*>\n     multiply work-n by work-d giving work-1\n     divide   work-1 by 100    giving work-1\n*>\n     subtract work-1  from  WS-Net.\n*>\n     move     WS-Net to Sil-Net (I) Display-9.\n     display  Display-9 at 1232 with foreground-color 3.\n*>\n Get-Vat-Code.\n     move     \"S\" to Vat-Code-X.  *> 17/2/23  for Standard rate\n     move     79 to cole.\n     display  Vat-Code-X at curs with foreground-color 3.\n     accept   Vat-Code-X at curs with foreground-color 3 update UPPER.\n*>\n*>   Accept S, R and Z replacing with 1, 2 & 3.      Rating   %   - Effective (supposed )\n*>\n     If       Vat-Code-X = \"S\"                   *> Standard code 1 (20% - 01/01/17)\n              move 1 to Vat-Code\n      else\n       If     Vat-Code-X = \"R\"                   *> Reduced  code 2 (05% - 01/01/17)\n              move 2 to Vat-Code\n        else\n         If   Vat-Code-X = \"Z\"                   *> Zero     code 3 (00% - 01/01/17)\n              move 3 to Vat-Code.\n*>\n     If       Vat-Code < 1 or > 5                *> using 1st three as last 2 are Sales tax, Not used In the UK but USA ?. 11/09/24\n              go to  Get-Vat-Code.\n*>\n     move     Vat-Code  to  SIl-Vat-Code (I).\n*>\n     If       Vat-Code = zero\n              move  zero  to  WS-VAT\n     else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute  WS-VAT rounded = (WS-Net * WS-VAT-Rate) / 100.\n*>\n     move     WS-VAT to  Display-9\n                         SIl-VAT (I).\n     display  Display-9 at 1249 with foreground-color 3.\n*>\n     perform  Running-Totals.\n*>\n Jump-Totals.\n     add      1  to  J.\n     add      1  to  I.\n     go       to Get-Data-2-Main.\n*>\n Test-For-Read-Stock.\n     If       fs-reply not = zero\n              perform Eval-Status\n              display SL194    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n              display fs-reply at line WS-23-lines col 21 with foreground-color 2 highlight\n              display exception-msg at line WS-23-lines col 24 with foreground-color 3\n              display SL006 at line WS-lines col 1\n              accept WS-reply at line WS-lines col 45\n     end-if.\n*>\n Main-Exit.\n     exit     section.\n*>\n End-Totals   section.\n*>==================\n*>\n End-Totals-Main.\n     move     zero to Cob-Crt-Status.\n     perform  Total-Screen.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              if       WS-BO-Processing = \"Y\"  *> THIS MAY NOT APPEAR ????\n                       display SL212 at 1501 with foreground-color 4\n                                                  highlight BEEP\n                                                  erase  eol\n              end-if\n              go to Main-Exit.\n*>\n     move     15  to  lin.\n     move     1 to cole.\n     display  \" \" at curs with erase eos.\n*>\n     display  \"*********************\" at 1660  with foreground-color 2\n     display  \"*\" at 1760 with foreground-color 2\n     display  \"*\" at 1780 with foreground-color 2\n     display  \"*\" at 1860 with foreground-color 2\n     display  \"*\" at 1880 with foreground-color 2\n     display  \"*\" at 1960 with foreground-color 2\n     display  \"*\" at 1980 with foreground-color 2\n     display  \"*********************\" at 2060 with foreground-color 2.\n*>\n     display  \"Invoice Ok to\" at 1761 with foreground-color 2.\n     If       Pass-Value = 2\n              display \"Store\" at 1775 with foreground-color 2\n     else\n              display \"Print\" at 1775 with foreground-color 2.\n     display  \"(Y/N) ? [Y]\" at 1968 with foreground-color 2.\n*>\n Confirmation.\n     move     \"Y\"  to   WS-reply.\n     accept   WS-reply at 1977 with foreground-color 6 update.\n     move     function upper-case (WS-reply) to WS-reply.\n*>\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to Main-Exit.\n*>\n     If       WS-reply = \"N\"\n              go to  End-Totals-Main.\n*>\n     If       WS-reply not = \"Y\"\n              go to  Confirmation.\n*>\n     move     \"P\"  to  sih-status.\n     move     space to sih-status-P.\n     subtract 1  from  I.\n     move     I    to  sih-lines.\n*>\n     move     SInvoice-Header  to  WS-Invoice-Record.  *> was Invoice-record\n*>\n Retry-Write-PInv-Rec.\n     perform  Invoice-Write.\n     If       FS-Reply = 22       *> Key exists so reread field/record, yes Ignore any Del-inv-nos\n              perform  zz100-Read-System-Record\n              move     Next-Invoice to Ih-Invoice\n                                       Sih-Invoice  *> details recs updated\n              add      1 to Next-Invoice\n              perform  zz110-Write-System-Record\n              go to    Retry-Write-PInv-Rec\n     end-if\n     If       fs-reply not = zero\n              perform Eval-Status\n              display sl180         at line WS-23-lines col  1 with erase eol foreground-color 4\n              display fs-reply      at line WS-23-lines col 36 with foreground-color 3\n              display exception-msg at line WS-23-lines col 39 with foreground-color 3\n              display Invoice-key   at line WS-23-lines col 64 with foreground-color 3\n              display sl006         at line WS-lines    col  1 with foreground-color 3\n              accept  WS-reply      at line WS-lines    col 44\n              display \" \"           at line WS-23-lines col  1 with erase eos.\n*>\n     move     zero to  J.\n     perform  Write-Details  I  times.\n*>\n*>  Set for sl930   Invoice print\n*>\n     If       First-SL-Inv = zero\n       and    Pass-Value not = 3   *> Batch\n              move  sih-invoice to  First-SL-Inv.\n*>\n     If       del-exists\n              perform DelInvNos-Delete.\n*>\n     If       Pass-Value = 3  *> One off invoice and print\n              go to ET-Print.\n*>\n     move     1 to S-Flag-I.\n     move     11  to  lin.\n     move     1 to cole.\n     display  \" \" at curs with erase eos.\n     go       to Main-Exit.\n*>\n ET-Print.\n     perform  Invoice-Close.\n     perform  OTM3-Close.\n*>\n     perform  Sales-Close.\n     perform  Delivery-Close.\n     perform  DelInvNos-Close.\n     perform  Analysis-Close.\n     If       SL-Stock-Link = \"Y\"\n              perform  Stock-Close\n              perform  Stock-Audit-Close\n     end-if\n*>\n*>  Now call print Invoice program as received a Immediate print request\n*>\n     call     \"sl930\" using WS-calling-data\n                            system-record\n                            to-day\n                            file-defs.\n     exit     program.\n*>\n Main-Exit.\n     exit     section.\n*>\n Total-Screen section.\n*>===================\n*>\n     move     1 to cole.\n     move     11 to lin.\n     display  \" \" at curs with erase eos.\n     display  WS-dash at 1101 with foreground-color 2.\n*>\n     If       I-level-1\n              move  1  to  menu-reply\n     else\n              move  2  to  menu-reply.\n*>\n     display  \"Level \"   at 1201 with foreground-color 2.\n     display  menu-reply at 1207 with foreground-color 2.\n     display  \"<---Net---->   <---VAT--->\" at 1225 with foreground-color 2.\n     display  \"<---Gross-->     Days\"      at 1254 with foreground-color 2.\n     display  \"Sub-Totals\"                 at 1404 with foreground-color 2.\n     display  \"{          }   {         }\" at 1425 with foreground-color 2.\n     display  \"{          }     [  ]\"      at 1454 with foreground-color 2.\n*>\n     display  Extra-Desc                   at 1504 with foreground-color 2.\n     display  \"[          ]   [         ]\" at 1525 with foreground-color 2.\n     display  \"{          }\"               at 1554 with foreground-color 2.\n*>\n     display  \"Shipping & Handling\"        at 1604 with foreground-color 2.\n     display  \"[          ]   [         ]\" at 1625 with foreground-color 2.\n     display  \"{          }\"               at 1654 with foreground-color 2.\n*>\n     display  \"Late Charge\"                at 1704 with foreground-color 2.\n     display  \"[          ]              \" at 1725 with foreground-color 2.\n     display  \"{          }     [  ]\"      at 1754 with foreground-color 2.\n*>\n     display  \"------------   -----------\" at 1825 with foreground-color 2.\n     display  \"------------\"               at 1854 with foreground-color 2.\n*>\n     display  \"Itemised Totals\"            at 1904 with foreground-color 2.\n     display  \"{          }   {         }\" at 1925 with foreground-color 2.\n     display  \"{          }\"               at 1954 with foreground-color 2.\n*>\n     move     sih-Net  to  Display-9.\n     display  Display-9 at 1426 with foreground-color 3.\n*>\n     move     sih-VAT  to  Display-8.\n     display  Display-8 at 1441 with foreground-color 3.\n*>\n     add      sih-Net  sih-VAT  giving  Display-9.\n     display  Display-9 at 1455 with foreground-color 3.\n*>\n Get-Days.\n     move     zero to sih-days sih-carriage.\n     If       sih-type = 2\n              move sales-credit  to  sih-days\n     else If  sih-type = 4\n              move pf-retention to sih-days.\n     move     sih-days to WS-Dayes.\n     If       sih-type not = 2\n              display WS-Dayes at 1472 with foreground-color 3\n              go to Get-Extra.\n*>\n     display  WS-Dayes at 1472 with foreground-color 3.\n     accept   WS-Dayes at 1472 with foreground-color 3 update.\n     move     WS-Dayes to sih-days.\n*>\n Get-Extra.\n     If       Extra-Type = space\n              move zero to sih-extra sih-e-VAT\n              go to Get-Carriage.\n*>\n     If       Extra-Rate not = zero\n              compute  sih-extra = (sih-Net * extra-rate) / 100\n     else\n              move  zero  to  sih-extra.\n*>\n     move     1526 to curs.\n     move     sih-extra to amt-ok7.\n     perform  Accept-Money7c.\n     move     amt-ok7 to sih-extra.\n*>\n Get-Extra-VAT.\n     If       sih-extra = zero\n              move  zero to  sih-e-VAT\n              go to Get-Carriage.\n*>\n     compute  amt-ok6 = sih-extra  *  VAT-Rate-1  /  100.\n*>\n     move     1541 to curs.\n     perform  Accept-Money6c.\n     move     amt-ok6 to sih-e-VAT.\n*>\n     add      sih-extra  sih-e-VAT  giving  Display-9.\n     display  Display-9 at 1555 with foreground-color 3.\n*>\n     If       discount\n         and  sih-extra not = zero\n              multiply -1 by sih-extra\n              multiply -1 by sih-e-VAT.\n*>\n Get-Carriage.\n     move     1626 to curs.\n     perform  Accept-Money7a thru Accept-Money7b.\n     move     amt-ok7 to sih-carriage.\n     compute  amt-ok6 rounded = sih-carriage * VAT-Rate-1 / 100.\n*>\n*> Note that VAT-Rate-1 must be standard rate for p & p\n*>\n Get-Carriage-VAT.\n     move     1641 to curs.\n     perform  Accept-Money6c.\n     move     amt-ok6 to sih-c-VAT.\n     add      sih-carriage  sih-c-VAT  giving  Display-9.\n     display  Display-9 at 1655 with foreground-color 3.\n*>\n Get-Deduct-Amt.\n     If       WS-named = \"A\"\n        and   oi-Net = sih-Net\n        and   oi-VAT = sih-VAT\n        and   oi-carriage = sih-carriage\n              move \"Z\" to WS-named.\n*>\n     If       (sih-type not = 2  and not = 3)       *> Invoices, Credit Notes\n          or  not late-charges\n          or  WS-named = \"Z\"\n              move zero to sih-deduct-amt sih-deduct-VAT sih-deduct-days\n              go to  Main-Exit.\n*>\n     compute  amt-ok7 =  sih-Net  /  10.\n*>\n     If       amt-ok7 <  4\n              move  4  to  amt-ok7.\n*>\n     move     1726 to curs.\n     perform  Accept-Money7c.\n     move     amt-ok7 to sih-deduct-amt.\n*>\n Get-Deduct-VAT.\n     move     zeros to sih-deduct-VAT.\n*>\n     add      sih-Net  sih-extra  sih-carriage  sih-deduct-amt giving  Display-9.\n     display  Display-9 at 1926 with foreground-color 3.\n*>\n     add      sih-VAT  sih-e-VAT  sih-c-VAT  sih-deduct-VAT giving  Display-8.\n     display  Display-8 at 1941 with foreground-color 3.\n*>\n     add      sih-Net  sih-extra  sih-carriage  sih-deduct-amt\n              sih-VAT  sih-e-VAT  sih-c-VAT  sih-deduct-VAT   giving  Display-9.\n     display  Display-9 at 1955 with foreground-color 3.\n*>\n Get-Deduct-Days.\n     move     sih-days  to  WS-Dayes.\n     display  WS-Dayes at 1772 with foreground-color 3.\n     accept   WS-Dayes at 1772 with foreground-color 3 update.\n     move     WS-Dayes to sih-deduct-days.\n*>\n Main-Exit.\n     exit     section.\n*>\n Invoice-Details section.\n*>======================\n*>\n Invoice-Details-Main.\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Invoicing Data Entry\" at 0132           with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  WS-date at 0171 with foreground-color 2.\n*>\n     display  \"****************************************\" at 0441 with foreground-color 2.\n     display  \"*Date  [  /  /    ]*                   *\" at 0541 with foreground-color 2.\n     display  \"*A/C Nos  [       ]*Ref    [          ]*\" at 0641 with foreground-color 2.\n     display  \"*Invoice [        ]*Order  [          ]*\" at 0741 with foreground-color 2.\n     display  \"****************************************\" at 0841 with foreground-color 2.\n     display  \"F1 = Setup new Customer; F8 = Only Show delivery details\" at 0911 with foreground-color 2.\n     display  \"Type [ ]  <1> = Receipt; <2> = Account; <3> = Credit Note; <4> = Pro-Forma\"\n                                                         at 1001  with foreground-color 2.\n*>\n Date-Input.\n     display  WS-date at 0549 with foreground-color 3.\n     accept   WS-date at 0549 with foreground-color 3 update.\n*>\n     If       Cob-Crt-Status = Cob-Scr-Esc\n         or   WS-date = spaces\n              move 1 to z\n              go to  Main-Exit.\n*>\n     move     WS-date to WS-test-date.\n     perform  zz050-Validate-Date.\n     If       u-bin = zero\n              go to  Date-Input.\n*>\n*> Now WS-Inv-Month (as XX) and WS-Inv-Mth (as 99), contains active month for Invoicing\n*>  so we will use that for stk totals In month within year.\n*>\n     move     WS-test-date to WS-date.  *> still need orig. disp date as WS-date now UK\n     move     u-bin  to  sih-date.\n*>\n Customer-Input.\n     move     spaces  to  sih-Customer.\n     move     zero to Cob-Crt-Status.\n     accept   sih-Customer at 0652 with foreground-color 3 update.\n     move     function upper-case (sih-Customer) to sih-Customer.\n*>\n     If       Cob-Crt-Status = Cob-Scr-F8\n              move \"Y\" to WS-Show-Delivery\n     else\n              move \"N\" to WS-Show-Delivery\n     end-if.\n*>\n Customer-Test.\n     If       sih-Customer = \"NEW\"\n         or   Cob-Crt-Status = Cob-Scr-F1\n              go to New-Customer.\n*>\n     If       sih-Customer = spaces\n              move  \"Q\"  to  escape-Code\n              go to  Main-Exit.\n*>\n     move     1  to  C-Check.\n     move     sih-Customer  to WS-Sales-Key.\n*>\n     move     1 to File-Key-No.\n     perform  Sales-Read-Indexed.\n     If       fs-reply = 21 or = 23\n              move  zero  to  C-Check.\n*>\n     If       not  c-exists\n              display  \"No such Customer\" at 0401 with foreground-color 3\n              go to  Customer-Input.\n     display  \"                \" at 0401.\n*>\n     display  \"                        \" at 0911.  *> Clear F1 comment Only\n*>\n     If       sl-own-nos = \"Y\"\n              go to Get-inv.\n*>\n     move     zeros to Sih-Invoice.\n     If       Del-Exists\n              perform  Get-a-Deleted-Invoice.\n     If       Sih-Invoice = zeros\n              perform zz100-Read-System-Record\n              move next-invoice  to  sih-invoice\n                                     WS-Temp-Invoice\n              add  1 to Next-Invoice          *> Remove same code else where <<\n              perform zz110-Write-System-Record.\n*>\n     display  sih-invoice at 0751 with foreground-color 3.\n     go       to Jump-1.\n*>\n Get-inv.\n     accept   sih-invoice at 0751 with foreground-color 3 update.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              go to Customer-Input.\n*>\n try-again.\n     move     zero to sih-test.\n     move     sih-invoice  to  Invoice-nos.\n     move     sih-test     to  Item-nos.\n     perform  Invoice-Read-Indexed.\n     If       fs-reply not = zero\n              go to Jump-1.\n     display  \"Invoice Exists Re-Enter\" at 0701  with foreground-color 2.\n     go       to Get-Inv.\n*>\n Jump-1.\n     If       delivery-tag = zero\t*> Only show delivery details If F8 pressed Instead of\n       or     WS-Show-Delivery = \"N\"\t*> accept on cust no. Input\n              go to Customer-Setup.\n*>\n     move     \"D\"          to WS-Deliv-Key-Type.\n     move     WS-Sales-Key to WS-Deliv-Sales-Key.\n     perform  Delivery-Read-Indexed.\n     If       fs-reply = 21\n              move  zero  to  delivery-tag\n              go to  Customer-Setup.\n*>\n     move     deliv-address to address-a.\n     go       to Customer-display.\n*>\n Customer-Setup.\n     move     sales-address  to  address-a.\n*>\n Customer-display.\n     If       delivery-tag = zero\n              display sales-name at 0301 with foreground-color 3\n     else\n              display deliv-name at 0301 with foreground-color 3.\n*>\n     move     1  to  Z.\n     unstring address-a  delimited  by  sl-delim\n                  Into  address-line  count Z  pointer  Z.\n     display  address-line at 0401 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited  by  sl-delim\n                  Into  address-line  count Z  pointer  Z.\n     display  address-line at 0501 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited  by  sl-delim\n                  Into  address-line  count Z  pointer  Z.\n     display  address-line at 0601 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited  by  sl-delim\n                  Into  address-line  count Z  pointer  Z.\n     display  address-line at 0701 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  Into  address-line   pointer  Z.\n     display  address-line at 0801 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n*>\n ref-input.\n     move     spaces to sih-ref sih-order.\n     accept   sih-ref at 0669 with foreground-color 3 update.\n*>\n order-input.\n     accept   sih-order at 0769 with foreground-color 3 update.\n*>\n type-input.\n     move     zero to sih-type.\n     accept   sih-type at 1007 with foreground-color 3 update.\n     move     space to WS-named.\n     If       sih-type = zero\n              go to Invoice-Details-Main.\n*>\n     If       sih-type  >  4 or < 1\n              go to  type-input.\n*>\n     move     D-Types (sih-type) to add-line1.\n     display  \" \" at 1001 with erase eol.\n     display  \">>> \" at 1031 with foreground-color 2.\n     display  add-line1 at 1035 with foreground-color 2.\n*>\n     move     zero to sih-cr.\n     If       sih-type = 3\n              perform  cr-note\n              If    escape-Code = \"Q\"\n                    go to  Invoice-Details-Main.\n*>\n     move     zero to Z.\n*>\n     If       sih-type = 1  or  >  2\n              go to  Main-Exit.\n*>\n*>  Type 2 (Account) only\n*>\n     move     zero  to  we-error.\n*>\n     subtract sales-unapplied from sales-current.\n*>\n     If       sales-current  >  zero\n              subtract sales-last-inv from run-date giving  work-1\n              If work-1  >  sales-credit\n              display \"Overdue Balance <<<\" at 1648   with foreground-color 2 highlight\n              move  999  to  we-error.\n*>\n     If       sales-current  >  sales-limit\n              display \"Balance Exceeds Credit Limit <<<\" at 1725 with foreground-color 2 highlight\n              move  998  to  we-error.\n*>\n     If       sales-credit not > zero\n          or  sales-limit  not > zero\n              display \"No Longer an Account Customer <<<\" at 1825 with foreground-color 2 highlight\n              move  997  to  we-error.\n*>\n     If       we-error = zero\n              go to  Main-Exit.\n*>\n     display  \">>> Warning! \"      at 1635 with foreground-color 2  highlight.\n     display  \"**********************\" at 1958  with foreground-color 2.\n     display  \"*\" at 2058 with foreground-color 2.\n     display  \"*\" at 2158 with foreground-color 2.\n     display  \"*\" at 2079 with foreground-color 2.\n     display  \"*\" at 2179 with foreground-color 2.\n     display  \"**********************\" at 2258  with foreground-color 2.\n*>\n     display  \"None Zero or ESC To Abort\" at 2040 with foreground-color 2.\n     display  \"Return To Continue\" at 2140 with foreground-color 2.\n     move     zero to Z.\n     accept   Z at 2260 with foreground-color 6 update.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              move 1 to z\n                        Cob-Crt-Status.\n     go       to Main-Exit.\n*>\n New-Customer.\n     perform  OTM3-Close.\n     perform  Invoice-Close.\n*>\n     perform  Sales-Close.\n     perform  DelInvNos-Close.\n     perform  Delivery-Close.\n     perform  Analysis-Close.\n     If       SL-Stock-Link = \"Y\"\n              perform  Stock-Close.\n     If       Stk-Audit-Used = 1\n              perform Stock-Audit-Close.\n*>\n*> Call SL cust create program for New Customer.\n*>\n     call     \"sl960\" using WS-calling-data system-record to-day.\n     perform  Program-Start.\n     go       to Invoice-Details-Main.\n*>\n Main-Exit.\n     exit     section.\n*>\n Get-a-Deleted-Invoice section.\n*>============================\n*>\n     If       not Del-Exists\n              go to l70ad-Terminate.\n l70ab-Read.\n*>\n*> 30/4/15 new code for ISAM Instead of seq\n*>\n     move     zeros to WS-Del-Inv-Nos.\n     move     zeros to sih-invoice.  *> so we can test for It\n     move     1 to File-Key-No.\n     set      fn-not-less-than to true.\n     perform  DelInvNos-Start.\n*>     start    Del-Inv-Nos-File key not < WS-Del-Inv-Nos Invalid key\n     If       fs-reply = 21 or 23\n              go to l70ad-terminate.\n*>\n l70ab-Read-2.\n     perform  DelInvNos-Read-Next.\n     If       fs-reply = 10\n              move     \"N\" to WS-Using-Del-Inv-No\n              go to l70ac-Close.\n     If       WS-Del-Inv-Nos = zero\n              go to l70ab-Read-2.\n     move     WS-Del-Inv-Nos to sih-invoice.  *> del rec will be deleted after o/p of Invoice.\n     display  \"Using Deleted Invoice Numbers\" at 0345  with foreground-color 2 blink.\n     move     \"Y\" to WS-Using-Del-Inv-No.\n     go       to l70ae-Exit.\n*>\n l70ac-Close.\n*>\n*> If open as output clear down file and If RDB *MT deletes all records with\n*>  key below 99999999 so same thing\n*>\n     perform  DelInvNos-Close.\n     perform  DelInvNos-Open-Output.\n     display  \"                             \" at 0345.\n*>\n l70ad-Terminate.\n*>\n *>    move     next-invoice to sih-invoice.\n     move     zero to WS-delinv.\n*>\n l70ae-Exit.\n     exit     section.\n*>\n CR-Note      section.\n*>===================\n*>\n*>  CRs are only processed against posted Invoices, hence using OTM3.\n*>\n main.\n     display  \" \" at 1201 with erase eol.\n     display  \" \" at 1301 with erase eol.\n     display  \" \" at 1401 with erase eol.\n     display  \" \" at 1501 with erase eol.\n     display  \" \" at 1601 with erase eol.\n*>\n main-input.\n     display  \"Invoice To Credit - [        ]\" at 1201 with foreground-color 2.\n*>\n     move     zero  to  WS-CR.\n*>\n     accept   WS-CR at 1222 with foreground-color 3 update.\n     If       Cob-Crt-Status = Cob-Scr-Esc\n              move \"Q\" to escape-Code\n              go to Main-Exit.\n     move     WS-CR to sih-cr.\n     If       sih-cr = zero\n              move  \"Z\"  to  WS-named\n              go to  no-inv-restart\n     else\n              move  space  to  WS-named.\n*>\n     If       sih-cr = 99999999\n              move \"Q\" to escape-Code\n              go to Main-Exit\n     else\n              move space to escape-Code.\n*>\n     move     sih-cr       to  oi3-invoice.\n     move     sih-Customer to  oi3-Customer.\n*>\n     move     1 to File-Key-No.\n     perform  OTM3-Read-Indexed.     *> Error cant find the Invoice\n     If       fs-reply not = zero\n              display SL181 at line WS-23-lines col 01 with foreground-color 2 highlight\n              go to  main.\n*>\n     display  space at line WS-23-lines col 01 with erase eol.\n     If       oi-type not = 2               *> Error can only credit Posted Invoices\n              display SL184  at line WS-23-lines col 01 with foreground-color 2 highlight\n              go to main-input.\n*>\n     If       s-closed\t\t\t*> Error Invoice Is Paid\n              display SL182  at 1301  with foreground-color 2 highlight\n              go to main-input\n     else\n              display \" \" at line WS-23-lines col 01 with erase eol.\n*>\n     If       oi-hold-flag = \"Q\"\t*> Warning Invoice has query flag set but we can continue\n              display SL183  at line WS-23-lines col 01  with foreground-color 2 highlight.\n*>\n     If       Invoice-Customer not = WS-Sales-Key    *> cant happen\n              display SL193  at 1301 with foreground-color 4\n              go to main-input.\n*>\n     move     oi-date to u-bin.\n     add      1 oi-deduct-days to u-bin.\n     If       u-bin > sih-date\n              move \"A\" to WS-named.\n*>\n     add      oi-deduct-VAT to oi-deduct-amt.\n     add      oi-extra oi-carriage oi-deduct-amt oi-Net\n              oi-VAT oi-c-VAT oi-e-VAT to oi-discount.\n     subtract oi-PAid from oi-discount.\n*>\n     display  \"Amount O/S on Invoice Is \" at 1401   with foreground-color 2.\n     move     oi-discount to Display-9.\n     display  Display-9  at 1426 with foreground-color 3.\n     move     oi-deduct-amt to Display-8.\n     display  \"of which\" at 1437 with foreground-color 2.\n     display  Display-8  at 1446 with foreground-color 3.\n     display  \"is Late Charges\" at 1456 with foreground-color 2.\n     If       WS-named = \"A\"\n              display SL185 at 1510 with foreground-color 2.\n     display  SL006  at 1626.\n     accept   WS-reply  at 1670.\n*>\n No-Inv-Restart.\n     perform  main.       *> Clear screen lines 12 - 16\n*>\n Main-Exit.\n   exit section.\n*>\n Program-Start section.\n*>====================\n*>\n     display  \" \" at 0101 with erase eos.\n     move     to-day to u-date.          *> In UK date form\n*>\n*> New for BO processing 17/03/24\n*>\n     move     SL-BO-Flag  to WS-SL-BO-Flag.   *> BO In operation ? (will set (or not WS-BO-Used)\n*>\n     If       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-15        *> Analysis\n                                                 File-Info\n              If    return-Code not = zero          *> not = zero - No file found\n                    move 1 to WS-Process-Func\n                              WS-Sub-Function\n                    call \"sl070\" using WS-calling-data  *> Create Anal default recs\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15   *> Only If the call failed\n                                                       File-Info *> SHOULD NEVER happen but JIC\n                    If    return-Code not = zero          *> not = zero - No file found\n                          display   SL186 at 2301\n                          display   SL003 at 2401\n                          accept WS-Reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n     perform  Sales-Open.\n     perform  Delivery-Open.          *> these 2 are open I-O to force creation.\n     perform  Analysis-Open.\n     If       SL-Stock-Link = \"Y\" and  *> Create if not exist\n              WS-BO-Used               *> If BO flag set and linked to stock set\n              open     I-O BO-Stk-Itm-File\n              If       FS-Reply not = zero\n                       close BO-Stk-Itm-File\n                       open output BO-Stk-Itm-File\n                       close BO-Stk-Itm-File\n                       open  I-O BO-Stk-Itm-File.\n*>\n*> Create Invoice & ITM3 files If do not exist.\n*>\n     If       FS-Cobol-Files-Used             *> create Invoice If not exist.\n              call  \"CBL_CHECK_FILE_EXIST\" using File-16      *> Invoice\n                                                 File-Info\n              If    return-Code not = zero          *> not = zero - No file found\n                    perform  Invoice-Open-Output\n                    perform  Invoice-Close\n              end-if\n              call  \"CBL_CHECK_FILE_EXIST\" using File-19      *> create ITM3 If not exist\n                                                 File-Info\n              If    return-Code not = zero        *> not = zero - No file found\n                    perform OTM3-Open-Output\n                    perform OTM3-Close\n              end-if\n     end-if\n*>\n     move     zero  to  menu-reply.\n     perform  Invoice-Open.\n     perform  OTM3-Open-Input.\n     perform  DelInvNos-Open.\n     move     1 to WS-delinv.           *> could be just created as code will clear It If empty.\n*>\n*> If linked open Stock & Audit file\n*>\n     If       SL-Stock-Link = \"Y\"\n       If     FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-11        *> Stock file\n                                                 File-Info\n              end-call\n              If    return-Code not = zero          *> not = zero - No file found\n                    perform Stock-Open-Output\n                    perform Stock-Close\n              end-if\n              perform Stock-Open                   *> open I-o  stock-file   Thats ok we just wont find any Items\n              If     Stk-Audit-Used = 1\n                     call  \"CBL_CHECK_FILE_EXIST\" using File-10        *> Stock audit file\n                                                        File-Info\n                     end-call\n                     If    return-Code not = zero          *> not = zero - No file found\n                           perform Stock-Audit-Open-Output\n                     else\n                           perform Stock-Audit-Open-Extend\n                     end-if\n              end-if\n       end-if\n     end-if.\n*>\n Main-Exit.\n     exit     section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   WS-test-date\n*> output:  u-date/WS-date as uk date format\n*>          u-bin not zero If valid date\n*>\n     move     WS-test-date to WS-date.\n     If       Date-Form = zero\n              move WS-Month to WS-Inv-Month    *> done again for UK - but JIC\n              move 1 to Date-Form.\n     If       Date-UK\n              move WS-Month to WS-Inv-Month\n              go to zz050-test-date.\n     If       Date-USA                *> swap month and days\n              move WS-days  to WS-swap\n              move WS-month to WS-days\n              move WS-swap  to WS-month\n              move WS-Month to WS-Inv-Month\n              go to zz050-test-date.\n*>\n*> So Its International date format\n*>\n     move     \"dd/mm/ccyy\" to WS-date.  *> swap Intl to UK form\n     move     WS-test-date (1:4) to WS-Year.\n     move     WS-test-date (6:2) to WS-Month.\n     move     WS-Month           to WS-Inv-Month\n     move     WS-test-date (9:2) to WS-Days.\n*>\n zz050-test-date.\n     move     WS-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date In binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  WS-date as uk/US/Inlt date format\n*>          u-date & WS-Date = spaces If Invalid date\n*>\n     perform  maps04.\n     If       u-date = spaces\n              move spaces to WS-Date\n              go to zz060-Exit.\n     move     u-date to WS-date.\n*>\n     If       Date-Form = zero\n              move 1 to Date-Form.\n     If       Date-UK\n              go to zz060-Exit.\n     If       Date-USA                *> swap month and days\n              move WS-days to WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz060-Exit.\n*>\n*> So Its International date format\n*>\n     move     \"ccyy/mm/dd\" to WS-date.  *> swap Intl to UK form\n     move     u-date (7:4) to WS-Intl-Year.\n     move     u-date (4:2) to WS-Intl-Month.\n     move     u-date (1:2) to WS-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date In to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  WS-date as uk/US/Inlt date format\n*>\n     move     to-day to WS-date.\n*>\n     If       Date-Form = zero\n              move 1 to Date-Form.\n     If       Date-UK\n              go to zz070-Exit.\n     If       Date-USA                *> swap month and days\n              move WS-days to WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz070-Exit.\n*>\n*> So Its International date format\n*>\n     move     \"ccyy/mm/dd\" to WS-date.  *> swap Intl to UK form\n     move     to-day (7:4) to WS-Intl-Year.\n     move     to-day (4:2) to WS-Intl-Month.\n     move     to-day (1:2) to WS-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n zz080-Close-All-Files section.\n*>****************************\n*>\n     perform  Sales-Close.\n     perform  Delivery-Close.\n     perform  Analysis-Close.\n     close    BO-Stk-Itm-File.\n     perform  Invoice-Close.\n     perform  OTM3-Close.\n     perform  DelInvNos-Close.\n     move     zero to  Pass-Value.\n     If       SL-Stock-Link = \"Y\"\n              perform Stock-Close\n              perform Stock-Audit-Close\n              close    BO-Stk-Itm-File.\n*>\n zz080-Exit.\n     exit     section.\n*>\n*> Used when next-invoice and saving It when creating Invoice recs.\n*>\n zz100-Read-System-Record  section.\n*>********************************\n*>\n     move     zeros to File-System-Used\n                       File-Duplicates-In-Use.  *> Only use param FILE\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.  *> Force Cobol proc.\n     move     Pass-Value to WS-Pass-Value.  *> save sys rec fld for rewrite as not saved yet.\n     move     1 to File-Key-No.\n     perform  System-Open-Input.\n*>\n     move     1 to File-Key-No.\n     perform  System-Read-Indexed.        *> Read Cobol file params, no tests as opened In sales.\n     perform  System-Close.\n*>\n zz100-Exit.\n     exit     section.\n*>\n zz110-Write-System-Record  section.\n*>*********************************\n*>\n     If       File-System-Used NOT = zero   *> Force RDB processing\n              move     \"66\" to FA-RDBMS-Flat-Statuses\n              move     1 to File-Key-No\n              move     WS-Pass-Value to Pass-Value  *> restore it\n              perform  System-Open\n              move     1 to File-Key-No\n              perform  System-Rewrite\n              perform  System-Close\n     end-if.\n*>\n*> Now do the same for the Cobol file.\n*>\n     move     zeros to File-System-Used\n                       File-Duplicates-In-Use.\n     move     \"00\" to  FA-RDBMS-Flat-Statuses.   *> Force Cobol proc.\n     move     1 to File-Key-No.\n     move     WS-Pass-Value to Pass-Value.  *> restore it.\n     perform  System-Open.                       *> Open cobol file params as I/O\n     move     1 to File-Key-No.\n     perform  System-Rewrite.                    *> Update Cobol file params\n     perform  System-Close.                      *> Close the Cobol param file.\n*>\n zz110-Exit.\n     exit     section.\n*>\n zz120-Build-BO-Record  section.\n*>*****************************\n*>\n*> No processing for Credit Notes\n*> Invoice-no = zero If stock-held = zero WITH no Inv Item line created.\n*>\n*> If we get an write error, retry adding 1 to serial up to 98 times\n*>",
        "line": 1380
      },
      {
        "type": "IF",
        "condition": "Sih-Type = 3  *> Not for CN's.\n              go to zz120-Exit.\n*>\n     Initialise\n              BO-Stk-Itm-Record with filler.\n     move     Sih-Customer    to BO-Stk-Cust-No.\n     move     Sil-Product (I) to BO-Stk-Item-No.\n     move     zero            to BO-Serial.\n     move     Sih-Type        to BO-Stk-Inv-Type.\n     move     Sih-Order       to BO-Stk-PO.\n     move     Sih-Ref         to BO-Stk-Ref.\n     move     WS-Temp-Invoice to BO-Stk-Orig-Inv-No.\n     subtract WS-Qty from Stock-Held giving BO-Stk-BO-Qty.\n     move     Stock-Order-Due to BO-Stk-BO-Arr-Date. *> days since 1601 ?.\n     move     Sih-Date        to BO-Stk-Order-Date.  *> Today, days since 1601.\n     move     Stock-Retail    to BO-Stk-Price.       *> current price\n     write    BO-Stk-Itm-Record.\n     If       FS-Reply  not = zero\n              perform  until FS-Reply = zero\n                       add      1 to BO-Serial\n                       write    BO-Stk-Itm-Record\n                       if       FS-Reply = zeros\n                                exit perform\n                       end-if\n                       if       BO-Serial > 98   *> It should never happen cust ordered 98 times for same item #\n                                perform Eval-Status\n                                display SL203         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                                display fs-reply      at line WS-23-lines col 30 with foreground-color 2 highlight\n                                display exception-msg at line WS-23-lines col 33 with foreground-color 3\n                                display BO-Cust-Itm-No at line WS-23-lines col 59 with foreground-color 3\n                                display SL006         at line WS-lines    col 1\n                                accept WS-reply       at line WS-lines    col 45\n                                move    4 to Return-Code\n                                exit perform\n                       end-if\n                       exit perform cycle\n              end-perform\n     end-if.\n*>\n zz120-Exit.\n     exit     section.\n*>\n zz200-Build-From-BO  section.\n*>***************************\n*>\n*> Process BO (Back Orders) if present but only if new stock has\n*> arrived via st020 Stock Addition processing which updates any\n*> and all existing BO records that have a matching stock item.\n*>\n*> Such BO records, are deleted after processing a new invoice, Proforma or\n*> receipt.\n*>\n*> Two tables are used BO-Table 1 and 2 and initialised at start with keys set\n*> as all 9's and other fields spaces or zeros depending on field type via\n*> INITIALISE.\n*> BO records are read and stored in BO table 1, sorted by Customer/Stock item.\n*> This allows (if present) multi stock items to be processed for the same\n*> customer in one hit but see later.\n*>\n*> BO Table 1 is read and for each unique Stock Item BO-Table 2 is created and\n*> Stock item record read, onhold stock stored & ordered qty added to.\n*> Table is sorted by item number.\n*>\n*>  For Table 1 - if stock onhold is not < ordered table 1 sorted by cust/item\n*> else left as sorted by order date and ALL processing done by Date only.\n*>\n*> This might need changing but that means looking for all items order for\n*> specific customer CANNOT occur- - [ Swings and roundabout syndrome ].\n*>\n*> Although it could be possible to just process table 1 for only items that\n*>  are short of stock and these are only processed by date with all others\n*>  assuming more than one item still present and re-sorted by cust/item\n*> This is not done at present as just makes it more complex.\n*>\n     If       NOT WS-BO-Used\n              go to zz200-Exit.  *> Quit if BO NOT In use\n*>\n     move     low-values to BO-Cust-Itm-No.\n     move     zeros  to BO-Table-Used  *> active table in use count\n                        Return-Code.   *> Needed if need next table entry at\n                                       *> top level inline perform\n     move     spaces to WS-Temp-Cust.  *> Records current cust # to test for change of #\n*>\n*> Init each table entry",
        "line": 2645
      },
      {
        "type": "IF",
        "condition": "Arrived-Flag = \"Y\"\n*>  as they can be processed now.\n*>\n     start    BO-Stk-Itm-File FIRST.\n     perform  until exit\n              read     BO-Stk-Itm-File next record at end\n                       exit perform\n              end-read\n              If       FS-Reply not = zero   *> EOF & JIC\n                       exit perform\n              end-if\n              If       BO-Stk-Arrived-Flag = \"Y\"\n                       add      1  to BO-Table-Used\n                       If       BO-Table-Used > BO-Table-Size\n                                display  \" \" at 0101 with erase eos\n                                display  SL207 at 1201 with foreground-color 4 highlight beep\n                                display  SL208 at 1401 with foreground-color 2\n                                display  SL006 at 1501 with foreground-color 2\n                                accept   WS-Reply at 1545\n                                move     4 to Return-Code\n                                exit perform\n                       end-if\n                       move     BO-Stk-Itm-Record to BOT-Record (BO-Table-Used)\n              end-if\n              exit     perform cycle\n     end-perform.\n*>\n*> Have now loaded table of all BO records that have NEWLY arrived stock\n*>\n     If       Return-Code = 4       *> Table size too small so quit process as\n              move     \"N\" to WS-BO-Processing\n              go to    zz200-Exit.  *> needs a recompile with larger Table size although preset to 500.\n*>\n     If       BO-Table-Used = zero    *> No BO records with new stock so quit BO process\n              move     \"N\" to WS-BO-Processing\n              go to    zz200-Exit.\n*>\n*> Sort First by Stock Item Number if we have > 1\n*>\n     move     zero to Return-Code.\n     if       BO-Table-Used = 1       *> sort not needed\n              move     1 to WS-Item-Table-Used\n              move     BOT-Stk-Item-No (1) to WS-Item-No (1)\n              move     BOT-Stk-BO-Qty  (1) to WS-Total-Ordered (1)\n     else\n              sort     BOT-Record on ascending key BOT-Stk-Item-No\n              move     zero   to BO-Table-Cnt\n                                 WS-Item-Table-Used\n              perform  until BO-Table-Cnt not < BO-Table-Used\n                       add      1  to BO-Table-Cnt\n                       if       BO-Table-Cnt > BO-Table-Used\n                                display  \" \" at 0101 with erase eos\n                                display  SL213 at 1201 with foreground-color 4 highlight beep\n                                display  SL208 at 1401 with foreground-color 2\n                                display  SL006 at 1501 with foreground-color 2\n                                accept   WS-Reply at 1545\n                                move     4 to Return-Code\n                                exit perform\n                       end-if\n                       if       WS-Temp-Stock-Key not = BOT-Stk-Item-No (BO-Table-Cnt)\n                                add      1  to WS-Item-Table-Used\n                                move     BOT-Stk-Item-No (BO-Table-Cnt)\n                                                      to WS-Temp-Stock-Key\n                                                         WS-Item-No (WS-Item-Table-Used)\n                                move     BOT-Stk-BO-Qty  (BO-Table-Cnt)\n                                                      to WS-Total-Ordered (WS-Item-Table-Used)\n                       else\n                                add      BOT-Stk-BO-Qty  (BO-Table-Cnt)\n                                                      to WS-Total-Ordered (WS-Item-Table-Used)\n                       end-if\n                       exit perform cycle\n              end-perform   *> Table holds total back ordered per item #\n     end-if.\n     If       Return-Code = 4       *> Table size too small so quit process as\n              move     \"N\" to WS-BO-Processing\n              go to    zz200-Exit.  *> needs a recompile with larger Table size although preset to 500.\n*>\n*>\n*> Now have table containing Total Qty per stock item BO, so we\n*> can now check if this total is LESS than the arrived stock via stock records.\n*> If NOT should process in DATE order instead of customer order.\n*>\n     move     zero to Return-Code.\n     if       WS-Item-Table-Used > zero\n              perform  varying  WS-Item-Table-Cnt from 1 by 1\n                          until WS-Item-Table-Cnt > WS-Item-Table-Used\n                       move     WS-Item-No (WS-Item-Table-Cnt)  to WS-Stock-Key\n                       move     1 to File-Key-No\n                       perform  Stock-Read-Indexed\n                       If       FS-Reply not = zeros   *> Should not really happen but ...\n                                perform Test-For-Read-Stock  *> display the problem\n                                move   8 to Return-Code\n                                exit perform\n                       end-if\n                       move     Stock-Held to WS-Stock-Held (WS-Item-Table-Cnt)\n                       if       WS-Total-Ordered (WS-Item-Table-Cnt) > WS-Stock-Held (WS-Item-Table-Cnt)\n                                move     \"Y\" to WS-BO-Date-Order-Processing\n                                                WS-Date-Flag (WS-Item-Table-Cnt)\n                                add      1 to WS-BO-Date-Cnt\n                       end-if\n                       exit     perform cycle\n              end-perform\n     end-if\n     if       Return-Code = 8              *> bad status reading stock record so quit\n              move     \"N\" to WS-BO-Processing\n              go to zz200-Exit.\n*>\n*> Sort second by Customer / Item no\n*>\n     If       BO-Table-Used > 1  *> Don't sort for < 2\n       and    not WS-BO-Process-By-Date\n              sort     BOT-Record on ascending key BOT-Cust-Itm-No\n              move     \"Y\" to WS-BO-Processing\n     end-if\n*>\n*> Also see further down for question and test..\n*>\n*> Now have table In sorted order of Items within Cust no so order Is cust no.\n*> Item no.  This way only need to check change of cust no.\n*> and as unused entries have high-values, they will be at end of table after\n*> sort.\n*>\n*> At this point there ARE BO items to process.\n*>\n*> IF any BO Stock items Qty > Stock-Held",
        "line": 2749
      },
      {
        "type": "IF",
        "condition": "needed one or more items Held\n*> stock is less than total BO orders all will be processed by Date only.\n*>  Offer to provide a BO item list with :\n*>  Item #, Short Description, BO Order total, Item Held #. Flash aly where stock not enough\n*>\n*> so ask (SL214) if BO processing to procede with # of items that can be done.\n*> If Yes",
        "line": 2877
      },
      {
        "type": "IF",
        "condition": "WS-Reply not = \"Y\"\n              move     \"N\" to WS-BO-Processing\n              go to zz200-Exit.\n*>\n     display  SL215  at 0401 with erase eol foreground-color 2.\n     move     \"Y\" to WS-Reply.\n\n     accept   WS-Reply at 0445 update UPPER.\n*>\n*> This perform, takes care if display area less than number of items available\n*>",
        "line": 2890
      },
      {
        "type": "IF",
        "condition": "Date mode needed (YES).\n*>\n     if       WS-Reply = \"Y\"\n*> Do Sub heads\n              display  \"Item Number \"   at 0401  with erase eos foreground-color 3\n              display  \" Held      Ord\" at 0416  with foreground-color 3\n              display  \"Date\"           at 0431  with foreground-color 3\n              display  \"Mode\"           at 0531  with foreground-color 3\n*> Now the data\n              move     zero to WS-Item-Table-Cnt\n              move     5    to Lin\n              Initialize SInvoice-Header\n              Initialize SInvoice-Bodies\n              perform  until exit\n                       add      1 to WS-Item-Table-Cnt\n                       if       WS-Item-Table-Cnt > WS-Item-Table-Used\n                                display  SL006    at line WS-23-Lines col 1 with foreground-color 2\n                                move     space to WS-Reply\n                                accept   WS-Reply at line WS-23-Lines col 45 with foreground-color 2\n                                exit perform   *> List finished as all displayed\n                       end-if\n                       add      1 to Lin\n                       move     WS-Stock-Held    (WS-Item-Table-Cnt) to WS-Display6-1\n                       move     WS-Total-Ordered (WS-Item-Table-Cnt) to WS-Display6-2\n                       display  WS-Item-No   (WS-Item-Table-Cnt) at line Lin col 01 with foreground-color 2\n                       display  WS-Display6-1                    at line Lin col 16 with foreground-color 2\n                       display  WS-Display6-2                    at line Lin col 23 with foreground-color 2\n                       if       WS-Date-Flag (WS-Item-Table-Cnt) = \"Y\"\n                                display  WS-Display6-1           at line Lin col 16 with foreground-color 3 HIGHLIGHT\n                                display  \"YES\"                   at line Lin col 32 with foreground-color 3 HIGHLIGHT\n                       end-if\n                       if       Lin = WS-22-Lines\n                                display  SL006    at line WS-23-Lines col 1 with foreground-color 2\n                                move     space to WS-Reply\n                                accept   WS-Reply at line WS-23-Lines col 45 with foreground-color 2\n                                if       WS-Item-Table-Cnt not < WS-Item-Table-Used\n                                         exit perform         *> stops dup SL006 etc as could happen.\n                                end-if\n                                move     5 to Lin\n                                display  space at 0601 with erase eos\n                       end-if\n                       exit perform cycle\n              end-perform\n              display  space at 0401 with erase eos\n     end-if.\n*>\n     move     To-Day to U-Date.\n     move     zero   to U-Bin.\n     perform  maps04.       *> Now U-Bin has days since 1601 for To-Day\n     If       U-Bin = zero   *> Should never happen but JIC\n              perform  zz080-Close-All-Files\n              stop     \"Date code In ZZ200 broken - aborted - press return to quit\"\n              stop     run.\n*>\n*> Ask if processing by DATE, if not turn date proc OFF and resort as cust / item\n*>\n     if       WS-BO-Process-By-Date\n          and BO-Table-Used > 1          *> other table ?, nope keep using primary\n              move     WS-BO-Date-Cnt     to WS-Display3-1\n              move     WS-Item-Table-Used to WS-Display3-2\n              display  SL216    at 0401 with erase eos foreground-color 2\n              display  WS-Display3-1 at 0411  with foreground-color 3\n              display  WS-Display3-2 at 0417  with foreground-color 3\n              display  SL217         at 0601  with foreground-color 2\n              move     space to WS-Reply\n              accept   WS-Reply at 0671 with foreground-color 3 UPPER\n              if       WS-Reply = \"Y\"\n                       move     \"N\" to WS-BO-Date-Order-Processing\n                       sort     BOT-Record on ascending key BOT-Cust-Itm-No\n                       move     \"Y\" to WS-BO-Processing\n              end-if\n     end-if\n*>\n*> Start of Primary BO Item processing\n*>\n     move     zero to Return-Code\n                      BO-Invoiced-Used\n                      BO-Invoiced-Cnt   *> so far not used\n                      BO-Table-Cnt.\n     perform  until exit *> get next table rec",
        "line": 2900
      },
      {
        "type": "IF",
        "condition": "BO-Table-Cnt > BO-Table-Used\n                       move     \"N\" to WS-BO-Processing\n                       exit perform\n              end-if\n              If       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                       move     BOT-Stk-Cust-No (BO-Table-Cnt) to WS-Temp-Cust   *> save for compare against change of cust\n              end-if\n*>\n*> Create header rec based In Invoice-Details\n*>\n              Initialize SInvoice-Header with filler\n              move     U-Bin            to Sih-Date\n              move     BOT-Stk-Cust-No (BO-Table-Cnt)  to Sih-Customer\n                                                          WS-Sales-Key\n              move     1  to C-Check\n              move     1  to File-Key-No\n              perform  Sales-Read-Indexed    *> JIC Cust. now deleted but should not happen\n              If       fs-reply not = zeros  *> as delete routine in sl010 checks for BO recs\n                       display  SL211 at 0401 with foreground-color 4\n                       move     BOT-Stk-Cust-No (BO-Table-Cnt) to WS-Temp-Cust  *> MAY BE SPACES ???\n                       exit perform cycle\n              end-if\n              display  \"                \" at 0401\n              display  \"                        \" at 0911\n*>\n              move     zeros to Sih-Invoice\n              If       Del-Exists\n                       perform  Get-a-Deleted-Invoice\n              end-if\n              move     zero         to Sih-Test\n              perform  until exit  *> Get a new Invoice # if sih-invoice = 0 (no deleted invoices)\n                       If       Sih-Invoice = zeros\n                                perform  zz100-Read-System-Record\n                                move     next-invoice  to  sih-invoice\n                                                           WS-Temp-Invoice\n                                add      1 to Next-Invoice          *> Remove same code else where\n                                perform  zz110-Write-System-Record\n                       end-if\n                       move     sih-invoice  to  Invoice-nos\n                       move     sih-test     to  Item-nos\n                       perform  Invoice-Read-Indexed\n                       If       fs-reply not = zero   *> Rec not present thats good\n                                exit perform\n                       else\n                                move     zero to Sih-Invoice\n                                exit     perform cycle  *> get next Inv # as It is present\n                       end-if\n              end-perform\n*>\n*> Have a good Invoice # in Sih_invoice\n*>\n              move     BOT-Stk-PO       (BO-Table-Cnt) to Sih-Order\n              move     BOT-Stk-Ref      (BO-Table-Cnt) to Sih-Ref\n              move     BOT-Stk-Inv-Type (BO-Table-Cnt) to Sih-Type\n              Initialise SInvoice-Bodies  *> No Filler present\n*>\n              display  prog-name at 0101 with foreground-color 2 erase eos\n              perform  zz070-Convert-Date\n              display  WS-date at 0171 with foreground-color 2\n              display  \"Back Order Processing\" at 0229 with foreground-color 2\n              display  \"****************************************\" at 0441 with foreground-color 2\n              display  \"*                  *                   *\" at 0541 with foreground-color 2\n              display  \"*A/C Nos  <       >*Ref    [          ]*\" at 0641 with foreground-color 2\n              display  \"*Invoice <        >*Order  [          ]*\" at 0741 with foreground-color 2\n              display  \"****************************************\" at 0841 with foreground-color 2\n              display  \"Type [ ]  <1> = Receipt; <2> = Account; <4> = Pro-Forma\"\n                                                         at 1001  with foreground-color 2\n*>\n              display  Sih-Customer at 0652 with foreground-color 3\n              display  Sih-Invoice  at 0751 with foreground-color 3\n              display  Sih-Ref      at 0669 with foreground-color 3\n              display  Sih-Order    at 0769 with foreground-color 3\n              display  Sih-Type     at 1007 with foreground-color 3\n              display  ws-dash      at 1101 with foreground-color 2\n*>\n              move     Sih-Customer  to WS-Sales-Key\n              move     1 to File-Key-No\n              perform  Sales-Read-Indexed\n              move     Sales-Address  to  Address-A\n              perform  Customer-Display  *> Display  name & address\n*>\n              display  \"Stock Linked\" at 1201 with foreground-color 2\n              display  \"Line - \"               at 1216 with foreground-color 2\n              display  \"Net <          >\"      at 1227 with foreground-color 2\n              display  \"Vat <          >\"      at 1244 with foreground-color 2\n              display  \"Invoice <          >\"  at 1261 with foreground-color 2\n              display  \"Product     <----------Description--------->    Qty   Unit Price  Disc. Vat\"\n                                               at 1405 with foreground-color 2\n*>\n*>  This all assumes that screen length Is always less than # of Items per cust.\n*>  otherwise this WILL need CHANGING.\n*>\n              move     zero to I\n              perform  zz300-Display-Outline-2 varying lin from 16 by 1\n                                                until lin not < ws-23-lines\n              subtract WS-Accept-Body from I                    *> M = WS-accept-body\n              move     1  to  J\n              add      J  14  giving  lin  *> minus 1 to allow for the ADD\n*>\n              move     1 to I\n*>\n              display  I at 1223 with foreground-color 3  *> Line # for item #\n*>   Get-data-2-main\n              perform  until exit\n                       if       BO-Table-Cnt > BO-Table-Used\n                                move     \"N\" to WS-BO-Processing\n                                exit perform   *> Ditto ^^\n                       end-if\n                       if       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                                exit perform\n                       end-if                *> Should never happen as tested 1st level perform\n                       add      1 to Lin\n                       move     2 to cole\n                       move     BOT-Stk-Item-No (BO-Table-Cnt)  to WS-Product\n                                                                   Sil-Product (I)\n                                                                   Test-Product\n                                                                   WS-Temp-Stock-Key\n                       display  WS-Product at curs with foreground-color 2\n*>\n*>   Get stock rec (Get-Simple-Stock)\n*>\n                       move     spaces  to  Sil-Description (I)\n                       If       WS-Stock-No-Long = spaces\n                                move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                                move 2 to File-Key-No\n                       else\n                                move WS-Temp-Stock-Key to WS-Stock-Key\n                                move 1 to File-Key-No\n                       end-if\n                       perform  Stock-Read-Indexed\n                       If       FS-Reply = 21 or = 23   *> Should never happen - BUT JIC\n                                move SL196 to WS-Stock-Desc\n                                move     spaces         to WS-PA\n                                                           PA-group\n                                                           Sil-PA (I)\n                       else\n                                move     Stock-SA-Group to WS-PA\n                                                           PA-group\n                                                           Sil-PA (I)\n                       end-if\n*>\n                       move     17 to cole        *> Desc\n                       display  WS-Stock-Desc   at curs with foreground-color 3\n                       move     WS-Stock-Desc to WS-Description\n                                                 Sil-Description (I)\n                       move     BOT-Stk-BO-Qty (BO-Table-Cnt) to WS-Qty\n                       move     53 to cole        *> QTY\n                       If       Stock-Services-Flag = \"Y\"\n                                move 1 to WS-Qty\n                       end-if\n *>                      display  WS-Qty at curs with foreground-color 3\n                       accept   WS-Qty at curs with foreground-color 3 update\n                       If       WS-Qty = zero       *> Cancel/Ignore BO transaction on zero or Escape\n                         OR     Cob-Crt-Status = Cob-Scr-Esc\n                                If       I > zero   *> JIC\n                                         move     \"S\" to WS-Reply     *> Skip this time\n                                         display  SL220 at line WS-23-Lines col 1 with foreground-color 4 with erase eos\n                                         display  SL221 at line WS-Lines col 5 with foreground-color 3 Highlight\n                                         accept   WS-Reply at line WS-23-Lines col 72\n                                                           with foreground-color 3 UPPER UPDATE\n                                         if       WS-Reply = \"D\"\n                                                  move BOT-Cust-Itm-No (BO-Invoiced-Cnt)  to BO-Cust-Itm-No\n                                                  delete   BO-Stk-Itm-File record  *> Dont care if invalid, hopefully\n                                         end-if  *> otherwise, it is Skip it, this time\n                                         display  space at line WS-23-Lines col 1 with erase eos\n                                         Initialise Invoice-Lines (I)  *> clear down any above entered data\n                                         subtract 1 from I             *>  for Item line\n                                end-if\n                                if       BO-Table-Cnt + 1 > BO-Table-Used\n                                         if       I > 1\n                                                  perform  End-Totals  *> does P&P etc.\n                                                  perform  zz210-Delete-BO-Records\n                                         end-if\n                                         move     2 to Return-Code  *> exit top perform\n                                         exit     perform   *> I = 1 = no transactions\n                                end-if\n                                add      1 to BO-Table-Cnt\n                                if       BOT-Stk-Cust-No (BO-Table-Cnt) not = WS-Temp-Cust\n                                         move     1 to Return-Code\n                                         exit     perform\n                                end-if\n                       end-if                *> Should never happen as tested 1st level perform\n                       if       BO-Table-Cnt > BO-Table-Used\n                                move     \"N\" to WS-BO-Processing\n                                move     2 to Return-Code\n                                exit perform\n                       end-if\n*>\n                       move     60 to cole  *> Unit Price\n                       move     Stock-Retail to WS-Tmp-Stk-Price\n*>\n*>  What to do If BO price and stock not the same  ??\n*>\n                       move     \"B\" to WS-Reply\n*>\n*> Set default as using BO price, Reply = B or S = Stock price\n*>\n                       If       BOT-Stk-Price (BO-Table-Cnt) not = Stock-Retail\n                                move     BOT-Stk-Price (BO-Table-Cnt) to WS-Tmp-BO-Price\n                                move     Stock-Retail to WS-Tmp-Stk-Price\n                                display  SL209 at line WS-23-Lines col 1 with foreground-color 4\n                                                                         highlight beep erase eol\n                                display  SL003 at line WS-Lines  col 1   with foreground-color 2\n                                accept   WS-Reply at line WS-Lines col 30 with foreground-color 3\n                                                                               UPDATE\n                                display  \"BO Price - \"    at line WS-23-Lines col 1\n                                                             with foreground-color 2 erase eos\n                                display  WS-Tmp-BO-Price  at line WS-23-Lines col 12\n                                                             with foreground-color 2\n                                display  \"Stock Price - \" at line WS-23-Lines col 35\n                                                             with foreground-color 2\n                                display  WS-Tmp-Stk-Price at line WS-23-Lines col 49\n                                display  SL210 at line WS-Lines col 1 with foreground-color 2\n                                If       BOT-Stk-Inv-Type (BO-Table-Cnt) not = 1 and not = 2\n                                         move     \"S\" to WS-Reply  *> Using stock price for proformas else BO rec price\n                                else\n                                         move     \"B\" to WS-Reply\n                                end-if\n                                accept   WS-Reply at line WS-Lines col 45 with foreground-color 3\n                                                                               UPPER UPDATE\n*>  NET\n                                If       WS-Reply = \"B\"\n                                         multiply WS-Qty by BOT-Stk-Price (BO-Table-Cnt) giving WS-Net\n                                         display  WS-Tmp-BO-Price at curs with foreground-color 3\n                                         move     BOT-Stk-Price (BO-Table-Cnt) to WS-Unit\n                                else\n                                         multiply WS-Qty by Stock-Retail giving WS-Net\n                                         display  WS-Tmp-Stk-Price at curs with foreground-color 3\n                                         move     Stock-Retail to WS-Unit\n                                end-if\n                       else             *> BO and Stock price the same\n                                multiply WS-Qty by Stock-Retail giving WS-Net\n                                move     Stock-Retail to WS-Unit\n                                display  WS-Tmp-Stk-Price at curs with foreground-color 3\n                       end-if\n                       move     WS-Qty  to Sil-Qty (I)\n                       move     WS-Net  to Sil-Net (I)\n                                           Display-9\n                       move     WS-Unit to Sil-Unit (I)\n                       display  Display-9 at 1232 with foreground-color 3\n*>\n*>  Discount\n*>\n                       move     Sales-Discount  to  WS-discount\n                       move     72 to cole\n                       move     WS-disc-wka to WS-disca1\n                       move     WS-disc-wkb to WS-disca3\n                       display  WS-discount-display at curs with foreground-color 3\n                       accept   WS-discount-accept  at curs with foreground-color 3 update\n                       move     WS-discb1 to WS-disc-wka\n                       move     WS-discb3 to WS-disc-wkb\n                       move     WS-discount to  work-d Sil-discount (I)\n                       move     WS-Net to  work-n\n                       multiply work-n by work-d giving work-1\n                       divide   work-1 by 100    giving work-1\n                       subtract work-1  from  WS-Net\n                       move     WS-Net to Sil-Net (I) Display-9\n                       display  Display-9 at 1232 with foreground-color 3\n*>\n*>   VAT\n*>\n                       move     \"S\" to Vat-Code-X  *> 17/2/23  for Standard rate\n                       move     79 to cole\n                       display  Vat-Code-X at curs with foreground-color 3\n                       accept   Vat-Code-X at curs with foreground-color 3 update\n*>\n                       If       Vat-Code-X = \"S\"    *> Standard code 1\n                                move 1 to Vat-Code\n                        else\n                         If     Vat-Code-X = \"R\"    *> Reduced  code 2\n                                move 2 to Vat-Code\n                          else\n                           If   Vat-Code-X = \"Z\"    *> Zero     code 3\n                                move 3 to Vat-Code\n                           end-if\n                         end-if\n                       end-if  *> Otherwise assuming it is 1, 2 or 3 but could be 4 or 5 for say USA\n*> using 1st three as last 2 are Sales tax, Not 4 UK but used outside UK, EU & AUZ etc so supported\n                       If       Vat-Code < 1 or > 5  *> so change test for 'not\n                                move 3 to Vat-Code   *> = 4 or 5' Instead of '> 3'\n                       end-if\n                       move     Vat-Code  to  Sil-Vat-Code (I)\n*>\n                       If       Vat-Code = zero\n                                move  zero  to  WS-VAT\n                       else\n                                move VAT-Rate (Vat-Code) to WS-VAT-Rate\n                                compute  WS-VAT rounded = (WS-Net * WS-VAT-Rate) / 100\n                       end-if\n*>\n                       move     WS-VAT to  Display-9\n                                           Sil-VAT (I)\n                       display  Display-9 at 1249 with foreground-color 3\n                       perform  Running-Totals    *> GOOD for Inline so display for line 12\n*>\n                       add      1  to  J  *> Display line\n                       add      1  to  I  *> inv body no\n*>\n                       add      1  to  BO-Invoiced-Used\n                       if       BO-Invoiced-Used > BO-Invoiced-Size   *> size 50 for 1 cust, should never happen but JIC\n                                display  \" \" at 0101 with erase eos\n                                display  SL218 at 1201 with foreground-color 4 highlight beep\n                                display  \"(\"   at 1265 with foreground-color 4\n                                display  BO-Invoiced-Size at 1266 with foreground-color 4\n                                display  \")\"   at 1268 with foreground-color 4\n                                display  SL208 at 1401 with foreground-color 2\n                                display  SL006 at 1501 with foreground-color 2\n                                accept   WS-Reply at 1545\n                                move     8 to Return-Code\n                                exit perform\n                       end-if\n                       move     BOT-Cust-Itm-No (BO-Table-Cnt) to BO-Invoiced-Record (BO-Invoiced-Used)\n*>\n                       if       BO-Table-Cnt + 1 > BO-Table-Used\n                                if       I > 1\n                                         perform  End-Totals\n                                         perform  zz210-Delete-BO-Records\n                                end-if\n                                move     2 to Return-Code  *> exit top perform\n                                exit     perform   *> I = 1 = no transactions\n                       end-if\n\n                        if      BOT-Stk-Cust-No (BO-Table-Cnt + 1) not = WS-Temp-Cust\n                          and   I > 1\n                                perform  End-Totals\n                                perform  zz210-Delete-BO-Records\n                                move     1 to Return-Code  *> get next BO table record\n                                exit     perform\n                        end-if\n              end-perform\n              if       Return-Code = 1  *> Top level perform get next BO table rec (& store cust-no -> ws-temp-cust)\n                       exit perform cycle\n              end-if\n              if       Return-Code = 2   *> no more table entries, exit top perform\n                       move     \"N\" to WS-BO-Processing\n                       exit perform\n              end-if\n              if       Return-Code = 8   *> BO-invoiced table exceeded - BO process aborted\n                       move     \"N\" to WS-BO-Processing\n                       exit perform\n              end-if\n     end-perform.\n*>\n zz200-Exit.\n     exit     section.\n*>\n zz210-Delete-BO-Records   section.\n*>********************************\n*>\n*> FOR early TESTING JUST EXIT\n*>     REMOVE AFTER    <***\n     go to zz210-Exit.\n*>\n     perform  varying  BO-Invoiced-Cnt from 1 by 1\n              until    BO-Invoiced-Cnt > BO-Invoiced-Used\n              move     BO-Invoiced-Cust-Item-No (BO-Invoiced-Cnt)  to BO-Cust-Itm-No\n              delete   BO-Stk-Itm-File record   invalid key   *> No, should never happen but JIC (may be a coding bug)\n                       display  SL219          at line WS-23-Lines col 1 with foreground-color 4 erase eos\n                       move     spaces to Exception-Msg\n                       string   BO-Stk-Cust-No \"/\" BO-Stk-Item-No \"/\" BO-Serial\n                                  into Exception-Msg\n                       display  Exception-Msg  at line  WS-23-Lines col 37 with foreground-color 4\n                       display  SL006          at line  WS-Lines    col 1  with foreground-color 2\n                       accept   WS-Reply at line WS-Lines col 45\n              end-delete\n     end-perform.\n*>\n zz210-Exit.\n     exit     section.\n*>\n zz300-Display-Outline-2   section.\n*>********************************\n*>\n     add      1  to  I.\n     move     1 to cole.\n     display  \"[             ][\" at curs with foreground-color 2 erase eol.\n     move     49 to cole.\n     display  \"]  [     ][          ][     ][ ]\" at curs  with foreground-color 2.\n*>\n zz300-Exit.\n     exit     section.\n*>\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 2981
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 31,
    "cognitive": 19,
    "halstead": {
      "uniqueOperators": 2,
      "uniqueOperands": 295,
      "totalOperators": 309,
      "totalOperands": 610,
      "vocabulary": 297,
      "length": 919,
      "volume": 7548.959272015904
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
