{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl920.cbl",
  "fileName": "sl920.cbl",
  "timestamp": "2025-09-15T16:25:30.849Z",
  "programId": "sl920",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 203
      },
      {
        "name": "file",
        "line": 212
      },
      {
        "name": "working-storage",
        "line": 215
      },
      {
        "name": "linkage",
        "line": 444
      },
      {
        "name": "init01",
        "line": 459
      },
      {
        "name": "Running-Totals",
        "line": 546
      },
      {
        "name": "write-details",
        "line": 577
      },
      {
        "name": "Update-Stock-and-Audit",
        "line": 604
      },
      {
        "name": "exit",
        "line": 925
      },
      {
        "name": "Eval-Status",
        "line": 927
      },
      {
        "name": "read-details",
        "line": 940
      },
      {
        "name": "net-compute",
        "line": 956
      },
      {
        "name": "comm-routines",
        "line": 965
      },
      {
        "name": "inv-level-1",
        "line": 1017
      },
      {
        "name": "Get-Data-1",
        "line": 1054
      },
      {
        "name": "inv-level-2",
        "line": 1162
      },
      {
        "name": "Get-Data-2",
        "line": 1208
      },
      {
        "name": "erase-screen",
        "line": 1668
      },
      {
        "name": "End-Totals",
        "line": 1677
      },
      {
        "name": "total-screen",
        "line": 1740
      },
      {
        "name": "invoice-details",
        "line": 1903
      },
      {
        "name": "cr-note",
        "line": 2128
      },
      {
        "name": "Program-Start",
        "line": 2220
      },
      {
        "name": "Display-Outline-1",
        "line": 2305
      },
      {
        "name": "Display-Outline-2",
        "line": 2323
      },
      {
        "name": "zz050-Validate-Date",
        "line": 2341
      },
      {
        "name": "exit",
        "line": 2378
      },
      {
        "name": "zz060-Convert-Date",
        "line": 2380
      },
      {
        "name": "exit",
        "line": 2413
      },
      {
        "name": "zz070-Convert-Date",
        "line": 2415
      },
      {
        "name": "exit",
        "line": 2443
      },
      {
        "name": "maps04",
        "line": 2445
      },
      {
        "name": "exit",
        "line": 2451
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 206
      },
      {
        "name": "file-defs",
        "line": 456
      },
      {
        "name": "main",
        "line": 480
      },
      {
        "name": "Change-Item-Tables",
        "line": 484
      },
      {
        "name": "data-Input",
        "line": 495
      },
      {
        "name": "more-data",
        "line": 512
      },
      {
        "name": "menu-exit",
        "line": 527
      },
      {
        "name": "sih-vat",
        "line": 551
      },
      {
        "name": "end-if",
        "line": 599
      },
      {
        "name": "end-perform",
        "line": 791
      },
      {
        "name": "end-perform",
        "line": 922
      },
      {
        "name": "Update-Stock-Exit",
        "line": 924
      },
      {
        "name": "end-perform",
        "line": 951
      },
      {
        "name": "accept-money6a",
        "line": 968
      },
      {
        "name": "accept-money6b",
        "line": 973
      },
      {
        "name": "accept-money6c",
        "line": 981
      },
      {
        "name": "accept-money7a",
        "line": 991
      },
      {
        "name": "accept-money7b",
        "line": 996
      },
      {
        "name": "accept-money7c",
        "line": 1004
      },
      {
        "name": "loop",
        "line": 1029
      },
      {
        "name": "Get-Data-1-Main",
        "line": 1057
      },
      {
        "name": "Get-Code",
        "line": 1066
      },
      {
        "name": "get-net",
        "line": 1113
      },
      {
        "name": "Get-Vat-Code",
        "line": 1123
      },
      {
        "name": "get-vat-rate",
        "line": 1141
      },
      {
        "name": "WS-vat",
        "line": 1147
      },
      {
        "name": "loop",
        "line": 1181
      },
      {
        "name": "Get-Data-2-Main",
        "line": 1225
      },
      {
        "name": "Get-Product",
        "line": 1234
      },
      {
        "name": "end-if",
        "line": 1393
      },
      {
        "name": "Get-Simple-Stock",
        "line": 1395
      },
      {
        "name": "end-if",
        "line": 1411
      },
      {
        "name": "GSS-End",
        "line": 1413
      },
      {
        "name": "Process-Stock-Record",
        "line": 1426
      },
      {
        "name": "clear-down-line",
        "line": 1464
      },
      {
        "name": "Get-Code",
        "line": 1482
      },
      {
        "name": "Get-Desc",
        "line": 1506
      },
      {
        "name": "Get-Qty",
        "line": 1529
      },
      {
        "name": "Get-Unit",
        "line": 1570
      },
      {
        "name": "Recomp-Net",
        "line": 1578
      },
      {
        "name": "end-if",
        "line": 1585
      },
      {
        "name": "Get-Disc",
        "line": 1596
      },
      {
        "name": "Get-Vat-Code",
        "line": 1616
      },
      {
        "name": "Jump-Totals",
        "line": 1650
      },
      {
        "name": "Test-For-Read-Stock",
        "line": 1655
      },
      {
        "name": "end-if",
        "line": 1663
      },
      {
        "name": "End-Totals-Main",
        "line": 1680
      },
      {
        "name": "confirmation",
        "line": 1698
      },
      {
        "name": "get-days",
        "line": 1789
      },
      {
        "name": "get-extra",
        "line": 1801
      },
      {
        "name": "get-extra-vat",
        "line": 1818
      },
      {
        "name": "get-carriage",
        "line": 1839
      },
      {
        "name": "get-carriage-vat",
        "line": 1850
      },
      {
        "name": "get-deduct-amt",
        "line": 1859
      },
      {
        "name": "get-deduct-vat",
        "line": 1877
      },
      {
        "name": "get-deduct-days",
        "line": 1892
      },
      {
        "name": "invoice-enter",
        "line": 1920
      },
      {
        "name": "date-Input",
        "line": 1954
      },
      {
        "name": "customer-Input",
        "line": 1971
      },
      {
        "name": "customer-setup",
        "line": 2015
      },
      {
        "name": "customer-display",
        "line": 2020
      },
      {
        "name": "ref-Input",
        "line": 2050
      },
      {
        "name": "order-Input",
        "line": 2056
      },
      {
        "name": "type-Input",
        "line": 2062
      },
      {
        "name": "Main",
        "line": 2133
      },
      {
        "name": "Main-Input",
        "line": 2140
      },
      {
        "name": "No-Inv-Restart",
        "line": 2214
      },
      {
        "name": "Menu-Return",
        "line": 2297
      },
      {
        "name": "end-if",
        "line": 2336
      },
      {
        "name": "zz050-Test-Date",
        "line": 2372
      },
      {
        "name": "zz050-exit",
        "line": 2377
      },
      {
        "name": "zz060-Exit",
        "line": 2412
      },
      {
        "name": "zz070-Exit",
        "line": 2442
      },
      {
        "name": "maps04-exit",
        "line": 2450
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 2226,
        "type": "DYNAMIC",
        "using": [
          "File-15",
          "*>",
          "Analysis",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "move",
          "1",
          "to",
          "WS-Process-Func",
          "WS-Sub-Function",
          "call",
          "\"sl070\"",
          "using",
          "WS-calling-data",
          "system-record",
          "to-day",
          "file-defs",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-15",
          "*>",
          "Only",
          "if",
          "the",
          "call",
          "failed",
          "for",
          "some",
          "unknown",
          "reason",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "SL186",
          "at",
          "2301",
          "display",
          "SL003",
          "at",
          "2401",
          "accept",
          "WS-reply",
          "at",
          "2430",
          "end-if",
          "end-if",
          "end-if",
          "*>",
          "*>",
          "Create",
          "Invoice",
          "&",
          "ITM3",
          "files",
          "if",
          "do",
          "not",
          "exist",
          "but",
          "as",
          "requested",
          "Amend",
          "invoices,",
          "it",
          "should",
          "be",
          "!",
          "*>",
          "JIC",
          "*>",
          "if",
          "FS-Cobol-Files-Used",
          "*>",
          "create",
          "invoice",
          "if",
          "not",
          "exist"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 2248,
        "type": "DYNAMIC",
        "using": [
          "File-16",
          "*>",
          "Invoice",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Invoice-Open-Output",
          "perform",
          "Invoice-Close",
          "end-if",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-19",
          "*>",
          "create",
          "ITM3",
          "if",
          "not",
          "exist",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "OTM3-Open-Output",
          "perform",
          "OTM3-Close",
          "end-if",
          "end-if",
          "*>",
          "*>",
          "if",
          "linked",
          "open",
          "Stock",
          "&",
          "Audit",
          "file",
          "*>",
          "if",
          "SL-Stock-Link",
          "=",
          "\"Y\"",
          "if",
          "FS-Cobol-Files-Used",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-11",
          "*>",
          "Stock",
          "File-Info",
          "end-call",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Stock-Open-Output",
          "perform",
          "Stock-Close",
          "end-if",
          "perform",
          "Stock-Open",
          "*>",
          "Thats",
          "ok",
          "we",
          "just",
          "wont",
          "find",
          "any",
          "items!",
          "if",
          "Stk-Audit-Used",
          "=",
          "1",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-10",
          "*>",
          "Stock-Audit",
          "File-Info",
          "end-call",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "Stock-Audit-Open-Output",
          "else",
          "perform",
          "Stock-Audit-Open-Extend",
          "end-if",
          "end-if",
          "end-if",
          "end-if",
          "*>",
          "*>",
          "*>",
          "Made",
          "sure",
          "needed",
          "files",
          "exist",
          "although",
          "most",
          "should",
          "be",
          "present",
          "but",
          "-",
          "JIC",
          "so",
          "open",
          "files/tables"
        ]
      },
      {
        "target": "maps04",
        "line": 2448,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 131,
        "replacing": null
      },
      {
        "name": "of",
        "line": 192,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 201,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 219,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 220,
        "replacing": null
      },
      {
        "name": "slwsinv",
        "line": 265,
        "replacing": null
      },
      {
        "name": "slwsinv2",
        "line": 266,
        "replacing": null
      },
      {
        "name": "slwsoi3",
        "line": 267,
        "replacing": null
      },
      {
        "name": "wsanal",
        "line": 269,
        "replacing": null
      },
      {
        "name": "wsaudit",
        "line": 270,
        "replacing": null
      },
      {
        "name": "wsdel",
        "line": 271,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 272,
        "replacing": null
      },
      {
        "name": "wsstock",
        "line": 273,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 372,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 398,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 447,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 448,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 449,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 935,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 2453,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 473
      },
      {
        "target": "Program-Start",
        "thru": null,
        "line": 478
      },
      {
        "target": "invoice-details",
        "thru": null,
        "line": 485
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 493
      },
      {
        "target": "inv-level-1",
        "thru": null,
        "line": 503
      },
      {
        "target": "inv-level-2",
        "thru": null,
        "line": 505
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 510
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 531
      },
      {
        "target": "Delivery-Close",
        "thru": null,
        "line": 532
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 533
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 534
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 535
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 537
      },
      {
        "target": "Stock-Audit-Close",
        "thru": null,
        "line": 538
      },
      {
        "target": "varying",
        "thru": null,
        "line": 553
      },
      {
        "target": "*>",
        "thru": null,
        "line": 557
      },
      {
        "target": "Invoice-Rewrite",
        "thru": null,
        "line": 586
      },
      {
        "target": "Invoice-Write",
        "thru": null,
        "line": 588
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 591
      },
      {
        "target": "varying",
        "thru": null,
        "line": 629
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 662
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 670
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 677
      },
      {
        "target": "Stock-Rewrite",
        "thru": null,
        "line": 760
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 768
      },
      {
        "target": "Stock-Audit-Write",
        "thru": null,
        "line": 781
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 783
      },
      {
        "target": "varying",
        "thru": null,
        "line": 796
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 823
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 831
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 838
      },
      {
        "target": "Stock-Rewrite",
        "thru": null,
        "line": 891
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 899
      },
      {
        "target": "Stock-Audit-Write",
        "thru": null,
        "line": 912
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 914
      },
      {
        "target": "sih-lines",
        "thru": null,
        "line": 944
      },
      {
        "target": "Invoice-Read-Next",
        "thru": null,
        "line": 948
      },
      {
        "target": "Display-Outline-1",
        "thru": null,
        "line": 1032
      },
      {
        "target": "Get-Data-1",
        "thru": null,
        "line": 1039
      },
      {
        "target": "clear-down-line",
        "thru": null,
        "line": 1095
      },
      {
        "target": "Display-Outline-1",
        "thru": null,
        "line": 1097
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 1104
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 1118
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 1145
      },
      {
        "target": "Running-Totals",
        "thru": null,
        "line": 1153
      },
      {
        "target": "Display-Outline-2",
        "thru": null,
        "line": 1184
      },
      {
        "target": "Get-Data-2",
        "thru": null,
        "line": 1193
      },
      {
        "target": "Get-Simple-Stock",
        "thru": null,
        "line": 1263
      },
      {
        "target": "Stock-Start",
        "thru": null,
        "line": 1307
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1313
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1325
      },
      {
        "target": "Stock-Start",
        "thru": null,
        "line": 1345
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1351
      },
      {
        "target": "Stock-Read-Next",
        "thru": null,
        "line": 1374
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 1406
      },
      {
        "target": "Stock-Read-Indexed",
        "thru": null,
        "line": 1417
      },
      {
        "target": "Test-For-Read-Stock",
        "thru": null,
        "line": 1424
      },
      {
        "target": "varying",
        "thru": null,
        "line": 1470
      },
      {
        "target": "*>",
        "thru": null,
        "line": 1473
      },
      {
        "target": "Invoice-Delete",
        "thru": null,
        "line": 1479
      },
      {
        "target": "clear-down-line",
        "thru": null,
        "line": 1485
      },
      {
        "target": "Display-Outline-2",
        "thru": null,
        "line": 1487
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 1501
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 1573
      },
      {
        "target": "net-compute",
        "thru": null,
        "line": 1609
      },
      {
        "target": "Running-Totals",
        "thru": null,
        "line": 1648
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 1657
      },
      {
        "target": "total-screen",
        "thru": null,
        "line": 1681
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 1684
      },
      {
        "target": "Invoice-Rewrite",
        "thru": null,
        "line": 1718
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 1720
      },
      {
        "target": "write-details",
        "thru": null,
        "line": 1731
      },
      {
        "target": "Update-Stock-And-Audit",
        "thru": null,
        "line": 1732
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 1735
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 1815
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 1828
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 1844
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 1854
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 1874
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 1908
      },
      {
        "target": "Invoice-Read-Indexed",
        "thru": null,
        "line": 1934
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 1951
      },
      {
        "target": "Read-Details",
        "thru": null,
        "line": 1952
      },
      {
        "target": "zz050-Validate-Date",
        "thru": null,
        "line": 1965
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 1993
      },
      {
        "target": "Delivery-Read-Indexed",
        "thru": null,
        "line": 2006
      },
      {
        "target": "cr-note",
        "thru": null,
        "line": 2075
      },
      {
        "target": "OTM3-Read-Indexed",
        "thru": null,
        "line": 2169
      },
      {
        "target": "Main",
        "thru": null,
        "line": 2215
      },
      {
        "target": "Invoice-Open-Output",
        "thru": null,
        "line": 2251
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 2252
      },
      {
        "target": "OTM3-Open-Output",
        "thru": null,
        "line": 2257
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 2258
      },
      {
        "target": "Stock-Open-Output",
        "thru": null,
        "line": 2270
      },
      {
        "target": "Stock-Close",
        "thru": null,
        "line": 2271
      },
      {
        "target": "Stock-Open",
        "thru": null,
        "line": 2273
      },
      {
        "target": "Stock-Audit-Open-Output",
        "thru": null,
        "line": 2279
      },
      {
        "target": "Stock-Audit-Open-Extend",
        "thru": null,
        "line": 2281
      },
      {
        "target": "Invoice-Open",
        "thru": null,
        "line": 2290
      },
      {
        "target": "OTM3-Open-Input",
        "thru": null,
        "line": 2291
      },
      {
        "target": "Sales-Open-Input",
        "thru": null,
        "line": 2293
      },
      {
        "target": "Delivery-Open-Input",
        "thru": null,
        "line": 2294
      },
      {
        "target": "Analysis-Open-Input",
        "thru": null,
        "line": 2295
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 2375
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 2389
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "WS-env-lines WS-lines\n     else\n              move  WS-env-lines   to WS-lines\n     end-if\n     subtract 1 from WS-lines giving WS-23-lines",
        "line": 464
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 474
      },
      {
        "from": "16",
        "to": "lin",
        "line": 492
      },
      {
        "from": "zero",
        "to": "sih-p-c sih-net sih-vat",
        "line": 498
      },
      {
        "from": "zero",
        "to": "i",
        "line": 500
      },
      {
        "from": "\"Y\"",
        "to": "WS-reply",
        "line": 516
      },
      {
        "from": "zero",
        "to": "pass-value",
        "line": 530
      },
      {
        "from": "zero",
        "to": "sih-net\n                        sih-vat",
        "line": 550
      },
      {
        "from": "sih-net",
        "to": "display-9",
        "line": 559
      },
      {
        "from": "sih-vat",
        "to": "display-9",
        "line": 563
      },
      {
        "from": "sih-invoice",
        "to": "sil-invoice (j)",
        "line": 581
      },
      {
        "from": "J",
        "to": "sil-line (j)",
        "line": 582
      },
      {
        "from": "sih-type",
        "to": "sil-type (j)",
        "line": 583
      },
      {
        "from": "3",
        "to": "Audit-Type\n              move Sih-Invoice             to Audit-Invoice-PO\n              move WS-Date                 to Audit-Process-Date\n              move CIT-A-Stock-Key (Tab-A) to Audit-Stock-Key\n                                              WS-Temp-Stock-Key\n              move CIT-A-Desc (Tab-A)      to Audit-Desc\n              if   CIT-A-Trans-Qty (Tab-A) > zero\t*> Sale has decreased\n                   move CIT-A-Trans-Qty (Tab-A) to Audit-Transaction-Qty\n                   move 1                  to Audit-Reverse-Transaction\n              else\n               if  CIT-A-Trans-Qty (Tab-A) < zero\t*> sale has increased\n                   multiply CIT-A-Trans-Qty (Tab-A) by -1 giving\n                                             Audit-Transaction-Qty\n               end-if\n              end-if\n*>\n              if   Sil-Type (j) = 3\t*> for Crs, switch the reverse flag\n                if Audit-Reverse-Transaction = zero\n                   move 1      to Audit-Reverse-Transaction\n                   move 5      to Audit-Type\n                   move Sih-cr to Audit-Cr-for-Invoice\n                else\n                   move zero to Audit-Reverse-Transaction\n                end-if\n              end-if\n              move Stk-Audit-No           to Audit-No\n*>\n*> Now get the stock record\n*>\n              if   WS-Stock-No-Long = spaces\n                   move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                   move  2 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              else\n                   move WS-Temp-Stock-Key to WS-Stock-Key\n                   move  1 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File key WS-Stock-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              end-if\n              if   fs-reply not = zero\n                   perform Eval-Status\n                   display SL198         at line WS-23-lines col 1 with erase eol foreground-color 4\n                   display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                   display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                   display WS-Stock-Key  at 2064 with foreground-color 3\n                   display sl006         at line WS-lines col 01 with foreground-color 3\n                   accept  WS-reply      at line WS-lines col 30\n                   display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it show up\n*>    in proof reports\n*>\n              if   WS-Stock-Key not = spaces\t\t*> we have a stock rec",
        "line": 630
      },
      {
        "from": "zero",
        "to": "Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite          *> rewrite Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                     *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write    *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform",
        "line": 751
      },
      {
        "from": "3",
        "to": "Audit-Type\n              move Sih-Invoice             to Audit-Invoice-PO\n              move WS-Date                 to Audit-Process-Date\n              move CIT-D-Stock-Key (Tab-D) to Audit-Stock-Key\n                                              WS-Temp-Stock-Key\n              move CIT-D-Desc (Tab-D)      to Audit-Desc\n              if   CIT-D-Trans-Qty (Tab-D) > zero\t\t*> Sale has increased\n                   move CIT-D-Trans-Qty (Tab-D) to Audit-Transaction-Qty\n              end-if\n*>\n              if   Sil-Type (j) = 3\t*> for Crs, switch the reverse flag\n                if Audit-Reverse-Transaction = zero\n                   move 1 to Audit-Reverse-Transaction\n                   move 5      to Audit-Type\n                   move Sih-cr to Audit-Cr-for-Invoice\n                else\n                   move zero to Audit-Reverse-Transaction\n                end-if\n              end-if\n              move Stk-Audit-No           to Audit-No\n*>\n*> Now get the stock record\n*>\n              if   WS-Stock-No-Long = spaces\n                   move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                   move  2 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              else\n                   move WS-Temp-Stock-Key to WS-Stock-Key\n                   move  1 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File key WS-Stock-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              end-if\n              if   fs-reply not = zero\n                   perform Eval-Status\n                   display SL198         at line WS-23-lines col 1 with erase eol foreground-color 4\n                   display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                   display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                   display WS-Stock-Key  at 2064 with foreground-color 3\n                   display sl006         at line WS-lines col 01 with foreground-color 3\n                   accept  WS-reply      at line WS-lines col 30\n                   display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it show up in\n*>    proof reports\n*>\n              if   WS-Stock-Key not = spaces\t\t*> we have a stock rec",
        "line": 797
      },
      {
        "from": "zero",
        "to": "Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite         *> rewrite  Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write       *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform",
        "line": 882
      },
      {
        "from": "spaces",
        "to": "exception-msg",
        "line": 934
      },
      {
        "from": "zero",
        "to": "j",
        "line": 943
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos\n              move J to item-nos\n              perform Invoice-Read-Next      *> read invoice-file\n                                             *>  end-read\n              move WS-Invoice-Record to Invoice-Lines (j)\n     end-perform",
        "line": 946
      },
      {
        "from": "zero",
        "to": "WS-poundsd6 WS-penced6 amt-ok6",
        "line": 971
      },
      {
        "from": "WS-pound6",
        "to": "amt-wk-pds6",
        "line": 978
      },
      {
        "from": "WS-pence6",
        "to": "amt-wk-pence6",
        "line": 979
      },
      {
        "from": "amt-wk-pence6",
        "to": "WS-pence6",
        "line": 984
      },
      {
        "from": "amt-wk-pds6",
        "to": "WS-pound6",
        "line": 985
      },
      {
        "from": "WS-pound6",
        "to": "amt-wk-pds6",
        "line": 988
      },
      {
        "from": "WS-pence6",
        "to": "amt-wk-pence6",
        "line": 989
      },
      {
        "from": "zero",
        "to": "WS-poundsd7 WS-penced7 amt-ok7",
        "line": 994
      },
      {
        "from": "WS-pound7",
        "to": "amt-wk-pds7",
        "line": 1001
      },
      {
        "from": "WS-pence7",
        "to": "amt-wk-pence7",
        "line": 1002
      },
      {
        "from": "amt-wk-pence7",
        "to": "WS-pence7",
        "line": 1007
      },
      {
        "from": "amt-wk-pds7",
        "to": "WS-pound7",
        "line": 1008
      },
      {
        "from": "WS-pound7",
        "to": "amt-wk-pds7",
        "line": 1011
      },
      {
        "from": "WS-pence7",
        "to": "amt-wk-pence7",
        "line": 1012
      },
      {
        "from": "1",
        "to": "j",
        "line": 1036
      },
      {
        "from": "zero",
        "to": "cob-crt-status",
        "line": 1038
      },
      {
        "from": "1",
        "to": "new-screen\n              go to  Main-Exit",
        "line": 1061
      },
      {
        "from": "zero",
        "to": "new-screen",
        "line": 1064
      },
      {
        "from": "7",
        "to": "cole",
        "line": 1070
      },
      {
        "from": "WS-pa",
        "to": "delete-test",
        "line": 1093
      },
      {
        "from": "WS-pa",
        "to": "sil-pa (I) pa-group",
        "line": 1100
      },
      {
        "from": "\"S\"",
        "to": "pa-system",
        "line": 1101
      },
      {
        "from": "11",
        "to": "cole",
        "line": 1102
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1103
      },
      {
        "from": "pa-desc",
        "to": "sil-description (I)",
        "line": 1111
      },
      {
        "from": "37",
        "to": "cole",
        "line": 1116
      },
      {
        "from": "amt-ok7",
        "to": "sil-net (I) WS-net",
        "line": 1121
      },
      {
        "from": "50",
        "to": "cole",
        "line": 1126
      },
      {
        "from": "vat-code",
        "to": "sil-vat-code (I)",
        "line": 1134
      },
      {
        "from": "zero",
        "to": "amt-ok6\n     else\n              move vat-rate (vat-code) to WS-vat-rate\n              compute amt-ok6 rounded = (WS-net * WS-vat-rate) / 100",
        "line": 1136
      },
      {
        "from": "56",
        "to": "cole",
        "line": 1144
      },
      {
        "from": "amt-ok6",
        "to": "sil-vat (I)\n                         WS-vat",
        "line": 1146
      },
      {
        "from": "68",
        "to": "cole",
        "line": 1150
      },
      {
        "from": "1",
        "to": "i\n     subtract WS-Accept-Body from i",
        "line": 1186
      },
      {
        "from": "1",
        "to": "j",
        "line": 1188
      },
      {
        "from": "zero",
        "to": "CIT-A CIT-D TAB-A TAB-D",
        "line": 1192
      },
      {
        "from": "1",
        "to": "new-screen\n              go to  Main-Exit",
        "line": 1229
      },
      {
        "from": "zero",
        "to": "new-screen",
        "line": 1232
      },
      {
        "from": "2",
        "to": "cole",
        "line": 1237
      },
      {
        "from": "WS-product",
        "to": "test-product",
        "line": 1248
      },
      {
        "from": "zero",
        "to": "CIT-New-Product\n              move     WS-product          to CIT-A-Stock-Key (CIT-A)\n              move     sil-Description (I) to CIT-A-Desc (CIT-A)\n              move     17 to cole                *> 4 Desc",
        "line": 1256
      },
      {
        "from": "WS-Product",
        "to": "WS-Temp-Stock-Key\n              move     sil-Qty (I)         to CIT-A-Trans-Qty (CIT-A)\n              perform  Get-Simple-Stock      *> 12/08/23\n              go to Get-Qty                  *> Desc does not change against product\n      end-if\n     end-if\n*>\n     if       sil-comment\n              move WS-product to sil-product (I)\n              move zero to sil-net (I) sil-qty (I) sil-vat (I)\n              go to  Get-Desc",
        "line": 1261
      },
      {
        "from": "1",
        "to": "CIT-New-Product\n              move     WS-Product to CIT-D-Stock-Key (CIT-D)  *> still need qty & desc\n     end-if\n     move     WS-product to sil-product (I)",
        "line": 1285
      },
      {
        "from": "zero",
        "to": "CIT-New-Product\n              go to Get-Code",
        "line": 1291
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1298
      },
      {
        "from": "WS-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move  2 to File-Key-No\n              set   fn-not-less-than to true\n              perform Stock-Start                  *> start Stock-File key not < WS-Stock-Abrev-Key invalid key\n              if    FS-Reply = 21 or = 23\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n     if       cob-crt-status = cob-scr-F2\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n*> Search on Desc",
        "line": 1304
      },
      {
        "from": "WS-Description",
        "to": "WS-Stock-Desc\n              move  3 to File-Key-No\n              set fn-not-less-than to true\n              perform Stock-Start     *> start Stock-File key not < WS-Stock-Desc invalid key\n              if    FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              if       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              accept WS-reply at 2410            *> TESTING ONLY\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if\n*>\n     if       cob-crt-status = cob-scr-F5         *> Read next on Desc",
        "line": 1342
      },
      {
        "from": "SL196",
        "to": "WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              if       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if",
        "line": 1376
      },
      {
        "from": "WS-Abrev-Stock",
        "to": "WS-Stock-Abrev-Key\n              move 2 to File-Key-No\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move 1 to File-Key-No\n     end-if\n     perform  Stock-Read-Indexed\n     if       FS-Reply = 21 or = 23\n              move SL196 to WS-Stock-Desc\n              display WS-Stock-Desc at curs with foreground-color 4\n              go to Get-Product\n     end-if",
        "line": 1400
      },
      {
        "from": "SL196",
        "to": "WS-Stock-Desc\n *>                  display WS-Stock-Desc at curs with foreground-color 4\n *>                  go to Get-Product\n *>             end-if\n *>    end-if\n     perform  Test-For-Read-Stock",
        "line": 1419
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1430
      },
      {
        "from": "Stock-sa-Group",
        "to": "WS-pa\n                                pa-group\n                                sil-pa (I)",
        "line": 1431
      },
      {
        "from": "WS-Stock-Desc",
        "to": "WS-description\n                               sil-description (I)\n                               CIT-D-Desc (CIT-D)",
        "line": 1435
      },
      {
        "from": "Stock-Retail",
        "to": "amt-ok7",
        "line": 1438
      },
      {
        "from": "Stock-Retail",
        "to": "WS-Unit",
        "line": 1439
      },
      {
        "from": "amt-wk-pds7",
        "to": "WS-pound7",
        "line": 1440
      },
      {
        "from": "amt-wk-pence7",
        "to": "WS-pence7",
        "line": 1441
      },
      {
        "from": "Stock-Held",
        "to": "WS-qty",
        "line": 1443
      },
      {
        "from": "1",
        "to": "WS-Qty\n     end-if\n     go       to Get-Qty",
        "line": 1445
      },
      {
        "from": "z",
        "to": "sil-line (z)\n     end-perform\n*>\n     move     zero to z",
        "line": 1472
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos\n              move sih-lines  to  item-nos\n              perform  Invoice-Delete           *> delete the last item (that was)\n              subtract 1 from sih-lines",
        "line": 1477
      },
      {
        "from": "17",
        "to": "cole",
        "line": 1491
      },
      {
        "from": "\"S\"",
        "to": "pa-system",
        "line": 1497
      },
      {
        "from": "WS-pa",
        "to": "pa-group sil-pa (I)",
        "line": 1498
      },
      {
        "from": "21",
        "to": "cole",
        "line": 1499
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1500
      },
      {
        "from": "17",
        "to": "cole\n     else\n              move 21 to cole",
        "line": 1508
      },
      {
        "from": "\"B\"",
        "to": "escape-code\n     else\n              move space to escape-code",
        "line": 1516
      },
      {
        "from": "WS-description",
        "to": "sil-description (I)",
        "line": 1525
      },
      {
        "from": "53",
        "to": "cole",
        "line": 1531
      },
      {
        "from": "1",
        "to": "WS-Qty\n     end-if\n     display  WS-qty at curs with foreground-color 3",
        "line": 1533
      },
      {
        "from": "Stock-Held",
        "to": "WS-Qty\n              go to Get-Qty",
        "line": 1546
      },
      {
        "from": "WS-Qty",
        "to": "CIT-D-Trans-Qty (CIT-D)\n              go to Recomp-Net",
        "line": 1551
      },
      {
        "from": "1",
        "to": "CIT-A\n              end-if\n              initialize CIT-Additions (CIT-A)\t*> No change so clear the table entry\n              subtract 1 from CIT-A\t\t*> as only possible changes discount & vat does not effect stock\n              go to Recomp-Net",
        "line": 1557
      },
      {
        "from": "60",
        "to": "cole",
        "line": 1571
      },
      {
        "from": "amt-ok6",
        "to": "WS-unit",
        "line": 1576
      },
      {
        "from": "WS-net",
        "to": "display-9 sil-net (I)",
        "line": 1591
      },
      {
        "from": "WS-qty",
        "to": "sil-qty (I)",
        "line": 1592
      },
      {
        "from": "WS-unit",
        "to": "sil-unit (I)",
        "line": 1593
      },
      {
        "from": "72",
        "to": "cole",
        "line": 1598
      },
      {
        "from": "WS-disc-wka",
        "to": "WS-disca1",
        "line": 1599
      },
      {
        "from": "WS-disc-wkb",
        "to": "WS-disca3",
        "line": 1600
      },
      {
        "from": "WS-discb1",
        "to": "WS-disc-wka",
        "line": 1603
      },
      {
        "from": "WS-discb3",
        "to": "WS-disc-wkb",
        "line": 1604
      },
      {
        "from": "WS-discount",
        "to": "work-d sil-discount (I)",
        "line": 1606
      },
      {
        "from": "WS-net",
        "to": "work-n",
        "line": 1607
      },
      {
        "from": "WS-net",
        "to": "sil-net (I) display-9",
        "line": 1613
      },
      {
        "from": "\"S\"",
        "to": "Vat-Code-X",
        "line": 1617
      },
      {
        "from": "79",
        "to": "cole",
        "line": 1618
      },
      {
        "from": "1",
        "to": "Vat-Code\n      else\n       if     Vat-Code-X = \"R\"                   *> Reduced  code 2\n              move 2 to Vat-Code\n        else\n         if   Vat-Code-X = \"Z\"                   *> Zero     code 3\n              move 3 to Vat-Code",
        "line": 1626
      },
      {
        "from": "vat-code",
        "to": "sil-vat-code (I)",
        "line": 1637
      },
      {
        "from": "zero",
        "to": "WS-vat\n     else\n              move vat-rate (vat-code) to WS-vat-rate\n              compute  WS-vat rounded = (WS-net * WS-vat-rate) / 100",
        "line": 1640
      },
      {
        "from": "WS-vat",
        "to": "display-9 sil-vat (I)",
        "line": 1645
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1671
      },
      {
        "from": "15",
        "to": "lin",
        "line": 1683
      },
      {
        "from": "\"Y\"",
        "to": "WS-reply",
        "line": 1701
      },
      {
        "from": "\"P\"",
        "to": "sih-status",
        "line": 1711
      },
      {
        "from": "space",
        "to": "sih-status-P\n                       sih-Status-L",
        "line": 1712
      },
      {
        "from": "I",
        "to": "sih-lines",
        "line": 1715
      },
      {
        "from": "SInvoice-Header",
        "to": "WS-Invoice-Record",
        "line": 1717
      },
      {
        "from": "zero",
        "to": "j",
        "line": 1730
      },
      {
        "from": "1",
        "to": "s-flag-i",
        "line": 1733
      },
      {
        "from": "11",
        "to": "lin",
        "line": 1734
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1743
      },
      {
        "from": "11",
        "to": "lin",
        "line": 1744
      },
      {
        "from": "1",
        "to": "menu-reply\n     else\n              move  2  to  menu-reply",
        "line": 1749
      },
      {
        "from": "sih-net",
        "to": "display-9",
        "line": 1780
      },
      {
        "from": "sih-vat",
        "to": "display-8",
        "line": 1783
      },
      {
        "from": "sih-days",
        "to": "WS-dayes",
        "line": 1792
      },
      {
        "from": "zero",
        "to": "sih-days\t\t*> its a proforma so leave it & unchanged\n              go to get-extra",
        "line": 1795
      },
      {
        "from": "WS-dayes",
        "to": "sih-days",
        "line": 1799
      },
      {
        "from": "zero",
        "to": "sih-extra sih-e-vat\n              go to get-carriage",
        "line": 1805
      },
      {
        "from": "zero",
        "to": "sih-extra",
        "line": 1811
      },
      {
        "from": "1526",
        "to": "curs",
        "line": 1813
      },
      {
        "from": "sih-extra",
        "to": "amt-ok7",
        "line": 1814
      },
      {
        "from": "amt-ok7",
        "to": "sih-extra",
        "line": 1816
      },
      {
        "from": "zero",
        "to": "sih-e-vat\n              go to get-carriage",
        "line": 1822
      },
      {
        "from": "1541",
        "to": "curs",
        "line": 1827
      },
      {
        "from": "amt-ok6",
        "to": "sih-e-vat",
        "line": 1829
      },
      {
        "from": "1626",
        "to": "curs",
        "line": 1842
      },
      {
        "from": "sih-carriage",
        "to": "amt-ok7",
        "line": 1843
      },
      {
        "from": "amt-ok7",
        "to": "sih-carriage",
        "line": 1845
      },
      {
        "from": "1641",
        "to": "curs",
        "line": 1853
      },
      {
        "from": "amt-ok6",
        "to": "sih-c-vat",
        "line": 1855
      },
      {
        "from": "zero",
        "to": "sih-deduct-amt  sih-deduct-vat  sih-deduct-days\n              go to  Main-Exit",
        "line": 1865
      },
      {
        "from": "4",
        "to": "amt-ok7",
        "line": 1871
      },
      {
        "from": "1726",
        "to": "curs",
        "line": 1873
      },
      {
        "from": "amt-ok7",
        "to": "sih-deduct-amt",
        "line": 1875
      },
      {
        "from": "zero",
        "to": "sih-deduct-vat",
        "line": 1880
      },
      {
        "from": "sih-days",
        "to": "WS-dayes",
        "line": 1895
      },
      {
        "from": "WS-dayes",
        "to": "sih-deduct-days",
        "line": 1898
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1923
      },
      {
        "from": "zero",
        "to": "sih-invoice",
        "line": 1924
      },
      {
        "from": "1",
        "to": "z\n              go to Main-Exit",
        "line": 1929
      },
      {
        "from": "zero",
        "to": "item-nos",
        "line": 1932
      },
      {
        "from": "sih-invoice",
        "to": "invoice-nos",
        "line": 1933
      },
      {
        "from": "WS-Invoice-Record",
        "to": "SInvoice-Header",
        "line": 1942
      },
      {
        "from": "sih-date",
        "to": "u-bin",
        "line": 1950
      },
      {
        "from": "1",
        "to": "z\n              go to  Main-Exit",
        "line": 1961
      },
      {
        "from": "WS-date",
        "to": "WS-Test-Date",
        "line": 1964
      },
      {
        "from": "u-bin",
        "to": "sih-date",
        "line": 1969
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to  Main-Exit",
        "line": 1980
      },
      {
        "from": "\"Y\"",
        "to": "WS-Show-Delivery\n     else\n              move \"N\" to WS-Show-Delivery\n     end-if\n*>\n     move     1  to  c-check",
        "line": 1983
      },
      {
        "from": "sih-customer",
        "to": "WS-Sales-Key",
        "line": 1990
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1992
      },
      {
        "from": "zero",
        "to": "c-check",
        "line": 1995
      },
      {
        "from": "\"D\"",
        "to": "WS-Deliv-Key-Type",
        "line": 2004
      },
      {
        "from": "WS-Sales-Key",
        "to": "WS-Deliv-Sales-Key",
        "line": 2005
      },
      {
        "from": "zero",
        "to": "delivery-tag\n              go to  customer-setup",
        "line": 2008
      },
      {
        "from": "deliv-address",
        "to": "address-A",
        "line": 2011
      },
      {
        "from": "sales-address",
        "to": "address-A",
        "line": 2018
      },
      {
        "from": "1",
        "to": "z",
        "line": 2028
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2032
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2036
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2040
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2044
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 2048
      },
      {
        "from": "zero",
        "to": "z",
        "line": 2079
      },
      {
        "from": "zero",
        "to": "we-error",
        "line": 2086
      },
      {
        "from": "999",
        "to": "we-error",
        "line": 2094
      },
      {
        "from": "998",
        "to": "we-error",
        "line": 2098
      },
      {
        "from": "997",
        "to": "we-error",
        "line": 2103
      },
      {
        "from": "zero",
        "to": "z",
        "line": 2119
      },
      {
        "from": "1",
        "to": "z   cob-crt-status",
        "line": 2122
      },
      {
        "from": "sih-cr",
        "to": "WS-cr",
        "line": 2145
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to Main-Exit",
        "line": 2150
      },
      {
        "from": "WS-cr",
        "to": "sih-cr",
        "line": 2152
      },
      {
        "from": "\"Z\"",
        "to": "WS-named\n              go to  no-inv-restart\n     else\n              move  space to  WS-named",
        "line": 2154
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to Main-Exit\n     else\n              move space to escape-code",
        "line": 2160
      },
      {
        "from": "sih-cr",
        "to": "oi3-invoice",
        "line": 2165
      },
      {
        "from": "sih-customer",
        "to": "oi3-customer",
        "line": 2166
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 2168
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 2192
      },
      {
        "from": "\"A\"",
        "to": "WS-named",
        "line": 2195
      },
      {
        "from": "oi-discount",
        "to": "display-9",
        "line": 2203
      },
      {
        "from": "oi-deduct-amt",
        "to": "display-8",
        "line": 2205
      },
      {
        "from": "to-day",
        "to": "u-date WS-Test-Date",
        "line": 2224
      },
      {
        "from": "1",
        "to": "WS-Process-Func WS-Sub-Function\n                    call \"sl070\" using WS-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15       *> Only if the call failed for some unknown reason\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display SL186   at 2301\n                          display SL003   at 2401\n                          accept WS-reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n*> Create Invoice & ITM3 files if do not exist but as requested Amend invoices, it should be !\n*>    JIC\n*>\n     if       FS-Cobol-Files-Used             *> create invoice if not exist",
        "line": 2229
      },
      {
        "from": "zero",
        "to": "menu-reply",
        "line": 2300
      },
      {
        "from": "1",
        "to": "cole",
        "line": 2309
      },
      {
        "from": "2",
        "to": "cole",
        "line": 2311
      },
      {
        "from": "4",
        "to": "cole",
        "line": 2313
      },
      {
        "from": "36",
        "to": "cole",
        "line": 2315
      },
      {
        "from": "78",
        "to": "cole",
        "line": 2317
      },
      {
        "from": "1",
        "to": "cole",
        "line": 2327
      },
      {
        "from": "51",
        "to": "cole\n              display   \"][     ][          ][     ][ ]\" at curs  with foreground-color 2\n     else\t\t\t\t*> ignore PA\n              display \"[             ][\" at curs with foreground-color 2 erase eol\n              move    49 to cole\n              display \"]  [     ][          ][     ][ ]\" at curs  with foreground-color 2\n     end-if",
        "line": 2330
      },
      {
        "from": "WS-Test-Date",
        "to": "WS-date",
        "line": 2350
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month    *> done again for UK - but JIC\n              move 1 to Date-Form",
        "line": 2352
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n              go to zz050-Test-Date",
        "line": 2355
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              move WS-Month to WS-Inv-Month\n              go to zz050-Test-Date",
        "line": 2358
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "WS-date",
        "line": 2366
      },
      {
        "from": "WS-Month",
        "to": "WS-Inv-Month\n     move     WS-Test-Date (9:2) to WS-Days",
        "line": 2369
      },
      {
        "from": "WS-date",
        "to": "u-date",
        "line": 2373
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 2374
      },
      {
        "from": "spaces",
        "to": "WS-Date\n              go to zz060-Exit",
        "line": 2391
      },
      {
        "from": "u-date",
        "to": "WS-date",
        "line": 2393
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 2396
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz060-Exit",
        "line": 2400
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "WS-date",
        "line": 2407
      },
      {
        "from": "to-day",
        "to": "WS-date",
        "line": 2423
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 2426
      },
      {
        "from": "WS-days",
        "to": "WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz070-Exit",
        "line": 2430
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "WS-date",
        "line": 2437
      }
    ],
    "computes": [
      {
        "target": "Audit-Stock-Value-Change",
        "expression": "Audit-Transaction-Qty * Stock-Cost\n                    else\n                        if  CIT-A-Trans-Qty (Tab-A) < zero\t*> sale has increased\n                            subtract CIT-A-Trans-Qty (Tab-A) from Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                    Audit-Transaction-Qty * Stock-Cost * -1\n                        end-if\n                    end-if\n                   end-if\n                   if       Sil-Type (j) = 3\t\t*> It is a Credit note\n                      and   Stock-Services-Flag not = \"Y\"\n                    if      CIT-A-Trans-Qty (Tab-A) < zero\t*> Sale has Increased\n                            add CIT-A-Trans-Qty (Tab-A) to Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost\n                    else\n                     if     CIT-A-Trans-Qty (Tab-A) > zero\t*> sale has Decreased\n                            subtract CIT-A-Trans-Qty (Tab-A) from Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost * -1\n                     end-if\n                    end-if\n                   end-if\n*>\n*> This from sl910 but adds reversed for CR and receipts/invs as back in stock\n*>\n                   if       WS-Inv-Mth not < 1 or > 12\n                     if      Sil-Type (j)  = 1 or 2                    *> Invoice and Recepts\n                      if      CIT-A-Trans-Qty (Tab-A) > zero      *> Sale has decreased\n                              add Audit-Transaction-Qty to Stock-Adds\n                              add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                      else\n                          if  CIT-A-Trans-Qty (Tab-A) < zero      *> sale has increased\n                              add Audit-Transaction-Qty to Stock-Deducts\n                              add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                          end-if\n                      end-if\n                     else\n                     if      Sil-Type (j) = 3                         *> Credit Notes\n                      if      CIT-A-Trans-Qty (Tab-A) < zero      *> Sale has Increased\n                              add Audit-Transaction-Qty to Stock-Adds\n                              add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                      else\n                        if    CIT-A-Trans-Qty (Tab-A) > zero      *> sale has Decreased\n                              add Audit-Transaction-Qty to Stock-Deducts\n                              add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                        end-if\n                      end-if\n                     end-if    *> type = 3\n                   end-if      *> inv-mth good\n*>\n                   if       Stock-Held < zero\t\t*> Should NOT happen as testing in data entry but if a Cr?\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply -1 by Stock-Held\n                            add Stock-Held to Stock-Pre-Sales\n                            move zero to Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite          *> rewrite Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                     *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write    *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform",
        "line": 695
      },
      {
        "target": "Audit-Stock-Value-Change",
        "expression": "Audit-Transaction-Qty * Stock-Cost\n                   end-if\t\t*> CIT-D is NEW items so not on CRs",
        "line": 855
      },
      {
        "target": "Audit-Stock-Value-Change",
        "expression": "Audit-Transaction-Qty * Stock-Cost * -1\n                   end-if\n*>\n*> This from sl910 but adds reversed for CR and receipts/invs as back in stock\n*>\n                   if       WS-Inv-Mth not < 1 or > 12\n                     if      Sil-Type (j)  = 1 or 2                    *> Invoice and Recepts\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-Adds\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-TD-Adds (WS-Inv-Mth)\n                     else\n                     if      Sil-Type (j) = 3                         *> Credit Notes\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-Deducts\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-TD-Deds (WS-Inv-Mth)\n                     end-if    *> type = 3\n                   end-if      *> inv-mth good\n*>\n*>\n                   if       Stock-Held < zero\t\t*> Should NOT happen as testing in data entry but if a Cr?\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply -1 by Stock-Held\n                            add Stock-Held to Stock-Pre-Sales\n                            move zero to Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite         *> rewrite  Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write       *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform",
        "line": 860
      },
      {
        "target": "sih-extra",
        "expression": "(sih-net * Extra-Rate) / 100\n     else\n              move  zero  to  sih-extra",
        "line": 1809
      },
      {
        "target": "amt-ok6",
        "expression": "sih-extra  *  vat-rate-1  /  100",
        "line": 1825
      },
      {
        "target": "amt-ok7",
        "expression": "sih-net  /  10",
        "line": 1868
      }
    ]
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "any changes to quantity.\n  *>\n  *>==================================================\n  *>\n  *> PROGRAM IS NOT UPDATING STOCK MONTH YEARLY TOTALS ANYWHERE!!!!!\n  *> but  IS NOW, as of .16) - 20/03/18\n*>********************************************************\n*>                                                       *\n*>              Invoice  Maintenance (Amend)             *\n*>                                                       *\n*>    This program only works in invoice Batch mode.     *\n*>                                                       *\n*>********************************************************\n*>\n identification          division.\n*>===============================\n*>\n      program-id.         sl920.\n*>**\n*>    Author.             Cis Cobol Conversion By V B Coen, FBCS, FIDM, FIDPM 17/12/83\n*>                        For Applewood Computers.\n*>**\n*>    Security.           Copyright (C) 1976-2025 & later, Vincent Bryan Coen.\n*>                        Distributed under the GNU General Public License.\n*>                        See the file COPYING for details.\n*>**\n*>    Remarks.            Invoice Maintenance.\n*>**\n*>    Version.            See Prog-Name In Ws.\n*>**\n*>    Called Modules.     Maps04.\n*>                        acas010  ->\n*>                         auditMT\n*>                        acas011  ->\n*>                         stockMT.\n*>                        acas012  ->       (Sales)\n*>                         salesMT.\n*>                        acas014  ->       (Delivery)\n*>                         deliveryMT.\n*>                        acas015  ->       (Analysis)\n*>                         analMT.\n*>                        acas016  ->\n*>                         invoiceMT.\n*>                        acas019  ->\n*>                         otm3MT.\n*>\n*>                        SL070. Analysis codes set up - Defaults only.\n*>**\n*>    Error messages used.\n*>     System Wide:\n*>                        SL003\n*>                        SL006\n*>     Module specific:\n*>                        SL180\n*>                        SL181\n*>                        SL182\n*>                        SL183\n*>                        SL184\n*>                        SL185\n*>                        SL186\n*>                        SL190\n*>                        SL191\n*>                        SL192\n*>                        SL193\n*>                        SL194\n*>                        SL195\n*>                        SL196\n*>                        SL198\n*>                        SL199\n*>****\n*>  Changes.\n*> 04/03/83 Vbc - Changes To Fdinv.Cob And Cr-Notes.\n*> 22/03/83 Vbc - Cr-Notes.\n*> 30/03/83 Vbc - When Creating Invoices Check For Sl-Charges &\n*>                Sales-Late (Late-Charges).\n*> 30/04/83 Sjw - Accept Late Charges Only If Invoice WS-Named On\n*>                Cr. Notes.\n*> 02/05/83 Vbc - #.\n*> 17/12/83 Vbc - Cis Cobol Conversion.\n*> 18/01/84 Vbc - Fix Bugs In Delete Line & Record Routines.\n*> 01/03/84 Vbc - Support Sales-Unapplied In Invoice-Details.\n*> 10/03/84 Vbc - Scrap  Accept Of sih-Deduct-Vat(=0).\n*> 16/11/84 Vbc - Fix Abort Graphic Screen In Invoice-Details.\n*> 07/01/85 Vbc - Fix Bug Clear Screen In Cr-Notes.\n*> 03/03/09 vbc - .02 Migration to Open Cobol v3.00.00.\n*> 18/03/09 vbc - ,03 Bug/Feature 30.1 & 3 Escape out at any level.\n*> 19/03/09 vbc - .04 Feature 30.5 Allow receipts to be amended if not posted.\n*> 26/11/11 vbc - .05 Error msgs to SLnnn.Support for dates other than UK\n*> 08/12/11 vbc - .06 Support for path+filenames.\n*> 09/12/11 vbc -     Updated version to 3.01.nn, added support for IS delivery file\n*> 11/12/11 vbc - .07 Changed usage of Stk-Date-Form to the global field Date-Form making former redundent.\n*> 24/05/13 vbc - .08 Add in support for direct link to Stock Control with Stock and Audit files\n*>                    in inv-level-2. Changed stk code 12>13, desc 24>32 removing pa code\n*>                    & consider add new display field OS for Out of Stock but on order\n*>                    with delivery expected in 7 days or less.\n*> 24/10/16 vbc - .09 ALL programs now using wsnames.cob in copybooks\n*> 30/10/16 vbc - .10 Support for RDB on  Analysis, Stock & Stock Audit tables\n*>                    instead of cobol files\n*>                    using acas010, acas011 & acas015. Update version to v3.02\n*>                      more to do, have renamed the calls for acas010,11 & 15\n*>                      Stock-Audit, Stock & Analysis to reduce any coding errors\n*>                      as there will be a lot of them in this module.\n*> 15/01/17 vbc - .   All programs upgraded to v3.02 for RDB processing.\n*> 18/01/17 vbc - .11 Added remaining FH processing but excluding invoice.\n*> 19/01/17 vbc - .12 Added OTM3 file for use when amending Credit Notes.\n*>                    Removed the Letter postfix after invoice nos when using\n*>                    own invoice nos, as created for one customer many years\n*>                    ago, which could cause issues when posting to ITM3.\n*>                    2 B removed from the invoice file layout. <<<<<<\n*>                    Added missing CR checks for amount O/S (in sl910).\n*>                    Clears sih-Status-L (& P) for reprinting.\n*> 25/01/17 vbc       Dry testing completed.\n*> 10/02/17 vbc - .13 Updated FD/WS for 016,019 and replaced cobol verbs\n*>                    for access to FH/DALs.\n*> 17/04/17 vbc -     Dry check for slinvoiceMT.\n*> 27/08/17 vbc - .14 Added SL198 & 199 to replace embedded msgs as per sl910\n*>                    likewise SL196 in place of \"Not Found\" & \"Not on file\"\n*> 17/03/18 vbc - .15 Added test for type = 4 (proformas) in Update-Stock-and\n*>                   -Audit as we do not want to updates stock-held or do audit\n*>                    until it is amended to a receipt or a invoice. Matches\n*>                    sl910\n*> 19/03/18 vbc - .16 Updated to use CIT-A and CIT-D to update the stock record\n*>                    fields period and month within year totals.\n*>\n*>                    Just above Process-Stock-Record the multi copy of code\n*>                    is abbreviated as indexed reads etc for stock or abbrev\n*>                    key can be in a simpler code block now with orig rem.d out\n*>                    ALSO there might be an issue at Get-Prod-Test if screen\n*>                     is longer than 24 - TEST THIS warning in sl910.\n*>\n*>                    At the bottom of type-Input in invoice-details section\n*>                    there is a disp and accept but not test for 0 or non zero\n*>                    WHY NOT - TEST THIS and fix if needed. also sl910\n*>\n*> 10/12/22 vbc   .17 Added para after some sections 4 GC 3.2 warning msgs.\n*> 09/05/23 vbc - .18 Near end of type-Input changed 2 None Zero or ESC To Abort\n*>                    and next line to start at 40 instead of 60. ditto sl910,\n*> 20/05/23 vbc -     sl810 WS-Show-Delivery changed from pic 9 to x (sane as\n*>                    sl910).\n*> 06/08/23 vbc   .19 Better support for service items set default qty = 1.\n*>                    no further checking but check for audit as well\n*>                    matches work for sl910.\n*>                    Test for invoice type < 1 on invoice input.\n*> 07/08/23 vbc - .20 Added mv 1 to File-Key-No before obtaining invoice #.\n*>                 21 temp testing display for read indexed invoice #\n*> 12/08/23 vbc   .22 Force VAT rate to S = Standard as default - user can chng.\n*>                    In get-Vat support for accepting  S, R and Z and will\n*>                    convert. same as in sl910 - forgot to put it in.\n*> 17/03/24 vbc - .23 SL197 should be using SL186 - changed and 196 removed.\n*> 12/04/24 vbc - .24 Removed any and all BO processing as pointless as any\n*>                    such amendments can be done in sl970 via sales menu\n*>                    T.A.4 and is too late for amend mode as BO recs updated.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 21/08/25 vbc - .25 On Get-Vat-Code (level-2) force upper csae on accept\n*>                    Level 2 only.\n*> 25/08/25 vbc   .26 On line totals line # missing.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n*>\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"SL920 (3.02.26)\".\n 77  Exception-Msg       pic x(25) value spaces.\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n 01  WS-amount-screen-display6.\n     03  WS-poundsd6     pic 9(6).\n     03  WS-period6      pic x     value \".\".\n     03  WS-penced6      pic v99.\n 01  WS-amount-screen-accept6 redefines WS-amount-screen-display6.\n     03  WS-pound6       pic 9(6).\n     03  filler          pic x.\n     03  WS-pence6       pic v99.\n*>\n 01  WS-amount-work6.\n     03  amt-wk-pds6     pic 9(6).\n     03  amt-wk-pence6   pic v99.\n 01  WS-amount-ok6 redefines WS-amount-work6.\n     03  amt-ok6         pic 9(6)v99.\n*>\n 01  WS-amount-screen-display7.\n     03  WS-poundsd7     pic 9(7).\n     03  WS-period7      pic x     value \".\".\n     03  WS-penced7      pic v99.\n 01  WS-amount-screen-accept7 redefines WS-amount-screen-display7.\n     03  WS-pound7       pic 9(7).\n     03  filler          pic x.\n     03  WS-pence7       pic v99.\n*>\n 01  WS-amount-work7.\n     03  amt-wk-pds7     pic 9(7).\n     03  amt-wk-pence7   pic v99.\n 01  WS-amount-ok7 redefines WS-amount-work7.\n     03  amt-ok7         pic 9(7)v99.\n*>\n 01  WS-discount-display.\n     03  WS-disca1       pic 99.\n     03  WS-disca2       pic x        value \".\".\n     03  WS-disca3       pic v99.\n 01  WS-discount-accept redefines WS-discount-display.\n     03  WS-discb1       pic 99.\n     03  filler          pic x.\n     03  WS-discb3       pic v99.\n 01  WS-discount-work.\n     03  WS-disc-wka     pic 99.\n     03  WS-disc-wkb     pic v99.\n 01  WS-discount redefines WS-discount-work  pic 99v99.\n*>\n copy \"slwsinv.cob\"  replacing Invoice-Line by Invoice-Lines. *> Dup name, was wsinv.cob in sales\n copy \"slwsinv2.cob\" replacing Invoice-Record by WS-Invoice-Record.\n copy \"slwsoi3.cob\".\n*>\n copy \"wsanal.cob\".\n copy \"wsaudit.cob\".\n copy \"wsdel.cob\".\n copy \"wssl.cob\".\n copy \"wsstock.cob\".     *> 3.02\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n*>     03  WS-Stock-Audit-Record  pic x.\n*>     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n*>     03  WS-Delivery-Record     pic x.\n*>     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n*>     03  WS-Invoice-Record      pic x.\n*>     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  WS-data.\n     03  test-product.\n         05  filler      pic x.\n             88  sil-comment           value \"/\".\n         05  filler      pic x(12).\n     03  menu-reply      pic 9.\n     03  WS-reply        pic x.\n     03  z               pic 99.\n     03  c-check         pic 9.\n         88  c-exists                value  1.\n     03  WS-delinv       pic 9       value zero.\n         88  del-exists              value 1.\n     03  address-A       pic x(96).\n     03  address-line.\n         05 add-line1    pic x(15).\n         05 add-line2    pic x(21).\n     03  WS-named        pic x           value \" \".\n     03  WS-dash         pic x(80)       value all \"-\".\n     03  work-1          pic 9(7)v99.\n     03  work-n          pic 9(7)v99.\n     03  work-d          pic 9(7)v99.\n     03  display-8       pic z(5)9.99.\n     03  display-9       pic z(6)9.99.\n     03  Vat-Code-X.                           *> this for S, R, Z = Std,Reduced,Zero\n         05  Vat-Code    pic 9.                *> 18/01/17\n     03  I               pic 99.\n     03  J               pic 99.\n     03  k               pic 99.\n     03  m               pic 99.\n     03  escape-code     pic x.\n     03  new-screen      pic 9(8).\n     03  altypes         pic x(60) value \"Receipt <<<    Account <<<    Credit Note <<<Pro-Forma <<<\".\n     03  filler redefines altypes.\n         05 d-types      pic x(15) occurs 4.\n     03  WS-vat-rate     pic 99v99.\n     03  WS-pa           pic xx.\n     03  WS-product      pic x(13).\n     03  WS-Temp-Stock-Key             value spaces.\n         05  WS-Abrev-Stock   pic x(7).\n         05  WS-Stock-No-Long pic x(6).\n     03  WS-Temp-Invoice pic 9(8).\n     03  WS-description  pic x(32).\n     03  WS-qty          pic 9(5).\n     03  WS-net          pic 9(7)v99.\n     03  WS-vat          pic 9(7)v99.\n     03  WS-unit         pic 9(6)v99.\n     03  WS-cr           pic 9(8).\n     03  WS-dayes        pic 99.\n     03  WS-Inv-Month.\n         05  WS-Inv-Mth  pic 99.\n     03  WS-Show-Delivery pic x.\n*>\n     03  WS-Old-Product  pic x(13).     *> These hold line items prior to changes\n     03  WS-Old-Qty      pic 9(5).\t*> and new are tested against them for any changes & if needed\n*>                                         the CIT tables are updated.\n     03  WS-Old-Desc     pic x(32).\t*> NOT USED\n*>\n     03  WS-env-lines    pic 999       value zero.\n     03  WS-lines        binary-char unsigned value zero.\n     03  WS-accept-body  binary-char unsigned value 8.         *> set for 24 line screen (-1)\n     03  WS-23-lines     binary-char unsigned value zero.\n*>\n 01  All-My-Constants    pic 9(4).\n     copy \"screenio.cpy\".\n*>\n 01  WS-Test-Date            pic x(10).\n 01  WS-date-formats.\n     03  WS-swap             pic xx.\n     03  WS-Conv-Date        pic x(10).\n     03  WS-date             pic x(10).\n     03  WS-UK redefines WS-date.\n         05  WS-days         pic xx.\n         05  filler          pic x.\n         05  WS-month        pic xx.\n         05  filler          pic x.\n         05  WS-year         pic x(4).\n     03  WS-USA redefines WS-date.\n         05  WS-usa-month    pic xx.\n         05  filler          pic x.\n         05  WS-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  WS-Intl redefines WS-date.\n         05  WS-intl-year    pic x(4).\n         05  filler          pic x.\n         05  WS-intl-month   pic xx.\n         05  filler          pic x.\n         05  WS-intl-days    pic xx.\n*>\n copy \"Test-Data-Flags.cob\".    *> set sw-testing to zero to stop logging.\n*>\n 01  Change-Item-Tables.        *> Initialised on 1st getting a invoice/receipt/Cr.note.\n     03  CIT-New-Product     pic 9.       *> 0 = no & 1 yes\n     03  Tab-A               pic 99.\n     03  Tab-D               pic 99.\n     03  CIT-Additions       occurs 40.\t  *> items deleted from invoice (or quantity changed ??)\n         05  CIT-A-Stock-Key pic x(13).\n         05  CIT-A-Desc      pic x(32).\n         05  CIT-A-Trans-Qty pic s9(6).\t  *> if negative",
        "line": 7
      },
      {
        "type": "IF",
        "condition": "WS-env-lines < 24\n              move  24 to WS-env-lines WS-lines\n     else\n              move  WS-env-lines   to WS-lines\n     end-if\n     subtract 1 from WS-lines giving WS-23-lines.\n     subtract 15 from WS-23-Lines giving WS-Accept-Body.\t*> gives no. of invoice item lines\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n     perform  zz070-Convert-Date.   *> WS-date now local disp date\n     move     1 to File-Key-No.\n*>\n*>  Open files and check & setup if we have any deleted invoices\n*>\n     perform  Program-Start.\n*>\n main.\n*>***\n*>\n     initialize sInvoice-Bodies\n                Change-Item-Tables.\n     perform  invoice-details.\n*>\n     if       cob-crt-status = cob-scr-esc\n       or     z not = zero\n       or     escape-code = \"Q\"\n              go to  menu-exit.\n*>\n     move     16  to  lin.\n     perform  erase-screen.\n*>\n data-Input.\n*>*********\n*>\n     move     zero to   sih-p-c sih-net sih-vat.\n*>\n     move     zero to  i.\n*>\n     if       i-level-1\n              perform  inv-level-1\n     else\n              perform  inv-level-2.\n     if       cob-crt-status = cob-scr-esc\n              go to main.\n*>\n     if       I not = 1\n              perform End-Totals.\n*>\n more-data.\n*>\n     display \"Amend Further Invoices? (Y/N)  [Y]\" at 1629 with foreground-color 2.\n*>\n     move     \"Y\"  to   WS-reply.\n     accept   WS-reply at 1661 with foreground-color 6 update.\n     move     function upper-case (WS-reply) to WS-reply.\n*>\n     display  \" \" at 1601 with erase eol.\n*>\n     if       WS-reply = \"Y\"\n              go to main.\n     if       WS-reply not = \"N\"\n              go to more-data.\n*>\n menu-exit.\n*>********\n*>\n     move     zero to  pass-value.\n     perform  Sales-Close.\n     perform  Delivery-Close.       *> close sales-file delivery-file analysis-file\n     perform  Analysis-Close.\n     perform  Invoice-Close.     *> close    invoice-file.\n     perform  OTM3-Close.         *>  close    Open-Item-File-3.\n     if       SL-Stock-Link = \"Y\"\n              perform Stock-Close          *> close Stock-File  Stock-Audit\n              perform Stock-Audit-Close.\n*>\n     exit     program.\n*>\n*>****************************************************************\n*>                  P R O C E D U R E S                          *\n*>****************************************************************\n*>\n Running-Totals          section.\n*>==============================\n*>\n     display  I at 1223 with foreground-color 3.\n     move     zero  to  sih-net\n                        sih-vat.\n*>\n     perform  varying k from 1 by 1 until k > i\n              if  sil-type (k) not = \"D\"\n                  add sil-net (k)  to  sih-net\n                  add sil-vat (k) to  sih-vat\n     end-perform\n*>\n     move     sih-net  to  display-9.\n     if       i-level-1\n              display display-9 at 1237 with foreground-color 3.\n*>\n     move     sih-vat  to  display-9.\n     if       i-level-1\n              display display-9 at 1255 with foreground-color 3.\n*>\n     add      sih-net  sih-vat  giving  display-9.\n*>\n     if       i-level-1\n              display display-9 at 1268 with foreground-color 3\n     else\n              display display-9 at 1270 with foreground-color 3.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n write-details           section.\n*>==============================\n*>\n     add      1  to  j.\n     move     sih-invoice       to sil-invoice (j).\n     move     J                 to sil-line (j).\n     move     sih-type          to sil-type (j).\n     move     Invoice-Lines (j)  to WS-Invoice-Record.\n*>\n     perform  Invoice-Rewrite.        *> rewrite  invoice-record invalid key\t\t*> could be extra item\n     if       fs-reply not = zero\n              perform Invoice-Write.  *>   write invoice-record. SHOULD NEVER HAPPEN unless extra item\n*>\n     if       fs-reply not = zero\n              perform Eval-Status\n              display sl180         at line WS-23-lines col 1 with erase eol foreground-color 4\n              display fs-reply      at line WS-23-lines col 36 with foreground-color 3\n              display exception-msg at line WS-23-lines col 39 with foreground-color 3\n              display invoice-key   at line WS-23-lines col 64 with foreground-color 3\n              display sl006         at line WS-lines col 01 with foreground-color 3\n              accept  WS-reply      at line WS-lines col 30\n              display \" \"           at line WS-23-lines col 1 with erase eos\n     end-if.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n Update-Stock-and-Audit section.        *> This is NOT the same as in SL910 as\n*>=============================            it uses the CIT-A/D (Change-Item-Tables) tables\n*>                                         after writing out the updated invoice\n*>\n*> Normal for Receipts(1) and Invoices (2) but reverse process for Credit Notes (3)\n*>     ignoring proformas\n*>\n*> CIT-A processing is to :\n*>   Hold values of existing Inv. or Credit note line items\n*>  and at the end of amend process that has updated the CIT-A fields\n*>  o/p new audit record/s as needed which will show the differences per\n*>   line item. This way Auditing will always be correct after any amendments.\n*>\n*>  THIS IS TO BE TESTED as it is NEW CODE when linked Stock Control.\n*>  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n*>\n     if       SL-Stock-Link not = \"Y\"           *> Only process if linked to Stock Control\n              go to Update-Stock-Exit.\n     if       Sil-Type (j) = 4                  *> Ignore a proforma\n              go to Update-Stock-Exit.\n     if       CIT-A = zero                      *> If both tables are empty,",
        "line": 463
      },
      {
        "type": "IF",
        "condition": "CIT-A-Trans-Qty (Tab-A) > zero\t*> Sale has decreased\n                   move CIT-A-Trans-Qty (Tab-A) to Audit-Transaction-Qty\n                   move 1                  to Audit-Reverse-Transaction\n              else\n               if  CIT-A-Trans-Qty (Tab-A) < zero\t*> sale has increased\n                   multiply CIT-A-Trans-Qty (Tab-A) by -1 giving\n                                             Audit-Transaction-Qty\n               end-if\n              end-if\n*>\n              if   Sil-Type (j) = 3\t*> for Crs, switch the reverse flag\n                if Audit-Reverse-Transaction = zero\n                   move 1      to Audit-Reverse-Transaction\n                   move 5      to Audit-Type\n                   move Sih-cr to Audit-Cr-for-Invoice\n                else\n                   move zero to Audit-Reverse-Transaction\n                end-if\n              end-if\n              move Stk-Audit-No           to Audit-No\n*>\n*> Now get the stock record\n*>\n              if   WS-Stock-No-Long = spaces\n                   move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                   move  2 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              else\n                   move WS-Temp-Stock-Key to WS-Stock-Key\n                   move  1 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File key WS-Stock-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              end-if\n              if   fs-reply not = zero\n                   perform Eval-Status\n                   display SL198         at line WS-23-lines col 1 with erase eol foreground-color 4\n                   display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                   display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                   display WS-Stock-Key  at 2064 with foreground-color 3\n                   display sl006         at line WS-lines col 01 with foreground-color 3\n                   accept  WS-reply      at line WS-lines col 30\n                   display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it show up\n*>    in proof reports\n*>\n              if   WS-Stock-Key not = spaces\t\t*> we have a stock rec.\n                   if       Sil-Type (j) not = 3\t*> Its not a Credit note\n                      and   Stock-Services-Flag not = \"Y\"\n                    if      CIT-A-Trans-Qty (Tab-A) > zero\t*> Sale has decreased\n                            add CIT-A-Trans-Qty (Tab-A) to Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost\n                    else\n                        if  CIT-A-Trans-Qty (Tab-A) < zero\t*> sale has increased\n                            subtract CIT-A-Trans-Qty (Tab-A) from Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                    Audit-Transaction-Qty * Stock-Cost * -1\n                        end-if\n                    end-if\n                   end-if\n                   if       Sil-Type (j) = 3\t\t*> It is a Credit note\n                      and   Stock-Services-Flag not = \"Y\"\n                    if      CIT-A-Trans-Qty (Tab-A) < zero\t*> Sale has Increased\n                            add CIT-A-Trans-Qty (Tab-A) to Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost\n                    else\n                     if     CIT-A-Trans-Qty (Tab-A) > zero\t*> sale has Decreased\n                            subtract CIT-A-Trans-Qty (Tab-A) from Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost * -1\n                     end-if\n                    end-if\n                   end-if\n*>\n*> This from sl910 but adds reversed for CR and receipts/invs as back in stock\n*>\n                   if       WS-Inv-Mth not < 1 or > 12\n                     if      Sil-Type (j)  = 1 or 2                    *> Invoice and Recepts\n                      if      CIT-A-Trans-Qty (Tab-A) > zero      *> Sale has decreased\n                              add Audit-Transaction-Qty to Stock-Adds\n                              add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                      else\n                          if  CIT-A-Trans-Qty (Tab-A) < zero      *> sale has increased\n                              add Audit-Transaction-Qty to Stock-Deducts\n                              add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                          end-if\n                      end-if\n                     else\n                     if      Sil-Type (j) = 3                         *> Credit Notes\n                      if      CIT-A-Trans-Qty (Tab-A) < zero      *> Sale has Increased\n                              add Audit-Transaction-Qty to Stock-Adds\n                              add Audit-Transaction-Qty to Stock-TD-Adds (WS-Inv-Mth)\n                      else\n                        if    CIT-A-Trans-Qty (Tab-A) > zero      *> sale has Decreased\n                              add Audit-Transaction-Qty to Stock-Deducts\n                              add Audit-Transaction-Qty to Stock-TD-Deds (WS-Inv-Mth)\n                        end-if\n                      end-if\n                     end-if    *> type = 3\n                   end-if      *> inv-mth good\n*>\n                   if       Stock-Held < zero\t\t*> Should NOT happen as testing in data entry but if a Cr?\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply -1 by Stock-Held\n                            add Stock-Held to Stock-Pre-Sales\n                            move zero to Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite          *> rewrite Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                     *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write    *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform.\n*>\n*> Now we have processed Table CIT-A we have to do it all again for CIT-D\n*>  and No, it is too complex to try and do it all in one (higher risk of bugs)\n*>\n     perform  varying Tab-D from 1 by 1 until Tab-D > CIT-D\n              move 3                       to Audit-Type\n              move Sih-Invoice             to Audit-Invoice-PO\n              move WS-Date                 to Audit-Process-Date\n              move CIT-D-Stock-Key (Tab-D) to Audit-Stock-Key\n                                              WS-Temp-Stock-Key\n              move CIT-D-Desc (Tab-D)      to Audit-Desc\n              if   CIT-D-Trans-Qty (Tab-D) > zero\t\t*> Sale has increased\n                   move CIT-D-Trans-Qty (Tab-D) to Audit-Transaction-Qty\n              end-if\n*>\n              if   Sil-Type (j) = 3\t*> for Crs, switch the reverse flag\n                if Audit-Reverse-Transaction = zero\n                   move 1 to Audit-Reverse-Transaction\n                   move 5      to Audit-Type\n                   move Sih-cr to Audit-Cr-for-Invoice\n                else\n                   move zero to Audit-Reverse-Transaction\n                end-if\n              end-if\n              move Stk-Audit-No           to Audit-No\n*>\n*> Now get the stock record\n*>\n              if   WS-Stock-No-Long = spaces\n                   move WS-Abrev-Stock to WS-Stock-Abrev-Key\n                   move  2 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File record key WS-Stock-Abrev-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              else\n                   move WS-Temp-Stock-Key to WS-Stock-Key\n                   move  1 to File-Key-No\n                   perform Stock-Read-Indexed  *> read Stock-File key WS-Stock-Key invalid key\n                   if   FS-Reply = 21\n                        move zero to Stock-Cost\n                        move spaces to WS-Stock-Key\n                   end-if                      *> end-read\n              end-if\n              if   fs-reply not = zero\n                   perform Eval-Status\n                   display SL198         at line WS-23-lines col 1 with erase eol foreground-color 4\n                   display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                   display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                   display WS-Stock-Key  at 2064 with foreground-color 3\n                   display sl006         at line WS-lines col 01 with foreground-color 3\n                   accept  WS-reply      at line WS-lines col 30\n                   display \" \"           at line WS-23-lines col 1 with erase eos\n              end-if\n*>\n*> If we have great, but if not Stock-Cost is zero which helps it show up in\n*>    proof reports\n*>\n              if   WS-Stock-Key not = spaces\t\t*> we have a stock rec.\n               and Stock-Services-Flag not = \"Y\"\n                   if       Sil-Type (j) not = 3\t*> Its not a Credit note\n                            add CIT-D-Trans-Qty (Tab-D) to Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost\n                   end-if\t\t*> CIT-D is NEW items so not on CRs.\n                   if       Sil-Type (j) = 3\t\t*> It is a Credit note\n                            subtract CIT-D-Trans-Qty (Tab-D) from Stock-Held\n                            compute  Audit-Stock-Value-Change =\n                                     Audit-Transaction-Qty * Stock-Cost * -1\n                   end-if\n*>\n*> This from sl910 but adds reversed for CR and receipts/invs as back in stock\n*>\n                   if       WS-Inv-Mth not < 1 or > 12\n                     if      Sil-Type (j)  = 1 or 2                    *> Invoice and Recepts\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-Adds\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-TD-Adds (WS-Inv-Mth)\n                     else\n                     if      Sil-Type (j) = 3                         *> Credit Notes\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-Deducts\n                              add CIT-D-Trans-Qty (Tab-D) to Stock-TD-Deds (WS-Inv-Mth)\n                     end-if    *> type = 3\n                   end-if      *> inv-mth good\n*>\n*>\n                   if       Stock-Held < zero\t\t*> Should NOT happen as testing in data entry but if a Cr?\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply -1 by Stock-Held\n                            add Stock-Held to Stock-Pre-Sales\n                            move zero to Stock-Held\n                   end-if\n                   if       Stock-Held > zero\n                      and   Stock-Services-Flag not = \"Y\"\n                            multiply Stock-Held by Stock-Cost giving Stock-Value\n                   else\n                            move zero to Stock-Value\n                   end-if\n                   move 1 to File-Key-No\n                   perform  Stock-Rewrite         *> rewrite  Stock-Record invalid key\n                   if       FS-Reply = 21\n                            display SL191    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                            display fs-reply at line WS-23-lines col 38 with foreground-color 2 highlight\n                            display SL006    at line WS-lines col 1\n                            accept WS-reply  at line WS-lines col 45\n                   end-if                *> end-rewrite\n                   if       fs-reply not = zero\n                            perform Eval-Status\n                            display SL199         at line WS-23-lines col 1 with erase eol foreground-color 4\n                            display fs-reply      at line WS-23-lines col 16 with foreground-color 3\n                            display exception-msg at line WS-23-lines col 19 with foreground-color 3\n                            display WS-Stock-Key  at 2064 with foreground-color 3\n                            display sl006         at line WS-lines col 01 with foreground-color 3\n                            accept  WS-reply      at line WS-lines col 30\n                            display \" \"           at line WS-23-lines col 1 with erase eos\n                   end-if\n              end-if\n*>\n              if   Stk-Audit-Used = 1\n                   move zero to Stk-Activity-Rep-Run\t\t*> Need to run audit report\n                   perform  Stock-Audit-Write       *> write WS-Stock-Audit-Record\n                   if      fs-reply not = zero\n                           perform Eval-Status\n                           display SL190         at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n                           display fs-reply      at line WS-23-lines col 38 with foreground-color 2 highlight\n                           display exception-msg at line WS-23-lines col 41 with foreground-color 3\n                           display SL006         at line WS-lines col 1\n                           accept WS-reply       at line WS-lines col 45\n                   end-if\n              end-if\n     end-perform.\n*>\n Update-Stock-Exit.\n     exit     section.\n*>\n Eval-Status        section.\n*>=========================\n*>\n*> With advent of moving to FH & DALs is this still needed?\n*>   Problem is dealing with DAL processing but many msgs still can\n*>    apply so we will leave it in without change.\n*>\n     move     spaces to exception-msg.\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by Exception-Msg.\n*>\n Main-Exit.   exit section.\n*>\n read-details  section.\n*>====================\n*>\n     move     zero to j.\n     perform  sih-lines times\n              add  1 to j\n              move sih-invoice to invoice-nos\n              move J to item-nos\n              perform Invoice-Read-Next      *> read invoice-file\n                                             *>  end-read\n              move WS-Invoice-Record to Invoice-Lines (j)\n     end-perform.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n net-compute             section.\n*>==============================\n*>\n     multiply work-n  by  work-d  giving  work-1.\n     divide   work-1  by  100     giving  work-1.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n comm-routines section.\n*>********************\n*>\n accept-money6a.\n*>-------------\n*>\n     move     zero to WS-poundsd6 WS-penced6 amt-ok6.\n*>\n accept-money6b.\n*>-------------\n*>\n     display  WS-amount-screen-display6 at curs  with foreground-color 3.\n     accept   WS-amount-screen-accept6  at curs   with foreground-color 3 update.\n     move     WS-pound6 to amt-wk-pds6.\n     move     WS-pence6 to amt-wk-pence6.\n*>\n accept-money6c.\n*>-------------\n*>\n     move     amt-wk-pence6 to WS-pence6.\n     move     amt-wk-pds6 to WS-pound6.\n     display  WS-amount-screen-display6 at curs  with foreground-color 3.\n     accept   WS-amount-screen-accept6  at curs   with foreground-color 3 update.\n     move     WS-pound6 to amt-wk-pds6.\n     move     WS-pence6 to amt-wk-pence6.\n*>\n accept-money7a.\n*>-------------\n*>\n     move     zero to WS-poundsd7 WS-penced7 amt-ok7.\n*>\n accept-money7b.\n*>-------------\n*>\n     display  WS-amount-screen-display7 at curs with foreground-color 3.\n     accept   WS-amount-screen-accept7  at curs  with foreground-color 3 update.\n     move     WS-pound7 to amt-wk-pds7.\n     move     WS-pence7 to amt-wk-pence7.\n*>\n accept-money7c.\n*>-------------\n*>\n     move     amt-wk-pence7 to WS-pence7.\n     move     amt-wk-pds7 to WS-pound7.\n     display  WS-amount-screen-display7 at curs with foreground-color 3.\n     accept   WS-amount-screen-accept7  at curs  with foreground-color 3 update.\n     move     WS-pound7 to amt-wk-pds7.\n     move     WS-pence7 to amt-wk-pence7.\n*>\n comm-exit.   exit.\n*>--------    ----\n*>\n inv-level-1  section.\t\t*> No one should be using this consider scrapping and forcing invoicer =2 etc\n*>===================\n*>\n     display  WS-dash        at 1101 with foreground-color 2.\n     display  \"Level 1\"      at 1201 with foreground-color 2.\n     display  \"Line - \"      at 1216 with foreground-color 2.\n     display  \"<          >\" at 1236 with foreground-color 2.\n     display  \"<          >\" at 1254 with foreground-color 2.\n     display  \"<          >\" at 1267 with foreground-color 2.\n     display  \"Code\"         at 1405 with foreground-color 2.\n     display  \"<---Net---->  Vat   Vat Amount  Gross Amount\" at 1436 with foreground-color 2.\n*>\n loop.\n*>***\n*>\n     perform  Display-Outline-1 varying lin from 16 by 1 until lin not < WS-23-lines.\n*>\n*>     subtract 16 from WS-23-lines giving m.   *> 24 line screen\n     subtract WS-Accept-Body from  i.\t\t*> was m from i\n     move     1 to j.\n     display  I at 1223 with foreground-color 2.\n     move     zero to cob-crt-status.   *> from sl910\n     perform  Get-Data-1.\n     if       cob-crt-status = cob-scr-esc\n              go to Main-Exit.\n*>\n     if       new-screen = 1\n              go to loop.\n*>\n     if       sil-description (I) not = spaces\n        and   I not = 40\n*>       and  escape-code not = \"Q\"\n              go to  loop.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n Get-Data-1  section.     *> No one should be using this consider scrapping and forcing invoicer =2 etc\n*>==================\n*>\n Get-Data-1-Main.\n     add      J  15  giving  lin.\n     if       lin  > WS-23-lines\n              subtract 1 from i\n              move 1 to new-screen\n              go to  Main-Exit.\n*>\n     move     zero to new-screen.\n*>\n Get-Code.\n*>*******\n*>\n     move     sil-pa (I) to WS-pa.\n     move     7 to cole.\n     display  WS-pa at curs with foreground-color 3.\n     accept   WS-pa at curs with foreground-color 3 update.\n*>\n     if       WS-pa = spaces\n              go to  Main-Exit.\n     if       cob-crt-status = cob-scr-esc\n              go to Main-Exit.\n*>\n     if       WS-pa = \"<<\"\n         and  I = 1\n              go to Get-Code.\n*>\n     if       WS-pa = \"<<\"\n              subtract  1  from  lin\n              if    lin  >  15\n                    subtract  1  from  i\n                    subtract 1 from j\n                    go to  Get-Code\n              else\n                    subtract WS-Accept-Body from  I    *> Was 8 Need to follow logic, can we use WS-Accept-Body ??\n                    go to Get-Data-1-Main.\n*>\n     move     WS-pa to delete-test.\n     if       delete-field = \"**\"\n              perform clear-down-line\n              subtract 1 from i\n              perform Display-Outline-1\n              go to Get-Code.\n*>\n     move     WS-pa to sil-pa (I) pa-group.\n     move     \"S\" to pa-system.\n     move     11 to cole.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.\n     if       FS-Reply = 21\n              display SL186 at line WS-23-lines col 1 with foreground-color 4 highlight beep\n              go to  Get-Code.\n     display  \" \" at line WS-23-lines col 1 with erase eol.\n*>\n     display  pa-desc at curs with foreground-color 3.\n     move     pa-desc  to  sil-description (I).\n*>\n get-net.\n*>******\n*>\n     move     37 to cole.\n     move     sil-net (I) to amt-ok7.\n     perform  accept-money7c.\n     if       amt-ok7 = zero\n              go to Get-Code.\n     move     amt-ok7 to sil-net (I) WS-net.\n*>\n Get-Vat-Code.\n*>***********\n*>\n     move     50 to cole.\n     move     sil-vat-code (I) to vat-code.\n     display  vat-code at curs with foreground-color 3.\n     accept   vat-code at curs with foreground-color 3 update.\n*>\n     if       vat-code  >  3     *> last two are for non-UK sales tax\n              go to  Get-Vat-Code.\n*>\n     move     vat-code  to  sil-vat-code (I).\n     if       vat-code = zero\n              move  zero  to  amt-ok6\n     else\n              move vat-rate (vat-code) to WS-vat-rate\n              compute amt-ok6 rounded = (WS-net * WS-vat-rate) / 100.\n*>\n get-vat-rate.\n*>***********\n*>\n     move     56 to cole.\n     perform  accept-money6c.\n     move     amt-ok6 to sil-vat (I)\n                         WS-vat.\n*>\n     add      WS-vat WS-net giving  display-9.\n     move     68 to cole.\n     display  display-9 at curs with foreground-color 3.\n*>\n     perform  Running-Totals.\n*>\n     add      1 to j.\n     add      1  to  i.\n     go       to Get-Data-1-Main.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n inv-level-2             section.\n*>==============================\n*>\n     display  WS-dash                 at 1101 with foreground-color 2.\n     if       SL-Stock-Link not = \"Y\"\n              display  \"Level 2\"      at 1201 with foreground-color 2\n     else\n              display  \"Stock Linked\" at 1201 with foreground-color 2.\n     display  \"Line - \"               at 1216 with foreground-color 2.\n     display  \"Net <          >\"      at 1227 with foreground-color 2.\n     display  \"Vat <          >\"      at 1244 with foreground-color 2.\n     display  \"Invoice <          >\"  at 1261 with foreground-color 2.\n     if       SL-Stock-Link = \"N\"\t\t*> No stock",
        "line": 636
      },
      {
        "type": "IF",
        "condition": "cob-crt-status = cob-scr-esc\n              go to Main-Exit.\n*>\n     if       new-screen = 1\n              go to  loop.\n*>\n     if       WS-product not = spaces\n        and   I not = 40\t\t\t*> max no. of items per invoice\n*>       and   escape-code not = \"Q\"\n              go to loop.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n Get-Data-2              section.\n*>==============================\n*>\n*>**********************************************************************\n*>  This section will accept invoice line data if SC (stock control)   *\n*>  is NOT linked in param file. If it is linked, will only request:   *\n*>  Stock code or if entered chars = 7 or less, Abrev code so can      *\n*>  search same if using F3 to find 1st",
        "line": 1194
      },
      {
        "type": "IF",
        "condition": "lin  > WS-23-lines - 1\n              subtract  1  from  i\n              move  1  to  new-screen\n              go to  Main-Exit.\n*>\n     move     zero  to  new-screen.\n*>\n Get-Product.\n*>**********\n*>\n     move     2 to cole.\n     move     sil-product (I) to WS-product.\n     display  WS-product at curs with foreground-color 3.\n     accept   WS-product at curs with foreground-color 3 update.\n*>\n     if       WS-product = spaces\n              go to Main-Exit.\n     if       cob-crt-status = cob-scr-esc\n              go to Main-Exit.\n*>\n     move     function upper-case (WS-product) to WS-product.\n     move     WS-product to test-product.\n     add      1 to CIT-A.                   *> items deleted from an invoice or qty changed\n*>\n     if       WS-product = sil-Product (I)  *> No Change\n      if      SL-Stock-Link = \"N\"           *> so forget table\n              subtract 1 from CIT-A\n              go to Get-Code\n      else                                  *> SAME Stock Item\n              move     zero to CIT-New-Product\n              move     WS-product          to CIT-A-Stock-Key (CIT-A)\n              move     sil-Description (I) to CIT-A-Desc (CIT-A)\n              move     17 to cole                *> 4 Desc.\n              display  sil-Description (I) at curs with foreground-color 3\n              move     WS-Product to WS-Temp-Stock-Key\n              move     sil-Qty (I)         to CIT-A-Trans-Qty (CIT-A)\n              perform  Get-Simple-Stock      *> 12/08/23\n              go to Get-Qty                  *> Desc does not change against product\n      end-if\n     end-if\n*>\n     if       sil-comment\n              move WS-product to sil-product (I)\n              move zero to sil-net (I) sil-qty (I) sil-vat (I)\n              go to  Get-Desc.\n*>\n     if       WS-product = \"<<          \"\n              subtract  1  from  lin\n              go to Get-Prod-Test.\n*>\n*> If here we have a change of product but only interested for Audit if stock linked\n*>\n     if       SL-Stock-Link = \"Y\"            *> Save original item details in deleted table\n              move     sil-Product (I)     to CIT-A-Stock-Key (CIT-A)\n              move     sil-Description (I) to CIT-A-Desc (CIT-A)\n              move     sil-Qty (I)         to CIT-A-Trans-Qty (CIT-A)\n*>                                                         Thats the original, now for the new\n              add      1 to CIT-D\n              move     1 to CIT-New-Product\n              move     WS-Product to CIT-D-Stock-Key (CIT-D)  *> still need qty & desc\n     end-if\n     move     WS-product to sil-product (I).     *> NOW NEED TO GET Stock item from the Stock file etc <<<<<<<<<<<\n     if       WS-Product (1:2) = \"**\"            *> deleted line\n              subtract 1 from CIT-D\n              move zero to CIT-New-Product\n              go to Get-Code.                    *> to process a deleted line\n     if       SL-Stock-Link = \"N\"\n              go to Get-Code.\n*>\n*>>>>>> Now process stock file etc <<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n*>\n     move     17 to cole.                *> 4 Desc.\n*>\n*> Search nearest Abrev key and read next ..\n*>  When this is tested we can wrap this and next together with a F3 test",
        "line": 1227
      },
      {
        "type": "IF",
        "condition": "F2 or F3 test\n*>\n     if       cob-crt-status = cob-scr-F3                *> search Abrev",
        "line": 1301
      },
      {
        "type": "IF",
        "condition": "FS-Reply = 21 or = 23\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n     if       cob-crt-status = cob-scr-F2\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> have we the right one?\n              display WS-Stock-Desc at curs with foreground-color 3\n              go to Get-Product\n     end-if\n*>\n*> Search on Desc. but has dup keys so disp. Abrev. code & F5 for next on description\n*>  When this is tested we can wrap this and next together with a F6 test",
        "line": 1308
      },
      {
        "type": "IF",
        "condition": "F5 or F6 test\n*>\n     if       cob-crt-status = cob-scr-F6\n              move    sil-description (I) to WS-description\n              accept  WS-description at curs with foreground-color 3 update\n              move WS-Description to WS-Stock-Desc\n              move  3 to File-Key-No\n              set fn-not-less-than to true\n              perform Stock-Start     *> start Stock-File key not < WS-Stock-Desc invalid key\n              if    FS-Reply = 21\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              if       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              accept WS-reply at 2410            *> TESTING ONLY\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if\n*>\n     if       cob-crt-status = cob-scr-F5         *> Read next on Desc.\n              perform Stock-Read-Next\n              if    FS-Reply = 10\n                    move SL196 to WS-Stock-Desc\n                    display WS-Stock-Desc at curs with foreground-color 4\n                    go to Get-Product\n              end-if\n              move WS-Stock-Abrev-Key to sil-product (I)    *> Got the right one? Show desc, stock held & retail price\n                                      WS-Product\n              display WS-Stock-Desc at curs with foreground-color 3 highlight\n              move Stock-Held to WS-Qty\n              if       Stock-Services-Flag = \"Y\"\n                       move 1 to WS-Qty\n              end-if\n              display WS-Qty at line lin col 53 with foreground-color 3 highlight\n              move Stock-Retail to amt-ok7\n              move amt-wk-pds7   to WS-pound7\n              move amt-wk-pence7 to WS-pence7\n              display WS-amount-screen-display7 at line lin col 60 with foreground-color 3 highlight\n              go to Get-Product\n     end-if.\n*>\n Get-Simple-Stock.\n*>\n*> So, no special function just search for entered key\n*>\n     if       WS-Stock-No-Long = spaces\n              move WS-Abrev-Stock to WS-Stock-Abrev-Key\n              move 2 to File-Key-No\n     else\n              move WS-Temp-Stock-Key to WS-Stock-Key\n              move 1 to File-Key-No\n     end-if\n     perform  Stock-Read-Indexed\n     if       FS-Reply = 21 or = 23\n              move SL196 to WS-Stock-Desc\n              display WS-Stock-Desc at curs with foreground-color 4\n              go to Get-Product\n     end-if.\n*>\n GSS-End.\n*> can shorten code now so rem out next block vbc 27/08/17\n*>\n *>    else\n *>             perform Stock-Read-Indexed   *> read Stock-File key WS-Stock-Key invalid key\n *>             if   FS-Reply = 21\n *>                  move SL196 to WS-Stock-Desc\n *>                  display WS-Stock-Desc at curs with foreground-color 4\n *>                  go to Get-Product\n *>             end-if\n *>    end-if\n     perform  Test-For-Read-Stock.\n*>\n Process-Stock-Record.\n*>\n*>  Have the required Stock record so get and show the desc\n*>\n     move     17 to cole.        *> Desc.\n     move     Stock-sa-Group to WS-pa\n                                pa-group\n                                sil-pa (I).\n     display  WS-Stock-Desc   at curs with foreground-color 3.\n     move     WS-Stock-Desc to WS-description\n                               sil-description (I)\n                               CIT-D-Desc (CIT-D).\n     move     Stock-Retail  to amt-ok7.\n     move     Stock-Retail  to WS-Unit.\n     move     amt-wk-pds7   to WS-pound7.\n     move     amt-wk-pence7 to WS-pence7.\n     display  WS-amount-screen-display7 at line lin col 60 with foreground-color 3.\n     move     Stock-Held to WS-qty.\n     if       Stock-Services-Flag = \"Y\"\n              move 1 to WS-Qty\n     end-if\n     go       to Get-Qty.          *> Bypass manual input code as comes from stock record\n*>\n Get-Prod-Test.   *> THESE TESTS LOOK WRONG IF SCREEN LONGER THAN 24 LINES <<<<< (in sl910)\n*>************        So to be tested for\n*>\n     if       I = 1\n              add 1 to lin\n              go to Get-Product.\n*>\n     if       lin  >  15\n              subtract  1  from  i\n              subtract  1  from  j\n              go to  Get-Product\n      else\n              subtract WS-Accept-Body from I           *> instead of 8 can we use WS-Accept-Body ??\n              go to Get-Data-2-Main.\n*>\n clear-down-line.\n*>**************\n*>\n*> Clear deleted item by moving down 1 line at a time reducing line count by 1\n*>  every time a line item is deleted.\n*>\n     perform  varying z from I by 1 until z > 39\n              move Invoice-Lines (z + 1) to Invoice-Lines (z)\n              move z to sil-line (z)\n     end-perform\n*>\n     move     zero to z.\n     if       I not > sih-lines\t\t\t*> Check that the deleted line is not the last item\n              move sih-invoice to invoice-nos\n              move sih-lines  to  item-nos\n              perform  Invoice-Delete           *> delete the last item (that was)\n              subtract 1 from sih-lines.\n*>\n Get-Code.\n     move     sil-product (I) to delete-test.\n     if       delete-field = \"**\"\n              perform clear-down-line\n              subtract 1 from i\n              perform Display-Outline-2\n              go to Get-Product.\n*>\n     move     sil-pa (I) to WS-pa.\n     move     17 to cole.\n     display  WS-pa at curs with foreground-color 3.\n     accept   WS-pa at curs with foreground-color 3 update.\n*>\n     if       WS-pa = spaces\n              go to  Get-Product.\n     move     \"S\" to pa-system.\n     move     WS-pa to pa-group sil-pa (I).\n     move     21 to cole.                       *> disp error in desc.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.\n     if       FS-Reply not = zero\n              display SL186 at curs with foreground-color 4\n              go to  Get-Code.\n*>\n Get-Desc.\n     if       SL-Stock-Link = \"Y\"\n              move 17 to cole\n     else\n              move 21 to cole.\n     move     sil-description (I) to WS-description.\n     display  WS-description at curs with foreground-color 3.\n     accept   WS-description at curs with foreground-color 3 update.\n*>\n     if       WS-description = space\n              move \"B\" to escape-code\n     else\n              move space to escape-code.\n     if       escape-code = \"B\"\n         and  sil-comment\n              go to Get-Product.\n     if       escape-code = \"B\"\n              go to  Get-Code.\n*>\n     move     WS-description to sil-description (I).\n     if       sil-comment\n              go to  Jump-Totals.\n*>\n Get-Qty.\n     move     sil-qty (I) to WS-qty.\n     move     53 to cole.\n     if       Stock-Services-Flag = \"Y\"\n              move 1 to WS-Qty\n     end-if\n     display  WS-qty at curs with foreground-color 3.\n     accept   WS-qty at curs with foreground-color 3 update.\n*>\n     if       WS-qty = zero\n      and     SL-Stock-Link = \"Y\"\n              go to Recomp-Net. \t\t*> deleting this transaction so zero qty\n     if       WS-qty = zero\n              go to Get-Desc.\n     if       SL-Stock-Link = \"Y\"         \t*> make sure not selling more stock than held\n       and    WS-qty > Stock-Held\n        and   Stock-Services-Flag not = \"Y\"\n              move Stock-Held to WS-Qty\n              go to Get-Qty.\n*>\n     if       SL-Stock-Link = \"Y\"\t\t*> bypass accept unit price\n       and    CIT-New-Product = 1\n              move WS-Qty              to CIT-D-Trans-Qty (CIT-D)\n              go to Recomp-Net.\n     if       SL-Stock-Link = \"Y\"\t\t*> bypass accept unit price\n       and    CIT-New-Product = zero\n       and    WS-Qty = Sil-Qty (I)\n              if    CIT-A = zero\n                    move  1 to CIT-A\n              end-if\n              initialize CIT-Additions (CIT-A)\t*> No change so clear the table entry\n              subtract 1 from CIT-A\t\t*> as only possible changes discount & vat does not effect stock\n              go to Recomp-Net.\n     if       SL-Stock-Link = \"Y\"\t\t*> bypass accept unit price\n       and    CIT-New-Product = zero\n       and    WS-Qty not = Sil-Qty (I)\t\t*> We have a change in qty\n              subtract WS-Qty from Sil-Qty (I) giving CIT-A-Trans-Qty (CIT-A)\n*>              if  CIT-A-Trans-Qty > zero\t*> selling less to return unused/sold as reverse trans\n     end-if.    *> Any thing else needed ???????\n\n*>\n Get-Unit.\n     move     60 to cole.\n     move     sil-unit (I) to amt-ok6.\n     perform  accept-money6c.\n     if       amt-ok6 = zero\n              go to Get-Qty.\n     move     amt-ok6 to WS-unit.\n*>\n Recomp-Net.\n     if       WS-Qty = zero\n              if       I > zero   *> JIC\n                       initialise Invoice-Lines (I) *> clear down any above entered data for item line\n                       subtract 1 from I\n              end-if\n              go to Get-Data-2\n     end-if.\n*>\n     multiply WS-qty by  WS-unit giving  WS-net on size error\n              display  \"SizEr\" at curs with blink foreground-color 4.\n              go to Get-Qty.\n*>\n     move     WS-net to  display-9 sil-net (I).\n     move     WS-qty to sil-qty (I).\n     move     WS-unit to sil-unit (I).\n     display  display-9 at 1232 with foreground-color 3.\n*>\n Get-Disc.\n     move     sil-discount (I) to  WS-discount.\n     move     72 to cole.\n     move     WS-disc-wka to WS-disca1.\n     move     WS-disc-wkb to WS-disca3.\n     display  WS-discount-display at curs with foreground-color 3.\n     accept   WS-discount-accept  at curs with foreground-color 3 update.\n     move     WS-discb1 to WS-disc-wka.\n     move     WS-discb3 to WS-disc-wkb.\n*>\n     move     WS-discount to  work-d sil-discount (I).\n     move     WS-net to  work-n.\n*>\n     perform  net-compute.\n*>\n     subtract work-1  from  WS-net.\n*>\n     move     WS-net to sil-net (I) display-9.\n     display  display-9 at 1232 with foreground-color 3.\n*>\n Get-Vat-Code.\n     move     \"S\" to Vat-Code-X.  *> 12/8/23  for Standard rate\n     move     79 to cole.\n     move     sil-vat-code (I) to vat-code.\n     display  vat-code-X at curs with foreground-color 3.\n     accept   vat-code-X at curs with foreground-color 3 update UPPER.\n*>\n*>   Accept S, R and Z replacing with 1, 2 & 3.      Rating\n*>\n     if       Vat-Code-X = \"S\"                   *> Standard code 1\n              move 1 to Vat-Code\n      else\n       if     Vat-Code-X = \"R\"                   *> Reduced  code 2\n              move 2 to Vat-Code\n        else\n         if   Vat-Code-X = \"Z\"                   *> Zero     code 3\n              move 3 to Vat-Code.\n*>\n     if       vat-code < 1 or > 3                *> using 1st three as last 2 are Sales tax, Not used in the UK.\n              go to  Get-Vat-Code.                *> so change test for 'not = 4 or 5' instead of '> 3'\n*>\n     move     vat-code  to  sil-vat-code (I).\n*>\n     if       vat-code = zero\n              move  zero  to  WS-vat\n     else\n              move vat-rate (vat-code) to WS-vat-rate\n              compute  WS-vat rounded = (WS-net * WS-vat-rate) / 100.\n*>\n     move     WS-vat to  display-9 sil-vat (I).\n     display  display-9 at 1249 with foreground-color 3.\n*>\n     perform  Running-Totals.\n*>\n Jump-Totals.\n     add      1  to  j.\n     add      1  to  i.\n     go       to Get-Data-2-Main.\n*>\n Test-For-Read-Stock.\n     if       fs-reply not = zero\n              perform Eval-Status\n              display SL198    at line WS-23-lines col 1 with foreground-color 4 highlight erase eol\n              display fs-reply at line WS-23-lines col 20 with foreground-color 2 highlight\n              display exception-msg at line WS-23-lines col 24 with foreground-color 3\n              display SL006 at line WS-lines col 1\n              accept WS-reply at line WS-lines col 45\n     end-if.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n erase-screen            section.\n*>==============================\n*>\n     move     1 to cole.\n     display  space at curs with erase eos.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n End-Totals              section.\n*>==============================\n*>\n End-Totals-Main.\n     perform  total-screen.\n*>\n     move     15  to  lin.\n     perform  erase-screen.\n*>\n     display  \"*********************\" at 1660  with foreground-color 2\n     display  \"*\" at 1760 with foreground-color 2\n     display  \"*\" at 1760 with foreground-color 2\n     display  \"*\" at 1860 with foreground-color 2\n     display  \"*\" at 1880 with foreground-color 2\n     display  \"*\" at 1960 with foreground-color 2\n     display  \"*\" at 1980 with foreground-color 2\n     display  \"*********************\" at 2060 with foreground-color 2\n*>\n     display  \"Invoice Ok To Store?\" at 1761 with foreground-color 2.\n     display  \"(Y/N)  [Y]\" at 1967 with foreground-color 2.\n*>\n confirmation.\n*>***********\n*>\n     move     \"Y\"  to   WS-reply.\n     accept   WS-reply at 1975 with foreground-color 6 update.\n     move     function upper-case (WS-reply) to WS-reply.\n*>\n     if       WS-reply = \"N\"\n              go to End-Totals-Main.\n*>\n     if       WS-reply not = \"Y\"\n              go to  confirmation.\n*>\n     move     \"P\"  to  sih-status.\n     move     space to sih-status-P\n                       sih-Status-L.  *> 20/01/17\n     subtract 1  from  i.\n     move     I    to  sih-lines.\n*>\n     move     SInvoice-Header  to  WS-Invoice-Record.\n     perform  Invoice-Rewrite.            *>  rewrite  invoice-record.\n     if       fs-reply not = zero\n              perform Eval-Status\n              display sl192         at line WS-23-lines col  1 with erase eol foreground-color 4\n              display fs-reply      at line WS-23-lines col 36 with foreground-color 3\n              display exception-msg at line WS-23-lines col 39 with foreground-color 3\n              display invoice-key   at line WS-23-lines col 64 with foreground-color 3\n              display sl006         at line WS-lines    col  1 with foreground-color 3\n              accept  WS-reply      at line WS-lines    col 30\n              display \" \"           at line WS-23-lines col  1 with erase eos\n     end-if\n*>\n     move     zero to  j.\n     perform  write-details  I  times.\n     perform  Update-Stock-And-Audit.\n     move     1 to s-flag-i.\n     move     11  to  lin.\n     perform  erase-screen.\n*>\n Main-Exit.   exit section.\n*>********    *****\n*>\n total-screen            section.\n*>==============================\n*>\n     move     1 to cole.\n     move     11 to lin.\n     display  \" \" at curs with erase eos.\n     display  WS-dash at 1101 with foreground-color 2.\n*>\n     if       i-level-1\n              move  1  to  menu-reply\n     else\n              move  2  to  menu-reply.\n*>\n     display  \"Level \"   at 1201 with foreground-color 2.\n     display  menu-reply at 1207 with foreground-color 2.\n     display  \"<---Net---->   <---Vat--->\" at 1225 with foreground-color 2.\n     display  \"<---Gross-->     Days\"      at 1254 with foreground-color 2.\n     display  \"Sub-Totals\"                 at 1404 with foreground-color 2.\n     display  \"{          }   {         }\" at 1425 with foreground-color 2.\n     display  \"{          }     [  ]\"      at 1454 with foreground-color 2.\n*>\n     display  Extra-Desc                   at 1504 with foreground-color 2.\n     display  \"[          ]   [         ]\" at 1525 with foreground-color 2.\n     display  \"{          }\"               at 1554 with foreground-color 2.\n*>\n     display  \"Shipping & Handling\"        at 1604 with foreground-color 2.\n     display  \"[          ]   [         ]\" at 1625 with foreground-color 2.\n     display  \"{          }\"               at 1654 with foreground-color 2.\n*>\n     display  \"Late Charge\"                at 1704 with foreground-color 2.\n     display  \"[          ]              \" at 1725 with foreground-color 2.\n     display  \"{          }     [  ]\"      at 1754 with foreground-color 2.\n*>\n     display  \"------------   -----------\" at 1825 with foreground-color 2.\n     display  \"------------\"               at 1854 with foreground-color 2.\n*>\n     display  \"Itemised Totals\"            at 1904 with foreground-color 2.\n     display  \"{          }   {         }\" at 1925 with foreground-color 2.\n     display  \"{          }\"               at 1954 with foreground-color 2.\n*>\n     move     sih-net  to  display-9.\n     display  display-9 at 1426 with foreground-color 3.\n*>\n     move     sih-vat  to  display-8.\n     display  display-8 at 1441 with foreground-color 3.\n*>\n     add      sih-net  sih-vat  giving  display-9.\n     display  display-9 at 1455 with foreground-color 3.\n*>\n get-days.\n*>*******\n*>\n     move     sih-days to WS-dayes.\n     display  WS-dayes at 1472 with foreground-color 3.\n     if       sih-type not = 2\n*>              move zero to sih-days\t\t*> its a proforma so leave it & unchanged\n              go to get-extra.\n*>\n     accept   WS-dayes at 1472 with foreground-color 3 update.\n     move     WS-dayes to sih-days.\n*>\n get-extra.\n*>********\n*>\n     if       Extra-Type = space\n              move zero to sih-extra sih-e-vat\n              go to get-carriage.\n*>\n     if       Extra-Rate not = zero\n              compute  sih-extra = (sih-net * Extra-Rate) / 100\n     else\n              move  zero  to  sih-extra.\n*>\n     move     1526 to curs.\n     move     sih-extra to amt-ok7.\n     perform  accept-money7c.\n     move     amt-ok7 to sih-extra.\n*>\n get-extra-vat.\n*>************\n*>\n     if       sih-extra = zero\n              move  zero to  sih-e-vat\n              go to get-carriage.\n*>\n     compute  amt-ok6 = sih-extra  *  vat-rate-1  /  100.\n*>\n     move     1541 to curs.\n     perform  accept-money6c.\n     move     amt-ok6 to sih-e-vat.\n*>\n     add      sih-extra  sih-e-vat  giving  display-9.\n     display  display-9 at 1555 with foreground-color 3.\n*>\n     if       discount\n         and  sih-extra not = zero\n              multiply -1 by sih-extra\n              multiply -1 by sih-e-vat.\n*>\n get-carriage.\n*>***********\n*>\n     move     1626 to curs.\n     move     sih-carriage to amt-ok7.\n     perform  accept-money7c.\n     move     amt-ok7 to sih-carriage.\n     compute  amt-ok6 rounded = sih-carriage * vat-rate-1 / 100.\n*>\n*> Note That Vat-Rate-1 Must Be Standard Rate For P & P\n*>\n get-carriage-vat.\n*>***************\n*>\n     move     1641 to curs.\n     perform  accept-money6c.\n     move     amt-ok6 to sih-c-vat.\n     add      sih-carriage  sih-c-vat  giving  display-9.\n     display  display-9 at 1655 with foreground-color 3.\n*>\n get-deduct-amt.\n*>*************\n*>\n     if       (sih-type not = 2  and not = 3)\t\t*> Invoices, Credit Notes\n          or  not late-charges\n          or  WS-named = \"Z\"\n              move  zero  to  sih-deduct-amt  sih-deduct-vat  sih-deduct-days\n              go to  Main-Exit.\n*>\n     compute  amt-ok7 =  sih-net  /  10.\n*>\n     if       amt-ok7 <  4\n              move  4  to  amt-ok7.\n*>\n     move     1726 to curs.\n     perform  accept-money7c.\n     move     amt-ok7 to sih-deduct-amt.\n*>\n get-deduct-vat.\n*>*************\n*>\n     move     zero to sih-deduct-vat.\n*>\n     add      sih-net  sih-extra  sih-carriage  sih-deduct-amt  giving  display-9.\n     display  display-9 at 1926 with foreground-color 3.\n*>\n     add      sih-vat  sih-e-vat  sih-c-vat  sih-deduct-vat   giving  display-8.\n     display  display-8 at 1941 with foreground-color 3.\n*>\n     add      sih-net  sih-extra  sih-carriage  sih-deduct-amt\n              sih-vat  sih-e-vat  sih-c-vat  sih-deduct-vat    giving  display-9.\n     display  display-9 at 1955 with foreground-color 3.\n*>\n get-deduct-days.\n*>**************\n*>\n     move     sih-days  to  WS-dayes.\n     display  WS-dayes at 1772 with foreground-color 3.\n     accept   WS-dayes at 1772 with foreground-color 3 update.\n     move     WS-dayes to sih-deduct-days.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n invoice-details section.\n*>======================\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Invoicing Data Amend\" at 0132 with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  WS-date at 0171 with foreground-color 2.\n*>\n     display  \"****************************************\" at 0441 with foreground-color 2.\n     display  \"*Date   [  /  /    ]*                  *\" at 0541 with foreground-color 2.\n     display  \"*A/C Nos   [       ]*Ref   [          ]*\" at 0641 with foreground-color 2.\n     display  \"*Invoice  [        ]*Order [          ]*\" at 0741 with foreground-color 2.\n     display  \"****************************************\" at 0841 with foreground-color 2.\n     display  \"F8 = Only Show delivery details on 'A/C nos' entry\" at 0911 with foreground-color 2.\n     display  \"Type [ ]  <1> = Receipt; <2> = Account; <3> = Credit Note; <4> = Pro-Forma\"\n                                                         at 1001 with foreground-color 2.\n*>\n invoice-enter.\n*>************\n*>\n     move     1 to File-Key-No.\n     move     zero to sih-invoice.\n     display  sih-invoice at 0752 with foreground-color 3.\n     accept   sih-invoice at 0752 with foreground-color 3 update.\n     if       sih-invoice = zero\n           or cob-crt-status = cob-scr-esc\n              move 1 to z\n              go to Main-Exit.\n*>\n     move     zero         to  item-nos.\n     move     sih-invoice  to  invoice-nos.\n     perform  Invoice-Read-Indexed.\n     if       fs-reply not = zero\n              display SL194 at 1640 with foreground-color 4\n              display \"fs-reply = \" at 1665   *> TEMP VALUE FOR TESTING\n              display FS-Reply at 1676\n              display WS-invoice-key at 1705  *> VALID\n              display invoice-key at 1725\n              go to invoice-enter.\n     move     WS-Invoice-Record to SInvoice-Header.\n     display  \" \" at 1640 with erase eol.\n*>\n     if       sih-status = \"Z\" or \"z\"      *> Applied to OTM3\n              display SL195 at 1601 with foreground-color 4 erase eol\n              go to invoice-enter.\n*>\n     display  \" \" at 1601 with erase eol.\n     move     sih-date to u-bin.\n     perform  zz060-Convert-Date.   *> now have WS-date\n     perform  Read-Details.\n*>\n date-Input.\n*>*********\n*>\n     display  WS-date at 0550 with foreground-color 3.\n     accept   WS-date at 0550 with foreground-color 3 update.\n     if       cob-crt-status = cob-scr-esc\n         or   WS-date = spaces\n              move 1 to z\n              go to  Main-Exit.\n*>\n     move     WS-date to WS-Test-Date.\n     perform  zz050-Validate-Date.\n     if       u-bin = zero\n              go to  date-Input.\n*>\n     move     u-bin  to sih-date.\n*>\n customer-Input.\n*>*************\n*>\n     display  sih-customer at 0653 with foreground-color 3.\n     accept   sih-customer at 0653 with foreground-color 3 update UPPER.\n *>    move     function upper-case (sih-customer) to sih-customer.\n*>\n     if       cob-crt-status = cob-scr-esc\n         or   sih-customer = spaces\n              move  \"Q\"  to  escape-code\n              go to  Main-Exit.\n     if       Cob-Crt-Status = Cob-Scr-F8\n              move \"Y\" to WS-Show-Delivery\n     else\n              move \"N\" to WS-Show-Delivery\n     end-if\n*>\n     move     1  to  c-check.\n*>\n     move     sih-customer  to  WS-Sales-Key.\n*>\n     move     1 to File-Key-No.\n     perform  Sales-Read-Indexed.\n     if       fs-reply = 21\n              move  zero  to  c-check.\n*>\n     if       not  c-exists\n              go to  customer-Input.\n*>\n     if       delivery-tag = zero\t*> Only show delivery details if F8 pressed instead of\n       or     WS-Show-Delivery = \"N\"\t*> accept on cust no. input\n              go to  customer-setup.\n*>\n     move     \"D\"          to WS-Deliv-Key-Type.\n     move     WS-Sales-Key to WS-Deliv-Sales-Key.\n     perform  Delivery-Read-Indexed.\n     if       fs-reply = 21\n              move  zero  to  delivery-tag\n              go to  customer-setup.\n*>\n     move     deliv-address to address-A.\n*>\n     go       to customer-display.\n*>\n customer-setup.\n*>*************\n*>\n     move     sales-address  to  address-A.\n*>\n customer-display.\n*>****************\n*>\n     if       delivery-tag = zero\n              display sales-name at 0301 with foreground-color 3\n     else\n              display deliv-name at 0301 with foreground-color 3.\n*>\n     move     1  to  z.\n     unstring address-A  delimited  by  sl-delim into  address-line count z pointer  z.\n     display  address-line at 0401 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-A  delimited  by  sl-delim into  address-line count z pointer  z.\n     display  address-line at 0501 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-A  delimited  by  sl-delim into  address-line count z pointer  z.\n     display  address-line at 0601 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-A  delimited  by  sl-delim into  address-line count z pointer  z.\n     display  address-line at 0701 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-A into  address-line  pointer  z.\n     display  address-line at 0801 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n*>\n ref-Input.\n*>********\n*>\n     display  sih-ref at 0669 with foreground-color 3.\n     accept   sih-ref at 0669 with foreground-color 3 update.\n*>\n order-Input.\n*>**********\n*>\n     display  sih-order at 0769 with foreground-color 3.\n     accept   sih-order at 0769 with foreground-color 3 update.\n*>\n type-Input.\n*>*********\n*>\n     display  sih-type at 1007 with foreground-color 3.\n     accept   sih-type at 1007 with foreground-color 3 update.\n*>\n     if       sih-type = zero\n              go to Main-Exit.\n*>\n     if       sih-type  >  4 or < 1\n              go to  type-Input.\n*>\n     if       sih-type = 3\n              perform  cr-note\n              if  escape-code = \"Q\"\n                  go to  type-Input.\n*>\n     move     zero to z.\n*>\n     if       sih-type  >  2\n              go to  Main-Exit.\n*>\n*>  Type 2 (Account) only\n*>\n     move     zero  to  we-error.\n*>\n     subtract sales-unapplied from sales-current.\n*>\n     if       sales-current  >  zero\n              subtract sales-last-inv from run-date giving  work-1\n              if work-1  >  sales-credit\n              display \"Overdue Balance <<<\" at 1648 with foreground-color 2 highlight\n              move  999  to  we-error.\n*>\n     if       sales-current  >  sales-limit\n              display \"Balance Exceeds Credit Limit <<<\" at 1725 with foreground-color 2 highlight\n              move  998  to  we-error.\n*>\n     if       sales-credit not > zero\n          or  sales-limit  not > zero\n              display \"No Longer an Account Customer <<<\" at 1825 with foreground-color 2 highlight\n              move  997  to  we-error.\n*>\n     if       we-error = zero\n              go to  Main-Exit.\n*>\n     display  \">>> Warning! \" at 1635 with foreground-color 2 highlight.\n     display  \"**********************\" at 1958 with foreground-color 2\n     display  \"*\" at 2058 with foreground-color 2\n     display  \"*\" at 2158 with foreground-color 2\n     display  \"*\" at 2079 with foreground-color 2\n     display  \"*\" at 2179 with foreground-color 2\n     display  \"**********************\" at 2258 with foreground-color 2\n*>\n     display  \"None Zero or ESC To Abort\" at 2040 with foreground-color 2.\n     display  \"Return To Continue\" at 2140 with foreground-color 2.\n*>\n     move     zero to z.\n     accept   z at 2260 with foreground-color 3 update.\n     if       cob-crt-status = cob-scr-esc\n              move 1 to z   cob-crt-status.\n     go       to Main-Exit.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n cr-note             section.\n*>==========================\n*>\n*>  CRs are only processed against posted invoices, hence using OTM3.\n*>\n Main.\n     display  \" \" at 1201 with erase eol.\n     display  \" \" at 1301 with erase eol.\n     display  \" \" at 1401 with erase eol.\n     display  \" \" at 1501 with erase eol.\n     display  \" \" at 1601 with erase eol.\n*>\n Main-Input.\n*>*********\n*>\n     display  \"Invoice To Credit - [        ]\" at 1201 with foreground-color 2.\n*>\n     move     sih-cr to  WS-cr.\n*>\n     display  WS-cr at 1222 with foreground-color 3.\n     accept   WS-cr at 1222 with foreground-color 3 update.\n     if       cob-crt-status = cob-scr-esc\n              move \"Q\" to escape-code\n              go to Main-Exit.\n     move     WS-cr to sih-cr.\n     if       sih-cr = zero\n              move  \"Z\"  to  WS-named\n              go to  no-inv-restart\n     else\n              move  space to  WS-named.\n*>\n     if       sih-cr = 99999999\n              move \"Q\" to escape-code\n              go to Main-Exit\n     else\n              move space to escape-code.\n*>\n     move     sih-cr       to  oi3-invoice.     *> for ITM3\n     move     sih-customer to  oi3-customer.    *> for ITM3\n*>\n     move     1 to File-Key-No.\n     perform  OTM3-Read-Indexed.      *> Error cant find the invoice\n     if       fs-reply not = zero\n              display SL181 at line WS-23-lines col 01 with foreground-color 2 highlight\n              go to  Main.\n*>\n     display  space at line WS-23-lines col 01 with erase eol.\n     if       oi-type not = 2               *> Error can only credit Posted invoices\n              display SL184  at line WS-23-lines col 01 with foreground-color 2 highlight\n              go to Main-Input.\n*>\n     if       s-closed                  *> Error invoice is Paid\n              display SL182  at 1301  with foreground-color 2 highlight\n              go to Main-Input\n     else\n              display \" \" at line WS-23-lines col 01 with erase eol.\n*>\n     if       oi-hold-flag = \"Q\"        *> Warning Invoice has query flag set but we can continue\n              display SL183  at line WS-23-lines col 01  with foreground-color 2 highlight.\n*>\n     if       invoice-customer not = WS-Sales-Key\n              display SL193  at 1301 with foreground-color 4\n              go to Main-Input.\n*>\n     move     oi-date to u-bin.\n     add      1 oi-deduct-days to u-bin.\n     if       u-bin > sih-date\n              move \"A\" to WS-named.\n*>\n     add      oi-deduct-vat to oi-deduct-amt.\n     add      oi-extra oi-carriage oi-deduct-amt oi-net\n              oi-vat oi-c-vat oi-e-vat to oi-discount.\n     subtract oi-paid from oi-discount.\n*>\n     display  \"Amount O/S on Invoice is \" at 1401   with foreground-color 2.\n     move     oi-discount to display-9.\n     display  display-9 at 1426 with foreground-color 3.\n     move     oi-deduct-amt to display-8.\n     display  \"of which\" at 1437 with foreground-color 2.\n     display  display-8  at 1446 with foreground-color 3.\n     display  \"is Late Charges\" at 1456 with foreground-color 2.\n     if       WS-named = \"A\"\n              display SL185 at 1510 with foreground-color 2.\n     display  SL006  at 1626.\n     accept   WS-reply  at 1661.\n*>\n No-Inv-Restart.\n     perform  Main.       *> Clear screen lines 12 - 16\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n Program-Start section.\n*>====================\n*>\n     display  \" \" at 0101 with erase eos.\n     move     to-day to u-date WS-Test-Date.\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-15   *> Analysis\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    move 1 to WS-Process-Func WS-Sub-Function\n                    call \"sl070\" using WS-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15       *> Only if the call failed for some unknown reason\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display SL186   at 2301\n                          display SL003   at 2401\n                          accept WS-reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n*> Create Invoice & ITM3 files if do not exist but as requested Amend invoices, it should be !\n*>    JIC\n*>\n     if       FS-Cobol-Files-Used             *> create invoice if not exist.\n              call  \"CBL_CHECK_FILE_EXIST\" using File-16      *> Invoice\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    perform  Invoice-Open-Output\n                    perform  Invoice-Close\n              end-if\n              call  \"CBL_CHECK_FILE_EXIST\" using File-19      *> create ITM3 if not exist\n                                                 File-Info\n              if    return-code not = zero        *> not = zero - No file found\n                    perform OTM3-Open-Output\n                    perform OTM3-Close\n              end-if\n     end-if\n*>\n*> if linked open Stock & Audit file\n*>\n     if       SL-Stock-Link = \"Y\"\n       if     FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-11           *> Stock\n                                                 File-Info\n              end-call\n              if    return-code not = zero          *> not = zero - No file found\n                    perform Stock-Open-Output\n                    perform Stock-Close\n              end-if\n              perform Stock-Open      *> Thats ok we just wont find any items!\n              if     Stk-Audit-Used = 1\n                     call  \"CBL_CHECK_FILE_EXIST\" using File-10    *> Stock-Audit\n                                                        File-Info\n                     end-call\n                     if    return-code not = zero          *> not = zero - No file found\n                           perform Stock-Audit-Open-Output\n                     else\n                           perform Stock-Audit-Open-Extend\n                     end-if\n              end-if\n       end-if\n     end-if\n*>\n*>\n*> Made sure needed files exist although most should be present but - JIC so open files/tables.\n*>\n     perform  Invoice-Open.\n     perform  OTM3-Open-Input.     *> .12 for ITM3 support in Cr notes.\n*>\n     perform  Sales-Open-Input.\n     perform  Delivery-Open-Input.\n     perform  Analysis-Open-Input.\n*>\n Menu-Return.\n*>**********\n*>\n     move     zero  to  menu-reply.\n*>\n Main-Exit.   exit section.\n*>********    ****\n*>\n Display-Outline-1       section.\n*>==============================\n*>\n     add      1  to  i.\n     move     1 to cole.\n     display  \"(\" at curs with erase eol foreground-color 2.\n     move     2 to cole.\n     display  I at curs with foreground-color 2.\n     move     4 to cole.\n     display  \") [  ]\" at curs with foreground-color 2.\n     move     36 to cole.\n     display  \"[          ] [ ]   {         } (\" at curs with foreground-color 2.\n     move     78 to cole.\n     display  \")\" at curs with foreground-color 2.\n*>\n Main-Exit52a. exit section.\n*>***********  ************\n*>\n Display-Outline-2       section.\n*>===============================\n*>\n     add      1  to  i.\n     move     1 to cole.\n     if       SL-Stock-Link = \"N\"\t\t*> No stock",
        "line": 1337
      },
      {
        "type": "IF",
        "condition": "valid date\n*>\n     move     WS-Test-Date to WS-date.\n     if       Date-Form = zero\n              move WS-Month to WS-Inv-Month    *> done again for UK - but JIC\n              move 1 to Date-Form.\n     if       Date-UK\n              move WS-Month to WS-Inv-Month\n              go to zz050-Test-Date.\n     if       Date-USA                *> swap month and days\n              move WS-days to WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              move WS-Month to WS-Inv-Month\n              go to zz050-Test-Date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to WS-date.  *> swap Intl to UK form\n     move     WS-Test-Date (1:4) to WS-Year.\n     move     WS-Test-Date (6:2) to WS-Month.\n     move     WS-Month           to WS-Inv-Month\n     move     WS-Test-Date (9:2) to WS-Days.\n*>\n zz050-Test-Date.\n     move     WS-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  WS-date as uk/US/Inlt date format\n*>          u-date & WS-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to WS-Date\n              go to zz060-Exit.\n     move     u-date to WS-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move WS-days to WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to WS-date.  *> swap Intl to UK form\n     move     u-date (7:4) to WS-Intl-Year.\n     move     u-date (4:2) to WS-Intl-Month.\n     move     u-date (1:2) to WS-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  WS-date as uk/US/Inlt date format\n*>\n     move     to-day to WS-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move WS-days to WS-swap\n              move WS-month to WS-days\n              move WS-swap to WS-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to WS-date.  *> swap Intl to UK form\n     move     to-day (7:4) to WS-Intl-Year.\n     move     to-day (4:2) to WS-Intl-Month.\n     move     to-day (1:2) to WS-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".",
        "line": 2348
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 19,
    "cognitive": 9,
    "halstead": {
      "uniqueOperators": 2,
      "uniqueOperands": 224,
      "totalOperators": 229,
      "totalOperands": 446,
      "vocabulary": 226,
      "length": 675,
      "volume": 5278.620799630252
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
