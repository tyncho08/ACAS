{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl910.cbl",
  "fileName": "pl910.cbl",
  "timestamp": "2025-09-15T16:25:46.686Z",
  "programId": "pl910",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 103
      },
      {
        "name": "file",
        "line": 117
      },
      {
        "name": "working-storage",
        "line": 124
      },
      {
        "name": "linkage",
        "line": 276
      },
      {
        "name": "init",
        "line": 290
      },
      {
        "name": "Payment-Gen",
        "line": 326
      },
      {
        "name": "Headings",
        "line": 532
      },
      {
        "name": "zz050-Validate-Date",
        "line": 556
      },
      {
        "name": "exit",
        "line": 589
      },
      {
        "name": "zz060-Convert-Date",
        "line": 591
      },
      {
        "name": "exit",
        "line": 624
      },
      {
        "name": "zz070-Convert-Date",
        "line": 626
      },
      {
        "name": "exit",
        "line": 654
      },
      {
        "name": "maps04",
        "line": 656
      },
      {
        "name": "exit",
        "line": 662
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 106
      },
      {
        "name": "file-defs",
        "line": 287
      },
      {
        "name": "Menu-Exit",
        "line": 322
      },
      {
        "name": "Read-Purchase",
        "line": 356
      },
      {
        "name": "pay-supl-key",
        "line": 368
      },
      {
        "name": "Read-Open-Item",
        "line": 383
      },
      {
        "name": "End-Statement",
        "line": 495
      },
      {
        "name": "ES-Exit",
        "line": 511
      },
      {
        "name": "Main-End",
        "line": 514
      },
      {
        "name": "zz050-test-date",
        "line": 583
      },
      {
        "name": "zz050-exit",
        "line": 588
      },
      {
        "name": "zz060-Exit",
        "line": 623
      },
      {
        "name": "zz070-Exit",
        "line": 653
      },
      {
        "name": "maps04-exit",
        "line": 661
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "SYSTEM",
        "line": 528,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "maps04",
        "line": 659,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 93,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 102,
        "replacing": null
      },
      {
        "name": "selpl",
        "line": 109,
        "replacing": null
      },
      {
        "name": "seloi5",
        "line": 110,
        "replacing": null
      },
      {
        "name": "selpay",
        "line": 111,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 112,
        "replacing": null
      },
      {
        "name": "fdpl",
        "line": 120,
        "replacing": null
      },
      {
        "name": "fdoi5",
        "line": 121,
        "replacing": null
      },
      {
        "name": "fdpay",
        "line": 122,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 123,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 127,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 128,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 129,
        "replacing": null
      },
      {
        "name": "plwsoi",
        "line": 130,
        "replacing": null
      },
      {
        "name": "wspl",
        "line": 134,
        "replacing": null
      },
      {
        "name": "plwsoi5B",
        "line": 135,
        "replacing": null
      },
      {
        "name": "plwspay",
        "line": 136,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 164,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 279,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 280,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 281,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 664,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 293
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 318
      },
      {
        "target": "Payment-Gen",
        "thru": null,
        "line": 320
      },
      {
        "target": "Purch-Open-Input",
        "thru": null,
        "line": 329
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 334
      },
      {
        "target": "OTM5-Open-Input",
        "thru": null,
        "line": 337
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 342
      },
      {
        "target": "Payments-Open-Output",
        "thru": null,
        "line": 346
      },
      {
        "target": "Payments-Close",
        "thru": null,
        "line": 351
      },
      {
        "target": "Headings",
        "thru": null,
        "line": 354
      },
      {
        "target": "Purch-Read-Next",
        "thru": null,
        "line": 357
      },
      {
        "target": "OTM5-Start",
        "thru": null,
        "line": 381
      },
      {
        "target": "OTM5-Read-Next",
        "thru": null,
        "line": 384
      },
      {
        "target": "end-statement",
        "thru": null,
        "line": 386
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 408
      },
      {
        "target": "Headings",
        "thru": null,
        "line": 476
      },
      {
        "target": "Payments-Write",
        "thru": null,
        "line": 487
      },
      {
        "target": "Payments-Write",
        "thru": null,
        "line": 498
      },
      {
        "target": "Headings",
        "thru": null,
        "line": 502
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 525
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 526
      },
      {
        "target": "Payments-Close",
        "thru": null,
        "line": 527
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 586
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 600
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "References",
        "to": "Last-Read;Not Needed",
        "line": 44
      },
      {
        "from": "prog-name",
        "to": "l1-prog",
        "line": 291
      },
      {
        "from": "usera",
        "to": "l2-user",
        "line": 292
      },
      {
        "from": "ws-date",
        "to": "l1-date",
        "line": 294
      },
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 298
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 299
      },
      {
        "from": "Age-To-Pay",
        "to": "WS-Age-To-Pay",
        "line": 305
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 308
      },
      {
        "from": "ws-Age-To-Pay",
        "to": "Age-To-Pay",
        "line": 314
      },
      {
        "from": "To-Be-Paid",
        "to": "u-bin",
        "line": 317
      },
      {
        "from": "ws-date",
        "to": "l1-prior-date",
        "line": 319
      },
      {
        "from": "zero",
        "to": "oi5-invoice",
        "line": 365
      },
      {
        "from": "WS-Purch-Key",
        "to": "oi5-supplier\n                                l5-key\n                                pay-supl-key",
        "line": 366
      },
      {
        "from": "1",
        "to": "pay-nos",
        "line": 369
      },
      {
        "from": "u-bin",
        "to": "pay-date",
        "line": 370
      },
      {
        "from": "purch-name",
        "to": "l5-supplier",
        "line": 371
      },
      {
        "from": "purch-sortcode",
        "to": "pay-sortcode\n              move purch-accountno to pay-account\n              move \"B\" to l5-method\n     else\n              move \"C\" to l5-method\n     end-if\n     move     1  to  a",
        "line": 373
      },
      {
        "from": "open-item-record-5",
        "to": "oi-header",
        "line": 389
      },
      {
        "from": "oi-invoice",
        "to": "l5-folio  pay-folio (a)",
        "line": 406
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 407
      },
      {
        "from": "ws-date",
        "to": "l5-date",
        "line": 409
      },
      {
        "from": "oi-ref",
        "to": "l5-invoice  pay-invoice (a)",
        "line": 411
      },
      {
        "from": "oi-deduct-amt",
        "to": "pay-deduct (a)\n              if   amount-out = zero\n                   go to Read-Open-Item\n              else\n               if   amount-out < zero\n                    display PL901 at 2301 with foreground-color 4\n                    accept ws-reply at 2346\n                    go to Read-Open-Item",
        "line": 429
      },
      {
        "from": "amount-out",
        "to": "pay-value (a)",
        "line": 443
      },
      {
        "from": "0",
        "to": "pay-period (a)\n     else\n      if      work-1  <  60\n              add  amount-out  to  bal-30\n              move  30  to  pay-period (a)\n      else\n       if     work-1  <  90\n              move  60  to  pay-period (a)\n              add  amount-out  to  bal-60\n       else\n              move  90  to  pay-period (a)\n              add  amount-out  to  bal-90",
        "line": 446
      },
      {
        "from": "zero",
        "to": "amount-out",
        "line": 460
      },
      {
        "from": "bal-0",
        "to": "l5-0",
        "line": 462
      },
      {
        "from": "bal-30",
        "to": "l5-30",
        "line": 463
      },
      {
        "from": "bal-60",
        "to": "l5-60",
        "line": 464
      },
      {
        "from": "bal-90",
        "to": "l5-90",
        "line": 465
      },
      {
        "from": "bal-t",
        "to": "l5-pay  pay-gross",
        "line": 466
      },
      {
        "from": "zero",
        "to": "bal-0  bal-30  bal-60  bal-90",
        "line": 478
      },
      {
        "from": "space",
        "to": "l5-key  l5-supplier",
        "line": 479
      },
      {
        "from": "1",
        "to": "a\n              move \"C\" to pay-cont\n              perform Payments-Write  *> write pay-record\n              move zero to pay-gross\n              add 1 to pay-nos",
        "line": 485
      },
      {
        "from": "1",
        "to": "a",
        "line": 499
      },
      {
        "from": "spaces",
        "to": "print-record\n*>              write print-record after 1",
        "line": 506
      },
      {
        "from": "zero",
        "to": "bal-t",
        "line": 509
      },
      {
        "from": "tot-0",
        "to": "l6-0",
        "line": 516
      },
      {
        "from": "tot-30",
        "to": "l6-30",
        "line": 517
      },
      {
        "from": "tot-60",
        "to": "l6-60",
        "line": 518
      },
      {
        "from": "tot-90",
        "to": "l6-90",
        "line": 519
      },
      {
        "from": "p",
        "to": "l3-page",
        "line": 538
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record from line-4 after 1",
        "line": 543
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 550
      },
      {
        "from": "5",
        "to": "Line-Cnt",
        "line": 552
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 565
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 567
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 571
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 578
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 584
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 585
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 602
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 604
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 607
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 611
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 618
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 634
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 637
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 641
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 648
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n*> copy \"selpl.cob\".\n*> copy \"seloi5.cob\".\n*> copy \"selpay.cob\".\n copy \"selprint.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdpl.cob\".\n*> copy \"fdoi5.cob\".\n*> copy \"fdpay.cob\".\n copy \"fdprint.cob\".\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"PL910 (3.02.13)\".\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n copy \"plwsoi.cob\".\n*>\n*> Ex FDs\n*>\n copy \"wspl.cob\".     *> WS-Purch-Record.\n copy \"plwsoi5B.cob\".  *> Open-Item-Record-5.\n copy \"plwspay.cob\".  *> Pay-Record.\n 01  WS-Pay-Record  redefines Pay-Record.\n     03  filler     pic x(238).\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n*>     03  WS-Purch-Record        pic x.\n*>     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n*>     03  WS-OTM5-Record         pic x.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  ws-data.\n     03  To-Be-Paid      binary-long             value zero.\n     03  ws-Age-To-Pay   pic 99                  value zero.\n     03  ws-reply        pic x.\n     03  a               pic 99                  value zero.\n     03  work-1          pic s9(6)v99    comp-3  value zero.\n     03  p               pic 99                  value zero.\n     03  inv-amount      pic s9(7)v99    comp-3  value zero.\n     03  amount-out      pic s9(7)v99    comp-3  value zero.\n     03  Line-Cnt        binary-char             value 90.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n     03  SY008           pic x(39) value \"SY008 Note message & Hit return to Quit\".\n*>     03  PL005          pic x(18) value \"PL005 Invalid Date\".\n*> Module specific\n     03  PL901          pic x(42) value \"PL901 PE 910-01 LOGIC: Note and hit return\".\n     03  PL902          pic x(31) value \"PL902 Purchase Ledger not Found\".\n     03  PL903          pic x(33) value \"PL903 Purchase OTM file not Found\".\n     03  PL904          pic x(32) value \"PL904 Payment file Error on Open\".\n*>\n 01  balances.\n     03  bal-0           pic 9(7)v99 value zero.\n     03  bal-30          pic 9(7)v99 value zero.\n     03  bal-60          pic 9(7)v99 value zero.\n     03  bal-90          pic 9(7)v99 value zero.\n     03  bal-t           pic 9(7)v99 value zero.\n     03  tot-0           pic 9(7)v99 value zero.\n     03  tot-30          pic 9(7)v99 value zero.\n     03  tot-60          pic 9(7)v99 value zero.\n     03  tot-90          pic 9(7)v99 value zero.\n     03  tot-t           pic 9(7)v99 value zero.\n*>\n 01  line-1.\n     03  l1-prog         pic x(54)       value spaces.\n     03  filler          pic x(22)       value \"Payments Due Report\".\n     03  filler          pic x(14)        value \"= or Prior To\".\n     03  l1-prior-date   pic x(10).\n     03  filler          pic x(24)       value spaces.\n     03  filler          pic x(5)        value \"Page \".\n     03  l3-page         pic zz9.\n*>\n 01  line-2.\n     03  l2-user         pic x(56)       value spaces.\n     03  filler          pic x(19)       value spaces.\n     03  filler          pic x(47)       value spaces.\n     03  l1-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(38)     value \" Number   Supplier\".\n     03  filler          pic x(94)     value\n         \"Folio M   Date       Invoice      Current       30 +  \" &\n         \"      60 +        90 +      Total to Pay\".\n*>\n 01  line-5.\n     03  l5-key          pic x(10).\n     03  l5-supplier     pic x(25).\n     03  l5-folio        pic z(7)9b.\n     03  l5-method       pic xb          value space.\n     03  l5-date         pic x(12).\n     03  l5-invoice      pic x(11).\n     03  l5-0            pic z(6)9.99cr  blank when zero.\n     03  l5-30           pic z(6)9.99cr  blank when zero.\n     03  l5-60           pic z(6)9.99cr  blank when zero.\n     03  l5-90           pic z(6)9.99cr  blank when zero.\n     03  filler          pic xxxx        value spaces.\n     03  l5-pay          pic z(6)9.99    blank when zero.\n*>\n 01  line-6.\n     03  filler          pic x(69)       value \"    Total\".\n     03  l6-0            pic z(6)9.99cr  blank when zero.\n     03  l6-30           pic z(6)9.99cr  blank when zero.\n     03  l6-60           pic z(6)9.99cr  blank when zero.\n     03  l6-90           pic z(6)9.99cr  blank when zero.\n     03  filler          pic xxxx        value spaces.\n     03  l6-pay          pic z(6)9.99    blank when zero.\n*>\n 01  line-7.\n     03  filler          pic x(69)       value spaces.\n     03  filler          pic x(12)       value \"  --------  \".\n     03  filler          pic x(12)       value \"  --------  \".\n     03  filler          pic x(12)       value \"  --------  \".\n     03  filler          pic x(12)       value \"  --------  \".\n     03  filler          pic x(4)        value spaces.\n     03  filler          pic x(12)       value \"  ========\".\n*>\n linkage section.\n*>==============\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n 01  to-day              pic x(10).\n*>\n procedure  division using ws-calling-data\n                           system-record\n                           to-day\n                           file-defs.\n*>========================================\n*>\n init section.\n     move     prog-name to l1-prog.\n     move     usera to  l2-user.\n     perform  zz070-Convert-Date.\n     move     ws-date to l1-date.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n     move     Print-Spool-Name to PSN.\n     move     1 to File-Key-No.  *> Good for all files/tables used here.\n*>\n     display  Prog-Name at 0101 with foreground-color 2 erase eos.\n     display  \"Payments Due Reporting\" at 0130       with foreground-color 2.\n     display  ws-date at 0171 with foreground-color 2.\n     display  \"Current Age to Pay on is - [  ]\" at 0501 with foreground-color 2.\n     move     Age-To-Pay to WS-Age-To-Pay.\n     display  ws-Age-To-Pay at 0529 with foreground-color 3.\n     display  \"is this correct (Y/N) ?  - [ ]\" at 0701  with foreground-color 2.\n     move     \"Y\"  to  ws-reply.\n     accept   ws-reply at 0729 with foreground-color 6.\n     move     function upper-case (ws-reply) to ws-reply.\n*>\n     if       ws-reply = \"N\"\n              accept ws-Age-To-Pay at 0529 with foreground-color 3 UPDATE\n              move ws-Age-To-Pay to Age-To-Pay.\n*>\n     subtract Age-To-Pay  from  Run-Date  giving  To-Be-Paid.\n     move     To-Be-Paid to u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date to l1-prior-date.\n     perform  Payment-Gen.\n*>\n Menu-Exit.\n*>\n     exit     program.\n*>\n Payment-Gen   section.\n*>====================\n*>\n     perform  Purch-Open-Input.  *> open input purchase-file open-item-file-5.\n     if       FS-Reply not = zeros\n              display  PL902 at 0701 with foreground-color 2\n              display  SY008 at 0801 with foreground-color 2\n              accept   WS-Reply at 0841\n              perform  Purch-Close\n              go to Main-Exit\n     end-if\n     perform  OTM5-Open-Input.\n     if       FS-Reply not = zeros\n              display  PL903 at 0701 with foreground-color 2\n              display  SY008 at 0801 with foreground-color 2\n              accept   WS-Reply at 0841\n              perform  OTM5-Close\n              go to Main-Exit\n     end-if\n     open     output print-file.  *> pay-file.\n     perform  Payments-Open-Output.\n     if       FS-Reply not = zeros\n              display  PL904 at 0701 with foreground-color 2\n              display  SY008 at 0801 with foreground-color 2\n              accept   WS-Reply at 0841\n              perform  Payments-Close\n              go to Main-Exit\n     end-if\n     perform  Headings.\n*>\n Read-Purchase.\n     perform  Purch-Read-Next. *>  read purchase-file  next  record at end\n     if       fs-reply = 10\n              go to  main-end.\n*>\n     if       purch-current not > zero\n              go to Read-Purchase.\n*>\n     initialize pay-record.\n     move     zero          to  oi5-invoice.\n     move     WS-Purch-Key  to  oi5-supplier\n                                l5-key\n                                pay-supl-key.\n     move     1  to  pay-nos.\n     move     u-bin  to  pay-date.\n     move     purch-name to  l5-supplier.\n     if       purch-sortcode not = zero\n              move purch-sortcode  to pay-sortcode\n              move purch-accountno to pay-account\n              move \"B\" to l5-method\n     else\n              move \"C\" to l5-method\n     end-if\n     move     1  to  a.\n     set      fn-not-less-than to true.\n     perform  OTM5-Start.   *> start open-item-file-5 key not < oi5-key.\n*>\n Read-Open-Item.\n     perform  OTM5-Read-Next.  *> read open-item-file-5 next record at end\n     if       fs-reply = 10\n              perform end-statement\n              go to main-end.\n*>\n     move     open-item-record-5  to  oi-header.\n     if       s-closed\n         or   payment-held\n         or   oi-b-nos not = zero\n              go to Read-Open-Item.\n*>\n     if       oi-supplier not =  WS-Purch-Key\n              go to  end-statement.\n*>\n*> O-I transaction is for this Supplier.\n*>\n     if       oi-type not = 2\n              go to  Read-Open-Item.\n*>\n     if       oi-date  >  To-Be-Paid\n              go to  Read-Open-Item.\n*>\n     move     oi-invoice  to  l5-folio  pay-folio (a).\n     move     oi-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date   to  l5-date.\n*>\n     move     oi-ref to  l5-invoice  pay-invoice (a).\n*>\n*> invoices only here\n*>\n     add      oi-net oi-carriage oi-vat oi-c-vat giving inv-amount.\n     subtract oi-paid  from  inv-amount          giving amount-out.\n*>\n     if       amount-out = zero\n              go to Read-Open-Item.\n*>\n*> ie no. of days o/s.\n*>\n     subtract oi-date  from  Run-Date  giving  work-1.\n*>\n*>  Are we in time to take prompt pay discount ?\n*>\n     if       oi-deduct-days not < work-1\n              subtract oi-deduct-amt from amount-out\n              move oi-deduct-amt to pay-deduct (a)\n              if   amount-out = zero\n                   go to Read-Open-Item\n              else\n               if   amount-out < zero\n                    display PL901 at 2301 with foreground-color 4\n                    accept ws-reply at 2346\n                    go to Read-Open-Item.\n*>\n*>  Above 2 lines checks for overpayment last time run ???\n*>    this should Never Ever happen...... otherwise a bug\n*>\n*> now work out ageing\n*>\n     move     amount-out  to  pay-value (a).\n     if       work-1  <  30\n              add  amount-out  to  bal-0\n              move  0  to  pay-period (a)\n     else\n      if      work-1  <  60\n              add  amount-out  to  bal-30\n              move  30  to  pay-period (a)\n      else\n       if     work-1  <  90\n              move  60  to  pay-period (a)\n              add  amount-out  to  bal-60\n       else\n              move  90  to  pay-period (a)\n              add  amount-out  to  bal-90.\n*>\n     add      amount-out  to  bal-t.\n     move     zero  to  amount-out.\n*>\n     move     bal-0  to  l5-0.\n     move     bal-30 to  l5-30.\n     move     bal-60 to  l5-60.\n     move     bal-90 to  l5-90.\n     move     bal-t  to  l5-pay  pay-gross.\n*>\n     add      bal-0  to  tot-0.\n     add      bal-30 to  tot-30.\n     add      bal-60 to  tot-60.\n     add      bal-90 to  tot-90.\n*>\n     write    print-record  from  line-5 after 1.\n     add      1 to Line-Cnt.\n     if       Line-Cnt > Page-Lines\n              perform Headings.\n*>\n     move     zero  to  bal-0  bal-30  bal-60  bal-90.\n     move     space to  l5-key  l5-supplier.\n*>\n*> now loop back for next item....\n*>\n     add      1  to  a.\n     if       a  >  9\n              move  1  to  a\n              move \"C\" to pay-cont\n              perform Payments-Write  *> write pay-record\n              move zero to pay-gross\n              add 1 to pay-nos.\n*>\n     go       to Read-Open-Item.\n*>\n*> can only get here at the end of a statement.\n*>\n End-Statement.\n*>\n     if       a not = 1\n              perform Payments-Write  *> write pay-record\n              move  1  to  a.\n*>\n     if       Line-Cnt > Page-Lines\n              perform Headings.\n*>     else\n*>        if    bal-t not = zero\n*>              add 1 to Line-Cnt\n*>              move spaces  to  print-record\n*>              write print-record after 1.\n*>\n     move     zero to bal-t.\n*>\n ES-Exit.\n     go       to Read-Purchase.\n*>\n Main-End.\n*>\n     move     tot-0  to  l6-0.\n     move     tot-30 to  l6-30.\n     move     tot-60 to  l6-60.\n     move     tot-90 to  l6-90.\n     add      tot-0 tot-30 tot-60 tot-90 giving l6-pay.\n*>\n     write    print-record from line-7 after 1.\n     write    print-record from line-6 after 1.\n     close    print-file.    *> open-item-file-5 purchase-file pay-file.\n     perform  OTM5-Close.\n     perform  Purch-Close.\n     perform  Payments-Close.\n     call     \"SYSTEM\" using Print-Report.\n*>\n Main-Exit.   exit section.\n*>\n Headings     section.\n*>===================\n*>\n     if       Page-Lines > Line-Cnt\n              go to Main-Exit.             *> 01/09/25 page cnt started at 2.\n     add      1  to  p.\n     move     p  to  l3-page.\n*>\n     if       p not = 1\n              write print-record from line-1 after page\n              write print-record from line-2 after 1\n              move  spaces to print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record from line-4 after 1.\n     move     spaces  to  print-record.\n     write    print-record  after 1.\n     move     5 to Line-Cnt.\n*>\n main-exit.   exit section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 90
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 4,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 86,
      "totalOperators": 60,
      "totalOperands": 120,
      "vocabulary": 87,
      "length": 180,
      "volume": 1159.729829252771
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
