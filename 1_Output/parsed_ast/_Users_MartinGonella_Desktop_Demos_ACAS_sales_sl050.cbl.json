{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl050.cbl",
  "fileName": "sl050.cbl",
  "timestamp": "2025-09-15T16:25:30.707Z",
  "programId": "sl050",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 124
      },
      {
        "name": "file",
        "line": 136
      },
      {
        "name": "working-storage",
        "line": 140
      },
      {
        "name": "linkage",
        "line": 386
      },
      {
        "name": "init01",
        "line": 400
      },
      {
        "name": "Headings-1",
        "line": 624
      },
      {
        "name": "Analysis-Print",
        "line": 644
      },
      {
        "name": "extra-analysis",
        "line": 689
      },
      {
        "name": "zz060-Convert-Date",
        "line": 718
      },
      {
        "name": "zz070-Convert-Date",
        "line": 752
      },
      {
        "name": "maps04",
        "line": 781
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 128
      },
      {
        "name": "file-defs",
        "line": 397
      },
      {
        "name": "Menu-Return",
        "line": 413
      },
      {
        "name": "Get-Invoice-Record",
        "line": 442
      },
      {
        "name": "Main-End",
        "line": 560
      },
      {
        "name": "Main12",
        "line": 627
      },
      {
        "name": "Cont-HDs",
        "line": 638
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 419,
        "type": "DYNAMIC",
        "using": [
          "File-16",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "SL120",
          "at",
          "0501",
          "with",
          "foreground-color",
          "4",
          "if",
          "WS-Caller",
          "not",
          "=",
          "\"xl150\"",
          "*>",
          "Might",
          "be",
          "called",
          "by",
          "XL150",
          "EOC",
          "(End",
          "of",
          "Cycle)",
          "accept",
          "ws-reply",
          "at",
          "0563",
          "with",
          "foreground-color",
          "6",
          "end-if",
          "goback"
        ]
      },
      {
        "target": "SYSTEM",
        "line": 620,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "maps04",
        "line": 784,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 114,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 123,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 131,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 139,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 143,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 144,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 145,
        "replacing": null
      },
      {
        "name": "slwsinv2",
        "line": 239,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 242,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 384,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 389,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 390,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 391,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 788,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "4",
        "thru": null,
        "line": 403
      },
      {
        "target": "*>",
        "thru": null,
        "line": 406
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 409
      },
      {
        "target": "Sales-Open-Input",
        "thru": null,
        "line": 428
      },
      {
        "target": "headings-1",
        "thru": null,
        "line": 439
      },
      {
        "target": "Invoice-Open-Input",
        "thru": null,
        "line": 440
      },
      {
        "target": "Invoice-Read-Next",
        "thru": null,
        "line": 443
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 456
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 468
      },
      {
        "target": "headings-1",
        "thru": null,
        "line": 549
      },
      {
        "target": "Analysis-Print",
        "thru": null,
        "line": 556
      },
      {
        "target": "Extra-Analysis",
        "thru": null,
        "line": 557
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 561
      },
      {
        "target": "Invoice-Close",
        "thru": null,
        "line": 562
      },
      {
        "target": "main12",
        "thru": null,
        "line": 568
      },
      {
        "target": "4",
        "thru": null,
        "line": 574
      },
      {
        "target": "*>",
        "thru": null,
        "line": 585
      },
      {
        "target": "above",
        "thru": null,
        "line": 595
      },
      {
        "target": "3",
        "thru": null,
        "line": 596
      },
      {
        "target": "if",
        "thru": null,
        "line": 605
      },
      {
        "target": "2",
        "thru": null,
        "line": 608
      },
      {
        "target": "end-if",
        "thru": null,
        "line": 617
      },
      {
        "target": "Invoice-Read-Next",
        "thru": null,
        "line": 649
      },
      {
        "target": "headings-1",
        "thru": null,
        "line": 665
      },
      {
        "target": "headings-1",
        "thru": null,
        "line": 693
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 727
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 401
      },
      {
        "from": "zero",
        "to": "a",
        "line": 402
      },
      {
        "from": "prog-name",
        "to": "l1-version",
        "line": 408
      },
      {
        "from": "ws-date",
        "to": "l1-date",
        "line": 410
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 411
      },
      {
        "from": "zero",
        "to": "j",
        "line": 438
      },
      {
        "from": "zero",
        "to": "l",
        "line": 452
      },
      {
        "from": "ih-customer",
        "to": "ws-Sales-Key  l5-cust",
        "line": 453
      },
      {
        "from": "space",
        "to": "ws-reply",
        "line": 454
      },
      {
        "from": "\"X\"",
        "to": "ws-reply",
        "line": 458
      },
      {
        "from": "1",
        "to": "ws-error\n     else\n              move sales-name  to  l5-name",
        "line": 462
      },
      {
        "from": "ih-invoice",
        "to": "l5-nos",
        "line": 466
      },
      {
        "from": "ih-date",
        "to": "u-bin",
        "line": 467
      },
      {
        "from": "ws-date",
        "to": "l5-date",
        "line": 469
      },
      {
        "from": "ih-deduct-amt",
        "to": "ws-deduct-amt",
        "line": 471
      },
      {
        "from": "ih-deduct-vat",
        "to": "ws-deduct-vat",
        "line": 472
      },
      {
        "from": "spaces",
        "to": "lb-a  lb-code\n              move  zero    to  lb-amount ws-deduct-amt\n     else\n              move  \"Late Charge \"  to  lb-a\n              move  spaces          to  lb-code\n              move  ws-deduct-amt   to  lb-amount",
        "line": 486
      },
      {
        "from": "spaces",
        "to": "lc-a  lc-code  lc-c\n              move  zero    to  lc-amount  lc-vat ih-discount\n     else\n              move  \"Discount    \"  to lc-a\n              move  spaces          to lc-code  lc-c\n              move  ih-discount     to lc-amount\n              move  zero            to lc-vat",
        "line": 494
      },
      {
        "from": "spaces",
        "to": "ld-a  ld-code  ld-c\n              move  zero    to  ld-amount  ld-vat ih-Carriage\n     else\n              move  \"Carriage    \"  to  ld-a\n              move  spaces          to  ld-code  ld-c\n              move  ih-carriage     to  ld-amount\n              if    ih-c-vat = zero\n                    move  zero  to  ld-vat\n              else\n                    move  1  to  ld-vat",
        "line": 503
      },
      {
        "from": "spaces",
        "to": "le-a  le-code  le-c\n              move  zero    to  le-amount  le-vat ih-Extra\n     else\n              move  extra-desc to  le-a\n              move  spaces     to  le-code\n              move  ih-extra  to  le-amount\n              if    ih-e-vat = zero\n                    move  zero to  le-vat\n              else\n                    move  1  to  le-vat",
        "line": 515
      },
      {
        "from": "ih-Type",
        "to": "a\n              move     ws-lit (a) to L5-Type",
        "line": 527
      },
      {
        "from": "ih-net",
        "to": "l5-goods",
        "line": 532
      },
      {
        "from": "zero",
        "to": "fs-Reply",
        "line": 554
      },
      {
        "from": "ih-Lines",
        "to": "WS-Lines",
        "line": 555
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 3\n     else\n              perform  main12\n     end-if\n     write    print-record from line-7 after 2",
        "line": 565
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 571
      },
      {
        "from": "zero",
        "to": "a",
        "line": 573
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 593
      },
      {
        "from": "zero",
        "to": "i",
        "line": 595
      },
      {
        "from": "i",
        "to": "l8-vat-code\n              move  vat-rate (i) to l8-vat-rate\n              move  total-cvat (1, i) to l8-amount1\n              move  total-cvat (2, i) to l8-amount2\n              move  total-cvat (3, i) to l8-amount3\n              move  total-cvat (4, i) to l8-amount4\n              write print-record from line-8 after 1\n     end-perform\n     if       Vat-Rate (4) not = zero    *> test if local tax in use & print if so\n         or   Vat-Rate (5) not = zero    *> Both - Not used in the UK (so far)\n              perform  2 times\n                       add   1 to i\n                       move  i to l8-vat-code\n                       move  vat-rate (i) to l8-vat-rate\n                       move  total-cvat (1, i) to l8-amount1\n                       move  total-cvat (2, i) to l8-amount2\n                       move  total-cvat (3, i) to l8-amount3\n                       move  total-cvat (4, i) to l8-amount4\n                       write print-record from line-8 after 1\n              end-perform\n     end-if\n     close    print-file",
        "line": 598
      },
      {
        "from": "j",
        "to": "l3-page",
        "line": 629
      },
      {
        "from": "usera",
        "to": "l3-user",
        "line": 631
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 641
      },
      {
        "from": "5",
        "to": "line-cnt",
        "line": 642
      },
      {
        "from": "99",
        "to": "fs-Reply\t\t*> Just in case\n              go to Main-Exit",
        "line": 651
      },
      {
        "from": "il-product",
        "to": "test-product",
        "line": 654
      },
      {
        "from": "spaces",
        "to": "Line-5B\n              move     il-Description to L5B-Item-Desc\n              move     il-Vat-Code    to L5B-Vat-Code\n              move     il-pa          to L5B-pa\n              move     il-net         to l5B-goods\n              move     il-Net         to L5B-Net\n              move     il-Vat         to L5B-Vat\n              add      il-Net il-Vat giving L5B-Gross\n              write    print-record from line-5B after 1\n              add      1 to line-cnt",
        "line": 667
      },
      {
        "from": "il-pa",
        "to": "la-code",
        "line": 678
      },
      {
        "from": "il-net",
        "to": "la-amount",
        "line": 679
      },
      {
        "from": "il-vat-code",
        "to": "la-vat k",
        "line": 680
      },
      {
        "from": "spaces",
        "to": "la-a  la-b  la-c",
        "line": 684
      },
      {
        "from": "spaces",
        "to": "lb-a",
        "line": 698
      },
      {
        "from": "spaces",
        "to": "lc-a",
        "line": 703
      },
      {
        "from": "spaces",
        "to": "ld-a",
        "line": 708
      },
      {
        "from": "spaces",
        "to": "le-a",
        "line": 713
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 729
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 731
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 734
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 738
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 745
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 760
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 763
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 767
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 774
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "Rec Missing.\n*> 22/10/83 Vbc - Conversion To Cis Cobol.\n*> 11/05/84 Vbc - Report On Vat Codes.\n*> 03/03/09 vbc - Migration to Open Cobol v3.00.00.\n*> 14/03/09 vbc - Tidy up totals & keep on same page if enough space.\n*> 29/05/09 vbc - Support for Page-Lines instead of fixed number.\n*> 07/09/10 vbc - .06 Mod lpr.\n*> 24/11/11 vbc - .07 Error msgs to SLnnn.Support for dates other than UK\n*> 08/12/11 vbc - .08 Support for path+filenames.\n*> 09/12/11 vbc -     Updated version to 3.01.nn\n*> 11/12/11 vbc - .09 Changed usage of Stk-Date-Form to the global field Date-Form making former redundent.\n*> 01/06/13 vbc - .10 Minor tidy up of code with no functional changes eg replace zeroise by initialize etc\n*>                    Increase VAT codes reporting from 3 to 5 with test for non zero, just in case\n*>                    tax codes [options 4 & 5] are used.\n*> 24/10/16 vbc - .11 ALL programs now using wsnames.cob in copybooks\n*> 15/01/17 vbc - .   All programs upgraded to v3.02 for RDB processing\n*>                    but still need invoicing.\n*>                    Replaced all refs to file-status as redundant.\n*> 23/01/17 vbc       Dry testing completed.\n*> 07/02/17 vbc - .12 Updated to use FH & DALs replacing usage for sil- for\n*>                    il and sih- for ih-.\n*> 16/04/17 vbc -     Dry tested against slinvoiceMT but only needs head recs.\n*>                    Same issue as in sl020, consider new functions for heads.\n*> 18/04/17 vbc - .13 Updated to use Invoice-Read-Next-Header where only the\n*>                    Header is wanted (if test = zero",
        "line": 47
      },
      {
        "type": "IF",
        "condition": "called by xl150 do not stop for any errors.\n*> 15/06/20 vbc - .15 Extra test for reply when opening sales file JIC not exist.\n*> 12/05/23 vbc - .16 Added Msg SL121 and replaced to it for no SL file.\n*>                    Chngd to reporting on Proformas & confirm reporting on\n*>                    vat rates 4 & 5. Light code clean up.\n*> 20/05/23 vbc - .17 To Match sl020 added line item reporting. Is it ok ?\n*> 07/08/23 vbc - .18 Nope code moved to analysis-print & use IL data.\n*>                WHEN FIXED, UPDATE sl820 & pl820\n*> 13/08/23 vbc - .19 Added PA, Vat code & percentage to line items and remove\n*>                    analysis line as no longer needed. renove 1 line printed\n*>                    from heads, Removed zz050 code - not used.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> These files and programs is part of the Applewood Computers Accounting\n*> System and is copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms of the GNU General Public License as published by the\n*> Free Software Foundation; version 3 and later as revised for personal\n*> usage only and that includes for use within a business but without\n*> repackaging or for Resale in any way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental mode must get in touch with the copyright holder\n*> with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n copy \"selprint.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n copy \"fdprint.cob\".   *> x(132)\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"SL050 (3.02.19)\".\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n*>     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  ws-data.\n     03  test-product.\n         05  filler      pic x.\n             88  il-comment              value \"/\".\n         05  filler      pic x(11).\n     03  ws-reply        pic x.\n     03  ws-error        pic 9           value zero.\n         88  Sales-Missing               value 1.\n     03  a               pic 9           value zero.\n     03  i               pic 99          value zero.\n     03  j               pic 999         value zero.\n     03  k               pic 99          value zero.\n     03  l               pic 99          value zero.\n     03  total-group    occurs 4      comp-3.\n         05 total-ded    pic s9(8)v99.\n         05 total-gds    pic s9(8)v99.\n         05 total-car    pic s9(8)v99.\n         05 total-net    pic s9(8)v99.\n         05 total-vat    pic s9(8)v99.\n         05 total-grs    pic s9(8)v99.\n         05 total-dis    pic s9(8)v99.\n         05 total-cvat   pic s9(8)v99    occurs 5.\n     03  ws-deduct-amt   pic s999v99 comp-3 value zero.\n     03  ws-deduct-vat   pic s999v99 comp-3 value zero.\n     03  line-cnt        binary-char        value zero.\n     03  WS-Lines        pic 99             value zero.     *> 07/08/23\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n*>       NONE\n*> Module specific\n     03  SL120          pic x(57) value \"SL120 No Transactions to proof! ...Press return for menu.\".\n     03  SL121          pic x(59) value \"SL121 Sales Ledger file not found .. Press return for menu.\".\n*>\n copy \"slwsinv2.cob\".\n 01  WS-Invoice-Record  redefines Invoice-Record\n                         pic x(137).\n copy \"wssl.cob\".\n*>\n 01  ws-group-lits.\n     03  filler          pic x(17)      value \"Receipts\".\n     03  filler          pic x(17)      value \"Invoices\".\n     03  filler          pic x(17)      value \"Credit Notes\".\n     03  filler          pic x(17)      value \"Pro-Formas\".\n 01  filler  redefines ws-group-lits.\n     03  ws-lit          pic x(17)   occurs 4.\n*>\n 01  line-1.\n     03  l1-version      pic x(49)       value spaces.\n     03  filler          pic x(75)       value \"Unapplied Sales Transaction Report\".\n     03  filler          pic x(5)        value \"Page \".\n     03  l3-page         pic zz9.\n*>\n 01  line-2.\n     03  l3-user         pic x(49)       value spaces.\n     03  filler          pic x(34)       value spaces.\n     03  filler          pic x(39)       value spaces.\n     03  l1-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(65)       value \"  Number ---Date--- <------------Customer------------>  --Type--\".\n     03  filler          pic x(9)        value spaces.\n     03  filler          pic x(57)       value \" Goods   Anal Vat      <---Net-->  <---Vat-->  <--Gross->\".\n*>\n 01 Line-4B.\n     03  filler          pic x(75)       value space.\n     03  filler          pic x(08)       value spaces.\n     03  filler          pic x(8)        value \"<-Code->\".\n*>\n 01  line-5.\n     03  l5-nos          pic z(7)9b.\n     03  l5-date         pic x(11).\n     03  l5-cust         pic x(7)B.\n     03  l5-name         pic x(25).\n     03  l5-marker       pic x(2)        value spaces.\n     03  l5-type         pic x(15).\n     03  l5-goods        pic z(6)9.99cr.\n     03  filler          pic x(13)       value spaces.\n     03  l5-net          pic z(6)9.99cr.\n     03  l5-vat          pic z(6)9.99cr.\n     03  l5-gross        pic z(6)9.99cr.\n*>\n*> Line item print\n*>\n 01  Line-5B.\n     03  filler          pic x(45)      value spaces.\n     03  L5B-Item-Desc   pic x(25).\n     03  l5B-Goods       pic z(6)9.99cr.\n     03  filler          pic xx         value spaces.\n     03  L5B-pa          pic xx         value spaces.\n     03  filler          pic xx         value spaces.\n     03  L5B-Vat-Code    pic 9.\n     03  filler          pic x(6)       value spaces.\n     03  l5B-Net         pic z(6)9.99cr.\n     03  l5B-Vat         pic z(6)9.99cr.\n     03  l5B-Gross       pic z(6)9.99cr.\n*>\n*> Totals by type\n*>\n 01  line-6.\n     03  filler          pic x(7)         value spaces.\n     03  filler          pic x(6)         value \"Total\".\n     03  l6-lit          pic x(18).\n     03  l6-goods        pic z(6)9.99cr.\n     03  l6-disc         pic z(6)9.99cr.\n     03  l6-ded          pic z(6)9.99cr.\n     03  l6-carr         pic z(6)9.99cr.\n     03  l6-net          pic z(6)9.99cr.\n     03  l6-vat          pic z(6)9.99cr.\n     03  l6-gross        pic z(6)9.99cr.\n*>\n 01  line-7.\n     03  filler          pic x(36)      value spaces.\n     03  filler          pic x(78)      value \"Goods    Discount  Prompt Pay    Carriage         Net         Vat       Gross\".\n*>\n 01  line-8.\n     03  filler          pic x(9)        value \"Vat Code\".\n     03  L8-Code-Number.\n         05  l8-vat-code pic 9.\n         05  filler      pic xxx         value spaces.\n     03  L8-Vat-Type   redefines L8-Code-Number\n                         pic xxxB.\n     03  l8-vat-rate     pic z9.99.\n     03  filler          pic x(5)        value \"%\".\n     03  l8-amount1      pic z(7)9.99cr.\n     03  l8-amount2      pic z(9)9.99cr.\n     03  l8-amount3      pic z(9)9.99cr.\n     03  l8-amount4      pic z(9)9.99cr.\n*>\n 01  line-9.\n     03  filler          pic x(79)      value \"V.A.T. Reconciliation       Receipts       Invoices   Credit Notes    Proformas\".\n*>\n 01  line-a.\n     03  filler          pic x(45)       value spaces.\n     03  la-a            pic x(12).\n     03  la-code         pic x(6).\n     03  la-b            pic x(8).\n     03  la-amount       pic z(6)9.99cr   blank when zero.\n     03  filler          pic x(2)        value spaces.\n     03  la-c            pic x(9).                   *> \"Vat Code\"\n     03  la-vat          pic z.\n*>\n 01  line-b.\n     03  filler          pic x(45)       value spaces.\n     03  lb-a            pic x(12)       value spaces.\n     03  lb-code         pic x(6).\n     03  lb-b            pic x(8)        value spaces.\n     03  lb-amount       pic z(6)9.99cr   blank when zero.\n*>\n 01  line-c.\n     03  filler          pic x(45)       value spaces.\n     03  lc-a            pic x(12).\n     03  lc-code         pic x(6)        value spaces.\n     03  lc-b            pic x(8)        value spaces.\n     03  lc-amount       pic z(6)9.99cr   blank when zero.\n     03  filler          pic x(2)        value spaces.\n     03  lc-c            pic x(9).\n     03  lc-vat          pic z.\n*>\n 01  line-d.\n     03  filler          pic x(45)       value spaces.\n     03  ld-a            pic x(12).\n     03  ld-code         pic x(6)        value spaces.\n     03  ld-b            pic x(8)        value spaces.\n     03  ld-amount       pic z(6)9.99cr   blank when zero.\n     03  filler          pic x(2)        value spaces.\n     03  ld-c            pic x(9).\n     03  ld-vat          pic z.\n*>\n 01  line-e.\n     03  filler          pic x(45)       value spaces.\n     03  le-a            pic x(12).\n     03  le-code         pic x(6)        value spaces.\n     03  le-b            pic x(8)        value spaces.\n     03  le-amount       pic z(6)9.99cr   blank when zero.\n     03  filler          pic x(2)        value spaces.\n     03  le-c            pic x(9).\n     03  le-vat          pic z.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n     move     Print-Spool-Name to PSN.\n     move     zero to a.\n     perform  4 times\n              add  1 to a\n              initialize Total-Group (a)\n     end-perform\n*>\n     move     prog-name to l1-version.\n     perform  zz070-Convert-Date.\n     move     ws-date to l1-date.\n     move     1  to File-Key-No.\n*>\n Menu-Return.\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Invoice Proof Report\" at 0132  with foreground-color 2.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-16\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    display SL120   at 0501 with foreground-color 4\n                    if     WS-Caller not = \"xl150\"    *> Might be called by XL150 EOC (End of Cycle)\n                           accept ws-reply at 0563 with foreground-color 6\n                    end-if\n                    goback.                         *> As no transactions.\n*>\n     perform  Sales-Open-Input.\n     if       FS-Reply not = zero\n                    display SL121   at 0501 with foreground-color 4\n                    if     WS-Caller not = \"xl150\"    *> Might be called by XL150 EOC\n                           accept ws-reply at 0563 with foreground-color 6\n                    end-if\n                    goback.                         *> As no transactions.\n*>\n     open     output print-file.\n*>\n     move     zero  to  j.\n     perform  headings-1.\n     perform  Invoice-Open-Input.\n*>\n Get-Invoice-Record.\n     perform  Invoice-Read-Next.   *> read invoice-file  next record  at end\n     if       fs-reply = 10\n              go to  Main-End.\n*>\n*> Trap transactions which are already on the sales ledger & OTM file.\n*>\n     if       applied\n              go to Get-Invoice-Record.\n*>\n     move     zero to l.\n     move     ih-customer to ws-Sales-Key  l5-cust.\n     move     space to ws-reply.\n\n     perform  Sales-Read-Indexed.\n     if       fs-reply  = 21\n              move \"X\" to ws-reply.\n*>\n     if       ws-reply = \"X\"\n              move \"!! Customer Unknown\" to l5-name\n              move 1 to ws-error\n     else\n              move sales-name  to  l5-name.\n*>\n     move     ih-invoice  to  l5-nos.\n     move     ih-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date  to  l5-date.\n*>\n     move     ih-deduct-amt to ws-deduct-amt.\n     move     ih-deduct-vat to ws-deduct-vat.\n*>\n     if       ih-type = 3                \t\t*> Cr. Note  for Header Rec\n              multiply  -1  by  ih-net\n              multiply  -1  by  ih-extra\n              multiply  -1  by  ih-carriage\n              multiply  -1  by  ih-vat\n              multiply  -1  by  ih-c-vat\n              multiply  -1  by  ih-e-vat\n              multiply  -1  by  ih-discount\n              multiply  -1  by  ws-deduct-amt\n              multiply  -1  by  ws-deduct-vat.\n*>\n     if       ws-deduct-amt = zero or = spaces\n              move  spaces  to  lb-a  lb-code\n              move  zero    to  lb-amount ws-deduct-amt\n     else\n              move  \"Late Charge \"  to  lb-a\n              move  spaces          to  lb-code\n              move  ws-deduct-amt   to  lb-amount.\n*>\n     if       ih-discount = zero or = spaces\n              move  spaces  to  lc-a  lc-code  lc-c\n              move  zero    to  lc-amount  lc-vat ih-discount\n     else\n              move  \"Discount    \"  to lc-a\n              move  spaces          to lc-code  lc-c\n              move  ih-discount     to lc-amount\n              move  zero            to lc-vat.\n*>\n     if       ih-carriage = zero or = spaces\n              move  spaces  to  ld-a  ld-code  ld-c\n              move  zero    to  ld-amount  ld-vat ih-Carriage\n     else\n              move  \"Carriage    \"  to  ld-a\n              move  spaces          to  ld-code  ld-c\n              move  ih-carriage     to  ld-amount\n              if    ih-c-vat = zero\n                    move  zero  to  ld-vat\n              else\n                    move  1  to  ld-vat.\n*>\n     if       ih-extra = zero or = spaces\n              move  spaces  to  le-a  le-code  le-c\n              move  zero    to  le-amount  le-vat ih-Extra\n     else\n              move  extra-desc to  le-a\n              move  spaces     to  le-code\n              move  ih-extra  to  le-amount\n              if    ih-e-vat = zero\n                    move  zero to  le-vat\n              else\n                    move  1  to  le-vat.\n*>\n     if       Ih-Type > 0 and < 5\n              move     ih-Type to a\n              move     ws-lit (a) to L5-Type.\n*>\n     add      ih-c-vat ih-e-vat to total-cvat (a, 1).\n*>\n     move     ih-net  to  l5-goods.\n     add      ih-vat  ih-c-vat  ih-e-vat  ws-deduct-vat giving  l5-vat.\n     add      ih-net  ih-extra  ih-carriage  ih-discount ws-deduct-amt giving  l5-net.\n     add      ih-vat  ih-c-vat  ih-e-vat  ws-deduct-vat\n              ih-net  ih-extra  ih-carriage  ih-discount ws-deduct-amt giving  l5-gross.\n*>\n     add      ih-net  to  total-gds (a).\n     add      ih-discount  ih-extra  to  total-dis (a).\n     add      ws-deduct-amt to total-ded (a).\n     add      ih-carriage  to  total-car (a).\n     add      ih-vat  ih-c-vat  ih-e-vat  ws-deduct-vat to  total-vat (a).\n     add      ih-net  ih-extra  ih-carriage  ih-discount ws-deduct-amt to  total-net (a).\n     add      ih-vat  ih-c-vat  ih-e-vat  ws-deduct-vat\n              ih-net  ih-extra  ih-carriage  ih-discount\n              ws-deduct-amt to  total-grs (a).\n*>\n     if       line-cnt > Page-Lines - 2\n              perform headings-1.\n*>\n     write    print-record from line-5 after 2.\n     add      2 to line-cnt.\n*>\n     move     zero to fs-Reply.\n     move     ih-Lines to WS-Lines.\n     perform  Analysis-Print  WS-Lines times.\n     perform  Extra-Analysis.\n     go       to Get-Invoice-Record.   *> process Line items from file\n*>\n Main-End.\n     perform  Sales-Close.\n     perform  Invoice-Close.\n*>\n     if       line-cnt < Page-Lines - 16\n              move spaces to print-record\n              write print-record after 3\n     else\n              perform  main12\n     end-if\n     write    print-record from line-7 after 2.\n     move     spaces to print-record.\n     write    print-record after 1.\n     move     zero to a.\n     perform  4 times    *> chgd 12/5/23 from 3 to 4 proformas\n              add   1 to a\n              move  total-gds (a) to  l6-goods\n              move  total-dis (a) to  l6-disc\n              move  total-car (a) to  l6-carr\n              move  total-net (a) to  l6-net\n              move  total-vat (a) to  l6-vat\n              move  total-grs (a) to  l6-gross\n              move  total-ded (a) to  l6-ded\n              move  ws-lit (a)    to  l6-lit\n              write print-record from line-6 after 1\n     end-perform\n*>\n     if       Sales-Missing                    *> Should never happen but ...\n              move \"Warning Record/s Missing In Sales File\" to print-record\n              write print-record after 2\n              write print-record after 2.    *> yes twice\n*>\n     write    print-record from line-9 after 2.\n     move     spaces to print-record.\n     write    print-record after 1.\n     move     zero to i.   *> moved from within the perform above\n     perform  3 times      *> the three vat rates\n              add   1 to i\n              move  i to l8-vat-code\n              move  vat-rate (i) to l8-vat-rate\n              move  total-cvat (1, i) to l8-amount1\n              move  total-cvat (2, i) to l8-amount2\n              move  total-cvat (3, i) to l8-amount3\n              move  total-cvat (4, i) to l8-amount4\n              write print-record from line-8 after 1\n     end-perform\n     if       Vat-Rate (4) not = zero    *> test if local tax in use & print if so\n         or   Vat-Rate (5) not = zero    *> Both - Not used in the UK (so far)\n              perform  2 times\n                       add   1 to i\n                       move  i to l8-vat-code\n                       move  vat-rate (i) to l8-vat-rate\n                       move  total-cvat (1, i) to l8-amount1\n                       move  total-cvat (2, i) to l8-amount2\n                       move  total-cvat (3, i) to l8-amount3\n                       move  total-cvat (4, i) to l8-amount4\n                       write print-record from line-8 after 1\n              end-perform\n     end-if\n     close    print-file.\n     call     \"SYSTEM\" using Print-Report.\n*>\n Menu-Call.   exit program.\n*>\n Headings-1 section.\n*>*****************\n*>\n Main12.\n     add      1  to  j.\n     move     j  to  l3-page.\n*>\n     move     usera  to  l3-user.\n     if       j not = 1\n              write print-record from line-1 after page\n     else\n              write print-record from line-1 after 1.\n     write    print-record from line-2 after 1.\n*>\n Cont-HDs.\n     write    print-record from line-4 after 2.\n     write    print-record from line-4B after 1.\n     move     spaces  to  print-record.\n     move     5 to line-cnt.\n*>\n Analysis-Print          section.\n*>==============================\n*>\n     if       fs-reply = 99\t\t\t*> Just in case\n              go to Main-Exit.\n     perform  Invoice-Read-Next.\n     if       fs-reply = 10\n              move 99 to fs-Reply\t\t*> Just in case\n              go to Main-Exit.\n*>\n     move     il-product   to  test-product.\n     if       il-comment\n              go to  main-exit.\n*>\n     if       il-type = 3                 *> credit notes\n              multiply -1 by il-net\n              multiply -1 by il-vat.\n*>\n*> Process line items\n*>\n     if       line-cnt > Page-Lines - 2\n              perform headings-1.\n     if       ih-test not = zeros           *> JIC but SHOULD be line items\n              move     spaces to Line-5B\n              move     il-Description to L5B-Item-Desc\n              move     il-Vat-Code    to L5B-Vat-Code\n              move     il-pa          to L5B-pa\n              move     il-net         to l5B-goods\n              move     il-Net         to L5B-Net\n              move     il-Vat         to L5B-Vat\n              add      il-Net il-Vat giving L5B-Gross\n              write    print-record from line-5B after 1\n              add      1 to line-cnt.\n*>\n     move     il-pa       to la-code.\n     move     il-net      to la-amount.\n     move     il-vat-code to la-vat k.\n     if       k > zero\n              add il-vat  to total-cvat (a, k).\n*>\n     move  spaces     to la-a  la-b  la-c.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n extra-analysis          section.\n*>==============================\n*>\n     if       line-cnt > Page-Lines - 4\n              perform headings-1.\n*>\n     if       lb-a  not equal  spaces\n              write  print-record  from  line-b after 1\n              add 1 to line-cnt\n              move  spaces  to  lb-a.\n*>\n     if       lc-a  not equal  spaces\n              write  print-record  from  line-c after 1\n              add 1 to line-cnt\n              move  spaces  to  lc-a.\n*>\n     if       ld-a  not equal  spaces\n              write  print-record  from  line-d after 1\n              add 1 to line-cnt\n              move  spaces  to  ld-a.\n*>\n     if       le-a  not equal  spaces\n              write  print-record  from  line-e after 1\n              add 1 to line-cnt\n              move  spaces  to  le-a.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.  exit section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.  exit section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit. exit section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 75
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 6,
    "cognitive": 2,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 72,
      "totalOperators": 54,
      "totalOperands": 108,
      "vocabulary": 73,
      "length": 162,
      "volume": 1002.7515785385629
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
