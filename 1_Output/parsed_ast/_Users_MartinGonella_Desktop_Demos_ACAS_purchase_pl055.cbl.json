{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl055.cbl",
  "fileName": "pl055.cbl",
  "timestamp": "2025-09-15T16:25:46.604Z",
  "programId": "pl055",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 104
      },
      {
        "name": "file",
        "line": 115
      },
      {
        "name": "working-storage",
        "line": 124
      },
      {
        "name": "linkage",
        "line": 230
      },
      {
        "name": "mainline",
        "line": 247
      },
      {
        "name": "create",
        "line": 442
      },
      {
        "name": "store-specials",
        "line": 504
      },
      {
        "name": "extract",
        "line": 539
      },
      {
        "name": "zz070-Convert-Date",
        "line": 600
      },
      {
        "name": "exit",
        "line": 628
      },
      {
        "name": "a01-Eval-Status",
        "line": 630
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 105
      },
      {
        "name": "file-defs",
        "line": 244
      },
      {
        "name": "read-loop",
        "line": 307
      },
      {
        "name": "header-analysis",
        "line": 363
      },
      {
        "name": "close-files",
        "line": 401
      },
      {
        "name": "menu-exit",
        "line": 435
      },
      {
        "name": "goback",
        "line": 436
      },
      {
        "name": "Create-Main",
        "line": 445
      },
      {
        "name": "Create-Anal",
        "line": 489
      },
      {
        "name": "end-if",
        "line": 596
      },
      {
        "name": "zz070-Exit",
        "line": 627
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 268,
        "type": "DYNAMIC",
        "using": [
          "File-15",
          "File-Info",
          "end-call",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "*>",
          "This",
          "should",
          "have",
          "happened",
          "in",
          "sl910",
          "invoice",
          "create",
          "move",
          "1",
          "to",
          "ws-Process-Func",
          "ws-Sub-Function",
          "call",
          "\"sl070\"",
          "using",
          "ws-calling-data",
          "system-record",
          "to-day",
          "file-defs",
          "end-call",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-15",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "PL203",
          "at",
          "2301",
          "display",
          "PL003",
          "at",
          "2401",
          "if",
          "WS-Caller",
          "not",
          "=",
          "\"xl150\"",
          "*>",
          "unlikely",
          "as",
          "sl070",
          "was",
          "run"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 94,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 103,
        "replacing": null
      },
      {
        "name": "selanal",
        "line": 107,
        "replacing": null
      },
      {
        "name": "selval",
        "line": 108,
        "replacing": null
      },
      {
        "name": "selpinv",
        "line": 109,
        "replacing": null
      },
      {
        "name": "seloi4",
        "line": 110,
        "replacing": null
      },
      {
        "name": "fdanal",
        "line": 118,
        "replacing": null
      },
      {
        "name": "fdval",
        "line": 119,
        "replacing": null
      },
      {
        "name": "fdpinv2",
        "line": 120,
        "replacing": null
      },
      {
        "name": "fdoi4",
        "line": 121,
        "replacing": null
      },
      {
        "name": "plwsoi",
        "line": 122,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 129,
        "replacing": null
      },
      {
        "name": "wsval",
        "line": 133,
        "replacing": null
      },
      {
        "name": "wsanal",
        "line": 134,
        "replacing": null
      },
      {
        "name": "plwspinv2",
        "line": 136,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 226,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 233,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 234,
        "replacing": null
      },
      {
        "name": "wssys4",
        "line": 235,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 236,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 632,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 635,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "Value-Open",
        "thru": null,
        "line": 262
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 296
      },
      {
        "target": "PInvoice-Open",
        "thru": null,
        "line": 299
      },
      {
        "target": "Value-Open",
        "thru": null,
        "line": 300
      },
      {
        "target": "Analysis-Open",
        "thru": null,
        "line": 301
      },
      {
        "target": "PInvoice-Read-Next",
        "thru": null,
        "line": 308
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 323
      },
      {
        "target": "create",
        "thru": null,
        "line": 325
      },
      {
        "target": "Value-Write",
        "thru": null,
        "line": 336
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 338
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 346
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 357
      },
      {
        "target": "PInvoice-Rewrite",
        "thru": null,
        "line": 360
      },
      {
        "target": "extract",
        "thru": null,
        "line": 369
      },
      {
        "target": "PInvoice-Rewrite",
        "thru": null,
        "line": 372
      },
      {
        "target": "PInvoice-Rewrite",
        "thru": null,
        "line": 398
      },
      {
        "target": "store-specials",
        "thru": null,
        "line": 408
      },
      {
        "target": "store-specials",
        "thru": null,
        "line": 412
      },
      {
        "target": "store-specials",
        "thru": null,
        "line": 416
      },
      {
        "target": "store-specials",
        "thru": null,
        "line": 420
      },
      {
        "target": "PInvoice-Close",
        "thru": null,
        "line": 421
      },
      {
        "target": "Value-Close",
        "thru": null,
        "line": 422
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 423
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 449
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 466
      },
      {
        "target": "Value-Write",
        "thru": null,
        "line": 475
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 479
      },
      {
        "target": "Analysis-Write",
        "thru": null,
        "line": 495
      },
      {
        "target": "Analysis-Write",
        "thru": null,
        "line": 498
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 510
      },
      {
        "target": "create",
        "thru": null,
        "line": 512
      },
      {
        "target": "Value-Write",
        "thru": null,
        "line": 521
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 523
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 527
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 535
      },
      {
        "target": "a01-Eval-Status",
        "thru": null,
        "line": 590
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines",
        "line": 252
      },
      {
        "from": "1",
        "to": "ws-Process-Func ws-Sub-Function\n                    call \"sl070\" using ws-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    end-call\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display   PL203 at 2301\n                          display   PL003 at 2401\n                          if     WS-Caller not = \"xl150\"  *> unlikely as sl070 was run",
        "line": 273
      },
      {
        "from": "8",
        "to": "WS-Term-Code\n                          goback\n                    end-if\n              end-if\n     end-if\n     move     1 to File-Key-No",
        "line": 287
      },
      {
        "from": "\"P\"",
        "to": "va-system",
        "line": 318
      },
      {
        "from": "il-pa",
        "to": "va-group",
        "line": 319
      },
      {
        "from": "1",
        "to": "v-exists",
        "line": 320
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 322
      },
      {
        "from": "zero",
        "to": "v-exists",
        "line": 326
      },
      {
        "from": "space",
        "to": "va-second",
        "line": 344
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 345
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 356
      },
      {
        "from": "\"z\"",
        "to": "il-update",
        "line": 359
      },
      {
        "from": "ih-carriage",
        "to": "work-2",
        "line": 386
      },
      {
        "from": "ih-deduct-amt",
        "to": "work-2",
        "line": 392
      },
      {
        "from": "\"z\"",
        "to": "ih-update",
        "line": 397
      },
      {
        "from": "\"P\"",
        "to": "va-system",
        "line": 404
      },
      {
        "from": "\"vi\"",
        "to": "va-group",
        "line": 405
      },
      {
        "from": "ws-vat-totalt",
        "to": "work-3",
        "line": 406
      },
      {
        "from": "ws-vat-totalv",
        "to": "work-2",
        "line": 407
      },
      {
        "from": "\"vj\"",
        "to": "va-group",
        "line": 409
      },
      {
        "from": "ws-vatr-totalt",
        "to": "work-3",
        "line": 410
      },
      {
        "from": "ws-vatr-totalv",
        "to": "work-2",
        "line": 411
      },
      {
        "from": "\"za\"",
        "to": "va-group",
        "line": 413
      },
      {
        "from": "ws-carr-totalt",
        "to": "work-3",
        "line": 414
      },
      {
        "from": "ws-carr-totalv",
        "to": "work-2",
        "line": 415
      },
      {
        "from": "\"zb\"",
        "to": "va-group",
        "line": 417
      },
      {
        "from": "ws-disc-totalt",
        "to": "work-3",
        "line": 418
      },
      {
        "from": "ws-disc-totalv",
        "to": "work-2",
        "line": 419
      },
      {
        "from": "va-code",
        "to": "WS-Pa-Code",
        "line": 446
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 448
      },
      {
        "from": "WS-Analysis-record",
        "to": "WS-Value-record",
        "line": 453
      },
      {
        "from": "zero",
        "to": "va-t-this  va-t-last va-t-year\n                        va-v-this  va-v-last va-v-year",
        "line": 454
      },
      {
        "from": "va-code",
        "to": "save-code",
        "line": 460
      },
      {
        "from": "space",
        "to": "va-second",
        "line": 462
      },
      {
        "from": "va-code",
        "to": "WS-Pa-Code",
        "line": 463
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 465
      },
      {
        "from": "save-code",
        "to": "WS-Pa-Code\n              go to  main-exit",
        "line": 468
      },
      {
        "from": "WS-Analysis-record",
        "to": "WS-Value-record\n     move     zero  to  va-t-this  va-t-last  va-t-year\n                        va-v-this  va-v-last  va-v-year",
        "line": 471
      },
      {
        "from": "save-code",
        "to": "va-code  WS-Pa-Code",
        "line": 477
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 478
      },
      {
        "from": "WS-Analysis-record",
        "to": "WS-Value-record\n     move     zero  to  va-t-this  va-t-last  va-t-year\n                        va-v-this  va-v-last  va-v-year",
        "line": 483
      },
      {
        "from": "va-code",
        "to": "WS-Pa-Code",
        "line": 490
      },
      {
        "from": "zero",
        "to": "pa-gl",
        "line": 491
      },
      {
        "from": "spaces",
        "to": "pa-print",
        "line": 492
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 494
      },
      {
        "from": "space",
        "to": "pa-second\n              perform Analysis-Write",
        "line": 497
      },
      {
        "from": "1",
        "to": "Anal-Created",
        "line": 499
      },
      {
        "from": "1",
        "to": "v-exists",
        "line": 507
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 509
      },
      {
        "from": "zero",
        "to": "v-exists",
        "line": 513
      },
      {
        "from": "space",
        "to": "va-second",
        "line": 525
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 526
      },
      {
        "from": "ih-supplier",
        "to": "oi-supplier",
        "line": 549
      },
      {
        "from": "ih-invoice",
        "to": "oi-invoice",
        "line": 550
      },
      {
        "from": "ih-date",
        "to": "oi-date",
        "line": 551
      },
      {
        "from": "zero",
        "to": "oi-b-nos oi-b-item",
        "line": 552
      },
      {
        "from": "ih-type",
        "to": "oi-type",
        "line": 553
      },
      {
        "from": "ih-ref",
        "to": "oi-ref",
        "line": 554
      },
      {
        "from": "ih-order",
        "to": "oi-order",
        "line": 555
      },
      {
        "from": "zero",
        "to": "oi-p-c",
        "line": 556
      },
      {
        "from": "ih-net",
        "to": "oi-net",
        "line": 557
      },
      {
        "from": "zero",
        "to": "oi-extra",
        "line": 558
      },
      {
        "from": "ih-carriage",
        "to": "oi-carriage",
        "line": 559
      },
      {
        "from": "ih-vat",
        "to": "oi-vat",
        "line": 560
      },
      {
        "from": "zero",
        "to": "oi-discount",
        "line": 561
      },
      {
        "from": "ih-c-vat",
        "to": "oi-c-vat",
        "line": 562
      },
      {
        "from": "zero",
        "to": "oi-e-vat",
        "line": 563
      },
      {
        "from": "zero",
        "to": "oi-paid",
        "line": 564
      },
      {
        "from": "ih-deduct-amt",
        "to": "oi-deduct-amt",
        "line": 565
      },
      {
        "from": "zero",
        "to": "oi-deduct-vat",
        "line": 566
      },
      {
        "from": "ih-deduct-days",
        "to": "oi-deduct-days",
        "line": 567
      },
      {
        "from": "ih-days",
        "to": "oi-days",
        "line": 568
      },
      {
        "from": "zero",
        "to": "oi-status oi-date-cleared",
        "line": 569
      },
      {
        "from": "space",
        "to": "oi-applied oi-hold-flag",
        "line": 570
      },
      {
        "from": "ih-cr",
        "to": "oi-cr",
        "line": 578
      },
      {
        "from": "\"Z\"",
        "to": "ih-status",
        "line": 587
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 608
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 611
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 615
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 622
      },
      {
        "from": "spaces",
        "to": "exception-msg",
        "line": 631
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "error open as output as bug in OC.\n*> 13/12/11 vbc - .03 Error msgs to SLnnn.Support for dates other than UK (Neither used here)\n*>                    Support for path+filenames.\n*>                    Updated version to 3.01.nn\n*> 24/10/16 vbc - .   ALL programs now using wsnames.cob in copybooks\n*> 31/10/16 vbc - .04 Support for RDB on Value & Analysis tables\n*>                    instead of cobol files\n*>                    using acas013  acas015. Update version to v3.02\n*> 07/01/18 vbc - .05 Support for RDB on all other tables.\n*>                    Replaced use of maps99 with display if needed.\n*>                    Now uses Proc-ACAS-FH-Calls.cob for all FH & DAL calls\n*>                    Added in support for remaining FH & DALs.\n*>                    Temp file OTM4 kept to pass on to pl060.\n*> 22/03/18 vbc - .06 Dont stop if error when run by xl150.\n*> 09/12/22 vbc - .07 Added para to start of sections 4 GC 3.2 warning.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 26/08/25 vbc   .08 Change description of Emergency anal. rec.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n file-control.\n*>\n*> copy \"selanal.cob\".\n*> copy \"selval.cob\".\n*> copy \"selpinv.cob\".\n copy \"seloi4.cob\".     *> Temp file only for i/p to pl060.\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdanal.cob\".\n*> copy \"fdval.cob\".\n*> copy \"fdpinv2.cob\".\n copy \"fdoi4.cob\".\n copy \"plwsoi.cob\".\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15)    value \"PL055 (3.02.08)\".\n 77  Exception-Msg       pic x(25)    value spaces.\n*>\n copy \"wsfnctn.cob\".\n*>\n*>  Ex FDs\n*>\n copy \"wsval.cob\".  *>   replacing Value-Record by WS-Value-Record\n copy \"wsanal.cob\". *>   replacing Analysis-Record by WS-Analysis-Record\n                    *>             WS-Pa-Code by WS-Pa-Code.\n copy \"plwspinv2.cob\".\n*>\n*> REMARK OUT, ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n*>     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n*>     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n*>     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n*>     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  ws-data.\n     03  ws-reply        pic x.\n     03  Anal-Created    pic 9                  value zero.\n     03  save-code       pic xxx.\n     03  ws-inv-amt      pic s9(7)v99   comp-3  value zero.\n     03  work-2          pic s9(7)v99   comp-3  value zero.\n     03  work-3          pic s9(5)      comp    value zero.\n     03  ws-vat-totalv   pic s9(7)v99   comp-3  value zero.\n     03  ws-vatr-totalv  pic s9(7)v99   comp-3  value zero.\n     03  ws-carr-totalv  pic s9(7)v99   comp-3  value zero.\n     03  ws-disc-totalv  pic s9(7)v99   comp-3  value zero.\n     03  ws-vat-totalt   pic s9(5)      comp    value zero.\n     03  ws-vatr-totalt  pic s9(5)      comp    value zero.\n     03  ws-carr-totalt  pic s9(5)      comp    value zero.\n     03  ws-disc-totalt  pic s9(5)      comp    value zero.\n     03  v-exists        pic 9.\n     03  ws-env-lines    pic 999       value zero.\n     03  ws-lines        binary-char unsigned value zero.\n     03  ws-23-lines     binary-char unsigned value zero.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  Error-Messages.\n*> System Wide\n     03  PL003          pic x(28) value \"PL003 Hit Return To Continue\".\n     03  PL006          pic x(43) value \"PL006 Note Details & Hit Return to continue\".\n*> Module specific\n     03  PL201          pic x(57) value \"PL201 Analyst records with desc, 'Emergency Name' created\".\n     03  PL202          pic x(36) value \"PL202 You will need to update these\".\n     03  PL203          pic x(30) value \"PL203 P.A. File Does Not Exist\".\n     03  PL204          pic x(40) value \"PL204 Error writing to Open Item 4 File \".\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  error-code          pic 999.\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wssys4.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          system-record-4\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n mainline section.\n*>===============\n*>\n     accept   ws-env-lines   from lines.\n     if       ws-env-lines < 24\n              move  24 to ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n*>     open     input value-file.  *> creates if not exist via acas013\n     perform  Value-Open.\n*>              close value-file\n*>              open  output  value-file.\n*>     close    value-file.\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-15\n                                                 File-Info\n              end-call\n              if    return-code not = zero          *> not = zero - No file found\n                                                    *> This should have happened in sl910 invoice create\n                    move 1 to ws-Process-Func ws-Sub-Function\n                    call \"sl070\" using ws-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    end-call\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display   PL203 at 2301\n                          display   PL003 at 2401\n                          if     WS-Caller not = \"xl150\"  *> unlikely as sl070 was run.\n                                 accept WS-Reply at 2430\n                          end-if\n                          move 8 to WS-Term-Code\n                          goback\n                    end-if\n              end-if\n     end-if\n     move     1 to File-Key-No.\n*>\n     display  prog-name at 0101 with foreground-color 2 with erase eos.\n     display  \"Invoice Post Extract\" at 0133 with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n     perform  PInvoice-Open. *>  open  i-o invoice-file value-file analysis-file.\n     perform  Value-Open.\n     perform  Analysis-Open.\n     open     extend  open-item-file-4.\n     if       fs-reply not = zero\n              close open-item-file-4\n              open output open-item-file-4.\n*>\n read-loop.\n     perform  PInvoice-Read-Next. *> read     invoice-file next record at end\n     if       FS-Reply not = zero\n              go to  close-files.\n*>\n     if       ih-test = zero\n              go to header-analysis.\n*>\n     if       il-analyised\n              go to  read-loop.\n*>\n     move     \"P\" to va-system.\n     move     il-pa to  va-group.\n     move     1  to  v-exists.\n*>\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read     value-file  invalid key\n     if       fs-reply = 21\n              perform  create\n              move zero to v-exists.\n*>\n     add      1  to  va-t-this.\n     add      1  to  va-t-year.\n     if       il-type not = 3\n              add il-net to  va-v-this va-v-year\n     else\n              subtract il-net from va-v-this va-v-year.\n*>\n     if       v-exists = zero\n              perform Value-Write    *> write  value-record\n     else\n              perform Value-Rewrite  *> rewrite  value-record.\n     end-if\n*>\n     if       va-second = space\n              go to read-loop.\n*>\n     move     space  to  va-second.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read     value-file  invalid key\n     if       FS-Reply = 21\n              go to read-loop.\n*>\n     add      1  to  va-t-this.\n     add      1 to va-t-year.\n     if       il-type not = 3\n              add il-net to  va-v-this va-v-year\n     else\n              subtract il-net from va-v-this va-v-year.\n     move     1 to File-Key-No.\n     perform  Value-Rewrite.  *> rewrite  value-record.\n*>\n     move     \"z\"  to  il-update.\n     perform  PInvoice-Rewrite.    *> rewrite  invoice-record.\n     go       to read-loop.\n*>\n header-analysis.\n*>**************\n*>\n     if       ih-analyised and applied\n              go to read-loop.\n*>\n     perform  extract.\n*>\n     if       ih-analyised\n              perform  PInvoice-Rewrite  *> rewrite invoice-record\n              go to read-loop.\n*>\n     add      ih-c-vat ih-vat giving work-2.\n     if       ih-type = 3\n              multiply -1 by work-2.\n     if       work-2 not = zero and\n              ih-type not = 1\n              add 1 to ws-vat-totalt\n              add work-2 to ws-vat-totalv.\n     if       work-2 not = zero and\n              ih-type = 1\n              add 1 to ws-vatr-totalt\n              add work-2 to ws-vatr-totalv.\n     move     ih-carriage to work-2.\n     if       ih-type = 3\n              multiply -1 by work-2.\n     if       work-2 not = zero\n              add 1 to ws-carr-totalt\n              add work-2 to ws-carr-totalv.\n     move     ih-deduct-amt to work-2.\n     if       work-2 not = zero\n              add 1 to ws-disc-totalt\n              add work-2 to ws-disc-totalv.\n*>\n     move     \"z\" to ih-update.\n     perform  PInvoice-Rewrite.  *>  rewrite  invoice-record.\n     go       to read-loop.\n*>\n close-files.\n*>**********\n*>\n     move     \"P\" to va-system.\n     move     \"vi\" to va-group.\n     move     ws-vat-totalt to work-3.\n     move     ws-vat-totalv to work-2.\n     perform  store-specials\n     move     \"vj\" to va-group.\n     move     ws-vatr-totalt to work-3.\n     move     ws-vatr-totalv to work-2.\n     perform  store-specials\n     move     \"za\" to va-group.\n     move     ws-carr-totalt to work-3.\n     move     ws-carr-totalv to work-2.\n     perform  store-specials\n     move     \"zb\" to va-group.\n     move     ws-disc-totalt to work-3.\n     move     ws-disc-totalv to work-2.\n     perform  store-specials\n     perform  PInvoice-Close.  *> close   invoice-file analysis-file value-file\n     perform  Value-Close.\n     perform  Analysis-Close.\n     close    open-item-file-4.\n*>\n     if       Anal-Created not = zero\n              display PL201 at 1201 with foreground-color 2\n              display PL202 at 1401 with foreground-color 2\n              if     WS-Caller not = \"xl150\"\n                     display PL006 at 1601 with foreground-color 2\n                     accept ws-reply at 1645\n              end-if\n              goback.                           *> Yep, I know but just in case extra code goes here!\n*>\n menu-exit.\n     goback.\n*>\n*>****************************************************\n*>                   Procedures                      *\n*>****************************************************\n*>\n create       section.\n*>===================\n*>\n Create-Main.\n     move     va-code  to  WS-Pa-Code.\n*>\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.   *> read     analysis-file  invalid key\n     if       FS-Reply = 21 or = 23\n              go to  Create-Anal.\n*>\n     move     WS-Analysis-record  to  WS-Value-record.\n     move     zero  to  va-t-this  va-t-last va-t-year\n                        va-v-this  va-v-last va-v-year.\n*>\n     if       va-second = space\n              go to  main-exit.\n*>\n     move     va-code  to  save-code.\n*>\n     move     space    to  va-second.\n     move     va-code  to  WS-Pa-Code.\n*>\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.  *> read     analysis-file  invalid key\n     if       FS-Reply = 21\n              move  save-code  to  WS-Pa-Code\n              go to  main-exit.\n*>\n     move     WS-Analysis-record  to  WS-Value-record\n     move     zero  to  va-t-this  va-t-last  va-t-year\n                        va-v-this  va-v-last  va-v-year.\n*>\n     perform  Value-Write.  *> write    value-record.\n*>\n     move     save-code  to  va-code  WS-Pa-Code.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.  *> read     analysis-file  invalid key\n     if       FS-Reply = 21\n              go to  main-exit.\n*>\n     move     WS-Analysis-record  to  WS-Value-record\n     move     zero  to  va-t-this  va-t-last  va-t-year\n                        va-v-this  va-v-last  va-v-year.\n*>\n     go       to main-exit.\n*>\n Create-Anal.\n     move     va-code to WS-Pa-Code.\n     move     zero to pa-gl.\n     move     spaces to pa-print.\n     move     \"Emergency Name - Missing\" to pa-desc.\n     move     1 to File-Key-No.\n     perform  Analysis-Write.          *> write    analysis-record.\n     if       pa-second not = space\n              move space to pa-second\n              perform Analysis-Write.  *> write analysis-record.\n     move     1 to Anal-Created.\n     go       to create-Main.\n*>\n main-exit.   exit section.\n*>\n store-specials  section.\n*>======================\n*>\n     move     1  to  v-exists.\n*>\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read     value-file  invalid key\n     if       FS-Reply = 21\n              perform  create\n              move zero to v-exists.\n*>\n     add      work-3 to  va-t-this.\n     add      work-3 to  va-t-year.\n     add      work-2 to  va-v-this.\n     add      work-2 to  va-v-year.\n*>\n     if       v-exists = zero\n              perform Value-Write     *> write  value-record\n     else\n              perform Value-Rewrite.  *> rewrite value-record.\n*>\n     move     space  to  va-second.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read     value-file  invalid key\n     if       FS-Reply = 21\n              go to main-exit.\n*>\n     add      work-3 to  va-t-this.\n     add      work-3 to  va-t-year.\n     add      work-2 to  va-v-this.\n     add      work-2 to  va-v-year.\n     perform  Value-Rewrite.  *> rewrite  value-record.\n*>\n main-exit.   exit section.\n*>\n extract section.\n*>==============\n*>\n*> only Process header records, drop pro-formas.\n*>   ignore records which have already been copied.\n*>\n     if       applied\n              go to  main-exit.\n*>\n      initialise OI-Header.   *> 07/01/18  JIC\n     move     ih-supplier to  oi-supplier.\n     move     ih-invoice  to  oi-invoice.\n     move     ih-date     to  oi-date.\n     move     zero        to  oi-b-nos oi-b-item.\n     move     ih-type     to  oi-type.\n     move     ih-ref      to  oi-ref.\n     move     ih-order    to  oi-order.\n     move     zero        to  oi-p-c.\n     move     ih-net      to  oi-net.\n     move     zero        to  oi-extra.\n     move     ih-carriage to  oi-carriage.\n     move     ih-vat      to  oi-vat.\n     move     zero        to  oi-discount.\n     move     ih-c-vat    to  oi-c-vat.\n     move     zero        to  oi-e-vat.\n     move     zero        to  oi-paid.\n     move     ih-deduct-amt  to  oi-deduct-amt.\n     move     zero           to  oi-deduct-vat.\n     move     ih-deduct-days to  oi-deduct-days.\n     move     ih-days     to  oi-days.\n     move     zero        to  oi-status oi-date-cleared.\n     move     space       to  oi-applied oi-hold-flag.\n*>\n     if       ih-type = 3\n              multiply  -1  by  oi-net\n              multiply  -1  by  oi-carriage\n              multiply  -1  by  oi-vat\n              multiply  -1  by  oi-c-vat.\n*>\n     move     ih-cr to oi-cr.\n*>\n     if       ih-type not = 1\n              add ih-net ih-carriage ih-vat ih-c-vat giving ws-inv-amt.\n     if       ih-type = 2\n              add ws-inv-amt to pl-invoices-this-month.\n     if       ih-type = 3\n              add ws-inv-amt to pl-credit-notes-this-month.\n*>\n     move     \"Z\"  to  ih-status.   *> 07/01/18 was \"z\"\n     write    open-item-record-4.\n     if       fs-reply not = zero\n              perform  a01-Eval-Status\n              display  PL204         at line ws-23-lines col 1\n              display  fs-reply      at line ws-23-lines col 41\n              display  Exception-Msg at line ws-23-lines col 44\n              display  PL006         at line ws-lines col 01\n              accept   ws-reply      at line ws-lines col 45\n     end-if.\n*>\n main-exit.   exit.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n a01-Eval-Status section.\n     move     spaces to exception-msg.\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 48
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 3,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 92,
      "totalOperators": 81,
      "totalOperands": 162,
      "vocabulary": 93,
      "length": 243,
      "volume": 1589.0155910992514
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
