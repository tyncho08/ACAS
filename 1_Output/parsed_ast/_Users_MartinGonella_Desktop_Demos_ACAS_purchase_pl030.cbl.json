{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl030.cbl",
  "fileName": "pl030.cbl",
  "timestamp": "2025-09-15T16:25:47.555Z",
  "programId": "pl030",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 117
      },
      {
        "name": "file",
        "line": 130
      },
      {
        "name": "working-storage",
        "line": 137
      },
      {
        "name": "linkage",
        "line": 328
      },
      {
        "name": "init01",
        "line": 343
      },
      {
        "name": "running-totals",
        "line": 410
      },
      {
        "name": "write-details",
        "line": 435
      },
      {
        "name": "Eval-Status",
        "line": 462
      },
      {
        "name": "read-details",
        "line": 471
      },
      {
        "name": "comm-routines",
        "line": 487
      },
      {
        "name": "inv-level-1",
        "line": 513
      },
      {
        "name": "get-data-1",
        "line": 550
      },
      {
        "name": "erase-screen",
        "line": 686
      },
      {
        "name": "End-Totals",
        "line": 695
      },
      {
        "name": "Total-Screen",
        "line": 758
      },
      {
        "name": "invoice-details",
        "line": 856
      },
      {
        "name": "cr-note",
        "line": 1006
      },
      {
        "name": "Program-Start",
        "line": 1073
      },
      {
        "name": "display-outline-1",
        "line": 1120
      },
      {
        "name": "zz050-Validate-Date",
        "line": 1138
      },
      {
        "name": "exit",
        "line": 1171
      },
      {
        "name": "zz060-Convert-Date",
        "line": 1173
      },
      {
        "name": "exit",
        "line": 1206
      },
      {
        "name": "zz070-Convert-Date",
        "line": 1208
      },
      {
        "name": "exit",
        "line": 1236
      },
      {
        "name": "maps04",
        "line": 1238
      },
      {
        "name": "exit",
        "line": 1244
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 120
      },
      {
        "name": "file-defs",
        "line": 340
      },
      {
        "name": "main",
        "line": 359
      },
      {
        "name": "data-input",
        "line": 373
      },
      {
        "name": "more-data",
        "line": 386
      },
      {
        "name": "main-exit",
        "line": 401
      },
      {
        "name": "ih-vat",
        "line": 415
      },
      {
        "name": "end-perform",
        "line": 482
      },
      {
        "name": "accept-money6c",
        "line": 490
      },
      {
        "name": "accept-money7c",
        "line": 500
      },
      {
        "name": "loop",
        "line": 525
      },
      {
        "name": "Get-Data-1-Main",
        "line": 553
      },
      {
        "name": "get-code",
        "line": 562
      },
      {
        "name": "get-net",
        "line": 608
      },
      {
        "name": "Get-Vat-Code",
        "line": 618
      },
      {
        "name": "get-vat-rate",
        "line": 652
      },
      {
        "name": "clear-down-line",
        "line": 669
      },
      {
        "name": "End-Totals-Main",
        "line": 698
      },
      {
        "name": "confirmation",
        "line": 719
      },
      {
        "name": "get-days",
        "line": 797
      },
      {
        "name": "get-extra",
        "line": 807
      },
      {
        "name": "get-carriage",
        "line": 825
      },
      {
        "name": "get-carriage-vat",
        "line": 834
      },
      {
        "name": "main-display-end",
        "line": 870
      },
      {
        "name": "invoice-enter",
        "line": 875
      },
      {
        "name": "date-input",
        "line": 905
      },
      {
        "name": "supplier-input",
        "line": 922
      },
      {
        "name": "order-input",
        "line": 970
      },
      {
        "name": "ref-input",
        "line": 976
      },
      {
        "name": "type-input",
        "line": 982
      },
      {
        "name": "main-display",
        "line": 1011
      },
      {
        "name": "main-input",
        "line": 1018
      },
      {
        "name": "No-Inv-Restart",
        "line": 1067
      },
      {
        "name": "menu-return",
        "line": 1101
      },
      {
        "name": "menu-exit",
        "line": 1107
      },
      {
        "name": "goback",
        "line": 1115
      },
      {
        "name": "zz050-test-date",
        "line": 1165
      },
      {
        "name": "zz050-exit",
        "line": 1170
      },
      {
        "name": "zz060-Exit",
        "line": 1205
      },
      {
        "name": "zz070-Exit",
        "line": 1235
      },
      {
        "name": "maps04-exit",
        "line": 1243
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 1079,
        "type": "DYNAMIC",
        "using": [
          "File-15",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "move",
          "1",
          "to",
          "ws-Process-Func",
          "ws-Sub-Function",
          "call",
          "\"sl070\"",
          "using",
          "ws-calling-data",
          "system-record",
          "to-day",
          "file-defs",
          "call",
          "\"CBL_CHECK_FILE_EXIST\"",
          "using",
          "File-15",
          "*>",
          "Only",
          "if",
          "the",
          "call",
          "failed",
          "for",
          "some",
          "unknown",
          "reason",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "PL191",
          "at",
          "2301",
          "display",
          "PL003",
          "at",
          "2401",
          "accept",
          "ws-reply",
          "at",
          "2430",
          "end-if",
          "end-if",
          "end-if",
          "*>",
          "perform",
          "Purch-Open-Input"
        ]
      },
      {
        "target": "maps04",
        "line": 1241,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 106,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 115,
        "replacing": null
      },
      {
        "name": "selanal",
        "line": 123,
        "replacing": null
      },
      {
        "name": "selpl",
        "line": 124,
        "replacing": null
      },
      {
        "name": "selpinv",
        "line": 125,
        "replacing": null
      },
      {
        "name": "fdanal",
        "line": 133,
        "replacing": null
      },
      {
        "name": "fdpl",
        "line": 134,
        "replacing": null
      },
      {
        "name": "fdpinv",
        "line": 135,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 141,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 142,
        "replacing": null
      },
      {
        "name": "wsanal",
        "line": 189,
        "replacing": null
      },
      {
        "name": "wspl",
        "line": 191,
        "replacing": null
      },
      {
        "name": "plwsoi5C",
        "line": 192,
        "replacing": null
      },
      {
        "name": "wsfdpinv",
        "line": 193,
        "replacing": null
      },
      {
        "name": "plwspinv",
        "line": 197,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 267,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 293,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 331,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 332,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 333,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 466,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 1246,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 354
      },
      {
        "target": "program-start",
        "thru": null,
        "line": 357
      },
      {
        "target": "invoice-details",
        "thru": null,
        "line": 363
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 371
      },
      {
        "target": "inv-level-1",
        "thru": null,
        "line": 379
      },
      {
        "target": "End-Totals",
        "thru": null,
        "line": 384
      },
      {
        "target": "varying",
        "thru": null,
        "line": 417
      },
      {
        "target": "move",
        "thru": null,
        "line": 421
      },
      {
        "target": "PInvoice-Rewrite",
        "thru": null,
        "line": 444
      },
      {
        "target": "PInvoice-Write",
        "thru": null,
        "line": 446
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 449
      },
      {
        "target": "ih-lines",
        "thru": null,
        "line": 475
      },
      {
        "target": "PInvoice-Read-Next",
        "thru": null,
        "line": 479
      },
      {
        "target": "display-outline-1",
        "thru": null,
        "line": 528
      },
      {
        "target": "get-data-1",
        "thru": null,
        "line": 535
      },
      {
        "target": "clear-down-line",
        "thru": null,
        "line": 591
      },
      {
        "target": "display-outline-1",
        "thru": null,
        "line": 593
      },
      {
        "target": "Analysis-Read-Indexed",
        "thru": null,
        "line": 600
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 613
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 656
      },
      {
        "target": "running-totals",
        "thru": null,
        "line": 663
      },
      {
        "target": "varying",
        "thru": null,
        "line": 672
      },
      {
        "target": "*>",
        "thru": null,
        "line": 675
      },
      {
        "target": "PInvoice-Delete",
        "thru": null,
        "line": 681
      },
      {
        "target": "Total-Screen",
        "thru": null,
        "line": 699
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 702
      },
      {
        "target": "PInvoice-Rewrite",
        "thru": null,
        "line": 737
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 739
      },
      {
        "target": "write-details",
        "thru": null,
        "line": 750
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 753
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 810
      },
      {
        "target": "accept-money7c",
        "thru": null,
        "line": 828
      },
      {
        "target": "accept-money6c",
        "thru": null,
        "line": 836
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 861
      },
      {
        "target": "PInvoice-Read-Indexed",
        "thru": null,
        "line": 889
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 902
      },
      {
        "target": "read-details",
        "thru": null,
        "line": 903
      },
      {
        "target": "zz050-Validate-Date",
        "thru": null,
        "line": 916
      },
      {
        "target": "Purch-Read-Indexed",
        "thru": null,
        "line": 939
      },
      {
        "target": "cr-note",
        "thru": null,
        "line": 995
      },
      {
        "target": "main-display-end",
        "thru": null,
        "line": 997
      },
      {
        "target": "OTM5-Read-Indexed",
        "thru": null,
        "line": 1044
      },
      {
        "target": "main-display",
        "thru": null,
        "line": 1068
      },
      {
        "target": "Purch-Open-Input",
        "thru": null,
        "line": 1097
      },
      {
        "target": "Analysis-Open-Input",
        "thru": null,
        "line": 1098
      },
      {
        "target": "PInvoice-Open",
        "thru": null,
        "line": 1099
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 1111
      },
      {
        "target": "PInvoice-Close",
        "thru": null,
        "line": 1112
      },
      {
        "target": "Analysis-Close",
        "thru": null,
        "line": 1113
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 1168
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 1182
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines",
        "line": 346
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 355
      },
      {
        "from": "16",
        "to": "lin",
        "line": 370
      },
      {
        "from": "zero",
        "to": "ih-p-c ih-net ih-vat",
        "line": 376
      },
      {
        "from": "zero",
        "to": "i",
        "line": 378
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 390
      },
      {
        "from": "zero",
        "to": "ih-net\n                        ih-vat",
        "line": 414
      },
      {
        "from": "ih-net",
        "to": "display-9",
        "line": 422
      },
      {
        "from": "ih-vat",
        "to": "display-9",
        "line": 425
      },
      {
        "from": "ih-invoice",
        "to": "il-invoice (j)",
        "line": 439
      },
      {
        "from": "j",
        "to": "il-line (j)",
        "line": 440
      },
      {
        "from": "ih-type",
        "to": "il-type (j)",
        "line": 441
      },
      {
        "from": "spaces",
        "to": "exception-msg",
        "line": 465
      },
      {
        "from": "zero",
        "to": "j",
        "line": 474
      },
      {
        "from": "ih-invoice",
        "to": "invoice-nos\n              move j to item-nos\n              perform PInvoice-Read-Next     *> read invoice-file\n                                             *>  end-read\n              move WS-Pinvoice-record to invoice-line (j)\n     end-perform",
        "line": 477
      },
      {
        "from": "amt-wk-pence6",
        "to": "ws-pence6",
        "line": 493
      },
      {
        "from": "amt-wk-pds6",
        "to": "ws-pound6",
        "line": 494
      },
      {
        "from": "ws-pound6",
        "to": "amt-wk-pds6",
        "line": 497
      },
      {
        "from": "ws-pence6",
        "to": "amt-wk-pence6",
        "line": 498
      },
      {
        "from": "amt-wk-pence7",
        "to": "ws-pence7",
        "line": 503
      },
      {
        "from": "amt-wk-pds7",
        "to": "ws-pound7",
        "line": 504
      },
      {
        "from": "ws-pound7",
        "to": "amt-wk-pds7",
        "line": 507
      },
      {
        "from": "ws-pence7",
        "to": "amt-wk-pence7",
        "line": 508
      },
      {
        "from": "1",
        "to": "j",
        "line": 532
      },
      {
        "from": "1",
        "to": "new-screen\n              go to  main-exit",
        "line": 557
      },
      {
        "from": "zero",
        "to": "new-screen",
        "line": 560
      },
      {
        "from": "7",
        "to": "cole",
        "line": 566
      },
      {
        "from": "ws-pa",
        "to": "delete-test",
        "line": 589
      },
      {
        "from": "ws-pa",
        "to": "il-pa (i) pa-group",
        "line": 596
      },
      {
        "from": "\"P\"",
        "to": "pa-system",
        "line": 597
      },
      {
        "from": "11",
        "to": "cole",
        "line": 598
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 599
      },
      {
        "from": "pa-desc",
        "to": "il-description (i)",
        "line": 606
      },
      {
        "from": "37",
        "to": "cole",
        "line": 611
      },
      {
        "from": "amt-ok7",
        "to": "il-net (i) ws-net",
        "line": 616
      },
      {
        "from": "\"S\"",
        "to": "Vat-Code-X",
        "line": 623
      },
      {
        "from": "50",
        "to": "cole",
        "line": 624
      },
      {
        "from": "1",
        "to": "Vat-Code\n      else\n       If     Vat-Code-X = \"R\"                   *> Reduced  code 2 (05% - 21/08/25)\n              move 2 to Vat-Code\n        else\n         If   Vat-Code-X = \"Z\"                   *> Zero     code 3 (00% - 21/08/25)\n              move 3 to Vat-Code",
        "line": 631
      },
      {
        "from": "Vat-Code",
        "to": "il-Vat-Code (I)",
        "line": 642
      },
      {
        "from": "zero",
        "to": "Amt-OK6\n     else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute  Amt-OK6 rounded = (WS-Net * WS-VAT-Rate) / 100",
        "line": 645
      },
      {
        "from": "WS-VAT",
        "to": "Display-9 Il-VAT (I)",
        "line": 650
      },
      {
        "from": "56",
        "to": "cole",
        "line": 655
      },
      {
        "from": "amt-ok6",
        "to": "il-vat (i) ws-vat",
        "line": 657
      },
      {
        "from": "68",
        "to": "cole",
        "line": 660
      },
      {
        "from": "z",
        "to": "il-line (z)\n     end-perform\n*>\n     move     zero to z",
        "line": 674
      },
      {
        "from": "ih-invoice",
        "to": "invoice-nos\n              move ih-lines  to  item-nos\n              perform  PInvoice-Delete        *> delete invoice-file record\n              subtract 1 from ih-lines",
        "line": 679
      },
      {
        "from": "1",
        "to": "cole",
        "line": 689
      },
      {
        "from": "15",
        "to": "lin",
        "line": 701
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 722
      },
      {
        "from": "\"P\"",
        "to": "ih-status",
        "line": 732
      },
      {
        "from": "i",
        "to": "ih-lines",
        "line": 734
      },
      {
        "from": "PInvoice-header",
        "to": "ws-Pinvoice-record",
        "line": 736
      },
      {
        "from": "zero",
        "to": "j",
        "line": 749
      },
      {
        "from": "11",
        "to": "lin",
        "line": 751
      },
      {
        "from": "1",
        "to": "p-flag-i",
        "line": 752
      },
      {
        "from": "1",
        "to": "cole",
        "line": 761
      },
      {
        "from": "11",
        "to": "lin",
        "line": 762
      },
      {
        "from": "ih-net",
        "to": "display-9",
        "line": 788
      },
      {
        "from": "ih-vat",
        "to": "display-8",
        "line": 791
      },
      {
        "from": "ih-days",
        "to": "ws-dayes",
        "line": 798
      },
      {
        "from": "zero",
        "to": "ih-days\n              go to get-carriage",
        "line": 801
      },
      {
        "from": "ws-dayes",
        "to": "ih-days",
        "line": 805
      },
      {
        "from": "1726",
        "to": "curs",
        "line": 808
      },
      {
        "from": "ih-deduct-amt",
        "to": "amt-ok7",
        "line": 809
      },
      {
        "from": "amt-ok7",
        "to": "ih-deduct-amt display-9",
        "line": 813
      },
      {
        "from": "zero",
        "to": "ih-deduct-vat ih-deduct-days\n              go to get-carriage",
        "line": 816
      },
      {
        "from": "ih-deduct-days",
        "to": "ws-days",
        "line": 820
      },
      {
        "from": "ws-days",
        "to": "ih-deduct-days",
        "line": 823
      },
      {
        "from": "1926",
        "to": "curs",
        "line": 826
      },
      {
        "from": "ih-carriage",
        "to": "amt-ok7",
        "line": 827
      },
      {
        "from": "amt-ok7",
        "to": "ih-carriage",
        "line": 829
      },
      {
        "from": "1941",
        "to": "curs",
        "line": 835
      },
      {
        "from": "amt-ok6",
        "to": "ih-c-vat",
        "line": 837
      },
      {
        "from": "zero",
        "to": "ih-invoice",
        "line": 878
      },
      {
        "from": "1",
        "to": "z\n              go to main-exit",
        "line": 883
      },
      {
        "from": "zero",
        "to": "item-nos",
        "line": 886
      },
      {
        "from": "ih-invoice",
        "to": "invoice-nos",
        "line": 887
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 888
      },
      {
        "from": "WS-Pinvoice-record",
        "to": "Pinvoice-header",
        "line": 893
      },
      {
        "from": "ih-date",
        "to": "u-bin",
        "line": 901
      },
      {
        "from": "1",
        "to": "z\n              go to  main-exit",
        "line": 912
      },
      {
        "from": "ws-date",
        "to": "ws-test-date",
        "line": 915
      },
      {
        "from": "u-bin",
        "to": "ih-date",
        "line": 920
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to  main-exit",
        "line": 931
      },
      {
        "from": "1",
        "to": "c-check",
        "line": 934
      },
      {
        "from": "ih-supplier",
        "to": "WS-Purch-key",
        "line": 936
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 938
      },
      {
        "from": "zero",
        "to": "c-check",
        "line": 941
      },
      {
        "from": "1",
        "to": "z",
        "line": 948
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 952
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 956
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 960
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 964
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 968
      },
      {
        "from": "zero",
        "to": "z",
        "line": 1000
      },
      {
        "from": "ih-cr",
        "to": "ws-cr",
        "line": 1023
      },
      {
        "from": "ws-cr",
        "to": "ih-cr",
        "line": 1027
      },
      {
        "from": "\"Z\"",
        "to": "ws-named\n              go to  no-inv-restart\n     else\n              move  space  to  ws-named",
        "line": 1029
      },
      {
        "from": "\"Q\"",
        "to": "escape-code\n              go to main-exit\n     else\n              move space to escape-code",
        "line": 1035
      },
      {
        "from": "ih-supplier",
        "to": "oi5-supplier",
        "line": 1040
      },
      {
        "from": "ih-cr",
        "to": "oi5-invoice",
        "line": 1041
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 1043
      },
      {
        "from": "to-day",
        "to": "u-date ws-test-date",
        "line": 1077
      },
      {
        "from": "1",
        "to": "ws-Process-Func ws-Sub-Function\n                    call \"sl070\" using ws-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15       *> Only if the call failed for some unknown reason\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display PL191   at 2301\n                          display PL003   at 2401\n                          accept ws-reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n     perform  Purch-Open-Input",
        "line": 1082
      },
      {
        "from": "zero",
        "to": "menu-reply",
        "line": 1104
      },
      {
        "from": "zero",
        "to": "pass-value",
        "line": 1110
      },
      {
        "from": "1",
        "to": "cole",
        "line": 1124
      },
      {
        "from": "2",
        "to": "cole",
        "line": 1127
      },
      {
        "from": "4",
        "to": "cole",
        "line": 1129
      },
      {
        "from": "36",
        "to": "cole",
        "line": 1131
      },
      {
        "from": "78",
        "to": "cole",
        "line": 1133
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 1147
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1149
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap  to ws-month\n              go to zz050-test-date",
        "line": 1153
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 1160
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 1166
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 1167
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 1184
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 1186
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1189
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 1193
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1200
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 1216
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1219
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 1223
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1230
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "inv not found just offer re-input of inv.\n*>                    Also added tests for on hold or closed & renamed err msgs\n*> 09/12/22 vbc - .06 Added para to start of sections 4 GC 3.2 warning.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 22/08/25 vbc - .07 Support for Vat-Code-X for S(tandard), R(educed), Z(ero)\n*>                    In place of 1, 2, 3. To Match Sales ledger SL910 and pl020.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n*>\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n*> copy \"selanal.cob\".\n*> copy \"selpl.cob\".\n*> copy \"selpinv.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n *> copy \"fdanal.cob\".\n *> copy \"fdpl.cob\".\n *> copy \"fdpinv.cob\".\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"PL030 (3.02.07)\".\n 77  exception-msg       pic x(25) value spaces.\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n 01  ws-amount-screen-display6.\n     03  ws-poundsd6     pic 9(6).\n     03  ws-period6      pic x     value \".\".\n     03  ws-penced6      pic v99.\n 01  ws-amount-screen-accept6 redefines ws-amount-screen-display6.\n     03  ws-pound6       pic 9(6).\n     03  filler          pic x.\n     03  ws-pence6       pic v99.\n*>\n 01  ws-amount-work6.\n     03  amt-wk-pds6     pic 9(6).\n     03  amt-wk-pence6   pic v99.\n 01  ws-amount-ok6 redefines ws-amount-work6.\n     03  amt-ok6         pic 9(6)v99.\n*>\n 01  ws-amount-screen-display7.\n     03  ws-poundsd7     pic 9(7).\n     03  ws-period7      pic x     value \".\".\n     03  ws-penced7      pic v99.\n 01  ws-amount-screen-accept7 redefines ws-amount-screen-display7.\n     03  ws-pound7       pic 9(7).\n     03  filler          pic x.\n     03  ws-pence7       pic v99.\n*>\n 01  ws-amount-work7.\n     03  amt-wk-pds7     pic 9(7).\n     03  amt-wk-pence7   pic v99.\n 01  ws-amount-ok7 redefines ws-amount-work7.\n     03  amt-ok7         pic 9(7)v99.\n*>\n 01  ws-discount-display.\n     03  ws-disca1       pic 99.\n     03  ws-disca2       pic x        value \".\".\n     03  ws-disca3       pic v99.\n 01  ws-discount-accept redefines ws-discount-display.\n     03  ws-discb1       pic 99.\n     03  filler          pic x.\n     03  ws-discb3       pic v99.\n 01  ws-discount-work.\n     03  ws-disc-wka     pic 99.\n     03  ws-disc-wkb     pic v99.\n 01  ws-discount redefines ws-discount-work pic 99v99.\n*>\n*>  EX FDs\n*>\n copy \"wsanal.cob\".     *>  replacing  Analysis-Record by WS-Analysis-Record\n                        *>             Pa-Code by WS-Pa-Code.\n copy \"wspl.cob\".\n copy \"plwsoi5C.cob\".   *> WS-OTM5-Record.\n copy \"wsfdpinv.cob\".   *> replacing Invoice-Record by WS-PInvoice-Record.\n*>\n*>  WS record areas\n*>\n copy \"plwspinv.cob\".     *> WS record data for head & 40 lines\n*>\n*> REMARK OUT, ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n*>     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n*>     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n*>     03  WS-PInvoice-Record     pic x.\n*>     03  WS-OTM5-Record         pic x.\n*>\n 01  ws-data.\n     03  test-product.\n         05  filler      pic x.\n             88  il-comment              value \"/\".\n         05  filler      pic x(11).\n     03  menu-reply      pic 9.\n     03  ws-reply        pic x.\n     03  z               pic 99.\n     03  c-check         pic 9.\n         88  c-exists                    value  1.\n     03  address-line.\n         05  add-line1   pic x(15).\n         05  add-line2   pic x(21).\n     03  ws-named        pic x           value space.\n     03  ws-dash         pic x(80)       value all \"-\".\n     03  display-8       pic z(5)9.99.\n     03  display-9       pic z(6)9.99.\n     03  Vat-Code-X.                           *> this for S, R, Z = Std,Reduced,Zero\n         05  Vat-Code    pic 9.                *> 21/08/25\n     03  i               pic 99.\n     03  j               pic 99.\n     03  k               pic 99.\n     03  m               pic 99.\n     03  escape-code     pic x.\n     03  new-screen      pic 9(8).\n     03  altypes         pic x(45) value \"Receipt <<<    Account <<<    Credit Note <<<\".\n     03  filler redefines altypes.\n         05  d-types     pic x(15) occurs 3.\n     03  ws-vat-rate     pic 99v99.\n     03  ws-pa           pic xx.\n     03  ws-product      pic x(12).\n     03  ws-description  pic x(24).\n     03  ws-qty          pic 9(5).\n     03  ws-net          pic 9(7)v99.\n     03  ws-vat          pic 9(7)v99.\n     03  ws-unit         pic 9(6)v99.\n     03  ws-cr           pic 9(8).\n     03  ws-dayes        pic 99.\n*>\n     03  ws-env-lines    pic 999       value zero.\n     03  ws-lines        binary-char unsigned value zero.\n     03  ws-23-lines     binary-char unsigned value zero.\n*>\n 01  All-My-Constants    pic 9(4).\n     copy \"screenio.cpy\".\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  Error-Messages.\n*> System Wide\n     03  PL003          pic x(28) value \"PL003 Hit Return To Continue\".\n     03  PL006          pic x(43) value \"PL006 Note Details & Hit Return to continue\".\n*> Module specific\n     03  PL180          pic x(32) value \"PL180 Err on Folio Rec. Write : \".\n     03  PL181          pic x(44) value \"PL181 Folio To Credit Does Not Exist On ITM5\".\n     03  PL182          pic x(29) value \"PL182 Folio To Credit Is Paid\".\n     03  PL183          pic x(40) value \"PL183 Folio To Credit Has Query Flag Set\".\n     03  PL184          pic x(62) value \"PL184 You Can Only Credit Invoices. Not Receipts, Credit Notes\".\n     03  PL186          pic x(34) value \"PL186 Err on Folio Rec. Rewrite : \".\n     03  PL187          pic x(25) value \"PL187 Folio Not Found!!!!\".\n     03  PL188          pic x(46) value \"PL188 Folio Already Passed To Purchase Ledger!\".\n     03  PL190          pic x(63) value \"PL190 You Can Only Credit An Folio With The Same Account Number\".\n     03  PL191          pic x(30) value \"PL191 P.A. File Does Not Exist\".\n     03  PL192          pic x(30) value \"PL192 P.A. Code Does Not Exist\".\n*>\n*> 01  error-code          pic 999.\n*>\n 01  delete-test.\n     03  delete-field    pic xx.\n     03  filler          pic x(10).\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n     accept   ws-env-lines   from lines.\n     if       ws-env-lines < 24\n              move  24 to ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n     perform  zz070-Convert-Date.   *> ws-date now local disp date\n     move     1 to File-Key-No.\n*>\n     perform  program-start.\n*>\n main.\n*>***\n*>\n     initialize Pinvoice-Bodies.\n     perform  invoice-details\n*>\n     if       cob-crt-status = cob-scr-esc\n       or     z not = zero\n       or     escape-code = \"Q\"\n              go to  main-exit.\n*>\n     move     16  to  lin.\n     perform  erase-screen.\n*>\n data-input.\n*>*********\n*>\n     move     zero to   ih-p-c ih-net ih-vat.\n*>\n     move     zero to  i.\n     perform  inv-level-1\n     if       cob-crt-status = cob-scr-esc\n              go to main.\n*>\n     if       i not = 1\n              perform End-Totals.\n*>\n more-data.\n*>\n     display \"Amend further invoices? (Y/N)  [Y]\" at 1629 with foreground-color 2.\n*>\n     move     \"Y\"  to   ws-reply.\n     accept   ws-reply at 1661 with foreground-color 6 update.\n     move     function upper-case (ws-reply) to ws-reply.\n*>\n     display  space at 1601 with erase eol.\n*>\n     if       ws-reply = \"Y\"\n              go to main.\n     if       ws-reply not = \"N\"\n              go to more-data.\n*>\n main-exit.\n*>********\n*>\n     go       to menu-exit  of  program-start.\n*>\n*>****************************************************************\n*>               P R O C E D U R E S                             *\n*>****************************************************************\n*>\n running-totals section.\n*>=====================\n*>\n     display  I at 1223 with foreground-color 3.\n     move     zero  to  ih-net\n                        ih-vat.\n*>\n     perform  varying k from 1 by 1 until k > i\n              if  il-type (k) not = \"D\"\n                  add il-net (k)  to  ih-net\n                  add il-vat (k) to  ih-vat\n     end-perform\n     move     ih-net  to  display-9.\n     display  display-9 at 1237 with foreground-color 3.\n*>\n     move     ih-vat  to  display-9.\n     display  display-9 at 1255 with foreground-color 3.\n*>\n     add      ih-net  ih-vat  giving  display-9.\n*>\n     display  display-9 at 1268 with foreground-color 3.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n write-details section.\n*>====================\n*>\n     add      1  to  j.\n     move     ih-invoice  to il-invoice (j).\n     move     j           to il-line (j).\n     move     ih-type     to il-type (j).\n     move     invoice-line (j)  to  WS-Pinvoice-record.\n*>\n     perform  PInvoice-Rewrite.        *> rewrite  invoice-record invalid key\n     if       FS-Reply not = zero\n              perform PInvoice-Write.  *>   write invoice-record.\n*>\n     if       fs-reply not = zero\n              perform Eval-Status\n              display pl180         at 2001 with erase eol foreground-color 4\n              display fs-reply      at 2036 with foreground-color 3\n              display exception-msg at 2039 with foreground-color 3\n              display invoice-key   at 2064 with foreground-color 3\n              display pl006         at 2101 with foreground-color 3\n              accept  ws-reply at 2130\n              display space at 2001 with erase eol\n              display space at 2101 with erase eol.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n Eval-Status        section.\n*>=========================\n*>\n     move     spaces to exception-msg.\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n main-exit.   exit section.\n*>\n read-details  section.\n*>====================\n*>\n     move     zero to j.\n     perform  ih-lines times\n              add  1 to j\n              move ih-invoice to invoice-nos\n              move j to item-nos\n              perform PInvoice-Read-Next     *> read invoice-file\n                                             *>  end-read\n              move WS-Pinvoice-record to invoice-line (j)\n     end-perform.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n comm-routines section.\n*>********************\n*>\n accept-money6c.\n*>-------------\n*>\n     move     amt-wk-pence6 to ws-pence6.\n     move     amt-wk-pds6 to ws-pound6.\n     display  ws-amount-screen-display6 at curs with foreground-color 3.\n     accept   ws-amount-screen-accept6 at curs  with foreground-color 3 update.\n     move     ws-pound6 to amt-wk-pds6.\n     move     ws-pence6 to amt-wk-pence6.\n*>\n accept-money7c.\n*>-------------\n*>\n     move     amt-wk-pence7 to ws-pence7.\n     move     amt-wk-pds7 to ws-pound7.\n     display  ws-amount-screen-display7 at curs with foreground-color 3.\n     accept   ws-amount-screen-accept7 at curs  with foreground-color 3 update.\n     move     ws-pound7 to amt-wk-pds7.\n     move     ws-pence7 to amt-wk-pence7.\n*>\n comm-exit.   exit section.\n*>--------    ----\n*>\n inv-level-1  section.\n*>====================\n*>\n     display  ws-dash at 1101 with foreground-color 2.\n     display  \"Level 1\" at 1201 with foreground-color 2.\n     display  \"Line - \" at 1216 with foreground-color 2.\n     display  \"<          >\" at 1236 with foreground-color 2.\n     display  \"<          >\" at 1254 with foreground-color 2.\n     display  \"<          >\" at 1267 with foreground-color 2.\n     display  \"Code\" at 1406 with foreground-color 2.\n     display  \"<---Net----> Vat   Vat Amount  Gross Amount\" at 1436 with foreground-color 2.\n*>\n loop.\n*>***\n*>\n     perform  display-outline-1 varying lin from 16 by 1 until lin > ws-23-lines.\n*>\n     subtract 16 from ws-23-lines giving m.\n     subtract m  from  i.\n     move     1 to j.\n     display  i at 1223 with foreground-color 3.\n*>\n     perform  get-data-1.\n     if       cob-crt-status = cob-scr-esc\n              go to main-exit.\n*>\n     if       new-screen = 1\n              go to loop.\n*>\n     if       il-description (i) not = spaces\n        and   i not = 40\n        and   escape-code not = \"Q\"\n              go to  loop.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n get-data-1   section.\n*>===================\n*>\n Get-Data-1-Main.\n     add      j  15  giving  lin.\n     if       lin  >  ws-23-lines\n              subtract 1 from i\n              move 1 to new-screen\n              go to  main-exit.\n*>\n     move     zero to new-screen.\n*>\n get-code.\n*>*******\n*>\n     move     il-pa (i) to ws-pa.\n     move     7 to cole.\n     display  ws-pa at curs with foreground-color 3.\n     accept   ws-pa at curs with foreground-color 3 update.\n*>\n     if       ws-pa = spaces\n              go to  main-exit.\n     if       cob-crt-status = cob-scr-esc\n              go to main-exit.\n*>\n     if       ws-pa = \"<<\"\n         and  i = 1\n              go to get-code.\n*>\n     if       ws-pa = \"<<\"\n              subtract  1  from  lin\n              if    lin  >  15\n                    subtract  1  from  i\n                    subtract 1 from j\n                    go to  get-code\n              else\n                    subtract  8  from  i\n                    go to  get-data-1-Main.\n*>\n     move     ws-pa to delete-test.\n     if       delete-field = \"**\"\n              perform clear-down-line\n              subtract 1 from i\n              perform display-outline-1\n              go to get-code.\n*>\n     move     ws-pa to il-pa (i) pa-group.\n     move     \"P\" to pa-system.\n     move     11 to cole.\n     move     1 to File-Key-No.\n     perform  Analysis-Read-Indexed.\n     if       FS-Reply = 21\n              display PL192 at curs with foreground-color 4\n              go to  get-code.\n*>\n     display  pa-desc at curs with foreground-color 3.\n     move     pa-desc  to  il-description (i).\n*>\n get-net.\n*>******\n*>\n     move     37 to cole.\n     move     il-net (i) to amt-ok7.\n     perform  accept-money7c.\n     if       amt-ok7 = zero\n              go to get-code.\n     move     amt-ok7 to il-net (i) ws-net.\n*>\n Get-Vat-Code.\n*>\n*>  Only using 1st three as last 2 are for local sales tax (not in UK)\n*>   NOTE that Is Is not currently programmed for (e.g., last 2).\n*>\n     move     \"S\" to Vat-Code-X.\n     move     50 to cole.\n     display  Vat-Code-X at curs with foreground-color 3.\n     accept   Vat-Code-X at curs with foreground-color 3 update UPPER.\n*>\n*>   Accept S, R and Z replacing with 1, 2 & 3.      Rating   %   - Effective (supposed )\n*>\n     If       Vat-Code-X = \"S\"                   *> Standard code 1 (20% - 21/08/25)\n              move 1 to Vat-Code\n      else\n       If     Vat-Code-X = \"R\"                   *> Reduced  code 2 (05% - 21/08/25)\n              move 2 to Vat-Code\n        else\n         If   Vat-Code-X = \"Z\"                   *> Zero     code 3 (00% - 21/08/25)\n              move 3 to Vat-Code.\n*>\n     If       Vat-Code < 1 or > 5                *> using 1st three as last 2 are Sales tax, Not used In the UK but USA ?. 11/09/24\n              go to  Get-Vat-Code.\n*>\n     move     Vat-Code  to  il-Vat-Code (I).\n*>\n     If       Vat-Code = zero\n              move  zero  to  Amt-OK6\n     else\n              move VAT-Rate (Vat-Code) to WS-VAT-Rate\n              compute  Amt-OK6 rounded = (WS-Net * WS-VAT-Rate) / 100.\n*>\n     move     WS-VAT to  Display-9 Il-VAT (I).\n*>\n get-vat-rate.\n*>***********\n*>\n     move     56 to cole.\n     perform  accept-money6c.\n     move     amt-ok6 to il-vat (i) ws-vat.\n*>\n     add      ws-vat ws-net giving  display-9.\n     move     68 to cole.\n     display  display-9 at curs with foreground-color 3.\n*>\n     perform  running-totals.\n*>\n     add      1 to j.\n     add      1  to  i.\n     go to    get-data-1-Main.\n*>\n clear-down-line.\n*>**************\n*>\n     perform  varying z from i by 1 until z > 39\n              move invoice-line (z + 1) to invoice-line (z)\n              move z to il-line (z)\n     end-perform\n*>\n     move     zero to z.\n     if       i not > ih-lines\n              move ih-invoice to invoice-nos\n              move ih-lines  to  item-nos\n              perform  PInvoice-Delete        *> delete invoice-file record\n              subtract 1 from ih-lines.\n*>\n main-exit.   exit section.\n*>\n erase-screen section.\n*>===================\n*>\n     move     1 to cole.\n     display  space at curs with erase eos.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n End-Totals   section.\n*>===================\n*>\n End-Totals-Main.\n     perform  Total-Screen.\n*>\n     move     15  to  lin.\n     perform  erase-screen.\n*>\n     display  \"*********************\" at 1660  with foreground-color 2.\n     display  \"*\" at 1760 with foreground-color 2.\n     display  \"*\" at 1780 with foreground-color 2.\n     display  \"*\" at 1860 with foreground-color 2.\n     display  \"*\" at 1880 with foreground-color 2.\n     display  \"*\" at 1960 with foreground-color 2.\n     display  \"*\" at 1980 with foreground-color 2.\n     display  \"*\" at 1760 with foreground-color 2.\n     display  \"*\" at 1780 with foreground-color 2.\n     display  \"*********************\" at 2060  with foreground-color 2.\n*>\n     display  \"Order ok to store\" at 1761  with foreground-color 2.\n     display  \"(Y/N) ? [Y]\" at 1968 with foreground-color 2.\n*>\n*>\n confirmation.\n*>***********\n*>\n     move     \"Y\"  to   ws-reply.\n     accept   ws-reply at 1977 with foreground-color 6 update.\n     move     function upper-case (ws-reply) to ws-reply.\n*>\n     if       ws-reply = \"N\"\n              go to  End-Totals-Main.\n*>\n     if       ws-reply not = \"Y\"\n              go to  confirmation.\n*>\n     move     \"P\"  to  ih-status.\n     subtract 1  from  i.\n     move     i    to  ih-lines.\n*>\n     move     PInvoice-header  to  ws-Pinvoice-record.\n     perform  PInvoice-Rewrite.    *> rewrite  invoice-record.\n     if       fs-reply not = zero\n              perform Eval-Status\n              display pl186         at 2001 with erase eol foreground-color 4\n              display fs-reply      at 2036 with foreground-color 3\n              display exception-msg at 2039 with foreground-color 3\n              display invoice-key   at 2064 with foreground-color 3\n              display pl006         at 2101 with foreground-color 3\n              accept  ws-reply at 2130\n              display space at 2001 with erase eol\n              display space at 2101 with erase eol.\n*>\n     move     zero to  j.\n     perform  write-details  i  times.\n     move     11  to  lin.\n     move     1 to p-flag-i.\n     perform  erase-screen.\n*>\n main-exit.   exit section.\n*>********    *****\n*>\n Total-Screen section.\n*>===================\n*>\n     move     1 to cole.\n     move     11 to lin.\n     display  space at curs with erase eos.\n     display  ws-dash at 1101 with foreground-color 2.\n*>\n     display  \"Level 1\" at 1201 with foreground-color 2.\n     display  \"<---Net---->   <---Vat--->\" at 1325  with foreground-color 2.\n     display  \"<---Gross-->     Days\" at 1354       with foreground-color 2.\n     display  \"Sub-Totals\" at 1504 with foreground-color 2.\n     display  \"{          }   {         }\" at 1525  with foreground-color 2.\n     display  \"{          }     [  ]\" at 1554       with foreground-color 2.\n*>\n     display  \"Prompt Payment Disc\" at 1704         with foreground-color 2.\n     display  \"[          ]\" at 1725 with foreground-color 2.\n     display  \"{          }     [  ]\" at 1754       with foreground-color 2.\n*>\n     display  \"Shipping & Handling\" at 1904         with foreground-color 2.\n     display  \"[          ]   [         ]\" at 1925  with foreground-color 2.\n     display  \"{          }\" at 1954 with foreground-color 2.\n*>\n     display  \"------------   -----------\" at 2225  with foreground-color 2.\n     display  \"------------\" at 2254 with foreground-color 2.\n*>\n     display  \"Itemised Totals\" at 2304 with foreground-color 2.\n     display  \"{          }   {         }\" at 2325  with foreground-color 2.\n     display  \"{          }\" at 2354 with foreground-color 2.\n*>\n     move     ih-net  to  display-9.\n     display  display-9 at 1526 with foreground-color 3.\n*>\n     move     ih-vat  to  display-8.\n     display  display-8 at 1541 with foreground-color 3.\n*>\n     add      ih-net  ih-vat  giving  display-9.\n     display  display-9 at 1555 with foreground-color 3.\n*>\n get-days.\n     move     ih-days to ws-dayes.\n     display  ws-dayes at 1572 with foreground-color 3.\n     if       ih-type not = 2\n              move zero to ih-days\n              go to get-carriage.\n*>\n     accept   ws-dayes at 1572 with foreground-color 3 update.\n     move     ws-dayes to ih-days.\n*>\n get-extra.\n     move     1726 to curs.\n     move     ih-deduct-amt to amt-ok7.\n     perform  accept-money7c.\n     if       amt-ok7 not < 1000\n              go to get-extra.\n     move     amt-ok7 to ih-deduct-amt display-9.\n*>\n     if       ih-deduct-amt equal  zero\n              move zero to ih-deduct-vat ih-deduct-days\n              go to get-carriage.\n*>\n     display  display-9 at 1755 with foreground-color 3.\n     move     ih-deduct-days to ws-days.\n     display  ws-days at 1772 with foreground-color 3.\n     accept   ws-days at 1772 with foreground-color 3 update.\n     move     ws-days to ih-deduct-days.\n*>\n get-carriage.\n     move     1926 to curs.\n     move     ih-carriage to amt-ok7.\n     perform  accept-money7c.\n     move     amt-ok7 to ih-carriage.\n     compute  amt-ok6 rounded  = ih-carriage * vat-rate-1 / 100.\n*>\n*> Note that vat-rate-1 must be standard rate for p & p\n*>\n get-carriage-vat.\n     move     1941 to curs.\n     perform  accept-money6c.\n     move     amt-ok6 to ih-c-vat.\n     add      ih-carriage  ih-c-vat  giving  display-9.\n     display  display-9 at 1955 with foreground-color 3.\n*>\n     add      ih-net ih-carriage giving  display-9.\n     display  display-9 at 2326 with foreground-color 3.\n*>\n     add      ih-vat ih-c-vat giving  display-8.\n     display  display-8 at 2341 with foreground-color 3.\n*>\n     add      ih-net ih-carriage ih-vat ih-c-vat giving display-9.\n     display  display-9 at 2355 with foreground-color 3.\n     display  \"ok  [ ]\" at 2374 with foreground-color 2.\n     accept   ws-reply at 2379 with foreground-color 6.\n     move     function upper-case (ws-reply) to ws-reply.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n invoice-details section.\n*>======================\n*>\n     display  prog-name at 0101 with erase eos foreground-color 2.\n     display  \"Order Data Amend\" at 0133  with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n     display  \"****************************************\" at 0441 with foreground-color 2.\n     display  \"*Date [  /  /    ]*A/C Nos    [       ]*\" at 0541 with foreground-color 2.\n     display  \"**                *Order   [          ]*\" at 0641 with foreground-color 2.\n     display  \"*Folio  [        ]*Ref/Inv [          ]*\" at 0741 with foreground-color 2.\n     display  \"****************************************\" at 0841 with foreground-color 2.\n*>\n main-display-end.\n*>\n     display  \"Type [ ]  <1> = Receipt; <2> = Account; <3> = Credit Note\"\n                                             at 1001 with foreground-color 2.\n*>\n invoice-enter.\n*>************\n*>\n     move     zero to ih-invoice.\n     display  ih-invoice at 0750 with foreground-color 3.\n     accept   ih-invoice at 0750 with foreground-color 3 update.\n     if       ih-invoice = zero\n           or cob-crt-status = cob-scr-esc\n              move 1 to z\n              go to main-exit.\n*>\n     move     zero to item-nos.\n     move     ih-invoice  to  invoice-nos.\n     move     1 to File-Key-No.\n     perform  PInvoice-Read-Indexed.  *> read     invoice-file invalid key\n     if       Fs-Reply not = zero\n              display PL187 at 1640 with foreground-color 2\n              go to invoice-enter.\n     move     WS-Pinvoice-record to Pinvoice-header.\n     display  space at 1640 with erase eol.\n*>\n     if       applied\n              display PL188 at 1601 with foreground-color 2 erase eol\n              go to invoice-enter.\n*>\n     display  space at 1601 with erase eol.\n     move     ih-date to u-bin.\n     perform  zz060-Convert-Date.   *> now have ws-date\n     perform  read-details.\n*>\n date-input.\n*>*********\n*>\n     display  ws-date at 0548 with foreground-color 3.\n     accept   ws-date at 0548 with foreground-color 3 update.\n     if       cob-crt-status = cob-scr-esc\n         or   ws-date = spaces\n              move 1 to z\n              go to  main-exit.\n*>\n     move     ws-date to ws-test-date.\n     perform  zz050-Validate-Date.\n     if       u-bin = zero\n              go to  date-input.\n*>\n     move     u-bin  to  ih-date.\n*>\n supplier-input.\n*>*************\n*>\n     display  ih-supplier at 0572 with foreground-color 3.\n     accept   ih-supplier at 0572 with foreground-color 3 update.\n     move     function upper-case (ih-supplier) to ih-supplier.\n*>\n     if       cob-crt-status = cob-scr-esc\n         or   ih-supplier = spaces\n              move  \"Q\"  to  escape-code\n              go to  main-exit.\n*>\n     move     1  to  c-check.\n*>\n     move     ih-supplier  to  WS-Purch-key.\n*>\n     move     1 to File-Key-No.\n     perform  Purch-Read-Indexed.  *> read     purchase-file invalid key\n     if       FS-Reply not = zero\n              move  zero  to  c-check.\n*>\n     if       not  c-exists\n              go to  supplier-input.\n*>\n     display  purch-name at 0301 with foreground-color 3.\n*>\n     move     1  to  z.\n     unstring purch-address  delimited by  pl-delim into  address-line count z pointer  z.\n     display  address-line at 0401 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring purch-address  delimited by  pl-delim into  address-line count z pointer  z.\n     display  address-line at 0501 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring purch-address  delimited by  pl-delim into  address-line count z pointer  z.\n     display  address-line at 0601 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring purch-address  delimited by  pl-delim into  address-line count z pointer  z.\n     display  address-line at 0701 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring purch-address    into  address-line   pointer  z.\n     display  address-line at 0801 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n*>\n order-input.\n*>**********\n*>\n     display  ih-order at 0669 with foreground-color 3.\n     accept   ih-order at 0669 with foreground-color 3 update.\n*>\n ref-input.\n*>********\n*>\n     display  ih-ref at 0769 with foreground-color 3.\n     accept   ih-ref at 0769 with foreground-color 3 update.\n*>\n type-input.\n*>*********\n*>\n     display  ih-type at 1007 with foreground-color 3.\n     accept   ih-type at 1007 with foreground-color 3 update.\n*>\n     if       ih-type = zero\n              go to main-exit.\n*>\n     if       ih-type  >  3\n              go to  type-input.\n*>\n     if       ih-type = 3\n              perform  cr-note\n              if  escape-code = \"Q\"\n                  perform main-display-end\n                  go to  type-input.\n*>\n     move     zero to z.\n     go       to main-exit.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n cr-note      section.\n*>===================\n*>\n*>  CRs are only processed against posted invoices, hence using OTM5.\n*>\n main-display.\n     display  space at 1201 with erase eol\n     display  space at 1301 with erase eol.\n     display  space at 1401 with erase eol.\n     display  space at 1501 with erase eol.\n     display  space at 1601 with erase eol.\n*>\n main-input.\n*>*********\n*>\n     display  \"Invoice to Credit - [        ]\" at 1201  with foreground-color 2.\n*>\n     move     ih-cr to  ws-cr.\n*>\n     display  ws-cr at 1222 with foreground-color 3.\n     accept   ws-cr at 1222 with foreground-color 3 update.\n     move     ws-cr to ih-cr.\n     if       ih-cr = zero\n              move  \"Z\"  to  ws-named\n              go to  no-inv-restart\n     else\n              move  space  to  ws-named.\n*>\n     if       ih-cr = 99999999\n              move \"Q\" to escape-code\n              go to main-exit\n     else\n              move space to escape-code.\n*>\n     move     ih-supplier to oi5-supplier.\n     move     ih-cr       to oi5-invoice.\n*>\n     move     1 to File-Key-No.\n     perform  OTM5-Read-Indexed.\n     if       Fs-Reply not = zero\n              display PL181 at line ws-23-lines col 01 with foreground-color 2\n              go to  Main.\n*>\n     display  space at 1301 with erase eol.\n     if       invoice-type not = 2\n              display PL184 at line ws-23-lines col 01 with foreground-color 2\n              go to main-input.\n*>\n     if       s-closed                  *> Error invoice is Paid\n              display PL182  at line ws-23-lines col 01 with foreground-color 2 highlight\n              go to main-input\n     else\n              display space at line ws-23-lines col 01 with erase eol.\n*>\n     if       oi-hold-flag = \"Q\"        *> Warning Invoice has query flag set but we can continue\n              display PL183  at line ws-23-lines col 01 with foreground-color 2 highlight.\n*>\n     if       invoice-supplier not = WS-Purch-key    *> cant happen.\n              display PL190 at line ws-23-lines col 01 with foreground-color 2\n              go to main-input.\n*>\n No-Inv-Restart.\n     perform  main-display.       *> Clear screen lines 12 - 16\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n Program-Start section.\n*>====================\n*>\n     display  space at 0101 with erase eos.\n     move     to-day to u-date ws-test-date.\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-15\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    move 1 to ws-Process-Func ws-Sub-Function\n                    call \"sl070\" using ws-calling-data\n                                       system-record\n                                       to-day\n                                       file-defs\n                    call  \"CBL_CHECK_FILE_EXIST\" using File-15       *> Only if the call failed for some unknown reason\n                                                       File-Info\n                    if    return-code not = zero          *> not = zero - No file found\n                          display PL191   at 2301\n                          display PL003   at 2401\n                          accept ws-reply at 2430\n                    end-if\n              end-if\n     end-if\n*>\n     perform  Purch-Open-Input.     *> open input purchase-file analysis-file.\n     perform  Analysis-Open-Input.\n     perform  PInvoice-Open.        *>  open     i-o invoice-file.\n*>\n menu-return.\n*>**********\n*>\n     move     zero  to  menu-reply.\n     go       to main-exit.\n*>\n menu-exit.\n*>********\n*>\n     move     zero to  pass-value.\n     perform  Purch-Close.       *> close purchase-file invoice-file analysis-file\n     perform  PInvoice-Close.\n     perform  Analysis-Close.\n*>\n     goback.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n display-outline-1       section.\n*>==============================\n*>\n     add      1  to  i.\n     move     1 to cole.\n     display  space at curs with erase eol.\n     display  \"(\" at curs         with foreground-color 2.\n     move     2 to cole.\n     display  i at curs           with foreground-color 3.\n     move     4 to cole.\n     display  \") [  ]\" at curs    with foreground-color 2.\n     move     36 to cole.\n     display  \"[          ] [ ]   {         } (\" at curs with foreground-color 2.\n     move     78 to cole.\n     display  \")\" at curs         with foreground-color 2.\n*>\n main-exit52a. exit section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days  to ws-swap\n              move ws-month to ws-days\n              move ws-swap  to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero    to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 71
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 4,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 124,
      "totalOperators": 126,
      "totalOperands": 252,
      "vocabulary": 125,
      "length": 378,
      "volume": 2633.066459602269
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
