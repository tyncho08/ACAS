{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl060.cbl",
  "fileName": "pl060.cbl",
  "timestamp": "2025-09-15T16:25:48.427Z",
  "programId": "pl060",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 112
      },
      {
        "name": "file",
        "line": 130
      },
      {
        "name": "working-storage",
        "line": 142
      },
      {
        "name": "linkage",
        "line": 335
      },
      {
        "name": "init01",
        "line": 352
      },
      {
        "name": "cr-swop",
        "line": 658
      },
      {
        "name": "new-heading",
        "line": 696
      },
      {
        "name": "headings",
        "line": 722
      },
      {
        "name": "purch-comp",
        "line": 745
      },
      {
        "name": "credit-comp",
        "line": 760
      },
      {
        "name": "cr-notes",
        "line": 775
      },
      {
        "name": "apportion",
        "line": 836
      },
      {
        "name": "BL-Open",
        "line": 882
      },
      {
        "name": "bl-write",
        "line": 930
      },
      {
        "name": "bl-close",
        "line": 1008
      },
      {
        "name": "Evaluate-Message",
        "line": 1032
      },
      {
        "name": "zz050-Validate-Date",
        "line": 1041
      },
      {
        "name": "exit",
        "line": 1074
      },
      {
        "name": "zz060-Convert-Date",
        "line": 1076
      },
      {
        "name": "exit",
        "line": 1109
      },
      {
        "name": "zz070-Convert-Date",
        "line": 1111
      },
      {
        "name": "exit",
        "line": 1139
      },
      {
        "name": "maps04",
        "line": 1141
      },
      {
        "name": "exit",
        "line": 1147
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 115
      },
      {
        "name": "file-defs",
        "line": 349
      },
      {
        "name": "acpt-xrply",
        "line": 367
      },
      {
        "name": "end-if",
        "line": 400
      },
      {
        "name": "loop",
        "line": 429
      },
      {
        "name": "main-end",
        "line": 550
      },
      {
        "name": "end-loop",
        "line": 590
      },
      {
        "name": "end-loop-end",
        "line": 607
      },
      {
        "name": "exit-prog",
        "line": 655
      },
      {
        "name": "read-loop",
        "line": 791
      },
      {
        "name": "end-loop",
        "line": 814
      },
      {
        "name": "main-end",
        "line": 828
      },
      {
        "name": "main-rewrite",
        "line": 872
      },
      {
        "name": "cleared-status",
        "line": 895
      },
      {
        "name": "vat-amount",
        "line": 968
      },
      {
        "name": "zz050-test-date",
        "line": 1068
      },
      {
        "name": "zz050-exit",
        "line": 1073
      },
      {
        "name": "zz060-Exit",
        "line": 1108
      },
      {
        "name": "zz070-Exit",
        "line": 1138
      },
      {
        "name": "maps04-exit",
        "line": 1146
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 382,
        "type": "DYNAMIC",
        "using": [
          "File-29",
          "*>",
          "Open",
          "ITM5",
          "file",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "perform",
          "OTM5-Open-Output",
          "*>",
          "open",
          "output",
          "open-item-file-5",
          "perform",
          "OTM5-Close",
          "*>",
          "close",
          "open-item-file-5",
          "end-if",
          "end-if",
          "*>",
          "*>",
          "File-18",
          "settings",
          "used",
          "elsewhere",
          "in",
          "program",
          "but",
          "file",
          "IS",
          "created",
          "in",
          "sl055",
          "so",
          "a",
          "bit",
          "pointless"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 393,
        "type": "DYNAMIC",
        "using": [
          "File-28",
          "*>",
          "Open",
          "ITM4",
          "file",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "set",
          "File-28-Not-Exists",
          "to",
          "true",
          "else",
          "set",
          "File-28-Exists",
          "to",
          "true",
          "end-if",
          "end-if"
        ]
      },
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 615,
        "type": "DYNAMIC",
        "using": [
          "File-28",
          "*>",
          "ITM4",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "set",
          "File-28-Not-Exists",
          "to",
          "true",
          "else",
          "set",
          "File-28-Exists",
          "to",
          "true",
          "end-if",
          "end-if",
          "*>",
          "if",
          "line-cnt",
          ">",
          "Page-Lines",
          "-",
          "6",
          "and",
          "FS-Cobol-Files-Used",
          "and",
          "File-28-Exists",
          "*>",
          "was",
          "file-status",
          "(28)",
          "=",
          "1",
          "perform",
          "new-heading"
        ]
      },
      {
        "target": "SYSTEM",
        "line": 643,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "CBL_DELETE_FILE",
        "line": 646,
        "type": "DYNAMIC",
        "using": [
          "File-28"
        ]
      },
      {
        "target": "maps04",
        "line": 1144,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 102,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 111,
        "replacing": null
      },
      {
        "name": "seloi4",
        "line": 118,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 119,
        "replacing": null
      },
      {
        "name": "selpl",
        "line": 121,
        "replacing": null
      },
      {
        "name": "seloi5",
        "line": 122,
        "replacing": null
      },
      {
        "name": "selbatch",
        "line": 123,
        "replacing": null
      },
      {
        "name": "selpost",
        "line": 124,
        "replacing": null
      },
      {
        "name": "selpost-irs",
        "line": 125,
        "replacing": null
      },
      {
        "name": "fdoi4",
        "line": 133,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 134,
        "replacing": null
      },
      {
        "name": "fdpl",
        "line": 136,
        "replacing": null
      },
      {
        "name": "fdoi5",
        "line": 137,
        "replacing": null
      },
      {
        "name": "fdbatch",
        "line": 138,
        "replacing": null
      },
      {
        "name": "fdpost",
        "line": 139,
        "replacing": null
      },
      {
        "name": "fdpost-irs",
        "line": 140,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 145,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 146,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 147,
        "replacing": null
      },
      {
        "name": "wspl",
        "line": 151,
        "replacing": null
      },
      {
        "name": "plwsoi5B",
        "line": 152,
        "replacing": null
      },
      {
        "name": "wsbatch",
        "line": 153,
        "replacing": null
      },
      {
        "name": "wspost",
        "line": 154,
        "replacing": null
      },
      {
        "name": "wspost-irs",
        "line": 155,
        "replacing": null
      },
      {
        "name": "plwsoi",
        "line": 157,
        "replacing": null
      },
      {
        "name": "plwssoi",
        "line": 158,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 251,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 338,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 339,
        "replacing": null
      },
      {
        "name": "wssys4",
        "line": 340,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 341,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 1035,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 1149,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 363
      },
      {
        "target": "OTM5-Open-Output",
        "thru": null,
        "line": 385
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 386
      },
      {
        "target": "bl-open",
        "thru": null,
        "line": 411
      },
      {
        "target": "Purch-Open",
        "thru": null,
        "line": 413
      },
      {
        "target": "headings",
        "thru": null,
        "line": 421
      },
      {
        "target": "OTM5-Open",
        "thru": null,
        "line": 427
      },
      {
        "target": "Purch-Read-Indexed",
        "thru": null,
        "line": 437
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 452
      },
      {
        "target": "BL-Write",
        "thru": null,
        "line": 480
      },
      {
        "target": "purch-comp",
        "thru": null,
        "line": 484
      },
      {
        "target": "cr-notes",
        "thru": null,
        "line": 505
      },
      {
        "target": "credit-comp",
        "thru": null,
        "line": 506
      },
      {
        "target": "Purch-Write",
        "thru": null,
        "line": 522
      },
      {
        "target": "Purch-Rewrite",
        "thru": null,
        "line": 524
      },
      {
        "target": "OTM5-Write",
        "thru": null,
        "line": 527
      },
      {
        "target": "evaluate-message",
        "thru": null,
        "line": 538
      },
      {
        "target": "headings",
        "thru": null,
        "line": 547
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 554
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 555
      },
      {
        "target": "headings",
        "thru": null,
        "line": 562
      },
      {
        "target": "BL-Close",
        "thru": null,
        "line": 579
      },
      {
        "target": "OTM5-Open",
        "thru": null,
        "line": 585
      },
      {
        "target": "OTM5-Read-Next",
        "thru": null,
        "line": 593
      },
      {
        "target": "cr-swop",
        "thru": null,
        "line": 603
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 612
      },
      {
        "target": "new-heading",
        "thru": null,
        "line": 626
      },
      {
        "target": "new-heading",
        "thru": null,
        "line": 671
      },
      {
        "target": "new-heading",
        "thru": null,
        "line": 685
      },
      {
        "target": "OTM5-Rewrite",
        "thru": null,
        "line": 691
      },
      {
        "target": "OTM5-Start",
        "thru": null,
        "line": 783
      },
      {
        "target": "OTM5-Read-Next",
        "thru": null,
        "line": 794
      },
      {
        "target": "apportion",
        "thru": null,
        "line": 809
      },
      {
        "target": "OTM5-Start",
        "thru": null,
        "line": 824
      },
      {
        "target": "OTM5-Rewrite",
        "thru": null,
        "line": 876
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 885
      },
      {
        "target": "SPL-Posting-Open-Extend",
        "thru": null,
        "line": 913
      },
      {
        "target": "SPL-Posting-Close",
        "thru": null,
        "line": 915
      },
      {
        "target": "SPL-Posting-Open-Output",
        "thru": null,
        "line": 916
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 919
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 921
      },
      {
        "target": "GL-Posting-Open-Output",
        "thru": null,
        "line": 922
      },
      {
        "target": "SPL-Posting-Write",
        "thru": null,
        "line": 993
      },
      {
        "target": "GL-Posting-Write",
        "thru": null,
        "line": 996
      },
      {
        "target": "bl-close",
        "thru": null,
        "line": 1002
      },
      {
        "target": "bl-open",
        "thru": null,
        "line": 1003
      },
      {
        "target": "GL-Batch-Write",
        "thru": null,
        "line": 1011
      },
      {
        "target": "evaluate-message",
        "thru": null,
        "line": 1015
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 1024
      },
      {
        "target": "SPL-Posting-Close",
        "thru": null,
        "line": 1026
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 1028
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 1071
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 1085
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "p-creditors",
        "to": "post-cr instead of post-dr",
        "line": 55
      },
      {
        "from": "ok",
        "to": "post",
        "line": 70
      },
      {
        "from": "prog-name",
        "to": "l1-name",
        "line": 353
      },
      {
        "from": "to-day",
        "to": "l1-date",
        "line": 354
      },
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 355
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 365
      },
      {
        "from": "spaces",
        "to": "wx-reply",
        "line": 369
      },
      {
        "from": "2",
        "to": "P-Flag-I",
        "line": 378
      },
      {
        "from": "1",
        "to": "P-Flag-A",
        "line": 379
      },
      {
        "from": "\"Y\"",
        "to": "Oi-5-Flag",
        "line": 380
      },
      {
        "from": "level-1",
        "to": "save-level-1",
        "line": 405
      },
      {
        "from": "0",
        "to": "level-1",
        "line": 406
      },
      {
        "from": "zero",
        "to": "j",
        "line": 420
      },
      {
        "from": "zeros",
        "to": "total-net (1) total-net (2) total-net (3)",
        "line": 423
      },
      {
        "from": "zeros",
        "to": "total-vat (1) total-vat (2) total-vat (3)",
        "line": 424
      },
      {
        "from": "open-item-record-4",
        "to": "oi-header",
        "line": 433
      },
      {
        "from": "oi-supplier",
        "to": "WS-Purch-key  l5-cust",
        "line": 435
      },
      {
        "from": "space",
        "to": "ws-reply",
        "line": 436
      },
      {
        "from": "\"X\"",
        "to": "ws-reply",
        "line": 439
      },
      {
        "from": "1",
        "to": "ws-error\n              initialize WS-Purch-Record with filler\n              move \"Supplier Unknown\" to l5-name purch-name\n              move oi-supplier to WS-Purch-key\n     else\n              move purch-name  to  l5-name",
        "line": 442
      },
      {
        "from": "oi-invoice",
        "to": "l5-nos",
        "line": 449
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 451
      },
      {
        "from": "ws-date",
        "to": "l5-date",
        "line": 453
      },
      {
        "from": "oi-type",
        "to": "a",
        "line": 455
      },
      {
        "from": "\"Invoice\"",
        "to": "l5-type\n     else\n      if      oi-type = 3\n              move \"Cr",
        "line": 458
      },
      {
        "from": "\"Receipt\"",
        "to": "l5-type",
        "line": 464
      },
      {
        "from": "oi-net",
        "to": "work-goods",
        "line": 467
      },
      {
        "from": "work-vat",
        "to": "l5-vat",
        "line": 468
      },
      {
        "from": "work-net",
        "to": "l5-net",
        "line": 470
      },
      {
        "from": "work-net",
        "to": "work-1",
        "line": 475
      },
      {
        "from": "work-1",
        "to": "l5-gross",
        "line": 477
      },
      {
        "from": "oi-date",
        "to": "purch-last-inv purch-last-pay",
        "line": 490
      },
      {
        "from": "oi-date",
        "to": "purch-last-inv",
        "line": 497
      },
      {
        "from": "oi-date",
        "to": "purch-last-pay\n              perform  cr-notes\n              perform credit-comp",
        "line": 504
      },
      {
        "from": "1",
        "to": "purch-status",
        "line": 509
      },
      {
        "from": "zero",
        "to": "purch-current",
        "line": 514
      },
      {
        "from": "1",
        "to": "purch-status\n              perform  Purch-Write  *> write WS-Purch-Record\n     else\n              perform Purch-Rewrite",
        "line": 521
      },
      {
        "from": "OI-Header",
        "to": "WS-OTM5-Record",
        "line": 526
      },
      {
        "from": "oi5-invoice",
        "to": "l5-nos\n              display l5-nos at 1801\n              display \"fs-reply = \" at 1901\n              display fs-reply at 1912\n              perform evaluate-message\n              display ws-Eval-Msg at 1915\n              display PL002       at 2401\n              if  WS-Caller not = \"xl150\"\n                  accept ws-reply at 2450",
        "line": 534
      },
      {
        "from": "zero",
        "to": "work-b",
        "line": 587
      },
      {
        "from": "open-item-record-5",
        "to": "oi-header",
        "line": 597
      },
      {
        "from": "work-b",
        "to": "l8-tot\n              write  print-record  from  line-8 after 3",
        "line": 630
      },
      {
        "from": "PL133",
        "to": "print-record\n         else\n              move PL133T to print-record\n              write print-record after 3",
        "line": 637
      },
      {
        "from": "save-level-1",
        "to": "level-1",
        "line": 651
      },
      {
        "from": "1",
        "to": "oi-status",
        "line": 673
      },
      {
        "from": "oi-supplier",
        "to": "l7-cust",
        "line": 675
      },
      {
        "from": "oi-invoice",
        "to": "l7-trans",
        "line": 676
      },
      {
        "from": "oi-cr",
        "to": "l7-cr-note",
        "line": 677
      },
      {
        "from": "work-1",
        "to": "l7-bal",
        "line": 679
      },
      {
        "from": "oi-paid",
        "to": "l7-appl",
        "line": 680
      },
      {
        "from": "OI-Header",
        "to": "WS-OTM5-Record",
        "line": 690
      },
      {
        "from": "j",
        "to": "l3-page",
        "line": 700
      },
      {
        "from": "usera",
        "to": "l3-user",
        "line": 701
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n              write print-record from line-1a before 1\n     end-if\n     write    print-record from line-4a after 1",
        "line": 707
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 715
      },
      {
        "from": "6",
        "to": "line-cnt",
        "line": 717
      },
      {
        "from": "j",
        "to": "l3-page",
        "line": 726
      },
      {
        "from": "usera",
        "to": "l3-user",
        "line": 727
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record  from  line-4 after 1",
        "line": 732
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 739
      },
      {
        "from": "5",
        "to": "line-cnt",
        "line": 741
      },
      {
        "from": "zero",
        "to": "work-2\n     end-if\n     add      1 to purch-activety",
        "line": 752
      },
      {
        "from": "zero",
        "to": "work-2\n     end-if\n     if       work-2 not = zero\n              add work-goods to work-2\n              divide purch-activety into work-2 giving purch-average",
        "line": 767
      },
      {
        "from": "oi-header",
        "to": "si-header",
        "line": 778
      },
      {
        "from": "\"Y\"",
        "to": "first-pass",
        "line": 779
      },
      {
        "from": "oi-supplier",
        "to": "oi5-supplier",
        "line": 780
      },
      {
        "from": "oi-cr",
        "to": "oi5-invoice",
        "line": 781
      },
      {
        "from": "zero",
        "to": "work-b",
        "line": 786
      },
      {
        "from": "open-item-record-5",
        "to": "oi-header",
        "line": 798
      },
      {
        "from": "\"N\"",
        "to": "first-pass",
        "line": 820
      },
      {
        "from": "si-supplier",
        "to": "oi5-supplier",
        "line": 821
      },
      {
        "from": "zero",
        "to": "oi5-invoice",
        "line": 822
      },
      {
        "from": "si-header",
        "to": "oi-header",
        "line": 831
      },
      {
        "from": "1",
        "to": "oi-status\n              go to main-rewrite",
        "line": 843
      },
      {
        "from": "zero",
        "to": "work-1\n              move  1  to  oi-status  si-status\n     else\n      if      work-a  >  work-1\n              add  work-1  to  oi-paid\n              add  work-1  to  si-paid\n              add  work-1 to oi-p-c\n              move  zero  to  work-1\n              move  1  to  si-status\n      else\n              add  work-a  to  oi-paid\n              add  work-a  to  si-paid\n              add  work-a to oi-p-c\n              subtract  work-a  from  work-1\n              move  1  to  oi-status",
        "line": 853
      },
      {
        "from": "1",
        "to": "si-status",
        "line": 870
      },
      {
        "from": "OI-Header",
        "to": "WS-OTM5-Record",
        "line": 875
      },
      {
        "from": "oi-header",
        "to": "open-item-record-5",
        "line": 877
      },
      {
        "from": "next-batch",
        "to": "WS-Batch-nos",
        "line": 890
      },
      {
        "from": "2",
        "to": "WS-Ledger",
        "line": 891
      },
      {
        "from": "zero",
        "to": "batch-status\n                          cleared-status",
        "line": 894
      },
      {
        "from": "scycle",
        "to": "bcycle",
        "line": 896
      },
      {
        "from": "run-date",
        "to": "entered",
        "line": 897
      },
      {
        "from": "zero",
        "to": "bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat",
        "line": 900
      },
      {
        "from": "\"DR\"",
        "to": "convention",
        "line": 907
      },
      {
        "from": "\"PL\"",
        "to": "batch-def-code",
        "line": 908
      },
      {
        "from": "\"I\"",
        "to": "batch-def-vat",
        "line": 909
      },
      {
        "from": "batch-start",
        "to": "rrn",
        "line": 925
      },
      {
        "from": "WS-Batch-nos",
        "to": "batch",
        "line": 943
      },
      {
        "from": "items",
        "to": "Post-number",
        "line": 945
      },
      {
        "from": "work-net",
        "to": "Post-amount",
        "line": 946
      },
      {
        "from": "oi-invoice",
        "to": "m",
        "line": 951
      },
      {
        "from": "zero",
        "to": "b",
        "line": 952
      },
      {
        "from": "1",
        "to": "xx",
        "line": 957
      },
      {
        "from": "p-creditors",
        "to": "post-cr",
        "line": 962
      },
      {
        "from": "bl-purch-ac",
        "to": "post-dr",
        "line": 963
      },
      {
        "from": "zero",
        "to": "dr-pc\n                        cr-pc\n                        vat-pc\n                        vat-amount",
        "line": 965
      },
      {
        "from": "\"DR\"",
        "to": "post-vat-side",
        "line": 974
      },
      {
        "from": "\"PL\"",
        "to": "post-code in WS-Posting-Record",
        "line": 975
      },
      {
        "from": "WS-Post-Key",
        "to": "WS-IRS-Post-key\n              move post-code  in WS-Posting-Record to WS-IRS-Post-Code\n              move post-date     to WS-IRS-Post-Date\n              move post-dr       to WS-IRS-Post-DR\n              move post-cr       to WS-IRS-Post-CR\n              move post-amount   to WS-IRS-Post-Amount\n              move post-legend   to WS-IRS-Post-Legend\n              move 31            to WS-IRS-Vat-AC-Def\n              move post-vat-side to WS-IRS-Post-Vat-Side\n              move vat-amount    to WS-IRS-Vat-Amount\n              perform SPL-Posting-Write    *> write irs-posting-record\n     else\n              move  RRN to WS-Post-rrn  *> ???????????? is in sl060\n              perform GL-Posting-Write     *> write posting-record\n     end-if\n     if       not irs-used\n              add 1 to rrn",
        "line": 983
      },
      {
        "from": "rrn",
        "to": "postings",
        "line": 1023
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 1050
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1052
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 1056
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 1063
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 1069
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 1070
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 1087
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 1089
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1092
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 1096
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1103
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 1119
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 1122
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 1126
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 1133
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "needed.\n*>                    Removed usage of file-status flags, long redundant.\n*>                    Now uses Proc-ACAS-FH-Calls.cob for all FH & DAL calls\n*>                    Added in support for remaining FH & DALs.\n*>                    Temp file OTM4 kept from pl055 to pass on to pl060.\n*> 08/01/18 vbc - .09 Increased by 1 char PL130 message so it shows OTM.\n*> 22/03/18 vbc - .10 Removed accepts on errors if run from xl150 and remove ok to post.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*> 26/08/25 vbc   .11 Change title to Transactions.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n copy \"seloi4.cob\".\n copy \"selprint.cob\".\n*>\n*> copy \"selpl.cob\".\n*> copy \"seloi5.cob\".\n*> copy \"selbatch.cob\".\n*> copy \"selpost.cob\".\n*> copy \"selpost-irs.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n copy \"fdoi4.cob\".\n copy \"fdprint.cob\".\n*>\n*> copy \"fdpl.cob\".\n*> copy \"fdoi5.cob\".\n*> copy \"fdbatch.cob\".\n*> copy \"fdpost.cob\".\n*> copy \"fdpost-irs.cob\".\n*>\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15)    value \"PL060 (3.02.10)\".\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n*>  FD replacements in WS.\n*>\n copy \"wspl.cob\".      *> uses WS-purch-record\n copy \"plwsoi5B.cob\".  *> uses Open-Item-Record-5 & WS-OTM5-rec. 113 Bytes\n copy \"wsbatch.cob\".   *> uses ws-batch-record.\n copy \"wspost.cob\".    *> uses ws-posting-record with rrn & post-key(10)\n copy \"wspost-irs.cob\". *> ues ws-irs-posting-record & WS-IRS- instead of IRS-\n*>\n copy \"plwsoi.cob\".    *> from orig but invoice added to key after supplier.\n copy \"plwssoi.cob\".   *> from orig but invoice added to key after supplier.\n*>\n*> REMARK OUT, ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n*>     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n*>     03  WS-Posting-Record      pic x.\n*>     03  WS-Batch-Record        pic x.\n*>     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n*>     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n*>     03  WS-OTM5-Record         pic x.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  ws-data.\n     03  save-level-1    pic 9                  value zero.\n     03  ws-reply        pic x.\n     03  ws-error        pic 9                  value zero.\n         88  purchase-missing                   value 1.\n     03  wx-reply        pic xxx.\n     03  xx              pic 99.\n     03  c-check         pic 9.\n         88  c-exists                           value 1.\n     03  ws-eval-msg     pic x(25)       value spaces.\n     03  work-1          pic s9(7)v99  comp-3   value zero.\n     03  work-2          pic s9(14)    comp-3.\n     03  work-a          pic s9(7)v99  comp-3   value zero.\n     03  work-b          pic s9(7)v99  comp-3   value zero.\n     03  first-pass      pic x.\n     03  i               pic 999.\n     03  j               pic 999.\n     03  k               pic 9(5).\n     03  m               pic z(7)9.\n     03  a               pic 9                 value zero.\n     03  b               binary-char           value zero.\n     03  c               binary-char           value zero.\n     03  work-net        pic s9(7)v99   comp-3.\n     03  work-vat        pic s9(7)v99   comp-3.\n     03  work-goods      pic s9(7)v99   comp-3.\n     03  total-group    occurs 3        comp-3.\n         05 total-net    pic s9(7)v99.\n         05 total-vat    pic s9(7)v99.\n     03  line-cnt        binary-char           value zero.\n     03  File-28-status  pic 9                 value zero.\n         88  File-28-Exists                    value 0.\n         88  File-28-Not-Exists                value 1.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  Error-Messages.\n*> System Wide\n     03  PL002          pic x(31) value \"PL002 Note error and hit return\".\n     03  PL003          pic x(28) value \"PL003 Hit Return To Continue\".\n*> Module specific\n     03  PL130          pic x(38) value \"PL130 Error writing Open Item 5 Record\".\n     03  PL131          pic x(38) value \"PL131 PE - CR SWOP: Return to continue\".\n     03  PL132          pic x(32) value \"PL132 Err on Batch file write : \".\n     03  PL133          pic x(47) value \"PL133 Warning Record/s missing in Purchase File\".\n     03  PL133T         pic x(48) value \"PL133 Warning Record/s missing in Purchase Table\".\n*>\n 01  error-code          pic 999.\n*>\n 01  total-lits.\n     03  filler          pic x(17)      value \"Receipts\".\n     03  filler          pic x(17)      value \"Invoices\".\n     03  filler          pic x(17)      value \"Credit Notes\".\n 01  filler  redefines total-lits.\n     03  ws-lits         pic x(17)   occurs 3.\n*>\n 01  line-1.\n     03  l1-name         pic x(54).\n     03  filler          pic x(70)       value \"Purchase Orders Posting Report\".\n     03  filler          pic x(5)        value \"Page \".\n     03  l3-page         pic zz9.\n*>\n 01  line-1a.\n     03  filler          pic x(56)       value spaces.\n     03  filler          pic x(18)       value \"Un-Applied Credits\".\n*>\n 01  line-2.\n     03  l3-user         pic x(54)       value spaces.\n     03  filler          pic x(22)       value spaces.\n     03  filler          pic x(46)       value spaces.\n     03  l1-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(64)       value \" Number     Date    <------------Supplier------------>    Type  \".\n     03  filler          pic x(68)       value \" Old Balance  New Balance            Net         Vat       Gross\".\n*>\n 01  line-4a.\n     03  filler          pic x(82)       value \"--Supplier--   Folio #      Bal C/F        Applied      Cr. Note          Type    \".\n*>\n 01  line-5.\n     03  l5-nos          pic z(7)9b.\n     03  l5-date         pic x(11).\n     03  l5-cust         pic x(9).\n     03  l5-name         pic x(25).\n     03  filler          pic x(2)        value spaces.\n     03  l5-type         pic x(9).\n     03  l5-old-bal      pic z(6)9.99cr.\n     03  l5-new-bal      pic z(6)9.99cr.\n     03  filler          pic x(7).\n     03  l5-net          pic z(6)9.99cr.\n     03  l5-vat          pic z(6)9.99cr.\n     03  l5-gross        pic z(6)9.99cr.\n*>\n 01  line-6.\n     03  filler          pic x(11)       value spaces.\n     03  filler          pic x(14)       value \"Total  Posted\".\n     03  l6-lit          pic x(18)       value spaces.\n     03  l6-net          pic z(7)9.99cr.\n     03  l6-vat          pic z(7)9.99cr.\n     03  l6-gross        pic z(7)9.99cr.\n*>\n 01  line-7.\n     03  l7-cust         pic x(12).\n     03  l7-trans        pic z(7)9bb     blank when zero.\n     03  filler          pic x(4)        value spaces.\n     03  l7-bal          pic z(7)9.99    blank when zero.\n     03  filler          pic x(4)        value spaces.\n     03  l7-appl         pic z(7)9.99    blank when zero.\n     03  filler          pic x(4)        value spaces.\n     03  l7-cr-note      pic z(7)9bb     blank when zero.\n     03  filler          pic x(4)        value spaces.\n     03  l7-type         pic x(12).\n*>\n 01  line-8.\n     03  filler          pic x(24)       value spaces.\n     03  l8-desc         pic x(32).\n     03  l8-tot          pic z(7)9.99    blank when zero.\n*>\n linkage section.\n*>***************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wssys4.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          system-record-4\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01  section.\n     move     prog-name to l1-name.\n     move     to-day to l1-date.\n     move     Print-Spool-Name to PSN.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n     display  \" \" at 0101 with erase eos.\n     display  prog-name at 0101 with foreground-color 2.\n     display  \"Purchase Orders Posting Report\" at 0127  with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n     move     1 to File-Key-No.\n*>\n acpt-xrply.\n *>    display  \"OK to post Purchase Transactions (YES/NO) ?  [   ]\" at 0812 with foreground-color 2.\n *>    move     spaces to  wx-reply.\n *>    accept   wx-reply at 0858 with foreground-color 6 update.\n *>    move     function upper-case (wx-reply) to wx-reply.\n *>    if       wx-reply = \"NO\"\n *>             go to exit-prog.\n *>    if       wx-reply not = \"YES\"\n *>             go to acpt-xrply.\n*>\n     display  space at 0801 with erase eol.\n     move     2   to  P-Flag-I.                 *> invoice lines\n     move     1   to  P-Flag-A.                 *> Applied recs\n     move     \"Y\" to  Oi-5-Flag.                *> sets changes to file so pl115 sort needed\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-29    *> Open ITM5 file\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    perform OTM5-Open-Output   *> open output open-item-file-5\n                    perform OTM5-Close         *>  close open-item-file-5\n              end-if\n     end-if\n*>\n*>  File-18 settings used elsewhere in program but file IS created in sl055 so a bit pointless ..\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-28    *> Open ITM4 file\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    set File-28-Not-Exists to true\n              else\n                    set File-28-Exists to true\n              end-if\n     end-if.\n*>\n*>*****************************************************\n*>* >>>>> BYPASS CODE TO SEND TOTALS TO GL <<<<<<     *\n*>*                                                   *\n*>     move     level-1 to save-level-1.\n*>     move     0 to level-1.\n*>*                                                   *\n*>*****************************************************\n*>\n     if       G-L\n              perform  bl-open.\n*>\n     perform  Purch-Open.  *>  open     i-o purchase-file.\n*>\n     open     output print-file.\n     display  \" \" at 1201 with erase eos.\n     display  \"Posting......Please Wait\" at 1201  with foreground-color 2.\n     display  \"Phase 1\" at 1401        with foreground-color 2.\n*>\n     move     zero  to  j.\n     perform  headings.\n*>\n     move     zeros to total-net (1) total-net (2) total-net (3).\n     move     zeros to total-vat (1) total-vat (2) total-vat (3).\n*>\n     open     input  open-item-file-4.\n     perform  OTM5-Open.  *>  open     i-o    open-item-file-5.\n*>\n loop.\n     read     open-item-file-4 at end  *> only has headers\n              go to  main-end.\n*>\n     move     open-item-record-4  to  oi-header.\n*>\n     move     oi-supplier  to  WS-Purch-key  l5-cust.\n     move     space to ws-reply.\n     perform  Purch-Read-Indexed.   *> read     purchase-file  record invalid key\n     if       FS-Reply not = zero\n              move \"X\" to ws-reply.\n*>\n     if       ws-reply = \"X\"\n              move 1 to ws-error\n              initialize WS-Purch-Record with filler\n              move \"Supplier Unknown\" to l5-name purch-name\n              move oi-supplier to WS-Purch-key\n     else\n              move purch-name  to  l5-name.\n*>\n     move     oi-invoice  to  l5-nos.\n*>\n     move     oi-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     ws-date  to  l5-date.\n*>\n     move     oi-type to a.\n*>\n     if       oi-type = 2\n              move \"Invoice\"  to  l5-type\n     else\n      if      oi-type = 3\n              move \"Cr. Note\" to  l5-type\n      else\n       if     oi-type = 1\n              move  \"Receipt\" to  l5-type.\n*>\n     add      oi-vat oi-c-vat giving work-vat.\n     move     oi-net to work-goods.\n     move     work-vat to l5-vat.\n     add      oi-net oi-carriage giving work-net.\n     move     work-net to l5-net.\n*>\n     add      work-vat to total-vat (a).\n     add      work-net to total-net (a).\n*>\n     move     work-net to work-1.\n     add      work-vat to work-1.\n     move     work-1 to l5-gross.\n*>\n     if       G-L\n              perform  BL-Write.\n*>\n     subtract purch-unapplied from purch-current giving l5-old-bal.\n     if       oi-type = 1 or 2\n              perform purch-comp.\n*>\n*> Receipts\n*>\n     if       oi-type = 1\n              add  work-goods to  pturnover-q (current-quarter)\n              move  oi-date  to  purch-last-inv purch-last-pay.\n*>\n*> Accounts\n*>\n     if       oi-type = 2\n              add work-goods to  pturnover-q (current-quarter)\n              add work-vat work-net to  purch-current\n              move  oi-date  to  purch-last-inv.\n*>\n*> CR. Notes\n*>\n     if       oi-type = 3\n              add work-goods to pturnover-q (current-quarter)\n              add work-vat work-net to  purch-current\n              move oi-date to purch-last-pay\n              perform  cr-notes\n              perform credit-comp.\n*>\n     if       supplier-dead\n              move  1  to  purch-status.\n*>\n     if       purch-current is negative\n              multiply -1 by purch-current\n              add purch-current to purch-unapplied\n              move zero to purch-current.\n*>\n*>    At this point only current OR unapplied can be non zero\n*>    and current will be = or > zero\n*>\n     subtract purch-unapplied from purch-current  giving l5-new-bal.\n     if       ws-reply = \"X\"\n              move 1 to purch-status\n              perform  Purch-Write  *> write WS-Purch-Record\n     else\n              perform Purch-Rewrite.  *> rewrite WS-Purch-Record.\n*>\n     move     OI-Header to WS-OTM5-Record.\n     perform  OTM5-Write      *> write open-item-record-5 from oi-header invalid key\n*>\n*> Should not happen.\n*>\n     if       FS-Reply not = zero  *> 21\n              display PL130        at 1601\n              display oi5-supplier at 1701\n              move oi5-invoice to l5-nos\n              display l5-nos at 1801\n              display \"fs-reply = \" at 1901\n              display fs-reply at 1912\n              perform evaluate-message\n              display ws-Eval-Msg at 1915\n              display PL002       at 2401\n              if  WS-Caller not = \"xl150\"\n                  accept ws-reply at 2450.\n*>\n     write    print-record from line-5 after 1.\n     add      1 to line-cnt.\n     if       line-cnt > Page-Lines\n              perform  headings.\n     go       to loop.\n*>\n main-end.\n*>*******\n*>\n     close    open-item-file-4.  *> purchase-file open-item-file-5.\n     perform  Purch-Close.\n     perform  OTM5-Close.\n     move     total-net (1) to  l6-net.\n     move     total-vat (1) to  l6-vat.\n     add      total-net (1) total-vat (1) giving  l6-gross.\n     move     ws-lits (1) to l6-lit.\n*>\n     if       line-cnt > Page-Lines - 7\n              perform headings.\n*>\n     write    print-record  from  line-6 after 3.\n*>\n     move     total-net (2) to  l6-net.\n     move     total-vat (2) to  l6-vat.\n     add      total-net (2) total-vat (2) giving  l6-gross.\n     move     ws-lits (2) to l6-lit.\n     write    print-record  from  line-6 after 2.\n*>\n     move     total-net (3) to  l6-net.\n     move     total-vat (3) to  l6-vat.\n     add      total-net (3) total-vat (3) giving  l6-gross.\n     move     ws-lits (3) to l6-lit.\n     write    print-record  from  line-6 after 2.\n*>\n     if       G-L\n              perform  BL-Close.\n*>\n*>************************************************************\n*>    Routine To Close Un-Applied CR. Notes                  *\n*>************************************************************\n*>\n     perform  OTM5-Open.  *> open     i-o     open-item-file-5.\n*>\n     move     zero  to  work-b.\n     display  \"2\" at 1407 with foreground-color 2.\n*>\n end-loop.\n*>*******\n*>\n     perform  OTM5-Read-Next.  *> read     open-item-file-5 next record at end\n     if       FS-Reply not = zero\n              go to  end-loop-end.\n*>\n     move     open-item-record-5  to  oi-header. *> WS-OTM5-Record.\n*>\n     if       s-closed\n              go to  end-loop.\n*>\n     if       oi-type = 3\n              perform  cr-swop.\n*>\n     go       to end-loop.\n*>\n end-loop-end.\n*>***********\n*>\n     open     output  open-item-file-4.\n     close    open-item-file-4.     *> open-item-file-5.\n     perform  OTM5-Close.\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-28    *> ITM4\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    set  File-28-Not-Exists to true\n              else\n                    set  File-28-Exists to true\n              end-if\n     end-if\n*>\n     if       line-cnt > Page-Lines - 6 and\n              FS-Cobol-Files-Used and File-28-Exists  *> was file-status (28) = 1\n              perform new-heading.\n*>\n     if       FS-Cobol-Files-Used and File-28-Exists  *> was file-status (28) = 1\n              move  \"Un-Applied Credits C/F \" to  l8-desc\n              move  work-b  to  l8-tot\n              write  print-record  from  line-8 after 3.\n*>\n     add      work-b to pl-cn-unappl-this-month.\n*>\n     if       purchase-missing\n         if   FS-Cobol-Files-Used\n              move PL133 to print-record\n         else\n              move PL133T to print-record\n              write print-record after 3.\n*>\n     close    print-file.\n     call     \"SYSTEM\" using Print-Report.\n     if       FS-Cobol-Files-Used\n        and   File-28-Exists\n              call \"CBL_DELETE_FILE\" using File-28.\n*>\n*>*******************************************\n*>*  >>> BYPASS CODE FOR G-L\n*>*\n*>     move     save-level-1 to level-1.\n*>*\n*>*******************************************\n*>\n exit-prog.\n     exit     program.\n*>\n cr-swop      section.\n*>===================\n*>\n     add      oi-net oi-carriage oi-vat oi-c-vat giving  work-1.\n     add      oi-paid   to   work-1.\n     if       work-1 = zero\n              display PL131 at 2401 with foreground-color 4\n              if    WS-Caller not = \"xl150\"\n                    accept ws-reply at 2434.\n*>\n*> Above should NOT happen\n*>\n     if       FS-Cobol-Files-Used and File-28-Not-Exists\n              perform  new-heading.\n*>\n     move     1  to  oi-status.\n*>\n     move     oi-supplier  to  l7-cust.\n     move     oi-invoice   to  l7-trans.\n     move     oi-cr        to  l7-cr-note.\n     move     \"Cr. Note\"   to  l7-type.\n     move     work-1       to  l7-bal.\n     move     oi-paid      to  l7-appl.\n     write    print-record  from  line-7 after 1.\n*>\n     add      1 to line-cnt.\n     if       line-cnt > Page-Lines\n              perform  new-heading.\n*>\n     add      work-1   to  work-b.\n     multiply -1 by work-1.\n     add      work-1 to oi-paid.\n     move     OI-Header to WS-OTM5-Record.\n     perform  OTM5-Rewrite.      *> rewrite  open-item-record-5  from  oi-header.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n new-heading  section.\n*>===================\n*>\n     add      1  to  j.\n     move     j  to  l3-page.\n     move     usera  to  l3-user.\n*>\n     if       j not = 1\n              write print-record from line-1 after page\n              write print-record from line-2 after 1\n              write print-record from line-1a after 1\n              move  spaces to print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n              write print-record from line-1a before 1\n     end-if\n     write    print-record from line-4a after 1.\n     move     spaces  to  print-record.\n     write    print-record after 1.\n     move     6 to line-cnt.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n headings     section.\n*>===================\n*>\n     add      1  to  j.\n     move     j  to  l3-page.\n     move     usera  to  l3-user.\n*>\n     if       j not = 1\n              write print-record from line-1 after page\n              write print-record from line-2 after 1\n              move  spaces to print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record  from  line-4 after 1.\n     move     spaces  to  print-record.\n     write    print-record  after  1.\n     move     5 to line-cnt.\n*>\n main-exit.   exit section.\n*>\n purch-comp   section.\n*>===================\n*>\n     if       purch-activety not = zero\n        and   purch-average not = zero\n              multiply purch-activety by purch-average giving work-2\n     else\n              move zero to work-2\n     end-if\n     add      1 to purch-activety.\n     add      work-goods to work-2.\n     divide   purch-activety into work-2 giving purch-average.\n*>\n main-exit.   exit section.\n*>\n credit-comp  section.\n*>===================\n*>\n     if       purch-activety not = zero\n       and    purch-average not = zero\n              multiply purch-activety by purch-average giving work-2\n     else\n              move zero to work-2\n     end-if\n     if       work-2 not = zero\n              add work-goods to work-2\n              divide purch-activety into work-2 giving purch-average.\n*>\n main-exit.   exit section.\n*>\n cr-notes     section.\n*>===================\n*>\n     move     oi-header  to  si-header.\n     move     \"Y\"  to  first-pass.\n     move     oi-supplier to oi5-supplier.\n     move     oi-cr       to oi5-invoice.\n     set      fn-not-less-than to true.\n     perform  OTM5-Start. *> start    open-item-file-5 key not < oi5-key invalid key\n     if       FS-Reply not = zero     *> 21 ?\n              go to end-loop.\n     move     zero to work-b.\n     if       work-1  <  zero\n              multiply  -1  by  work-1.\n     subtract si-paid  from  work-1.\n*>\n read-loop.\n*>********\n*>\n     perform  OTM5-Read-Next.  *> read     open-item-file-5 next record  at end\n     if       FS-Reply = 10\n              go to  end-loop.\n*>\n     move     open-item-record-5  to  oi-header. *> WS-OTM5-Record.\n     if       oi-type not = 2\n              go to read-loop.\n*>\n     if       oi-supplier  not = si-supplier\n              go to  end-loop.\n     if       s-closed\n              go to  read-loop.\n*>\n     if       si-cr = oi-invoice\n        or    first-pass = \"N\"\n              perform  apportion.\n*>\n     if       work-1  not equal  zero\n              go to  read-loop.\n*>\n end-loop.\n*>*******\n*>\n     if       work-1 = zero\n       or     first-pass not = \"Y\"\n              go to  main-end.\n     move     \"N\"  to  first-pass.\n     move     si-supplier to oi5-supplier.\n     move     zero to oi5-invoice.\n     set      fn-not-less-than to true.\n     perform  OTM5-Start.      *>   start    open-item-file-5 key not < oi5-key invalid key\n              go to main-end.\n     go       to  read-loop.\n*>\n main-end.\n*>*******\n*>\n     move     si-header  to  oi-header.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n apportion    section.\n*>===================\n*>\n     add      oi-net oi-carriage oi-vat oi-c-vat giving  work-a.\n     subtract oi-paid  from  work-a.\n*>\n     if       work-a = zero\n              move 1 to oi-status\n              go to main-rewrite.\n*>\n     if       work-a  not >  zero\n              go to  main-exit.\n*>\n     if       work-a = work-1\n              add  work-1  to  oi-paid\n              add  work-1  to  si-paid\n              add  work-1 to oi-p-c\n              move  zero  to  work-1\n              move  1  to  oi-status  si-status\n     else\n      if      work-a  >  work-1\n              add  work-1  to  oi-paid\n              add  work-1  to  si-paid\n              add  work-1 to oi-p-c\n              move  zero  to  work-1\n              move  1  to  si-status\n      else\n              add  work-a  to  oi-paid\n              add  work-a  to  si-paid\n              add  work-a to oi-p-c\n              subtract  work-a  from  work-1\n              move  1  to  oi-status.\n*>\n     if       work-1 = zero\n              move  1  to  si-status.\n*>\n main-rewrite.\n*>-----------\n*>\n     move     OI-Header to WS-OTM5-Record.\n     perform  OTM5-Rewrite.        *> rewrite  open-item-record-5  from  oi-header.\n *>    move     oi-header  to  open-item-record-5.\n *>    rewrite  open-item-record-5.\n*>\n main-exit.   exit section.\n*>\n BL-Open      section.\n*>===================\n*>\n     perform  GL-Batch-Open.  *> open     i-o  batch-file.\n *>    if       fs-reply not = zero\n *>             close batch-file\n *>             open output batch-file.\n*>\n     move     next-batch  to  WS-Batch-nos.\n     move     2  to  WS-Ledger.\n     add      1  to  Next-Batch.\n*>\n     move     zero     to batch-status\n                          cleared-status.\n     move     scycle   to bcycle.\n     move     run-date to entered.\n*>\n     move     \"Purchase Ledger Orders\" to description.\n     move     zero  to  bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat.\n*>\n     move     \"DR\"  to  convention.\n     move     \"PL\"  to  batch-def-code.\n     move     \"I\"   to  batch-def-vat.\n     add      postings  1  giving  batch-start.\n*>\n     if       irs-used\n              perform SPL-Posting-Open-Extend     *>  open extend irs-post-file\n              if fs-reply not = zero             *> wont happen in FH\n                 perform SPL-Posting-Close       *> close irs-post-file\n                 perform SPL-Posting-Open-Output *> open output irs-post-file\n              end-if\n     else\n              perform GL-Posting-Open            *> open i-o  posting-file\n              if  fs-reply not = zero\n                  perform GL-Posting-Close          *>   close posting-file\n                  perform GL-Posting-Open-Output    *>   open output posting-file.\n              end-if\n     end-if\n     move     batch-start  to  rrn.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-write     section.\n*>===================\n*><<<<<<<<<<<<<<<<<<<<<<<<<<< READ THIS >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n*>**********************************************************************\n*>  This will write a posting record to GL or IRS for EACH invoice     *\n*> so, to use it, you MUST have set up the GL account number for EVERY *\n*>  analysis code via pl070. It also assumes that you have followed    *\n*>  the convention in IRS that default a/c 31 points to VAT input      *\n*>  and default a/c 32 is VAT output tax (Sales).                      *\n*>**********************************************************************\n*>\n     move     u-date (1:6) to post-date (1:6).\n     move     u-date (9:2) to post-date (7:2).\n     move     WS-Batch-nos  to  batch.\n     add      1        to  items.\n     move     items    to Post-number.\n     move     work-net to Post-amount.\n*>\n*> using folio/invoice no + ' : ' supplier name instead of batch/item\n*>  on posting file for both IRS & GL.\n*>\n     move     oi-invoice to m.\n     move     zero to b.\n     inspect  m tallying b for leading space.\n     subtract b from 8 giving c.\n     add      1 to b.\n*>\n     move     1  to  xx.\n     string   m (b:c)     delimited by size\n              \" : \"       delimited by size\n              purch-name  delimited by size  into post-legend pointer  xx.\n*>\n     move     p-creditors  to  post-cr.\n     move     bl-purch-ac  to  post-dr.\n*>\n     move     zero  to  dr-pc\n                        cr-pc\n                        vat-pc\n                        vat-amount.\n*>\n     move     vat-ac of system-record\n              to  vat-ac of WS-Posting-Record\n*>\n     add      oi-vat oi-c-vat  to  vat-amount.\n     move     \"DR\" to post-vat-side.\n     move     \"PL\" to post-code in WS-Posting-Record.\n*>\n     add      post-amount  to  input-gross.\n     add      post-amount  to  actual-gross.\n     add      vat-amount   to  input-vat.\n     add      vat-amount   to  actual-vat.\n*>\n     if       irs-used\n              move WS-Post-Key      to WS-IRS-Post-key\n              move post-code  in WS-Posting-Record to WS-IRS-Post-Code\n              move post-date     to WS-IRS-Post-Date\n              move post-dr       to WS-IRS-Post-DR\n              move post-cr       to WS-IRS-Post-CR\n              move post-amount   to WS-IRS-Post-Amount\n              move post-legend   to WS-IRS-Post-Legend\n              move 31            to WS-IRS-Vat-AC-Def\n              move post-vat-side to WS-IRS-Post-Vat-Side\n              move vat-amount    to WS-IRS-Vat-Amount\n              perform SPL-Posting-Write    *> write irs-posting-record\n     else\n              move  RRN to WS-Post-rrn  *> ???????????? is in sl060\n              perform GL-Posting-Write     *> write posting-record\n     end-if\n     if       not irs-used\n              add 1 to rrn.\n*>\n     if       items = 99\n              perform  bl-close\n              perform  bl-open.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-close     section.\n*>===================\n*>\n     perform  GL-Batch-Write.   *> write    batch-record.\n     if       fs-reply not = zero\n              display PL132       at 2301\n              display fs-reply    at 2333\n              perform evaluate-message\n              display ws-Eval-Msg at 2336\n              if    WS-Caller not = \"xl150\"\n                    display PL002       at 2401 with foreground-color 2\n                    accept ws-reply     at 2430\n              end-if\n     end-if\n     if       not irs-used\n              move rrn to postings.\n     perform  GL-Batch-Close.  *> close    batch-file.\n     if       irs-used\n              perform SPL-Posting-Close   *> close irs-post-file\n     else\n              perform GL-Posting-Close.  *> close posting-file.\n*>\n main-exit.   exit section.\n*>\n Evaluate-Message        Section.\n*>==============================\n*>\n copy \"FileStat-Msgs.cpy\" replacing MSG by ws-Eval-Msg\n                                    STATUS by fs-reply.\n*>\n Eval-Msg-Exit.  exit section.\n*>************   ************\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 64
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 8,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 140,
      "totalOperators": 116,
      "totalOperands": 232,
      "vocabulary": 141,
      "length": 348,
      "volume": 2484.5638706347804
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
