{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl080.cbl",
  "fileName": "sl080.cbl",
  "timestamp": "2025-09-15T16:25:30.248Z",
  "programId": "sl080",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 122
      },
      {
        "name": "file",
        "line": 134
      },
      {
        "name": "working-storage",
        "line": 139
      },
      {
        "name": "linkage",
        "line": 277
      },
      {
        "name": "init01",
        "line": 292
      },
      {
        "name": "New-Payment",
        "line": 352
      },
      {
        "name": "Payment-Appropriate",
        "line": 545
      },
      {
        "name": "erase-screen",
        "line": 761
      },
      {
        "name": "zz050-Validate-Date",
        "line": 769
      },
      {
        "name": "exit",
        "line": 802
      },
      {
        "name": "zz060-Convert-Date",
        "line": 804
      },
      {
        "name": "exit",
        "line": 837
      },
      {
        "name": "zz070-Convert-Date",
        "line": 839
      },
      {
        "name": "exit",
        "line": 867
      },
      {
        "name": "maps04",
        "line": 869
      },
      {
        "name": "exit",
        "line": 875
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 125
      },
      {
        "name": "file-defs",
        "line": 289
      },
      {
        "name": "end-if",
        "line": 320
      },
      {
        "name": "display-heads",
        "line": 322
      },
      {
        "name": "dh-exit",
        "line": 329
      },
      {
        "name": "menu-exit",
        "line": 338
      },
      {
        "name": "main-exit",
        "line": 345
      },
      {
        "name": "New-Payment-Main",
        "line": 355
      },
      {
        "name": "date-input",
        "line": 365
      },
      {
        "name": "customer-input",
        "line": 385
      },
      {
        "name": "accept-unappl-reqst",
        "line": 446
      },
      {
        "name": "accept-unappl-money",
        "line": 463
      },
      {
        "name": "value-input",
        "line": 477
      },
      {
        "name": "set-batch-item",
        "line": 494
      },
      {
        "name": "data-input",
        "line": 504
      },
      {
        "name": "more-data",
        "line": 513
      },
      {
        "name": "accept-money",
        "line": 524
      },
      {
        "name": "accept-money2",
        "line": 533
      },
      {
        "name": "pay-loop",
        "line": 559
      },
      {
        "name": "pay-details",
        "line": 591
      },
      {
        "name": "get-agreement",
        "line": 649
      },
      {
        "name": "end-line",
        "line": 693
      },
      {
        "name": "end-line-2",
        "line": 706
      },
      {
        "name": "payment-2-high-maybe",
        "line": 716
      },
      {
        "name": "payment-2-high",
        "line": 727
      },
      {
        "name": "main-end",
        "line": 735
      },
      {
        "name": "oi-hold-flag",
        "line": 743
      },
      {
        "name": "zz050-test-date",
        "line": 796
      },
      {
        "name": "zz050-exit",
        "line": 801
      },
      {
        "name": "zz060-Exit",
        "line": 836
      },
      {
        "name": "zz070-Exit",
        "line": 866
      },
      {
        "name": "maps04-exit",
        "line": 874
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "CBL_CHECK_FILE_EXIST",
        "line": 312,
        "type": "DYNAMIC",
        "using": [
          "File-19",
          "*>",
          "Open",
          "ITM3",
          "file",
          "File-Info",
          "if",
          "return-code",
          "not",
          "=",
          "zero",
          "*>",
          "not",
          "=",
          "zero",
          "-",
          "No",
          "file",
          "found",
          "display",
          "SL119",
          "at",
          "line",
          "ws-23-lines",
          "col",
          "1",
          "*>",
          "2301",
          "display",
          "SL116",
          "at",
          "line",
          "ws-lines",
          "col",
          "1",
          "*>",
          "2401",
          "accept",
          "ws-reply",
          "at",
          "line",
          "ws-lines",
          "col",
          "40",
          "*>",
          "2440",
          "go",
          "to",
          "main-exit",
          "end-if",
          "end-if"
        ]
      },
      {
        "target": "maps04",
        "line": 872,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 112,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 121,
        "replacing": null
      },
      {
        "name": "selsl",
        "line": 128,
        "replacing": null
      },
      {
        "name": "seloi3",
        "line": 129,
        "replacing": null
      },
      {
        "name": "fdsl",
        "line": 137,
        "replacing": null
      },
      {
        "name": "fdoi3",
        "line": 138,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 143,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 144,
        "replacing": null
      },
      {
        "name": "wsoi",
        "line": 161,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 162,
        "replacing": null
      },
      {
        "name": "slwsoi3",
        "line": 163,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 238,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 275,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 280,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 281,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 282,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 877,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 326
      },
      {
        "target": "OTM3-Open",
        "thru": null,
        "line": 332
      },
      {
        "target": "Sales-Open",
        "thru": null,
        "line": 333
      },
      {
        "target": "New-Payment",
        "thru": null,
        "line": 334
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 335
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 336
      },
      {
        "target": "display-heads",
        "thru": null,
        "line": 341
      },
      {
        "target": "display-heads",
        "thru": null,
        "line": 357
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 368
      },
      {
        "target": "zz050-Validate-Date",
        "thru": null,
        "line": 378
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 404
      },
      {
        "target": "accept-money2",
        "thru": null,
        "line": 466
      },
      {
        "target": "Sales-Rewrite",
        "thru": null,
        "line": 474
      },
      {
        "target": "accept-money",
        "thru": null,
        "line": 481
      },
      {
        "target": "Payment-Appropriate",
        "thru": null,
        "line": 507
      },
      {
        "target": "erase-screen",
        "thru": null,
        "line": 509
      },
      {
        "target": "OTM3-Start",
        "thru": null,
        "line": 557
      },
      {
        "target": "OTM3-Read-Next",
        "thru": null,
        "line": 562
      },
      {
        "target": "OTM3-Rewrite",
        "thru": null,
        "line": 585
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 600
      },
      {
        "target": "accept-money2",
        "thru": null,
        "line": 635
      },
      {
        "target": "OTM3-Rewrite",
        "thru": null,
        "line": 704
      },
      {
        "target": "OTM3-Write",
        "thru": null,
        "line": 755
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 799
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 813
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "24",
        "to": "ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines",
        "line": 295
      },
      {
        "from": "today",
        "to": "to-day",
        "line": 300
      },
      {
        "from": "zero",
        "to": "k",
        "line": 331
      },
      {
        "from": "\"Y\"",
        "to": "oi-3-flag",
        "line": 343
      },
      {
        "from": "4",
        "to": "lin",
        "line": 356
      },
      {
        "from": "ws-date",
        "to": "ws-test-date",
        "line": 376
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 377
      },
      {
        "from": "u-bin",
        "to": "pay-date",
        "line": 382
      },
      {
        "from": "u-date",
        "to": "to-day",
        "line": 383
      },
      {
        "from": "spaces",
        "to": "pay-customer",
        "line": 392
      },
      {
        "from": "1",
        "to": "c-check",
        "line": 401
      },
      {
        "from": "pay-customer",
        "to": "WS-Sales-Key",
        "line": 402
      },
      {
        "from": "zero",
        "to": "c-check",
        "line": 406
      },
      {
        "from": "sales-address",
        "to": "address-a",
        "line": 411
      },
      {
        "from": "1",
        "to": "z",
        "line": 414
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 418
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 422
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 426
      },
      {
        "from": "spaces",
        "to": "address-line",
        "line": 430
      },
      {
        "from": "sales-current",
        "to": "display-s",
        "line": 432
      },
      {
        "from": "5",
        "to": "transaction-type",
        "line": 436
      },
      {
        "from": "sales-unapplied",
        "to": "display-8 amt-ok",
        "line": 440
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 444
      },
      {
        "from": "zero",
        "to": "cob-crt-status",
        "line": 449
      },
      {
        "from": "6",
        "to": "transaction-type",
        "line": 459
      },
      {
        "from": "0749",
        "to": "curs",
        "line": 461
      },
      {
        "from": "amt-ok",
        "to": "pay-value",
        "line": 473
      },
      {
        "from": "0749",
        "to": "curs",
        "line": 480
      },
      {
        "from": "amt-ok",
        "to": "pay-value",
        "line": 482
      },
      {
        "from": "1",
        "to": "s-flag-p",
        "line": 488
      },
      {
        "from": "batch-value",
        "to": "display-s",
        "line": 490
      },
      {
        "from": "1",
        "to": "first-sl-batch",
        "line": 498
      },
      {
        "from": "first-sl-batch",
        "to": "display-n",
        "line": 499
      },
      {
        "from": "14",
        "to": "lin",
        "line": 508
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 515
      },
      {
        "from": "zero",
        "to": "ws-poundsd amt-ok ws-penced",
        "line": 527
      },
      {
        "from": "ws-pound",
        "to": "amt-wk-pds",
        "line": 530
      },
      {
        "from": "ws-pence",
        "to": "amt-wk-pence",
        "line": 531
      },
      {
        "from": "amt-wk-pence",
        "to": "ws-pence",
        "line": 536
      },
      {
        "from": "amt-wk-pds",
        "to": "ws-pound",
        "line": 537
      },
      {
        "from": "ws-pound",
        "to": "amt-wk-pds",
        "line": 540
      },
      {
        "from": "ws-pence",
        "to": "amt-wk-pence",
        "line": 541
      },
      {
        "from": "zero",
        "to": "approp-amount oi3-invoice",
        "line": 553
      },
      {
        "from": "14",
        "to": "lin",
        "line": 554
      },
      {
        "from": "pay-customer",
        "to": "oi3-customer",
        "line": 555
      },
      {
        "from": "open-item-record-3",
        "to": "oi-header",
        "line": 566
      },
      {
        "from": "pay-date",
        "to": "oi-date-cleared\n              move 1 to oi-status\n              perform OTM3-Rewrite   *> rewrite open-item-record-3 from oi-header\n              go to pay-loop",
        "line": 583
      },
      {
        "from": "1",
        "to": "cole",
        "line": 594
      },
      {
        "from": "oi-invoice",
        "to": "display-inv",
        "line": 596
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 599
      },
      {
        "from": "11",
        "to": "cole",
        "line": 601
      },
      {
        "from": "work-net",
        "to": "work-1",
        "line": 604
      },
      {
        "from": "work-ded",
        "to": "work-2",
        "line": 605
      },
      {
        "from": "work-2",
        "to": "display-5\n     else\n              move  zero    to  display-5",
        "line": 611
      },
      {
        "from": "work-1",
        "to": "pay-paid",
        "line": 616
      },
      {
        "from": "work-1",
        "to": "display-8",
        "line": 617
      },
      {
        "from": "21",
        "to": "cole",
        "line": 618
      },
      {
        "from": "35",
        "to": "cole",
        "line": 621
      },
      {
        "from": "65",
        "to": "cole",
        "line": 624
      },
      {
        "from": "46",
        "to": "cole",
        "line": 633
      },
      {
        "from": "pay-paid",
        "to": "amt-ok",
        "line": 634
      },
      {
        "from": "amt-ok",
        "to": "pay-paid",
        "line": 636
      },
      {
        "from": "zero",
        "to": "pay-paid display-s\n              move 46 to cole\n              display display-s at curs with foreground-color 3\n              move 65 to cole\n              display \"",
        "line": 639
      },
      {
        "from": "first-sl-batch",
        "to": "oi-b-nos",
        "line": 646
      },
      {
        "from": "k",
        "to": "oi-b-item",
        "line": 647
      },
      {
        "from": "pay-date",
        "to": "oi-date-cleared\n              move 1  to  oi-status\n              if  u-bin  >  pay-date\n                  move zero  to  oi-deduct-amt  oi-deduct-vat\n                  add  work-2  to  deduct-taken\n              end-if\n              go to  end-line\n     end-if\n*>\n*>   I",
        "line": 661
      },
      {
        "from": "\"Y\"",
        "to": "ws-reply",
        "line": 682
      },
      {
        "from": "65",
        "to": "cole",
        "line": 683
      },
      {
        "from": "pay-date",
        "to": "oi-date-cleared\n              move 1  to  oi-status\n              add  work-2  to  deduct-taken\n              move  zero  to  oi-deduct-amt  oi-deduct-vat",
        "line": 688
      },
      {
        "from": "pay-date",
        "to": "oi-date-cleared\n              move 1 to oi-status",
        "line": 701
      },
      {
        "from": "14",
        "to": "lin",
        "line": 710
      },
      {
        "from": "65",
        "to": "cole",
        "line": 731
      },
      {
        "from": "zero",
        "to": "oi-extra oi-carriage oi-vat oi-discount\n                      oi-e-vat  oi-c-vat  oi-status",
        "line": 738
      },
      {
        "from": "zero",
        "to": "oi-cr oi-days oi-deduct-vat\n                      oi-deduct-days oi-p-c",
        "line": 740
      },
      {
        "from": "spaces",
        "to": "oi-description oi-applied oi-unapl\n                         oi-hold-flag",
        "line": 742
      },
      {
        "from": "pay-customer",
        "to": "oi-customer",
        "line": 744
      },
      {
        "from": "pay-date",
        "to": "oi-date",
        "line": 745
      },
      {
        "from": "transaction-type",
        "to": "oi-type",
        "line": 746
      },
      {
        "from": "pay-value",
        "to": "oi-paid",
        "line": 747
      },
      {
        "from": "approp-amount",
        "to": "oi-approp",
        "line": 748
      },
      {
        "from": "deduct-taken",
        "to": "oi-deduct-amt",
        "line": 749
      },
      {
        "from": "first-sl-batch",
        "to": "oi-b-nos",
        "line": 750
      },
      {
        "from": "k",
        "to": "oi-b-item",
        "line": 751
      },
      {
        "from": "zero",
        "to": "approp-amount  deduct-taken",
        "line": 756
      },
      {
        "from": "1",
        "to": "cole",
        "line": 764
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 778
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 780
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 784
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 791
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 797
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 798
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 815
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 817
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 820
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 824
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 831
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 847
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 850
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 854
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 861
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "Paid Early\n*>                    In Full.\n*> 24/10/83 Vbc - Conversion To Cis Cobol.\n*> 21/11/83 Vbc - Increase Batch No To 3 Digits.\n*> 05/03/84 Vbc - Support For Sales-Unapplied.\n*> 30/03/84 Vbc - Chg Payment Oi-Invoice To B-Nos*1000 + B-Item.\n*> 13/04/84 Vbc - Chg Pay2high Maybe To Cover Paymt < Total Inv >\n*>                 Total Inv - Deduct-Amt\n*> 10/05/84 Vbc - Support Of Indexed Openitm File.\n*> 16/05/84 Vbc - In Pay Details Display Inv Amt O/S At 21.\n*> 25/09/84 Vbc - Check If Next-Batch = 0,Then Add 1.\n*> 21/02/85 Vbc - Set S-Flag-P To 1\n*> 05/03/85 Vbc - Replace Usage Of Next-Batch For First-Sl-Batch.\n*> 03/03/09 vbc - Migration to Open GNU Cobol v3.00.00.\n*> 19/03/09 vbc - Bug/Feature 30.6 allowed out thru Escape.\n*> 25/11/11 vbc - .06 Error msgs to SLnnn.Support for dates other than UK\n*> 08/12/11 vbc - .07 Support for path+filenames.\n*> 09/12/11 vbc -     Updated version to 3.01.nn\n*> 11/12/11 vbc - .08 Changed usage of Stk-Date-Form to the global field\n*>                    Date-Form making former redundent.\n*> 24/10/16 vbc - .09 ALL programs now using wsnames.cob in copybooks\n*> 15/01/17 vbc - .   All programs upgraded to v3.02 for RDB processing.\n*>                    Removed/replaced all refs to maps99 with displays\n*>                    replaced file-status.\n*> 23/01/17 vbc       Dry testing completed.\n*> 07/02/17 vbc - .10 Updated FD/WS for 019 and replaced cobol verbs\n*>                    for access to FH/DALs.\n*> 10/12/22 vbc   .11 Added para after some sections 4 GC 3.2 warning msgs.\n*> 03/04/23 vbc - .12 Using ws-lines for error msgs at start of prog.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> These files and programs is part of the Applewood Computers Accounting\n*> System and is copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms of the GNU General Public License as published by the\n*> Free Software Foundation; version 3 and later as revised for personal\n*> usage only and that includes for use within a business but without\n*> repackaging or for Resale in any way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental mode must get in touch with the copyright holder\n*> with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n*> copy \"selsl.cob\".\n*> copy \"seloi3.cob\".\n*>\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdsl.cob\".\n*> copy \"fdoi3.cob\".\n working-storage section.\n*>----------------------\n  77  prog-name           pic x(15)      value \"SL080 (3.02.12)\".\n*>\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n 01  ws-amount-screen-display.\n     03  ws-poundsd      pic 9(7).\n     03  ws-period       pic x     value \".\".\n     03  ws-penced       pic v99.\n 01  ws-amount-screen-accept redefines ws-amount-screen-display.\n     03  ws-pound        pic 9(7).\n     03  filler          pic x.\n     03  ws-pence        pic v99.\n*>\n 01  ws-amount-work.\n     03  amt-wk-pds      pic 9(7).\n     03  amt-wk-pence    pic v99.\n 01  ws-amount-ok redefines ws-amount-work.\n     03  amt-ok          pic 9(7)v99.\n*>\n*> copy \"wsoi.cob\".\n copy \"wssl.cob\".\n copy \"slwsoi3.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n     03  WS-Posting-Record      pic x.\n     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n*>     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  File-Info                          value zero.\n     05 File-Size-Bytes  pic 9(18) comp.\n     05 Mod-DD           pic 9(2)  comp.\n     05 Mod-MO           pic 9(2)  comp.\n     05 Mod-YYYY         pic 9(4)  comp.\n     05 Mod-HH           pic 9(2)  comp.\n     05 Mod-MM           pic 9(2)  comp.\n     05 Mod-SS           pic 9(2)  comp.\n     05 filler           pic 9(2)  comp. *> Always 00\n*>\n 01  ws-data.\n     03  ws-reply        pic x.\n     03  z               pic 99.\n     03  to-day          pic x(10).\n     03  c-check         pic 9.\n         88  c-exists                          value  1.\n     03  work-1          pic 9(7)v99    comp-3 value zero.\n     03  work-2          pic 999v99     comp-3 value zero.\n     03  work-3          pic 9(7)v99    comp-3 value zero.\n     03  work-net        pic s9(7)v99   comp-3 value zero.\n     03  work-ded        pic 999v99     comp-3 value zero.\n     03  work-av         pic s9(14)     comp-3 value zero.\n     03  display-8       pic z(6)9.99.\n     03  display-s       pic z(6)9.99cr.\n     03  display-5       pic zz9.99.\n     03  display-n       pic z(4)9.\n     03  display-inv     pic z(7)9.\n     03  i               pic 99.\n     03  j               pic 99.\n     03  k               pic 999.\n     03  approp-amount   pic 9(6)v99    comp-3  value zero.\n     03  deduct-taken    pic 9(6)v99    comp-3  value zero.\n     03  pay-customer    pic x(7).\n     03  pay-date        binary-long.\n     03  pay-value       pic 9(7)v99     comp-3 value zero.\n     03  batch-value     pic 9(7)v99     comp-3 value zero.\n     03  pay-paid        pic s9(7)v99    comp-3 value zero.\n     03  test-amount     pic s9(7)v99    comp-3 value zero.\n     03  address-A       pic x(96).\n     03  address-line    pic x(36).\n     03  ws-dash         pic x(80)              value all \"-\".\n     03  transaction-type pic 9                 value zero.\n         88 trans-payment                       value 5.\n         88 trans-unapplied                     value 6.\n     03  ws-env-lines    pic 999                value zero.\n     03  ws-lines        binary-char unsigned   value zero.\n     03  ws-23-lines     binary-char unsigned   value zero.\n*>\n 01  All-My-Constants    pic 9(4).\n     copy \"screenio.cpy\".\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n*>       NONE\n*> Module specific\n     03  SL116           pic x(38) value \"SL116 Note: and hit return to continue\".\n     03  SL119           pic x(35) value \"SL119 Sales Transactions Not Posted\".\n     03  SL121           pic x(52) value\n                        \"SL121 Invoices Not Posted; Payment Entry Not Allowed\".\n*>\n 01  error-code          pic 999.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  today               pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          today\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n     accept   ws-env-lines   from lines.\n     if       ws-env-lines < 24\n              move  24 to ws-env-lines ws-lines\n     else\n              move  ws-env-lines   to ws-lines\n     end-if\n     subtract 1 from ws-lines giving ws-23-lines.\n     move     today to to-day.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n     if       S-Flag-I = 1\n              display SL121   at 0501\n              display SL116   at line ws-lines col 1  *> 2401\n              accept ws-reply at line ws-lines col 40 *> 2440\n              go to main-exit.\n*>\n     if       FS-Cobol-Files-Used\n              call  \"CBL_CHECK_FILE_EXIST\" using File-19    *> Open ITM3 file\n                                                 File-Info\n              if    return-code not = zero          *> not = zero - No file found\n                    display  SL119  at line ws-23-lines col 1  *> 2301\n                    display  SL116  at line ws-lines col 1  *> 2401\n                    accept ws-reply at line ws-lines col 40  *> 2440\n                    go to main-exit\n              end-if\n     end-if.\n*>\n display-heads.\n*>\n     display  prog-name at 0101 with erase eos foreground-color 2.\n     display  \"Payment Data Entry\" at 0133  with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n dh-exit.\n*>\n     move     zero  to  k.\n     perform  OTM3-Open.    *> open i-o open-item-file-3  sales-file\n     perform  Sales-Open.\n     perform  New-Payment.\n     perform  OTM3-Close.   *> close open-item-file-3 sales-file\n     perform  Sales-Close.\n*>\n menu-exit.\n*>********\n*>\n     perform  display-heads.\n     add      1  to first-sl-batch.\n     move     \"Y\" to oi-3-flag.\n*>\n main-exit.\n     exit     program.\n*>\n*>********************************************\n*>                Procedures                 *\n*>********************************************\n*>\n New-Payment  section.\n*>===================\n*>\n New-Payment-Main.\n     move     4  to  lin.\n     perform  display-heads.\n*>\n     display  \"****************************************\" at 0441  with foreground-color 2.\n     display  \"*Date    [  /  /    ]*A/C Nos [       ]*\" at 0541  with foreground-color 2.\n     display  \"***                                  ***\" at 0641  with foreground-color 2.\n     display  \"*Value   {          }*Batch [     /   ]*\" at 0741  with foreground-color 2.\n     display  \"****************************************\" at 0841  with foreground-color 2.\n*>\n date-input.\n*>*********\n*>\n     perform  zz070-Convert-Date.\n     display  ws-date at 0551 with foreground-color 3.\n     accept   ws-date at 0551 with foreground-color 3 update.\n*>\n     if       ws-date = spaces\n         or   cob-crt-status = cob-scr-esc\n              go to  main-exit.\n*>\n     move     ws-date to ws-test-date.\n     move     zero  to  u-bin.\n     perform  zz050-Validate-Date.\n     if       u-bin = zero\n              go to  date-input.\n*>\n     move     u-bin  to  pay-date.\n     move     u-date to  to-day.\n*>\n customer-input.\n*>*************\n*>\n     if       k  =  999\n              display \"Batch Closed..It is Full!  \" at 1041 with foreground-color 2\n              go to  main-exit.\n*>\n     move     spaces to pay-customer.\n     accept   pay-customer at 0572 with foreground-color 3 update UPPER.\n     display  pay-customer at 0572 with foreground-color 3.\n*>\n     if       pay-customer = spaces\n              go to date-input.\n     if       cob-crt-status = cob-scr-esc\n              go to  main-exit.\n*>\n     move     1  to  c-check.\n     move     pay-customer  to  WS-Sales-Key.\n*>\n     perform  Sales-Read-Indexed.     *>  read sales-file record invalid key\n     if       fs-reply = 21\n              move  zero  to  c-check.\n*>\n     if       not  c-exists\n              go to  customer-input.\n*>\n     move     sales-address  to  address-a.\n     display  sales-name at 0401 with foreground-color 3.\n*>\n     move     1  to  z.\n     unstring address-a  delimited by sl-delim into  address-line count z pointer  z.\n     display  address-line at 0501 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited by sl-delim into  address-line count z pointer  z.\n     display  address-line at 0601 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  delimited by sl-delim into  address-line count z pointer  z.\n     display  address-line at 0701 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n     unstring address-a  into  address-line pointer  z.\n     display  address-line at 0801 with foreground-color 3.\n*>\n     move     spaces  to  address-line.\n*>\n     move     sales-current  to  display-s.\n     display  \"Current Balance - \" at 1001  with foreground-color 2.\n     display  display-s at 1019 with foreground-color 3.\n*>\n     move     5 to transaction-type.\n     if       sales-unapplied = zero\n              go to value-input.\n*>\n     move     sales-unapplied to display-8 amt-ok.\n     display  \"Unapplied Balance - \" at 0645 with foreground-color 2.\n     display  display-8 at 0665   with foreground-color 3.\n     display  \"Do you wish to allocate the Unapplied Balance to this account?  [Y]\" at 1601 with foreground-color 2.\n     move     \"Y\" to ws-reply.\n*>\n accept-unappl-reqst.\n*>------------------\n*>\n     move     zero to cob-crt-status.\n     accept   ws-reply at 1666 with foreground-color 6 update UPPER.\n     if       cob-crt-status = cob-scr-esc\n              go to New-Payment-Main.\n     if       ws-reply not = \"Y\" and not = \"N\"\n              go to accept-unappl-reqst.\n     if       ws-reply = \"N\"\n              display \" \" at 1601 with erase eol\n              go to value-input.\n*>\n     move     6 to transaction-type.\n     display  \" \" at 1601 with erase eol.\n     move     0749 to curs.\n*>\n accept-unappl-money.\n*>------------------\n*>\n     perform  accept-money2.\n     if       amt-ok = zero\n              go to New-Payment-Main.\n     if       amt-ok > sales-unapplied\n              go to accept-unappl-money.\n*>\n     subtract amt-ok from sales-unapplied.\n     move     amt-ok to pay-value.\n     perform  Sales-Rewrite.                *>  rewrite  sales-record.\n     go       to set-batch-item.\n*>\n value-input.\n*>**********\n*>\n     move     0749 to curs.\n     perform  accept-money.\n     move     amt-ok to pay-value.\n     if       pay-value = zero\n              go to customer-input.\n     if       cob-crt-status = cob-scr-esc\n              go to  main-exit.\n*>\n     move     1 to s-flag-p.\n     add      pay-value  to  batch-value.\n     move     batch-value  to  display-s.\n     display  \"Batch Total - \" at 1041 with foreground-color 2.\n     display  display-s at 1055 with foreground-color 3.\n*>\n set-batch-item.\n*>-------------\n*>\n     if       first-sl-batch = zero\n              move 1 to first-sl-batch.\n     move     first-sl-batch  to  display-n.\n     add      1  to  k.\n     display  display-n at 0770 with foreground-color 3.\n     display  k at 0776 with foreground-color 3.\n*>\n data-input.\n*>*********\n*>\n     perform  Payment-Appropriate.\n     move     14  to  lin.\n     perform  erase-screen.\n*>\n     display \"Enter further payments (Y/N) ? [Y]\" at 1629 with foreground-color 2.\n*>\n more-data.\n*>\n     move     \"Y\"  to   ws-reply.\n     accept   ws-reply at 1661 with foreground-color 6 update UPPER.\n*>\n     if       ws-reply = \"Y\"\n              go to  New-Payment-Main.\n     if       ws-reply not = \"N\"\n              go to more-data.\n     go       to main-exit.\n*>\n accept-money.\n*>-----------\n*>\n     move     zero to ws-poundsd amt-ok ws-penced.\n     display  ws-amount-screen-display at curs with foreground-color 3.\n     accept   ws-amount-screen-accept at curs  with foreground-color 3 update.\n     move     ws-pound to amt-wk-pds.\n     move     ws-pence to amt-wk-pence.\n*>\n accept-money2.\n*>------------\n*>\n     move     amt-wk-pence to ws-pence.\n     move     amt-wk-pds to ws-pound.\n     display  ws-amount-screen-display at curs with foreground-color 3.\n     accept   ws-amount-screen-accept at curs  with foreground-color 3 update.\n     move     ws-pound to amt-wk-pds.\n     move     ws-pence to amt-wk-pence.\n*>\n main-exit.   exit section.\n*>\n Payment-Appropriate     section.\n*>==============================\n*>\n     display   ws-dash at 1101 with foreground-color 2.\n     display  \"Inv.Nos  --Date--  --Amount--\" at 1202  with foreground-color 2.\n     display  \"Deductable  ---Paid----\" at 1233        with foreground-color 2.\n     display  \"Deduction Taken\" at 1258                with foreground-color 2.\n*>\n     move     zero  to  approp-amount oi3-invoice.\n     move     14  to  lin.\n     move     pay-customer to oi3-customer.\n     set      fn-not-less-than to true.\n     perform  OTM3-Start.      *> start open-item-file-3 key not < oi3-key.\n*>\n pay-loop.\n*>*******\n*>\n     perform  OTM3-Read-Next.   *>  read open-item-file-3 next record  at end\n     if       fs-reply = 10\n              go to  main-end.\n*>\n  *>   move     open-item-record-3  to  oi-header. *> redefined.\n*>\n     if       oi-type not = 2\n              go to  pay-loop.\n*>\n     if       oi-customer not = pay-customer\n              go to main-end.\n*>\n     if       oi-b-nos not = zero\n              go to pay-loop.\n*>\n     add      oi-net  oi-extra  oi-carriage  oi-vat oi-c-vat\n              oi-discount  oi-e-vat giving work-net.\n     add      oi-deduct-amt  oi-deduct-vat  giving work-ded.\n     add      work-net work-ded giving test-amount.\n     if       test-amount = oi-paid\n        and   oi-status = zero\n              move pay-date to oi-date-cleared\n              move 1 to oi-status\n              perform OTM3-Rewrite   *> rewrite open-item-record-3 from oi-header\n              go to pay-loop.\n*>\n     if       test-amount  not >  oi-paid\n              go to  pay-loop.\n*>\n pay-details.\n*>**********\n*>\n     move     1 to cole.\n     display  \" \" at curs with erase eol.\n     move     oi-invoice to display-inv.\n     display  display-inv at curs with foreground-color 3.\n*>\n     move     oi-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     11 to cole.\n     display  u-date at curs with foreground-color 3.\n*>\n     move     work-net to work-1.\n     move     work-ded to work-2.\n*>\n     add      1  oi-deduct-days  to  u-bin.\n     add      work-2  to  work-1.\n     if       u-bin  >  pay-date\n              subtract  work-2  from  work-1\n              move  work-2  to  display-5\n     else\n              move  zero    to  display-5.\n*>\n     subtract oi-paid  from  work-1.\n     move     work-1 to pay-paid.\n     move     work-1  to  display-8.\n     move     21 to cole.\n     display  display-8 at curs with foreground-color 3.\n*>\n     move     35 to cole.\n     display  display-5 at curs with foreground-color 3.\n*>\n     move     65 to cole.\n     if       pay-paid = zero\n              display \"....Fully Paid  \" at curs  with foreground-color 2\n     else\n              display \" \" at curs with erase eol.\n*>\n     if       pay-paid > pay-value\n              subtract approp-amount from pay-value  giving pay-paid.\n*>\n     move     46 to cole.\n     move     pay-paid to amt-ok.\n     perform  accept-money2.\n     move     amt-ok to pay-paid.\n*>\n     if       pay-paid = zero\n              move  zero  to  pay-paid display-s\n              move 46 to cole\n              display display-s at curs with foreground-color 3\n              move 65 to cole\n              display \"....No Change  \" at curs  with foreground-color 2\n              go to  end-line-2.\n*>\n     move     first-sl-batch  to  oi-b-nos.\n     move     k  to  oi-b-item.\n*>\n get-agreement.\n*>************\n*>\n*>  If payment within discount term, discount has been\n*>    subtracted from work-1\n*>\n     add      pay-paid  to  approp-amount.\n*>\n     if       approp-amount  >  pay-value\n              go to  payment-2-high.\n*>\n     if       pay-paid = work-1\n              move pay-date to oi-date-cleared\n              move 1  to  oi-status\n              if  u-bin  >  pay-date\n                  move zero  to  oi-deduct-amt  oi-deduct-vat\n                  add  work-2  to  deduct-taken\n              end-if\n              go to  end-line\n     end-if\n*>\n*>   I.e., not paid within discount term & amt paid not = inv amt\n*>     o/s (with deduct amt)\n*>\n     if       u-bin  not >  pay-date\n              subtract  work-2  from  work-1.\n     if       pay-paid > work-1\n              go to payment-2-high-maybe.\n     if       pay-paid not = work-1\n              go to  end-line.\n*>\n*>   I.e., Amt paid < inv amt o/s\n*>\n     move     \"Y\"  to  ws-reply.\n     move     65 to cole.\n     display  ws-reply at curs with foreground-color 6.\n     accept   ws-reply at curs with foreground-color 6 update UPPER.\n*>\n     if       ws-reply = \"Y\"\n              move pay-date to oi-date-cleared\n              move 1  to  oi-status\n              add  work-2  to  deduct-taken\n              move  zero  to  oi-deduct-amt  oi-deduct-vat.\n*>\n end-line.\n*>*******\n*>\n     add      pay-paid  to  oi-paid.\n     add      pay-paid  to  oi-p-c.\n     multiply 100 by pay-paid giving oi-cr.\n     add      oi-deduct-amt oi-deduct-vat to work-net.\n     if       oi-paid = work-net\n              move pay-date to oi-date-cleared\n              move 1 to oi-status.\n*>\n     perform OTM3-Rewrite.   *> rewrite open-item-record-3 from oi-header.\n*>\n end-line-2.\n*>\n     add      1  to  lin.\n     if       lin  >  23\n              move  14  to  lin.\n*>\n     if       approp-amount  not <  pay-value\n              go to  main-end.\n     go       to pay-loop.\n*>\n payment-2-high-maybe.\n*>*******************\n*>\n*>   Check for paying late charge within time limit.\n*>\n     add      work-2 to work-1.\n     if       pay-paid > work-1\n              go to payment-2-high.\n*>\n     go       to end-line.\n*>\n payment-2-high.\n*>*************\n*>\n     subtract pay-paid  from  approp-amount.\n     move     65 to cole.\n     display  \"Payment Too High\" at curs with foreground-color 2.\n     go       to pay-details.\n*>\n main-end.\n*>*******\n*>\n     move     zero to oi-extra oi-carriage oi-vat oi-discount\n                      oi-e-vat  oi-c-vat  oi-status.\n     move     zero to oi-cr oi-days oi-deduct-vat\n                      oi-deduct-days oi-p-c.\n     move     spaces to oi-description oi-applied oi-unapl\n                         oi-hold-flag.\n     move     pay-customer  to  oi-customer.\n     move     pay-date  to  oi-date.\n     move     transaction-type to  oi-type.\n     move     pay-value to  oi-paid.\n     move     approp-amount  to  oi-approp.\n     move     deduct-taken   to  oi-deduct-amt.\n     move     first-sl-batch  to  oi-b-nos.\n     move     k  to  oi-b-item.\n     multiply oi-b-nos by 1000 giving oi-invoice.\n     add      oi-b-item to oi-invoice.\n*>\n     perform  OTM3-Write.      *> write open-item-record-3 from oi-header.\n     move     zero  to  approp-amount  deduct-taken.\n*>\n main-exit.   exit section.\n*>********    ****.\n*>\n erase-screen            section.\n*>==============================\n*>\n     move     1 to cole.\n     display  \" \" at curs with erase eos.\n*>\n main-exit.   exit section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>****************************************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 55
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 4,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 93,
      "totalOperators": 100,
      "totalOperands": 200,
      "vocabulary": 94,
      "length": 300,
      "volume": 1966.3766555032912
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
