{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/general/gl080.cbl",
  "fileName": "gl080.cbl",
  "timestamp": "2025-09-15T16:25:32.534Z",
  "programId": "gl080",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 133
      },
      {
        "name": "file",
        "line": 154
      },
      {
        "name": "working-storage",
        "line": 179
      },
      {
        "name": "linkage",
        "line": 261
      },
      {
        "name": "gl080-Main",
        "line": 276
      },
      {
        "name": "gl080a",
        "line": 369
      },
      {
        "name": "gl080b",
        "line": 399
      },
      {
        "name": "arc-process",
        "line": 446
      },
      {
        "name": "disk-change",
        "line": 520
      },
      {
        "name": "gl080c",
        "line": 563
      },
      {
        "name": "del-process",
        "line": 601
      },
      {
        "name": "compress-post",
        "line": 629
      },
      {
        "name": "exit",
        "line": 709
      },
      {
        "name": "Evaluate-Message",
        "line": 711
      },
      {
        "name": "zz070-Convert-Date",
        "line": 720
      },
      {
        "name": "exit",
        "line": 748
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 136
      },
      {
        "name": "file-defs",
        "line": 273
      },
      {
        "name": "goback",
        "line": 303
      },
      {
        "name": "loop",
        "line": 340
      },
      {
        "name": "loop-end",
        "line": 352
      },
      {
        "name": "main-end",
        "line": 366
      },
      {
        "name": "goback",
        "line": 367
      },
      {
        "name": "loop",
        "line": 375
      },
      {
        "name": "end-run",
        "line": 391
      },
      {
        "name": "loop",
        "line": 418
      },
      {
        "name": "end-run",
        "line": 437
      },
      {
        "name": "loop",
        "line": 453
      },
      {
        "name": "by-pass",
        "line": 511
      },
      {
        "name": "accept-option",
        "line": 543
      },
      {
        "name": "loop",
        "line": 573
      },
      {
        "name": "end-run",
        "line": 593
      },
      {
        "name": "loop",
        "line": 610
      },
      {
        "name": "end-if",
        "line": 636
      },
      {
        "name": "Test-Work-File-Size-1",
        "line": 640
      },
      {
        "name": "loop1",
        "line": 655
      },
      {
        "name": "loop1-end",
        "line": 668
      },
      {
        "name": "loop2",
        "line": 676
      },
      {
        "name": "file-error",
        "line": 689
      },
      {
        "name": "loop2-end",
        "line": 700
      },
      {
        "name": "main-exit",
        "line": 706
      },
      {
        "name": "zz070-Exit",
        "line": 747
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [],
    "copies": [
      {
        "name": "of",
        "line": 123,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 132,
        "replacing": null
      },
      {
        "name": "seledger",
        "line": 148,
        "replacing": null
      },
      {
        "name": "selbatch",
        "line": 149,
        "replacing": null
      },
      {
        "name": "selpost",
        "line": 150,
        "replacing": null
      },
      {
        "name": "fdledger",
        "line": 175,
        "replacing": null
      },
      {
        "name": "fdbatch",
        "line": 176,
        "replacing": null
      },
      {
        "name": "fdpost",
        "line": 177,
        "replacing": null
      },
      {
        "name": "wsledger",
        "line": 189,
        "replacing": null
      },
      {
        "name": "wsbatch",
        "line": 190,
        "replacing": null
      },
      {
        "name": "wspost",
        "line": 191,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 217,
        "replacing": null
      },
      {
        "name": "screenio",
        "line": 220,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 259,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 264,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 265,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 266,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 714,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 750,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-convert-date",
        "thru": null,
        "line": 286
      },
      {
        "target": "gl080a",
        "thru": null,
        "line": 308
      },
      {
        "target": "gl080b",
        "thru": null,
        "line": 318
      },
      {
        "target": "gl080c",
        "thru": null,
        "line": 321
      },
      {
        "target": "compress-post",
        "thru": null,
        "line": 323
      },
      {
        "target": "GL-Nominal-Open",
        "thru": null,
        "line": 338
      },
      {
        "target": "GL-Nominal-Read-Next",
        "thru": null,
        "line": 343
      },
      {
        "target": "GL-Nominal-Rewrite",
        "thru": null,
        "line": 349
      },
      {
        "target": "GL-Nominal-Close",
        "thru": null,
        "line": 355
      },
      {
        "target": "GL-Batch-Open-Input",
        "thru": null,
        "line": 373
      },
      {
        "target": "GL-Batch-Read-Next",
        "thru": null,
        "line": 378
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 394
      },
      {
        "target": "disk-change",
        "thru": null,
        "line": 407
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 416
      },
      {
        "target": "GL-Batch-Read-Next",
        "thru": null,
        "line": 421
      },
      {
        "target": "arc-process",
        "thru": null,
        "line": 428
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 429
      },
      {
        "target": "GL-Batch-Rewrite",
        "thru": null,
        "line": 434
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 441
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 451
      },
      {
        "target": "GL-Posting-Read-Next",
        "thru": null,
        "line": 456
      },
      {
        "target": "GL-Posting-Delete",
        "thru": null,
        "line": 514
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 571
      },
      {
        "target": "GL-Batch-Read-Next",
        "thru": null,
        "line": 576
      },
      {
        "target": "del-process",
        "thru": null,
        "line": 583
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 584
      },
      {
        "target": "GL-Batch-Rewrite",
        "thru": null,
        "line": 590
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 596
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 608
      },
      {
        "target": "GL-Posting-Read-Next",
        "thru": null,
        "line": 613
      },
      {
        "target": "GL-Posting-Delete",
        "thru": null,
        "line": 623
      },
      {
        "target": "GL-Posting-Open-Input",
        "thru": null,
        "line": 652
      },
      {
        "target": "GL-Posting-Read-Next",
        "thru": null,
        "line": 658
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 672
      },
      {
        "target": "GL-Posting-Open-Output",
        "thru": null,
        "line": 674
      },
      {
        "target": "GL-Posting-Write",
        "thru": null,
        "line": 684
      },
      {
        "target": "evaluate-message",
        "thru": null,
        "line": 694
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 704
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 289
      },
      {
        "from": "zero",
        "to": "a",
        "line": 291
      },
      {
        "from": "scycle",
        "to": "lin2",
        "line": 292
      },
      {
        "from": "space",
        "to": "keyed-reply",
        "line": 299
      },
      {
        "from": "space",
        "to": "keyed-reply\n              accept   keyed-reply at 1065 with update auto\n              go to  main-end",
        "line": 312
      },
      {
        "from": "ledger-balance",
        "to": "ledger-q (a)",
        "line": 346
      },
      {
        "from": "ledger-balance",
        "to": "ledger-last",
        "line": 348
      },
      {
        "from": "1",
        "to": "current-quarter",
        "line": 358
      },
      {
        "from": "1",
        "to": "scycle",
        "line": 361
      },
      {
        "from": "1",
        "to": "scycle",
        "line": 364
      },
      {
        "from": "1",
        "to": "a",
        "line": 387
      },
      {
        "from": "2",
        "to": "cleared-status",
        "line": 431
      },
      {
        "from": "run-date",
        "to": "stored",
        "line": 432
      },
      {
        "from": "zero",
        "to": "batch-start",
        "line": 433
      },
      {
        "from": "WS-Batch-Nos",
        "to": "arc-batch",
        "line": 450
      },
      {
        "from": "batch",
        "to": "arc-batch",
        "line": 466
      },
      {
        "from": "post-number",
        "to": "arc-post",
        "line": 467
      },
      {
        "from": "post-date",
        "to": "arc-date",
        "line": 469
      },
      {
        "from": "post-legend",
        "to": "arc-legend",
        "line": 470
      },
      {
        "from": "post-dr",
        "to": "arc-ac",
        "line": 472
      },
      {
        "from": "dr-pc",
        "to": "arc-pc",
        "line": 473
      },
      {
        "from": "post-cr",
        "to": "arc-c-ac",
        "line": 474
      },
      {
        "from": "cr-pc",
        "to": "arc-c-pc",
        "line": 475
      },
      {
        "from": "post-amount",
        "to": "arc-amount",
        "line": 480
      },
      {
        "from": "post-cr",
        "to": "arc-ac",
        "line": 484
      },
      {
        "from": "cr-pc",
        "to": "arc-pc",
        "line": 485
      },
      {
        "from": "post-dr",
        "to": "arc-c-ac",
        "line": 486
      },
      {
        "from": "dr-pc",
        "to": "arc-c-pc",
        "line": 487
      },
      {
        "from": "post-amount",
        "to": "arc-amount",
        "line": 492
      },
      {
        "from": "vat-pc",
        "to": "arc-pc",
        "line": 503
      },
      {
        "from": "vat-amount",
        "to": "arc-amount",
        "line": 504
      },
      {
        "from": "space",
        "to": "Arg-Test",
        "line": 531
      },
      {
        "from": "Arg-Test",
        "to": "file-2",
        "line": 538
      },
      {
        "from": "2",
        "to": "cleared-status",
        "line": 586
      },
      {
        "from": "run-date",
        "to": "stored",
        "line": 587
      },
      {
        "from": "zero",
        "to": "batch-start",
        "line": 588
      },
      {
        "from": "work-file-record",
        "to": "WS-Posting-Record",
        "line": 683
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 728
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 731
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 735
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 742
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "Archiving is set to Yes\n*>                        in the system parameter file under G/L for Cobol files.\n*>                        It will also check if there are any non proofed or\n*>                        posted batches present and exit with a message GL088.\n*>\n*>                        For RDB usage it is not needed as the RDB system will be\n*>                        running back ups daily or more often assuming you have\n*>                        turned on such back ups frequently, eg, hourly/daily.\n*>                        However these is no difference in processing for RDB.\n*>\n*>                        However For Cobol file processing, this is a bit moot\n*>                        assuming system makes a back up after processing, e.g.,\n*>                        when exiting the system, this is the same for all\n*>                        other systems such as sales, purchase, stock & irs,\n*>\n*>                        This process is a hold over from usage of floppies\n*>                        as the main storage medium for all files.\n*>                        It is, based on old systems converted to the original\n*>                        Personal Computers and as of now.\n*>\n*>                        Note that IRS does not do this but retains the posting\n*>                        until End of Year where it can be",
        "line": 41
      },
      {
        "type": "IF",
        "condition": "it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>-----------\n*>\n     select  archive    assign  file-2\n                        access  sequential\n                        status  fs-reply\n                        organization  line sequential.\n*>\n     select  work-file  assign  file-21\n                        access  sequential\n                        organization  sequential\n                        status  fs-reply.\n*> copy \"seledger.cob\".\n*> copy \"selbatch.cob\".\n*> copy \"selpost.cob\".\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n fd  archive.\n*>\n 01  arc-trans-record.\n     03  arc-batch       pic 9(5).\n     03  arc-post        pic 9(5).\n     03  arc-code        pic xx.\n     03  arc-date        pic x(8).\n     03  arc-ac          pic 9(6).\n     03  arc-pc          pic 99.\n     03  arc-amount      pic s9(8)v99.\n     03  arc-legend      pic x(32).\n     03  arc-c-ac        pic 9(6).\n     03  arc-c-pc        pic 99.\n*>\n fd  work-file.\n*>\n 01  work-file-record    pic x(101).     *> Was 96 added 5 for WS-Post-rrn (9(5).\n*>\n*> copy \"fdledger.cob\".\n*> copy \"fdbatch.cob\".\n*> copy \"fdpost.cob\".\n*>\n working-storage section.\n*>----------------------\n*>\n 77  prog-name           pic x(15)  value \"gl080 (3.02.04)\".\n 77  y                   pic 99     value zero.\n 77  a                   pic 99     value zero.\n 77  keyed-reply         pic x      value space.\n 77  ws-eval-msg         pic x(25)  value spaces.\n*>\n 01  Arg-Test            pic x(525) value spaces.\n copy \"wsledger.cob\".\n copy \"wsbatch.cob\".\n copy \"wspost.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n*>     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n*>     03  WS-Ledger-Record       pic x.\n*>     03  WS-Posting-Record      pic x.\n*>     03  WS-Batch-Record        pic x.\n     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  accept-terminator-array   pic 9(4).\n     copy \"screenio.cpy\".\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n    03  GL012           pic x(25) value \"GL012 Note and hit Return\".\n*> Module specific\n    03  GL081           pic x(54) value \"GL081 File Error On Writing Work/Post. Aborting Phase.\".\n    03  GL082           pic x(44) value \"GL082 Post record size not same as Work file\".\n    03  GL083           pic x(44) value \"GL083 You need to fix this before continuing\".\n    03  GL084           pic x(70) value \"GL084 Enter <0> to signify change made or <9> to abort this run :- [ ]\".\n    03  GL085           pic x(48) value \"GL085 Ensure Archive USB Memory Stick is in path\".\n    03  GL086           pic x(60) value \"GL086 Ensure you have done a file backup prior to running!!!\".\n    03  GL087           pic x(36) value \"GL087 Hit Escape or press A to abort\".\n    03  GL088           pic x(60) value \"GL088 Batches present that have NOT been proofed or posted !\".\n*>\n copy \"wsfnctn.cob\".\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>***************************************\n*>\n gl080-Main section.\n*>*****************\n*>\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n*>\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"End Of Cycle Processing\" at 0130 with foreground-color 2.\n     perform  zz070-convert-date.\n     display  ws-date at 0171 with foreground-color 2.\n     display  usera at 0301 with foreground-color 3.\n     move     1  to File-Key-No.\n*>\n     move     zero  to  a.\n     move     scycle to lin2.\n*>\n*> Let check that a back up has been run first\n*>\n     display  GL085  at 0801 with foreground-color 3.\n     display  GL086  at 0901 with foreground-color 3 highlight.\n     display  GL087  at 1001 with foreground-color 3 highlight.\n     move     space to keyed-reply.\n     accept   keyed-reply at 1065 with update auto.\n     if       cob-crt-status = cob-scr-esc\n         or   keyed-reply = \"A\" or \"a\"\n              goback.\n*>\n*> Good now we can process\n*>\n     display  \"Phase - 1.  Batch Check\" at 0801 with foreground-color 2 erase eos.\n     perform  gl080a.\n     if       a = 1\n              display GL088 at 1501 with foreground-color 2\n              display GL012 at 1701 with foreground-color 2\n              move     space to keyed-reply\n              accept   keyed-reply at 1065 with update auto\n              go to  main-end.\n*>\n     if       archiving\n              display \"Phase - 2.  Transaction Archiving\" at 0801 with foreground-color 2\n              perform gl080b\n     else\n              display \"Phase - 3.  Transaction Deletion\" at 0801 with foreground-color 2\n              perform gl080c.\n*>\n     perform  compress-post.\n*>\n     if       a = 9\n          or  scycle <  period\n              go to  main-end.\n*>\n     divide   scycle by period giving a rounded.\n     multiply a  by  period  giving  y.\n*>\n     if       scycle not = y\n              go to  main-end.\n*>\n     add      1  to scycle.\n*>\n     display  \"Phase - 5.  End of Period Processing\" at 0801 with foreground-color 2.\n     perform  GL-Nominal-Open.                   *> open     i-o  ledger-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Nominal-Read-Next.               *> read     ledger-file  next record at end\n     if       fs-reply = 10\n              go to  loop-end.\n     move     ledger-balance  to  ledger-q (a).\n     if       current-quarter = 4\n              move  ledger-balance  to  ledger-last.\n     perform  GL-Nominal-Rewrite.                 *> rewrite  ledger-record.\n     go       to loop.\n*>\n loop-end.\n*>*******\n*>\n     perform  GL-Nominal-Close.                   *> close    ledger-file.\n     add      1  to  current-quarter.\n     if       current-quarter = 5\n              move  1  to  current-quarter.\n     if       period = 3\n        and   scycle > 12\n              move 1 to scycle.\n     if       period = 13\n        and   scycle > 52\n              move 1 to scycle.\n*>\n main-end.\n      goback.\n*>\n gl080a section.\n*>*************\n*>\n     display  \"Checking Batches\" AT 2301 with foreground-color 2.\n     perform  GL-Batch-Open-Input.              *> open     input  batch-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Batch-Read-Next.               *> read     batch-file  next record  at end\n     if       fs-reply = 10\n              go to  end-run.\n*>\n     if       bcycle not = scycle\n              go to  loop.\n*>\n     if       not status-closed\n       and    not processed\n              move  1  to  a.\n*>\n     go       to loop.\n*>\n end-run.\n*>******\n*>\n     perform  GL-Batch-Close.                    *> close    batch-file.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n gl080b section.\n*>*************\n*>\n     display  \"Archiving.      Cycle - \" at 2301  with foreground-color 2.\n     display  lin2 at 2330         with foreground-color 2.\n     display  \"/ Batch - \" at 2334 with foreground-color 2.\n     display  \"/ Item  - \" at 2352 with foreground-color 2.\n*>\n     perform  disk-change.  *>   set up o/p path\n*>\n     if       a = 9\n              go to  main-exit.\n*>\n     open     extend  archive.\n     if       fs-reply not = zero   *> just in case extend wont create\n              close archive         *>  a non-existent file\n              open output archive.\n     perform  GL-Batch-Open.                       *> open     i-o  batch-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Batch-Read-Next.                  *> read     batch-file  next record  at end\n     if       fs-reply = 10\n              go to  end-run.\n*>\n     if       bcycle not = scycle\n              go to  loop.\n*>\n     perform  arc-process.\n     perform  GL-Posting-Close.                     *> close    posting-file.\n*>\n     move     2         to  cleared-status.\n     move     run-date  to  stored.\n     move     zero      to  batch-start.\n     perform  GL-Batch-Rewrite.                    *> rewrite  batch-record.\n     go       to loop.\n*>\n end-run.\n*>******\n*>\n     close    archive.                             *> close batch-file\n     perform  GL-Batch-Close.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n arc-process        section.\n*>-------------------------\n*>\n     display  WS-Batch-Nos at 2345 with foreground-color 2.\n     move     WS-Batch-Nos  to  arc-batch.\n     perform  GL-Posting-Open.                      *> open     i-o  posting-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Posting-Read-Next.                 *> read     posting-file  next record  at end\n     if       fs-reply = 10\n              go to  main-exit.\n*>\n     if       WS-Post-Key = zero\n        or    batch  not = WS-Batch-Nos\n              go to  loop.\n*>\n     display  post-number at 2364 with foreground-color 2.\n*>\n     move     batch        to  arc-batch.\n     move     post-number  to  arc-post.\n     move     post-code in WS-Posting-Record    to  arc-code.\n     move     post-date    to  arc-date.\n     move     post-legend  to  arc-legend.\n*>\n     move     post-dr      to  arc-ac.\n     move     dr-pc        to  arc-pc.\n     move     post-cr      to  arc-c-ac.\n     move     cr-pc        to  arc-c-pc.\n*>\n     if       post-vat-side = \"CR\"\n              add  post-amount  vat-amount  giving  arc-amount\n     else\n              move post-amount  to  arc-amount.\n*>\n     write    arc-trans-record.\n*>\n     move     post-cr      to  arc-ac.\n     move     cr-pc        to  arc-pc.\n     move     post-dr      to  arc-c-ac.\n     move     dr-pc        to  arc-c-pc.\n*>\n     if       post-vat-side = \"DR\"\n              add  post-amount  vat-amount  giving  arc-amount\n     else\n              move post-amount  to  arc-amount.\n*>\n     multiply arc-amount  by  -1  giving  arc-amount.\n*>\n     write    arc-trans-record.\n*>\n     if       vat-ac of WS-Posting-Record equal  zero\n           or vat-amount = zero\n              go to  by-pass.\n*>\n     move     vat-ac of WS-Posting-Record  to  arc-ac.\n     move     vat-pc     to  arc-pc.\n     move     vat-amount to  arc-amount.\n*>\n     if       post-vat-side = \"CR\"\n              multiply  arc-amount  by  -1 giving arc-amount.\n*>\n     write    arc-trans-record.\n*>\n by-pass.\n*>******\n*>\n     perform  GL-Posting-Delete.                   *> delete   posting-file  record.\n     go       to loop.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n disk-change        section.\n*>-------------------------\n*>     Copied to gl080\n*>     ***************\n*>\n*> Build path for archive file/s\n*>    this set up for testing but need to change to accept\n*>     path to usb memory stick (full path) but will work as is\n*>       assuming users changes path and the system KNOWS about\n*>         the memory stick\n*>\n     move     space to Arg-Test.                   *> this lot looks wrong !!!!!\n     string   file-24        delimited by space   *> spaces\n              \"archives\"     delimited by size\n              file-defs-os-delimiter\n                             delimited by size\n                file-2      delimited by space  *> archive.dat\n                            into Arg-Test.\n     move     Arg-Test to file-2.\n*>\n     display  GL085 at 1201 with erase eol foreground-color 2.\n     display  Gl084 at 1301 with erase eol foreground-color 2.\n*>\n accept-option.\n*>************\n*>\n     accept   a at 1369.\n     if       a = 9\n              go to  main-exit.\n     if       a  not = zero\n              go to  accept-option.\n*>\n*>  Hopefully can remove these after testing\n*>\n     display  \"Current path/name is :\" at 1401 with foreground-color 2 erase eol.\n     display  file-2             at 1501 with foreground-color 2 erase eol.\n     accept   file-2             at 1501 with foreground-color 2 update.\n     if       file-2 (1:1) = space\n              go to accept-option.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n gl080c section.\n*>*************\n*>\n     display  \"Deleting.       Cycle - \" at 2301 with foreground-color 2.\n     display  lin2 at 2330 with foreground-color 2.\n     display  \"/ Batch - \" at 2334 with foreground-color 2.\n     display  \"/ Item  - \" at 2352 with foreground-color 2.\n*>\n     perform  GL-Batch-Open.                   *> open     i-o  batch-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Batch-Read-Next.              *> read     batch-file  next record  at end\n     if       fs-reply = 10\n              go to  end-run.\n*>\n     if       bcycle not = scycle\n              go to  loop.\n*>\n     perform  del-process.\n     perform  GL-Posting-Close.                *> close    posting-file.\n*>\n     move     2         to  cleared-status.\n     move     run-date  to  stored.\n     move     zero      to  batch-start.\n*>\n     perform  GL-Batch-Rewrite.                *> rewrite  batch-record.\n     go       to loop.\n*>\n end-run.\n*>******\n*>\n     perform  GL-Batch-Close.                  *> close    batch-file.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n del-process        section.\n*>-------------------------\n*>\n*> Using RDB this step can be done with one SQL process to delete all with\n*>   specific batch no but using Cobol this is not possible.\n*>\n     display  WS-Batch-Nos at 2345.\n     perform  GL-Posting-Open.              *> open     i-o    posting-file.\n*>\n loop.\n*>***\n*>\n     perform  GL-Posting-Read-Next.         *> read     posting-file  next record  at end\n     if       fs-reply = 10\n              go to  main-exit.\n*>\n     if       WS-Post-Key = zero\n        or    batch  not = WS-Batch-Nos\n              go to  loop.\n*>\n     display  post-number at 2364 with foreground-color 2.\n*>\n     perform  GL-Posting-Delete.            *> delete   posting-file  record.\n     go       to loop.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n compress-post  section.\n*>---------------------\n*>\n*>  First check if NOT running with Cobol files, if so skip section.\n*>\n     if       not FS-Cobol-Files-Used    *> Will use fn-Read-Next-Sorted-By-Batch (32)\n              go to main-exit\n     end-if.\n*>\n     display  \"Phase - 4.  Posting Contraction \" at 0801 with foreground-color 2.\n*>\n Test-Work-File-Size-1.\n*>\n*>  Check files are same size\n*>\n     if       function length (WS-Posting-Record) not =\n              function length (work-file-record)\n              display GL082 at 1001 with foreground-color 3\n              display GL083 at 1101 with foreground-color 3\n              display GL012 at 1201 with foreground-color 3\n              accept Keyed-Reply at 1227\n              stop run.\n*>\n     perform  GL-Posting-Open-Input.          *> open     input  posting-file.\n     open     output work-file.\n*>\n loop1.\n*>****\n*>\n     perform  GL-Posting-Read-Next.           *> read     posting-file next record at end\n     if       fs-reply = 10\n              go to loop1-end.\n     if       fs-reply not = zero\n              go to file-error.\n     write    work-file-record from WS-Posting-Record.\n     if       fs-reply not = zero\n              go to file-error.\n     go       to loop1.\n*>\n loop1-end.\n*>********\n*>\n     close    work-file.                       *> posting-file\n     perform  GL-Posting-Close.\n     open     input  work-file.\n     perform  GL-Posting-Open-Output.               *> open     output posting-file.\n*>\n loop2.\n*>****\n*>\n     read     work-file at end\n              go to loop2-end.\n     if       fs-reply not = zero\n              go to file-error.\n     move     work-file-record to WS-Posting-Record.\n     perform  GL-Posting-Write.           *> write    posting-record from work-file-record.\n     if       fs-reply not = zero\n              go to file-error.\n     go       to loop2.\n*>\n file-error.\n*>*********\n*>\n     display  GL081 at 1501 with foreground-color 2.\n     display  fs-reply at 1539 with foreground-color 2.\n     perform  evaluate-message.\n     display  ws-Eval-Msg at 1542.\n     display  GL012 at 1601   with erase eol foreground-color 2.\n     accept   Keyed-Reply at 1627.\n     display  \" \" at 1601 with erase eol.\n*>\n loop2-end.\n*>********\n*>\n     close    work-file.             *>  posting-file.\n     perform  GL-Posting-Close.\n*>\n main-exit.\n*>********\n*>\n     exit     section.\n*>\n Evaluate-Message       Section.\n*>=============================\n*>\n copy \"FileStat-Msgs.cpy\" replacing MSG by ws-Eval-Msg\n                                    STATUS by fs-reply.\n*>\n Eval-Msg-Exit.  exit section.\n*>************   ****\n*>\n zz070-Convert-Date     section.\n*>*****************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 120
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 3,
    "cognitive": 2,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 49,
      "totalOperators": 41,
      "totalOperands": 82,
      "vocabulary": 50,
      "length": 123,
      "volume": 694.1943113422911
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
