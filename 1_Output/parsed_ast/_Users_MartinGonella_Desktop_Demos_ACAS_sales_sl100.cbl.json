{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/sales/sl100.cbl",
  "fileName": "sl100.cbl",
  "timestamp": "2025-09-15T16:25:31.040Z",
  "programId": "sl100",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 112
      },
      {
        "name": "file",
        "line": 128
      },
      {
        "name": "working-storage",
        "line": 138
      },
      {
        "name": "linkage",
        "line": 267
      },
      {
        "name": "init01",
        "line": 284
      },
      {
        "name": "analise-deductions",
        "line": 524
      },
      {
        "name": "bl-open",
        "line": 555
      },
      {
        "name": "bl-write",
        "line": 591
      },
      {
        "name": "bl-close",
        "line": 666
      },
      {
        "name": "Eval-Status",
        "line": 687
      },
      {
        "name": "zz050-Validate-Date",
        "line": 695
      },
      {
        "name": "exit",
        "line": 728
      },
      {
        "name": "zz060-Convert-Date",
        "line": 730
      },
      {
        "name": "exit",
        "line": 763
      },
      {
        "name": "zz070-Convert-Date",
        "line": 765
      },
      {
        "name": "exit",
        "line": 793
      },
      {
        "name": "maps04",
        "line": 795
      },
      {
        "name": "exit",
        "line": 801
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 115
      },
      {
        "name": "file-defs",
        "line": 281
      },
      {
        "name": "end-if",
        "line": 306
      },
      {
        "name": "menu-return",
        "line": 308
      },
      {
        "name": "acpt-xrply",
        "line": 315
      },
      {
        "name": "loop",
        "line": 336
      },
      {
        "name": "cust-update",
        "line": 362
      },
      {
        "name": "main-end",
        "line": 440
      },
      {
        "name": "menu-exit",
        "line": 481
      },
      {
        "name": "headings",
        "line": 484
      },
      {
        "name": "compute-sales-pay",
        "line": 502
      },
      {
        "name": "csp-exit",
        "line": 521
      },
      {
        "name": "exit",
        "line": 522
      },
      {
        "name": "end-if",
        "line": 584
      },
      {
        "name": "VAT-Amount",
        "line": 630
      },
      {
        "name": "zz050-test-date",
        "line": 722
      },
      {
        "name": "zz050-exit",
        "line": 727
      },
      {
        "name": "zz060-Exit",
        "line": 762
      },
      {
        "name": "zz070-Exit",
        "line": 792
      },
      {
        "name": "maps04-exit",
        "line": 800
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "SYSTEM",
        "line": 459,
        "type": "DYNAMIC",
        "using": [
          "print-report"
        ]
      },
      {
        "target": "maps04",
        "line": 798,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 102,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 111,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 118,
        "replacing": null
      },
      {
        "name": "seloi3",
        "line": 119,
        "replacing": null
      },
      {
        "name": "selsl",
        "line": 120,
        "replacing": null
      },
      {
        "name": "selpost",
        "line": 121,
        "replacing": null
      },
      {
        "name": "selpost-irs",
        "line": 122,
        "replacing": null
      },
      {
        "name": "selval",
        "line": 123,
        "replacing": null
      },
      {
        "name": "selbatch",
        "line": 124,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 131,
        "replacing": null
      },
      {
        "name": "fdsl",
        "line": 132,
        "replacing": null
      },
      {
        "name": "fdoi3",
        "line": 133,
        "replacing": null
      },
      {
        "name": "fdpost",
        "line": 134,
        "replacing": null
      },
      {
        "name": "fdpost-irs",
        "line": 135,
        "replacing": null
      },
      {
        "name": "fdval",
        "line": 136,
        "replacing": null
      },
      {
        "name": "fdbatch",
        "line": 137,
        "replacing": null
      },
      {
        "name": "print-spool-command",
        "line": 142,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 143,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 144,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 222,
        "replacing": null
      },
      {
        "name": "slwsoi3",
        "line": 224,
        "replacing": null
      },
      {
        "name": "wsoi",
        "line": 225,
        "replacing": null
      },
      {
        "name": "wssl",
        "line": 226,
        "replacing": null
      },
      {
        "name": "wsbatch",
        "line": 227,
        "replacing": null
      },
      {
        "name": "wsval",
        "line": 228,
        "replacing": null
      },
      {
        "name": "wspost",
        "line": 229,
        "replacing": null
      },
      {
        "name": "wspost-irs",
        "line": 230,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 270,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 271,
        "replacing": null
      },
      {
        "name": "wssys4",
        "line": 272,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 273,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 690,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 803,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 298
      },
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 312
      },
      {
        "target": "OTM3-Open",
        "thru": null,
        "line": 326
      },
      {
        "target": "Sales-Open",
        "thru": null,
        "line": 327
      },
      {
        "target": "Bl-Open",
        "thru": null,
        "line": 330
      },
      {
        "target": "headings",
        "thru": null,
        "line": 334
      },
      {
        "target": "OTM3-Read-Next",
        "thru": null,
        "line": 337
      },
      {
        "target": "compute-sales-pay",
        "thru": "csp-exit",
        "line": 349
      },
      {
        "target": "OTM3-Rewrite",
        "thru": null,
        "line": 352
      },
      {
        "target": "Sales-Read-Indexed",
        "thru": null,
        "line": 368
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 381
      },
      {
        "target": "Sales-Rewrite",
        "thru": null,
        "line": 418
      },
      {
        "target": "Bl-Write",
        "thru": null,
        "line": 423
      },
      {
        "target": "OTM3-Rewrite",
        "thru": null,
        "line": 426
      },
      {
        "target": "headings",
        "thru": null,
        "line": 436
      },
      {
        "target": "OTM3-Close",
        "thru": null,
        "line": 443
      },
      {
        "target": "Sales-Close",
        "thru": null,
        "line": 444
      },
      {
        "target": "Value-Open",
        "thru": null,
        "line": 463
      },
      {
        "target": "analise-deductions",
        "thru": null,
        "line": 464
      },
      {
        "target": "Value-Close",
        "thru": null,
        "line": 465
      },
      {
        "target": "bl-close",
        "thru": null,
        "line": 468
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 529
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 539
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 543
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 551
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 558
      },
      {
        "target": "SPL-Posting-Open-Extend",
        "thru": null,
        "line": 581
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 583
      },
      {
        "target": "SPL-Posting-Write",
        "thru": null,
        "line": 652
      },
      {
        "target": "GL-Posting-Write",
        "thru": null,
        "line": 655
      },
      {
        "target": "bl-close",
        "thru": null,
        "line": 660
      },
      {
        "target": "bl-open",
        "thru": null,
        "line": 661
      },
      {
        "target": "GL-Batch-Write",
        "thru": null,
        "line": 669
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 672
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 679
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 681
      },
      {
        "target": "SPL-Posting-Close",
        "thru": null,
        "line": 683
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 725
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 739
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "prog-name",
        "to": "l1-name",
        "line": 285
      },
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 286
      },
      {
        "from": "level-1",
        "to": "save-level-1",
        "line": 294
      },
      {
        "from": "zero",
        "to": "level-1",
        "line": 295
      },
      {
        "from": "ws-date",
        "to": "l2-date",
        "line": 299
      },
      {
        "from": "spaces",
        "to": "wx-reply",
        "line": 318
      },
      {
        "from": "zero",
        "to": "j",
        "line": 333
      },
      {
        "from": "open-item-record-3",
        "to": "oi-header",
        "line": 341
      },
      {
        "from": "zeros",
        "to": "oi-b-nos oi-b-item oi-cr        *> processed so clear batch info +\n *>              move oi-header to open-item-record-3\n              perform OTM3-Rewrite       *> rewrite open-item-record-3\n              go to loop",
        "line": 350
      },
      {
        "from": "oi-customer",
        "to": "WS-Sales-Key  l5-cust",
        "line": 365
      },
      {
        "from": "space",
        "to": "ws-reply",
        "line": 367
      },
      {
        "from": "\"X\"",
        "to": "ws-reply",
        "line": 370
      },
      {
        "from": "sales-name",
        "to": "l5-name",
        "line": 374
      },
      {
        "from": "oi-b-nos",
        "to": "l5-batch",
        "line": 376
      },
      {
        "from": "\"/\"",
        "to": "l5-slash",
        "line": 377
      },
      {
        "from": "oi-b-item",
        "to": "l5-item",
        "line": 378
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 380
      },
      {
        "from": "u-date",
        "to": "l5-date",
        "line": 382
      },
      {
        "from": "oi-approp",
        "to": "l5-approp",
        "line": 384
      },
      {
        "from": "oi-paid",
        "to": "l5-paid",
        "line": 385
      },
      {
        "from": "oi-deduct-amt",
        "to": "l5-deduct",
        "line": 386
      },
      {
        "from": "zero",
        "to": "sales-current",
        "line": 402
      },
      {
        "from": "oi-date",
        "to": "sales-last-pay",
        "line": 405
      },
      {
        "from": "oi-approp",
        "to": "oi-paid",
        "line": 417
      },
      {
        "from": "1",
        "to": "oi-status",
        "line": 424
      },
      {
        "from": "\"Payment\"",
        "to": "l5-type",
        "line": 432
      },
      {
        "from": "spaces",
        "to": "line-5",
        "line": 446
      },
      {
        "from": "t-approp",
        "to": "l5-approp",
        "line": 448
      },
      {
        "from": "t-deduct",
        "to": "l5-deduct",
        "line": 449
      },
      {
        "from": "t-paid",
        "to": "l5-paid",
        "line": 450
      },
      {
        "from": "j-approp",
        "to": "l5-approp",
        "line": 454
      },
      {
        "from": "j-deduct",
        "to": "l5-deduct",
        "line": 455
      },
      {
        "from": "j-paid",
        "to": "l5-paid",
        "line": 456
      },
      {
        "from": "save-level-1",
        "to": "level-1",
        "line": 470
      },
      {
        "from": "save-level-1",
        "to": "level-1",
        "line": 474
      },
      {
        "from": "\"Y\"",
        "to": "oi-3-flag",
        "line": 478
      },
      {
        "from": "zero",
        "to": "S-Flag-P",
        "line": 479
      },
      {
        "from": "j",
        "to": "l1-page",
        "line": 486
      },
      {
        "from": "usera",
        "to": "l2-user",
        "line": 487
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record  from  line-1 before 1\n              write print-record  from  line-2 before 1",
        "line": 492
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 498
      },
      {
        "from": "5",
        "to": "line-cnt",
        "line": 500
      },
      {
        "from": "zero",
        "to": "work-b",
        "line": 509
      },
      {
        "from": "work-a",
        "to": "sales-pay-worst",
        "line": 519
      },
      {
        "from": "\"Szd\"",
        "to": "va-code",
        "line": 527
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 528
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 538
      },
      {
        "from": "space",
        "to": "va-second",
        "line": 541
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 542
      },
      {
        "from": "next-batch",
        "to": "WS-Batch-Nos",
        "line": 560
      },
      {
        "from": "3",
        "to": "WS-Ledger",
        "line": 561
      },
      {
        "from": "zero",
        "to": "batch-status  cleared-status",
        "line": 563
      },
      {
        "from": "Scycle",
        "to": "Bcycle",
        "line": 564
      },
      {
        "from": "run-date",
        "to": "entered",
        "line": 565
      },
      {
        "from": "zero",
        "to": "bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat",
        "line": 568
      },
      {
        "from": "\"CR\"",
        "to": "convention",
        "line": 575
      },
      {
        "from": "\"SL\"",
        "to": "batch-def-code",
        "line": 576
      },
      {
        "from": "\"O\"",
        "to": "batch-def-vat",
        "line": 577
      },
      {
        "from": "batch-start",
        "to": "rrn",
        "line": 586
      },
      {
        "from": "items",
        "to": "post-number",
        "line": 608
      },
      {
        "from": "oi-paid",
        "to": "post-amount",
        "line": 609
      },
      {
        "from": "1",
        "to": "xx",
        "line": 613
      },
      {
        "from": "oi-b-nos",
        "to": "batch",
        "line": 614
      },
      {
        "from": "WS-Batch-Nos",
        "to": "batch",
        "line": 616
      },
      {
        "from": "oi-b-item",
        "to": "k",
        "line": 618
      },
      {
        "from": "S-Debtors",
        "to": "post-cr",
        "line": 623
      },
      {
        "from": "SL-Pay-AC",
        "to": "post-dr",
        "line": 624
      },
      {
        "from": "zero",
        "to": "dr-pc\n                        cr-pc\n                        VAT-AC of WS-Posting-record\n                        vat-pc\n                        VAT-Amount",
        "line": 626
      },
      {
        "from": "spaces",
        "to": "post-vat-side",
        "line": 632
      },
      {
        "from": "\"SL\"",
        "to": "post-code in WS-Posting-Record",
        "line": 637
      },
      {
        "from": "\"CR\"",
        "to": "post-vat-side",
        "line": 638
      },
      {
        "from": "WS-post-key",
        "to": "WS-IRS-post-key\n              move post-code in WS-Posting-record\n                                 to WS-IRS-post-code\n              move post-date     to WS-IRS-post-date\n              move post-dr       to WS-IRS-post-dr\n              move post-cr       to WS-IRS-post-cr\n              move post-amount   to WS-IRS-post-amount\n              move post-legend   to WS-IRS-post-legend\n              move 32            to WS-IRS-vat-ac-def\n              move post-vat-side to WS-IRS-post-vat-side\n              move vat-amount    to WS-IRS-vat-amount\n              perform SPL-Posting-Write     *>  write irs-posting-record\n     else\n              move  RRN          to WS-Post-rrn\n              perform GL-Posting-Write      *>  write GL-Posting-record\n              add  1  to  rrn\n     end-if\n*>\n     if       items = 99\n              perform  bl-close\n              perform  bl-open",
        "line": 641
      },
      {
        "from": "rrn",
        "to": "postings",
        "line": 678
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 704
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 706
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 710
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 717
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 723
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 724
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 741
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 743
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 746
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 750
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 757
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 773
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 776
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 780
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 787
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "Test.\n*> 03/03/09 vbc - Migration to Open Cobol v3.00.00.\n*> 03/04/09 vbc - IRS posting file support also in sl060.\n*> 10/04/09 vbc - New feature Env variable ACAS_IRS.\n*> 29/05/09 vbc - Support for Page-Lines instead of fixed number.\n*> 07/09/10 vbc - .08 Mod lpr.\n*> 25/11/11 vbc - .09 Error msgs to SLnnn.Support for dates other than UK\n*> 08/12/11 vbc - .10 Support for path+filenames and removed code dealing with Env vars\n*>                    & setting up IRS path etc, as now done in menu program (sales)\n*> 09/12/11 vbc -     Updated version to 3.01.nn\n*> 11/12/11 vbc - .11 Changed usage of Stk-Date-Form to the global field Date-Form making former redundent.\n*> 25/03/12 vbc - .12 Restored GL/IRS postings, not sure why it was turned off\n*> 24/10/16 vbc - .13 ALL programs now using wsnames.cob in copybooks\n*> 30/10/16 vbc - .14 Support for RDB on Value table instead of cobol files\n*>                    using acas013. Updated version to v3.02.\n*> 24/11/16 vbc - .15 Support for RDB on (IRS) SPL posting file using acas008\n*>                    & GL posting file using acas006\n*> 15/01/17 vbc - .   All programs upgraded to v3.02 for RDB processing.\n*> 21/01/17 vbc - .16 Replace all refs to maps99 for display msgs.\n*> 25/01/17 vbc       Dry testing completed.\n*> 09/02/17 vbc - .17 Updated FD/WS and replaced cobol verbs\n*>                    for access to FH/DALs - OTM3.\n*> 23/08/17 vbc - .18 Rem out move ITM3 -> oi-header as same area.\n*> 16/04/24 vbc       Copyright notice update superseding all previous notices.\n*>\n*>*************************************************************************\n*>\n*>  From copyright.cob.\n*>\n*> Copyright Notice.\n*> ****************\n*>\n*> This notice supersedes all prior copyright notices & was updated 2024-04-16.\n*>\n*> These files and programs are part of the Applewood Computers Accounting\n*> System and is Copyright (c) Vincent B Coen. 1976-2025 and later.\n*>\n*> This program is now free software; you can redistribute it and/or modify it\n*> under the terms listed here and of the GNU General Public License as\n*> published by the Free Software Foundation; version 3 and later as revised\n*> for PERSONAL USAGE ONLY and that includes for use within a business but\n*> EXCLUDES repackaging or for Resale, Rental or Hire in ANY way.\n*>\n*> Persons interested in repackaging, redevelopment for the purpose of resale or\n*> distribution in a rental or hire mode must get in touch with the copyright\n*> holder with your commercial plans and proposals.\n*>\n*> ACAS is distributed in the hope that it will be useful, but WITHOUT\n*> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n*> FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n*> for more details. If it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>------------\n*>\n copy \"selprint.cob\".\n*> copy \"seloi3.cob\".\n*> copy \"selsl.cob\".\n*> copy \"selpost.cob\".\n*> copy \"selpost-irs.cob\".\n*> copy \"selval.cob\".\n*> copy \"selbatch.cob\".\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n copy \"fdprint.cob\".\n*> copy \"fdsl.cob\".\n*> copy \"fdoi3.cob\".\n*> copy \"fdpost.cob\".\n*> copy \"fdpost-irs.cob\".\n*> copy \"fdval.cob\".\n*> copy \"fdbatch.cob\".\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15)   value \"SL100 (3.02.18)\".\n 77  exception-msg       pic x(25)   value spaces.\n copy \"print-spool-command.cob\".\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n*>     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n*>     03  WS-Posting-Record      pic x.\n*>     03  WS-Batch-Record        pic x.\n*>     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n*>     03  WS-Sales-Record        pic x.\n*>     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n     03  WS-Purch-Record        pic x.\n     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n*>     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n     03  WS-OTM5-Record         pic x.\n*>\n 01  ws-data.\n     03  ws-reply        pic x.\n     03  wx-reply        pic xxx   value spaces.\n     03  xx              pic 99.\n     03  i               pic 99.\n     03  j               pic 99.\n     03  k               pic 999.\n     03  save-level-1    pic 9.\n     03  line-cnt        binary-char           value zero.\n     03  t-paid          pic s9(7)v99  comp-3  value zero.\n     03  t-approp        pic s9(7)v99  comp-3  value zero.\n     03  t-deduct        pic s9(7)v99  comp-3  value zero.\n     03  j-paid          pic s9(7)v99  comp-3  value zero.\n     03  j-approp        pic s9(7)v99  comp-3  value zero.\n     03  j-deduct        pic s9(7)v99  comp-3  value zero.\n     03  n-deduct        binary-long           value zero.\n     03  work-1          pic s9(7)v99  comp-3  value zero.\n     03  work-a          binary-long           value zero.\n     03  work-b          binary-long           value zero.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n     03  SL002          pic x(31) value \"SL002 Note error and hit return\".\n*>     03  SL003          pic x(28) value \"SL003 Hit Return To Continue\".\n*> Module specific\n     03  SL132          pic x(32) value \"SL132 Err on Batch file write : \".\n     03  SL137          pic x(26) value \"SL137 Payments Not Proofed\".\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n copy \"slwsoi3.cob\".\n*> copy \"wsoi.cob\".\n copy \"wssl.cob\".\n copy \"wsbatch.cob\".\n copy \"wsval.cob\".\n copy \"wspost.cob\".\n copy \"wspost-irs.cob\".\n*>\n 01  line-1.\n     03  l1-name         pic x(56).\n     03  filler          pic x(68)       value \"Cash Posting Report\".\n     03  filler          pic x(5)        value \"Page \".\n     03  l1-page         pic zz9.\n*>\n 01  line-2.\n     03  l2-user         pic x(56)       value spaces.\n     03  filler          pic x(19)       value spaces.\n     03  filler          pic x(47)       value spaces.\n     03  l2-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(67)       value \" Number   ---Date--  <------------Customer------------>  --Type-- \".\n     03  filler          pic x(65)       value \" Old Balance    New Balance    Payment   Deduction   Apportioned\".\n*>\n 01  line-5.\n     03  l5-batch        pic z(4)9.\n     03  l5-slash        pic x.\n     03  l5-item         pic 999b.\n     03  l5-date         pic x(11).\n     03  l5-cust         pic x(8).\n     03  l5-name         pic x(25).\n     03  l5-marker       pic x(4)        value spaces.\n     03  l5-type         pic x(11).\n     03  l5-old-bal      pic z(5)9.99cr.\n     03  filler          pic x(3)        value spaces.\n     03  l5-new-bal      pic z(5)9.99cr.\n     03  filler          pic xx          value spaces.\n     03  l5-paid         pic z(5)9.99b.\n     03  filler          pic xx          value spaces.\n     03  l5-deduct       pic z(5)9.99b.\n     03  filler          pic x(4)        value spaces.\n     03  l5-approp       pic z(5)9.99bb.\n*>\n linkage section.\n*>**************\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wssys4.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          system-record-4\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n     move     prog-name to l1-name.\n     move     Print-Spool-Name to PSN.\n*> Force Esc, PgUp, PgDown, PrtSC to be detected\n     set      ENVIRONMENT \"COB_SCREEN_EXCEPTIONS\" to \"Y\".\n     set      ENVIRONMENT \"COB_SCREEN_ESC\" to \"Y\".\n*>\n*>*******************************************************  *> Turned back on 25/03/12\n*> bypass gl posting code also see line 455             *\n*>                                                      *\n*>     move     level-1 to save-level-1.\n*>     move     zero to level-1.\n*>                                                      *\n*>*******************************************************\n     perform  zz070-Convert-Date.\n     move     ws-date to l2-date.\n*>\n     if       S-Flag-P not = 2\n              display SL137   at 2301\n              display SL002   at 2401\n              accept ws-reply at 2433\n              go to menu-exit\n     end-if.\n*>\n menu-return.\n*>\n     display  prog-name at 0101 with erase eos foreground-color 2.\n     display  \"Sales Cash Posting\" at 0133 with foreground-color 2.\n     perform  zz070-Convert-Date.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n acpt-xrply.\n     display  \"OK to Post Payment Transactions (YES/NO) ? [   ]\"\n                                                 at 1212 with foreground-color 2.\n     move     spaces to wx-reply.\n     accept   wx-reply at 1256 with foreground-color 6 update.\n     move     function upper-case (wx-reply) to wx-reply.\n     if       wx-reply = \"NO\"\n              go to menu-exit.\n     if       wx-reply not = \"YES\"\n              go to acpt-xrply.\n*>\n     perform  OTM3-Open.        *> open i-o open-item-file-3 sales-file.\n     perform  Sales-Open.\n*>\n     if       G-L\n              perform  Bl-Open.\n*>\n     open     output print-file.\n     move     zero  to  j.\n     perform  headings.\n*>\n loop.\n     perform  OTM3-Read-Next.       *> read open-item-file-3 next record at end\n     if       fs-reply = 10\n              go to  main-end.\n*>\n *>    move     open-item-record-3  to  oi-header.\n*>\n     if       oi-type not = 2 and not = 5 and not = 6       *> invoices, payments, unapplied cash journal\n              go to loop.\n*>\n     if       oi-type = 2 and\n              oi-b-nos not = zero and\n              oi-b-item not = zero\n              perform compute-sales-pay thru csp-exit\n              move zeros to oi-b-nos oi-b-item oi-cr        *> processed so clear batch info +\n *>              move oi-header to open-item-record-3\n              perform OTM3-Rewrite       *> rewrite open-item-record-3\n              go to loop.\n*>\n     if       s-closed or\n              oi-type = 2\n              go to  loop.\n*>\n     if       zero = oi-b-nos and oi-b-item\n              go to loop.\n*>\n cust-update.\n*>**********\n*>\n     move     oi-customer  to  WS-Sales-Key  l5-cust.\n*>\n     move     space to ws-reply.\n     perform  Sales-Read-Indexed.       *> read sales-file record invalid key\n     if       fs-reply = 21\n              move \"X\" to ws-reply.\n     if       ws-reply = \"X\"\n              move \"!! Customer Unknown\" to l5-name\n     else\n              move sales-name to l5-name.\n*>\n     move     oi-b-nos  to l5-batch.\n     move     \"/\"       to l5-slash.\n     move     oi-b-item to l5-item.\n*>\n     move     oi-date  to  u-bin.\n     perform  zz060-Convert-Date.\n     move     u-date  to  l5-date.\n*>\n     move     oi-approp  to  l5-approp.\n     move     oi-paid    to  l5-paid.\n     move     oi-deduct-amt  to  l5-deduct.\n*>\n     if       oi-deduct-amt not = zero\n              add 1 to n-deduct.\n*>\n     subtract sales-unapplied from sales-current giving l5-old-bal.\n     subtract oi-approp from sales-current.\n     subtract oi-deduct-amt  from  sales-current.\n*>\n     if       oi-paid not = oi-approp\n              subtract oi-approp from oi-paid giving work-1\n              add work-1 to sales-unapplied.\n*>\n     if       sales-current is negative\n              multiply -1 by sales-current giving work-1\n              add work-1 to sales-unapplied\n              move zero to sales-current.\n*>\n     subtract sales-unapplied from sales-current giving l5-new-bal.\n     move     oi-date  to  sales-last-pay.\n*>\n     if       oi-type = 5\n              add oi-approp to t-approp\n              add oi-paid   to t-paid sl-payments\n              add oi-deduct-amt to t-deduct\n      else\n       if     oi-type = 6\n              add oi-approp to j-approp\n              add oi-paid   to j-paid\n              add oi-deduct-amt to j-deduct.\n*>\n     move     oi-approp to oi-paid.\n     perform  Sales-Rewrite.                   *> rewrite  sales-record.\n*>\n*> Yes for a non existant Sales rec the rewrite will fail so ignore error.\n*>\n     if       G-L\n              perform  Bl-Write.  *> what happens if using IRS ?\n     move     1  to  oi-status.\n*>\n     perform  OTM3-Rewrite.    *> rewrite open-item-record-3 from oi-header.\n*>\n     if       oi-type = 6\n              move \"Cr Journal\" to l5-type\n     else\n      if      oi-type = 5\n              move \"Payment\"  to  l5-type.\n     write    print-record  from  line-5 after 1.\n     add      1 to line-cnt.\n     if       line-cnt > Page-Lines\n              perform  headings.\n*>\n     go       to loop.\n*>\n main-end.\n*>*******\n*>\n     perform  OTM3-Close.       *> close open-item-file-3 sales-file\n     perform  Sales-Close.\n*>\n     move     spaces  to  line-5.\n     move     \"Payment Totals\" to l5-name.\n     move     t-approp to l5-approp.\n     move     t-deduct to l5-deduct.\n     move     t-paid   to l5-paid.\n     write    print-record from line-5 after 3.\n*>\n     move     \"Journal Totals\" to l5-name.\n     move     j-approp to l5-approp.\n     move     j-deduct to l5-deduct.\n     move     j-paid   to l5-paid.\n     write    print-record from line-5 after 2.\n     close    print-file.\n     call     \"SYSTEM\" using print-report.\n*>\n     add      j-deduct to t-deduct.\n     if       t-deduct not = zero\n              perform Value-Open                *>   open i-o value-file\n              perform analise-deductions\n              perform Value-Close.              *>   close value-file.\n*>\n     if       G-L\n              perform  bl-close.\n*>\n*>     move     save-level-1 to level-1.           *> Turned back on 25/03/12\n*>*******************************************\n*>  >>> BYPASS CODE FOR G-L\n*>\n*>     move     save-level-1 to level-1.\n*>\n*>*******************************************\n*>\n     move     \"Y\"  to  oi-3-flag.\n     move     zero to S-Flag-P.\n*>\n menu-exit.\n     exit     program.\n*>\n headings.\n     add      1  to  j.\n     move     j  to  l1-page.\n     move     usera  to  l2-user.\n*>\n     if       j not = 1\n              write print-record from line-1 after page\n              write print-record  from  line-2 after 1\n              move spaces to print-record\n              write print-record after 1\n     else\n              write print-record  from  line-1 before 1\n              write print-record  from  line-2 before 1.\n     write    print-record from line-4 after 1.\n     move     spaces to print-record.\n     write    print-record after 1.\n     move     5 to line-cnt.\n*>\n compute-sales-pay.\n*>****************\n*>\n     if       oi-date-cleared = zero\n              go to csp-exit.\n*>\n     subtract oi-date from oi-date-cleared giving work-a.\n     move     zero to work-b.\n*>\n     if       sales-pay-activety not = zero\n              multiply sales-pay-activety by sales-pay-average giving work-b.\n*>\n     add      work-a to work-b.\n     add      1 to sales-pay-activety.\n     divide   work-b by sales-pay-activety giving sales-pay-average.\n*>\n     if       work-a > sales-pay-worst\n              move work-a to sales-pay-worst.\n*>\n csp-exit.\n     exit.\n*>\n analise-deductions   section.\n*>===========================\n*>\n     move     \"Szd\" to va-code.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.         *> read value-file  invalid key\n     if       FS-Reply = 21\n              go to main-exit.\n*>\n     subtract n-deduct from va-t-this.\n     subtract n-deduct from va-t-year.\n     subtract t-deduct from va-v-this.\n     subtract t-deduct from va-v-year.\n*>\n     move     1 to File-Key-No.\n     perform  Value-Rewrite.          *> rewrite  value-record.\n*>\n     move     space  to  va-second.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.        *> read     value-file  invalid key\n     if       FS-Reply = 21\n              go to main-exit.\n*>\n     subtract n-deduct from va-t-this.\n     subtract n-deduct from va-t-year.\n     subtract t-deduct from va-v-this.\n     subtract t-deduct from va-v-year.\n     perform  Value-Rewrite.          *> rewrite  value-record.\n*>\n main-exit.   exit section.\n*>\n bl-open      section.\n*>===================\n*>\n     perform  GL-Batch-Open.               *> open     i-o  batch-file.\n*>\n     move     next-batch  to  WS-Batch-Nos.\n     move     3  to WS-Ledger.\n     add      1  to Next-Batch.\n     move     zero  to  batch-status  cleared-status.\n     move     Scycle to  Bcycle.\n     move     run-date  to  entered.\n*>\n     move     \"Sales-Ledger Payments\"  to  description.\n     move     zero  to  bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat.\n*>\n     move     \"CR\"  to  convention.\n     move     \"SL\"  to  batch-def-code.\n     move     \"O\"   to  batch-def-vat.\n     add      postings  1  giving  batch-start.\n*>\n     if       irs-used      *> will open as o/p if not exist\n              perform SPL-Posting-Open-Extend  *>   open extend irs-post-file *> needed: -  bug in OC\n     else                   *> will open as o/p if not exist\n              perform GL-Posting-Open          *>  open i-o  Posting-file\n     end-if.\n*>\n     move     batch-start  to  rrn.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-write     section.\n*>===================\n*>\n*><<<<<<<<<<<<<<<<<<<<<<<<<<< READ THIS >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n*>**********************************************************************\n*>  This will write a posting record to GL or IRS for EACH line item   *\n*>   in EACH invoice GL implies IRS, i.e., of or both.                 *\n*> so, to use it, you MUST have set up the GL account number for EVERY *\n*>  analysis code via Sl070. It also assumes that you have followed    *\n*>  the convention in IRS that default a/c 31 points to VAT input      *\n*>  and default a/c 32 is VAT output tax. The same applies to General. *\n*>**********************************************************************\n*>  u-date is in uk format\n*>\n     move     u-date (1:6) to post-date (1:6).\n     move     u-date (9:2) to post-date (7:2).\n     add      1       to  items.\n     move     items   to  post-number.\n     move     oi-paid to  post-amount.\n*>\n*> THIS DOES NOT APPEAR THE SAME as SL060 and PL060/PL100\n*>\n     move     1  to  xx.\n     move     oi-b-nos to batch.\n     string   batch delimited by size into post-legend pointer xx.\n     move     WS-Batch-Nos  to  batch.\n     string   \"/\" delimited by size into post-legend pointer xx.\n     move     oi-b-item to k.\n     string   k delimited by size into post-legend pointer xx.\n     string   \"  :  \"   delimited  by size into post-legend pointer xx.\n     string   sales-name delimited by size into post-legend pointer xx.\n*>\n     move     S-Debtors    to  post-cr.\n     move     SL-Pay-AC    to  post-dr.\n*>\n     move     zero  to  dr-pc\n                        cr-pc\n                        VAT-AC of WS-Posting-record\n                        vat-pc\n                        VAT-Amount.\n*>\n     move     spaces  to  post-vat-side.\n*>\n     add      post-amount  to  input-gross.\n     add      post-amount  to  actual-gross.\n*>\n     move     \"SL\"  to  post-code in WS-Posting-Record.\n     move     \"CR\" to post-vat-side.\n*>\n     if       irs-used\n              move WS-post-key   to WS-IRS-post-key\n              move post-code in WS-Posting-record\n                                 to WS-IRS-post-code\n              move post-date     to WS-IRS-post-date\n              move post-dr       to WS-IRS-post-dr\n              move post-cr       to WS-IRS-post-cr\n              move post-amount   to WS-IRS-post-amount\n              move post-legend   to WS-IRS-post-legend\n              move 32            to WS-IRS-vat-ac-def\n              move post-vat-side to WS-IRS-post-vat-side\n              move vat-amount    to WS-IRS-vat-amount\n              perform SPL-Posting-Write     *>  write irs-posting-record\n     else\n              move  RRN          to WS-Post-rrn\n              perform GL-Posting-Write      *>  write GL-Posting-record\n              add  1  to  rrn\n     end-if\n*>\n     if       items = 99\n              perform  bl-close\n              perform  bl-open.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-close     section.\n*>===================\n*>\n     perform  GL-Batch-Write.                 *> write    batch-record.\n     if       fs-reply not = zero\n              display SL132    at 2301\n              perform Eval-Status\n              display fs-reply at 2333\n              display exception-msg at 2336\n              display  SL002                       at 2401 with foreground-color 2\n              accept ws-reply at 2430.\n     if       not irs-used\n              move rrn  to  postings.\n     perform  GL-Batch-Close.                *> close    batch-file.\n     if       not irs-used\n              perform GL-Posting-Close       *>  close  GL-Posting-file\n     else\n              perform SPL-Posting-Close.     *> close irs-post-file.\n*>\n main-exit.   exit section.\n*>\n Eval-Status        section.\n*>=========================\n*>\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n main-exit.   exit section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>****************************************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 49
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 4,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 113,
      "totalOperators": 88,
      "totalOperands": 176,
      "vocabulary": 114,
      "length": 264,
      "volume": 1803.8829637394917
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
