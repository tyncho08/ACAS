{
  "filePath": "/Users/MartinGonella/Desktop/Demos/ACAS/purchase/pl950.cbl",
  "fileName": "pl950.cbl",
  "timestamp": "2025-09-15T16:25:48.070Z",
  "programId": "pl950",
  "parserUsed": "GnuCOBOL + Regex",
  "parseConfidence": 0,
  "validationStatus": "ERROR",
  "gnuCobolValidation": {
    "success": true,
    "errors": [],
    "warnings": []
  },
  "parseErrors": [
    "Cannot read properties of undefined (reading 'total')"
  ],
  "parseWarnings": [],
  "divisions": {
    "identification": true,
    "environment": true,
    "data": true,
    "procedure": true
  },
  "structure": {
    "sections": [
      {
        "name": "input-output",
        "line": 118
      },
      {
        "name": "file",
        "line": 136
      },
      {
        "name": "working-storage",
        "line": 148
      },
      {
        "name": "linkage",
        "line": 292
      },
      {
        "name": "init01",
        "line": 307
      },
      {
        "name": "headings",
        "line": 517
      },
      {
        "name": "analise-deductions",
        "line": 541
      },
      {
        "name": "bl-open",
        "line": 572
      },
      {
        "name": "bl-write",
        "line": 619
      },
      {
        "name": "bl-close",
        "line": 695
      },
      {
        "name": "Eval-Status",
        "line": 716
      },
      {
        "name": "zz050-Validate-Date",
        "line": 724
      },
      {
        "name": "exit",
        "line": 757
      },
      {
        "name": "zz060-Convert-Date",
        "line": 759
      },
      {
        "name": "exit",
        "line": 792
      },
      {
        "name": "zz070-Convert-Date",
        "line": 794
      },
      {
        "name": "exit",
        "line": 822
      },
      {
        "name": "maps04",
        "line": 824
      },
      {
        "name": "exit",
        "line": 830
      }
    ],
    "paragraphs": [
      {
        "name": "file-control",
        "line": 121
      },
      {
        "name": "file-defs",
        "line": 304
      },
      {
        "name": "disp-head",
        "line": 308
      },
      {
        "name": "re-accpt",
        "line": 321
      },
      {
        "name": "read-purchase",
        "line": 336
      },
      {
        "name": "main-end",
        "line": 378
      },
      {
        "name": "loop-outer",
        "line": 398
      },
      {
        "name": "loop-inner",
        "line": 448
      },
      {
        "name": "oi-read",
        "line": 454
      },
      {
        "name": "loop-inner-end",
        "line": 495
      },
      {
        "name": "exit",
        "line": 496
      },
      {
        "name": "end-run",
        "line": 498
      },
      {
        "name": "cleared-status",
        "line": 585
      },
      {
        "name": "vat-amount",
        "line": 661
      },
      {
        "name": "zz050-test-date",
        "line": 751
      },
      {
        "name": "zz050-exit",
        "line": 756
      },
      {
        "name": "zz060-Exit",
        "line": 791
      },
      {
        "name": "zz070-Exit",
        "line": 821
      },
      {
        "name": "maps04-exit",
        "line": 829
      }
    ],
    "entryPoints": []
  },
  "dependencies": {
    "calls": [
      {
        "target": "SYSTEM",
        "line": 389,
        "type": "DYNAMIC",
        "using": [
          "Print-Report"
        ]
      },
      {
        "target": "maps04",
        "line": 827,
        "type": "DYNAMIC",
        "using": [
          "maps03-ws"
        ]
      }
    ],
    "copies": [
      {
        "name": "of",
        "line": 108,
        "replacing": null
      },
      {
        "name": "envdiv",
        "line": 117,
        "replacing": null
      },
      {
        "name": "selpl",
        "line": 124,
        "replacing": null
      },
      {
        "name": "selpay",
        "line": 125,
        "replacing": null
      },
      {
        "name": "seloi5",
        "line": 126,
        "replacing": null
      },
      {
        "name": "selpost",
        "line": 127,
        "replacing": null
      },
      {
        "name": "selpost-irs",
        "line": 128,
        "replacing": null
      },
      {
        "name": "selval",
        "line": 129,
        "replacing": null
      },
      {
        "name": "selbatch",
        "line": 130,
        "replacing": null
      },
      {
        "name": "selprint",
        "line": 132,
        "replacing": null
      },
      {
        "name": "fdpl",
        "line": 139,
        "replacing": null
      },
      {
        "name": "fdpay",
        "line": 140,
        "replacing": null
      },
      {
        "name": "fdoi5",
        "line": 141,
        "replacing": null
      },
      {
        "name": "fdpost",
        "line": 142,
        "replacing": null
      },
      {
        "name": "fdpost-irs",
        "line": 143,
        "replacing": null
      },
      {
        "name": "fdval",
        "line": 144,
        "replacing": null
      },
      {
        "name": "fdbatch",
        "line": 145,
        "replacing": null
      },
      {
        "name": "fdprint",
        "line": 147,
        "replacing": null
      },
      {
        "name": "print-spool-command-p",
        "line": 152,
        "replacing": null
      },
      {
        "name": "wsmaps03",
        "line": 154,
        "replacing": null
      },
      {
        "name": "wsfnctn",
        "line": 155,
        "replacing": null
      },
      {
        "name": "plwsoi",
        "line": 156,
        "replacing": null
      },
      {
        "name": "wspl",
        "line": 160,
        "replacing": null
      },
      {
        "name": "plwsoi5B",
        "line": 161,
        "replacing": null
      },
      {
        "name": "plwspay",
        "line": 162,
        "replacing": null
      },
      {
        "name": "wsbatch",
        "line": 165,
        "replacing": null
      },
      {
        "name": "wspost",
        "line": 166,
        "replacing": null
      },
      {
        "name": "wspost-irs",
        "line": 167,
        "replacing": null
      },
      {
        "name": "wsval",
        "line": 168,
        "replacing": null
      },
      {
        "name": "Test-Data-Flags",
        "line": 194,
        "replacing": null
      },
      {
        "name": "wscall",
        "line": 295,
        "replacing": null
      },
      {
        "name": "wssystem",
        "line": 296,
        "replacing": null
      },
      {
        "name": "wsnames",
        "line": 297,
        "replacing": null
      },
      {
        "name": "FileStat-Msgs",
        "line": 719,
        "replacing": null
      },
      {
        "name": "Proc-ACAS-FH-Calls",
        "line": 832,
        "replacing": null
      }
    ],
    "performs": [
      {
        "target": "zz070-Convert-Date",
        "thru": null,
        "line": 310
      },
      {
        "target": "Purch-Open-Input",
        "thru": null,
        "line": 332
      },
      {
        "target": "Payments-Open-Input",
        "thru": null,
        "line": 333
      },
      {
        "target": "payments-Read-Next",
        "thru": null,
        "line": 337
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 343
      },
      {
        "target": "headings",
        "thru": null,
        "line": 345
      },
      {
        "target": "Purch-Read-Indexed",
        "thru": null,
        "line": 349
      },
      {
        "target": "headings",
        "thru": null,
        "line": 374
      },
      {
        "target": "Payments-Close",
        "thru": null,
        "line": 384
      },
      {
        "target": "Payments-Open-Input",
        "thru": null,
        "line": 390
      },
      {
        "target": "OTM5-Open",
        "thru": null,
        "line": 391
      },
      {
        "target": "BL-Open",
        "thru": null,
        "line": 393
      },
      {
        "target": "Payments-Read-Next",
        "thru": null,
        "line": 399
      },
      {
        "target": "Purch-Read-Indexed",
        "thru": null,
        "line": 404
      },
      {
        "target": "loop-inner",
        "thru": null,
        "line": 414
      },
      {
        "target": "zz060-Convert-Date",
        "thru": null,
        "line": 430
      },
      {
        "target": "OTM5-Write",
        "thru": null,
        "line": 440
      },
      {
        "target": "BL-Write",
        "thru": null,
        "line": 443
      },
      {
        "target": "OTM5-Read-Indexed",
        "thru": null,
        "line": 458
      },
      {
        "target": "OTM5-Rewrite",
        "thru": null,
        "line": 490
      },
      {
        "target": "Purch-Close",
        "thru": null,
        "line": 502
      },
      {
        "target": "OTM5-Close",
        "thru": null,
        "line": 503
      },
      {
        "target": "Payments-Close",
        "thru": null,
        "line": 504
      },
      {
        "target": "Payments-Open-Output",
        "thru": null,
        "line": 505
      },
      {
        "target": "Payments-Close",
        "thru": null,
        "line": 506
      },
      {
        "target": "Value-Open",
        "thru": null,
        "line": 508
      },
      {
        "target": "analise-deductions",
        "thru": null,
        "line": 509
      },
      {
        "target": "Value-Close",
        "thru": null,
        "line": 510
      },
      {
        "target": "BL-Close",
        "thru": null,
        "line": 513
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 546
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 556
      },
      {
        "target": "Value-Read-Indexed",
        "thru": null,
        "line": 560
      },
      {
        "target": "Value-Rewrite",
        "thru": null,
        "line": 568
      },
      {
        "target": "GL-Batch-Open",
        "thru": null,
        "line": 575
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 577
      },
      {
        "target": "GL-Batch-Open-Output",
        "thru": null,
        "line": 578
      },
      {
        "target": "SPL-Posting-Open-Extend",
        "thru": null,
        "line": 604
      },
      {
        "target": "SPL-Posting-Close",
        "thru": null,
        "line": 606
      },
      {
        "target": "SPL-Posting-Open-Output",
        "thru": null,
        "line": 607
      },
      {
        "target": "GL-Posting-Open",
        "thru": null,
        "line": 610
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 612
      },
      {
        "target": "GL-Posting-Open-Output",
        "thru": null,
        "line": 613
      },
      {
        "target": "SPL-Posting-Write",
        "thru": null,
        "line": 682
      },
      {
        "target": "GL-Posting-Write",
        "thru": null,
        "line": 684
      },
      {
        "target": "bl-close",
        "thru": null,
        "line": 689
      },
      {
        "target": "bl-open",
        "thru": null,
        "line": 690
      },
      {
        "target": "GL-Batch-Write",
        "thru": null,
        "line": 698
      },
      {
        "target": "Eval-Status",
        "thru": null,
        "line": 701
      },
      {
        "target": "GL-Batch-Close",
        "thru": null,
        "line": 708
      },
      {
        "target": "GL-Posting-Close",
        "thru": null,
        "line": 710
      },
      {
        "target": "SPL-Posting-Close",
        "thru": null,
        "line": 712
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 754
      },
      {
        "target": "maps04",
        "thru": null,
        "line": 768
      }
    ]
  },
  "dataFlow": {
    "files": [],
    "moves": [
      {
        "from": "prog-name",
        "to": "l1-prog",
        "line": 311
      },
      {
        "from": "ws-date",
        "to": "l1-date",
        "line": 312
      },
      {
        "from": "usera",
        "to": "l2-user",
        "line": 313
      },
      {
        "from": "Print-Spool-Name",
        "to": "PSN",
        "line": 314
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 315
      },
      {
        "from": "pay-date",
        "to": "u-bin\n              perform  zz060-Convert-Date\n              move  ws-date  to  l3-date\n              perform  headings\n              move  9  to  first-time",
        "line": 342
      },
      {
        "from": "pay-supl-key",
        "to": "WS-Purch-Key",
        "line": 348
      },
      {
        "from": "WS-Purch-Key",
        "to": "l5-account",
        "line": 353
      },
      {
        "from": "purch-name",
        "to": "l5-supplier",
        "line": 354
      },
      {
        "from": "pay-cheque",
        "to": "l5-cheque\n              move spaces to l5-acf\n     else\n              move pay-sortcode to ws-sortcode\n              move pay-account  to ws-accountno\n              move ws-account-details to l5-bacs-details",
        "line": 361
      },
      {
        "from": "pay-gross",
        "to": "l5-value",
        "line": 368
      },
      {
        "from": "bal-t",
        "to": "l7-value",
        "line": 379
      },
      {
        "from": "1",
        "to": "bl-next-batch",
        "line": 396
      },
      {
        "from": "pay-supl-key",
        "to": "oi5-supplier WS-Purch-Key",
        "line": 403
      },
      {
        "from": "zero",
        "to": "aprop-amount",
        "line": 408
      },
      {
        "from": "1",
        "to": "pay-series\n              add 1 to bl-next-batch",
        "line": 411
      },
      {
        "from": "zero",
        "to": "oi-carriage oi-c-vat oi-vat oi-discount\n                      oi-status oi-p-c oi-extra oi-e-vat oi-cr",
        "line": 420
      },
      {
        "from": "zero",
        "to": "oi-deduct-days oi-days oi-deduct-vat",
        "line": 422
      },
      {
        "from": "spaces",
        "to": "oi-order oi-hold-flag oi-applied",
        "line": 423
      },
      {
        "from": "pay-supl-key",
        "to": "oi-supplier",
        "line": 424
      },
      {
        "from": "bl-next-batch",
        "to": "oi-b-nos",
        "line": 425
      },
      {
        "from": "pay-series",
        "to": "oi-b-item",
        "line": 426
      },
      {
        "from": "pay-date",
        "to": "oi-date oi-date-cleared",
        "line": 427
      },
      {
        "from": "oi-date",
        "to": "u-bin",
        "line": 429
      },
      {
        "from": "pay-gross",
        "to": "oi-paid",
        "line": 432
      },
      {
        "from": "aprop-amount",
        "to": "oi-approp",
        "line": 433
      },
      {
        "from": "deduct-taken",
        "to": "oi-deduct-amt",
        "line": 434
      },
      {
        "from": "pay-cheque",
        "to": "oi-ref",
        "line": 437
      },
      {
        "from": "5",
        "to": "oi-type",
        "line": 438
      },
      {
        "from": "OI-Header",
        "to": "WS-OTM5-Record",
        "line": 439
      },
      {
        "from": "zero",
        "to": "deduct-taken aprop-amount",
        "line": 445
      },
      {
        "from": "open-item-record-5",
        "to": "oi-header",
        "line": 462
      },
      {
        "from": "1",
        "to": "oi-status\n              subtract pay-deduct (z) from oi-net\n              add  pay-deduct (z) to deduct-taken\n              move zero to oi-deduct-amt\n              move bl-next-batch to oi-b-nos\n              move pay-series to oi-b-item\n              move pay-date to oi-date-cleared",
        "line": 481
      },
      {
        "from": "OI-Header",
        "to": "WS-OTM5-Record",
        "line": 489
      },
      {
        "from": "p",
        "to": "l3-page",
        "line": 521
      },
      {
        "from": "spaces",
        "to": "print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record from line-3 after 1",
        "line": 526
      },
      {
        "from": "spaces",
        "to": "print-record",
        "line": 535
      },
      {
        "from": "8",
        "to": "line-cnt",
        "line": 537
      },
      {
        "from": "\"Pzb\"",
        "to": "va-code",
        "line": 544
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 545
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 555
      },
      {
        "from": "space",
        "to": "va-second",
        "line": 558
      },
      {
        "from": "1",
        "to": "File-Key-No",
        "line": 559
      },
      {
        "from": "bl-next-batch",
        "to": "WS-Batch-Nos",
        "line": 580
      },
      {
        "from": "2",
        "to": "WS-Ledger",
        "line": 581
      },
      {
        "from": "zero",
        "to": "batch-status\n                        cleared-status",
        "line": 584
      },
      {
        "from": "run-date",
        "to": "entered",
        "line": 588
      },
      {
        "from": "zero",
        "to": "bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat",
        "line": 591
      },
      {
        "from": "\"DR\"",
        "to": "convention",
        "line": 598
      },
      {
        "from": "\"PL\"",
        "to": "batch-def-code",
        "line": 599
      },
      {
        "from": "\"I\"",
        "to": "batch-def-vat",
        "line": 600
      },
      {
        "from": "batch-start",
        "to": "rrn",
        "line": 614
      },
      {
        "from": "items",
        "to": "post-number",
        "line": 636
      },
      {
        "from": "oi-paid",
        "to": "post-amount",
        "line": 637
      },
      {
        "from": "WS-Batch-Nos",
        "to": "batch",
        "line": 642
      },
      {
        "from": "oi-invoice",
        "to": "m",
        "line": 643
      },
      {
        "from": "zero",
        "to": "b",
        "line": 644
      },
      {
        "from": "1",
        "to": "xx",
        "line": 648
      },
      {
        "from": "p-creditors",
        "to": "post-dr",
        "line": 654
      },
      {
        "from": "bl-pay-ac",
        "to": "post-cr",
        "line": 655
      },
      {
        "from": "zero",
        "to": "dr-pc\n                        cr-pc\n                        vat-ac of WS-Posting-Record\n                        vat-pc\n                        vat-amount",
        "line": 657
      },
      {
        "from": "spaces",
        "to": "post-vat-side",
        "line": 663
      },
      {
        "from": "\"PL\"",
        "to": "post-code  in WS-Posting-Record",
        "line": 668
      },
      {
        "from": "\"DR\"",
        "to": "post-vat-side",
        "line": 669
      },
      {
        "from": "WS-post-key",
        "to": "WS-IRS-Post-key\n              move post-code in WS-Posting-Record    to WS-IRS-Post-code\n              move post-date     to WS-IRS-Post-date\n              move post-dr       to WS-IRS-Post-dr\n              move post-cr       to WS-IRS-Post-cr\n              move post-amount   to WS-IRS-Post-amount\n              move post-legend   to WS-IRS-Post-legend\n              move 31            to WS-IRS-vat-ac-def\n              move post-vat-side to WS-IRS-Post-vat-side\n              move vat-amount    to WS-IRS-vat-amount\n              perform  SPL-Posting-Write        *> write irs-posting-record\n     else\n              perform  GL-Posting-Write         *> write posting-record\n              add 1  to  rrn\n     end-if\n*>\n     if       items = 99\n              perform  bl-close\n              perform  bl-open",
        "line": 672
      },
      {
        "from": "rrn",
        "to": "postings",
        "line": 707
      },
      {
        "from": "ws-test-date",
        "to": "ws-date",
        "line": 733
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 735
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date",
        "line": 739
      },
      {
        "from": "\"dd/mm/ccyy\"",
        "to": "ws-date",
        "line": 746
      },
      {
        "from": "ws-date",
        "to": "u-date",
        "line": 752
      },
      {
        "from": "zero",
        "to": "u-bin",
        "line": 753
      },
      {
        "from": "spaces",
        "to": "ws-Date\n              go to zz060-Exit",
        "line": 770
      },
      {
        "from": "u-date",
        "to": "ws-date",
        "line": 772
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 775
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit",
        "line": 779
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 786
      },
      {
        "from": "to-day",
        "to": "ws-date",
        "line": 802
      },
      {
        "from": "1",
        "to": "Date-Form",
        "line": 805
      },
      {
        "from": "ws-days",
        "to": "ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit",
        "line": 809
      },
      {
        "from": "\"ccyy/mm/dd\"",
        "to": "ws-date",
        "line": 816
      }
    ],
    "computes": []
  },
  "businessLogic": {
    "conditions": [
      {
        "type": "IF",
        "condition": "it breaks, you own both pieces but I will endeavour\n*> to fix it, providing you tell me about the problem.\n*>\n*> You should have received a copy of the GNU General Public License along\n*> with ACAS; see the file COPYING.  If not, write to the Free Software\n*> Foundation, 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.\n*>\n*>*************************************************************************\n*>\n environment             division.\n*>===============================\n*>\n copy \"envdiv.cob\".\n input-output            section.\n*>------------------------------\n*>\n file-control.\n*>------------\n*>\n*> copy \"selpl.cob\".\n*> copy \"selpay.cob\".\n*> copy \"seloi5.cob\".\n*> copy \"selpost.cob\".\n*> copy \"selpost-irs.cob\".\n*> copy \"selval.cob\".\n*> copy \"selbatch.cob\".\n*>\n copy \"selprint.cob\".\n data                    division.\n*>===============================\n*>\n file section.\n*>-----------\n*>\n*> copy \"fdpl.cob\".\n*> copy \"fdpay.cob\".\n*> copy \"fdoi5.cob\".\n*> copy \"fdpost.cob\".\n*> copy \"fdpost-irs.cob\".\n*> copy \"fdval.cob\".\n*> copy \"fdbatch.cob\".\n*>\n copy \"fdprint.cob\".\n working-storage section.\n*>----------------------\n 77  prog-name           pic x(15) value \"PL950 (3.02.13)\".\n 77  exception-msg       pic x(25)    value spaces.\n copy \"print-spool-command-p.cob\".\n*>\n copy \"wsmaps03.cob\".\n copy \"wsfnctn.cob\".\n copy \"plwsoi.cob\".\n*>\n*> Ex FDs\n*>\n copy \"wspl.cob\".     *> WS-Purch-Record.\n copy \"plwsoi5B.cob\".  *> Open-Item-Record-5.\n copy \"plwspay.cob\".  *> Pay-Record.\n 01  WS-Pay-Record  redefines Pay-Record.\n     03  filler     pic x(238).\n copy \"wsbatch.cob\".   *> uses ws-batch-record.\n copy \"wspost.cob\".    *> uses ws-posting-record with rrn & post-key(10)\n copy \"wspost-irs.cob\". *> ues ws-irs-posting-record & WS-IRS- instead of IRS-\n copy \"wsval.cob\".\n*>\n*> REMARK OUT ANY IN USE\n*>\n 01  Dummies-4-Unused-ACAS-FH-Calls.      *> Call blk at zz080-ACAS-Calls\n     03  Default-Record         pic x.\n     03  Final-Record           pic x.\n     03  System-Record-4        pic x.\n     03  WS-Ledger-Record       pic x.\n*>     03  WS-Posting-Record      pic x.\n*>     03  WS-Batch-Record        pic x.\n*>     03  WS-IRS-Posting-Record  pic x.\n     03  WS-Stock-Audit-Record  pic x.\n     03  WS-Stock-Record        pic x.\n     03  WS-Sales-Record        pic x.\n*>     03  WS-Value-Record        pic x.\n     03  WS-Delivery-Record     pic x.\n     03  WS-Analysis-Record     pic x.\n     03  WS-Del-Inv-Nos-Record  pic x.\n*>     03  WS-Purch-Record        pic x.\n*>     03  WS-Pay-Record          pic x.\n     03  WS-Invoice-Record      pic x.\n     03  WS-OTM3-Record         pic x.\n     03  WS-PInvoice-Record     pic x.\n*>     03  WS-OTM5-Record         pic x.\n*>\n copy \"Test-Data-Flags.cob\".  *> set sw-testing to zero to stop logging.\n*>\n 01  ws-data.\n     03  pay-series      binary-short        value zero.\n     03  z               pic 99.\n     03  xx              pic 99.\n     03  first-time      pic 9               value zero.\n     03  work-1          pic s9(6)v99.\n     03  p               pic 99              value zero.\n     03  m               pic z(7)9.\n     03  b               binary-char           value zero.\n     03  c               binary-char           value zero.\n     03  aprop-amount    pic s9(7)v99        value zero.\n     03  t-deduct        pic s9(7)v99 comp-3 value zero.\n     03  deduct-taken    pic s9(7)v99 comp-3 value zero.\n     03  n-deduct        binary-long           value zero.\n     03  line-cnt        binary-char         value zero.\n     03  bal-t           pic 9(7)v99         value zero.\n     03  ws-reply        pic xxx             value space.\n     03  ws-account-details.\n         05 ws-sortcode  pic 9(6).\n         05 filler       pic x               value space.\n         05 ws-accountno pic 9(8).\n         05 filler       pic x               value space.\n*>\n 01  ws-Test-Date            pic x(10).\n 01  ws-date-formats.\n     03  ws-swap             pic xx.\n     03  ws-Conv-Date        pic x(10).\n     03  ws-date             pic x(10).\n     03  ws-UK redefines ws-date.\n         05  ws-days         pic xx.\n         05  filler          pic x.\n         05  ws-month        pic xx.\n         05  filler          pic x.\n         05  ws-year         pic x(4).\n     03  ws-USA redefines ws-date.\n         05  ws-usa-month    pic xx.\n         05  filler          pic x.\n         05  ws-usa-days     pic xx.\n         05  filler          pic x.\n         05  filler          pic x(4).\n     03  ws-Intl redefines ws-date.\n         05  ws-intl-year    pic x(4).\n         05  filler          pic x.\n         05  ws-intl-month   pic xx.\n         05  filler          pic x.\n         05  ws-intl-days    pic xx.\n*>\n 01  Error-Messages.\n*> System Wide\n     03  PL002          pic x(31) value \"PL002 Note error and hit return\".\n*> Module specific\n     03  PL132          pic x(32) value \"PL132 Err on Batch file write : \".\n     03  PL904          pic x(45) value \"PL904 PE 950-01 Logic: Hit return to continue\".\n     03  PL905          pic x(45) value \"PL905 PE 950-02 Logic: Hit return to continue\".\n*>\n 01  line-1.\n     03  l1-prog         pic x(33)       value spaces.\n     03  filler          pic x(39)       value \"B2B / Cheque Register\".\n     03  filler          pic x(5)        value \"Page \".\n     03  l3-page         pic zz9.\n*>\n 01  line-2.\n     03  l2-user         pic x(33)       value spaces.\n     03  filler          pic x(15)       value spaces.\n     03  filler          pic x(22)       value spaces.\n     03  l1-date         pic x(10).\n*>\n 01  line-3.\n     03  filler          pic x(16)       value \"Payment Date - \".\n     03  l3-date         pic x(10).\n*>\n 01  line-4.\n     03  filler          pic x(66)       value\n         \"Cheque Nos     <------------ Payee ------------->      <--Value-->\".\n*>\n 01  line-4-a.\n     03  filler          pic x(16)       value \" Sort  Account\".\n     03  filler          pic x(24)       value \"Account             Name\".\n*>\n 01  line-5.\n     03  l5-bacs-details.\n         05  l5-cheque   pic z(9)9.\n         05  l5-acf      pic x(6)        value spaces.\n     03  l5-account      pic x(9).\n     03  l5-supplier     pic x(30).\n     03  l5-value        pic z(7)9.99.\n*>\n 01  line-6.\n     03  filler          pic x(55)       value spaces.\n     03  filler          pic x(11)       value all \"=\".\n*>\n 01  line-7.\n     03  filler          pic x(25)       value spaces.\n     03  filler          pic x(30)       value \"    total\".\n     03  l7-value        pic z(7)9.99.\n*>\n linkage section.\n*>==============\n*>\n copy \"wscall.cob\".\n copy \"wssystem.cob\".\n copy \"wsnames.cob\".\n*>\n 01  to-day              pic x(10).\n*>\n procedure division using ws-calling-data\n                          system-record\n                          to-day\n                          file-defs.\n*>=======================================\n*>\n init01 section.\n disp-head.\n*>\n     perform  zz070-Convert-Date.\n     move     prog-name  to  l1-prog.\n     move     ws-date     to  l1-date.\n     move     usera       to  l2-user.\n     move     Print-Spool-Name to PSN.\n     move     1 to File-Key-No.  *> Good for all files/tables used here.\n*>\n     display  prog-name at 0101 with foreground-color 2 erase eos.\n     display  \"Payment Register\" at 0132 with foreground-color 2.\n     display  ws-date at 0171 with foreground-color 2.\n*>\n re-accpt.\n     display  \"Warning: Updating Open Item File. Do You Wish to Continue (YES/NO) [   ]\" at 1201\n                                        with foreground-color 2.\n     accept   ws-reply at 1269 with foreground-color 6.\n     move     function upper-case (ws-reply) to ws-reply.\n     if       ws-reply = \"NO\"\n              exit program.\n     if       ws-reply not = \"YES\"\n              go to re-accpt.\n*>\n     display  \" \" at 1201 with erase eol.\n     perform  Purch-Open-Input.  *> open input purchase-file pay-file.\n     perform  Payments-Open-Input.\n     open     output print-file.\n*>\n read-purchase.\n     perform  payments-Read-Next. *> read pay-file next record at end\n     if       fs-reply = 10\n              go to main-end.\n*>\n     if       first-time = zero\n              move  pay-date  to  u-bin\n              perform  zz060-Convert-Date\n              move  ws-date  to  l3-date\n              perform  headings\n              move  9  to  first-time.\n*>\n     move     pay-supl-key  to  WS-Purch-Key.\n     perform  Purch-Read-Indexed.  *> read purchase-file invalid key\n     if       fs-reply = 21 or = 23\n              move \"Record Missing\" to purch-name.\n*>\n     move     WS-Purch-Key  to  l5-account.\n     move     purch-name    to  l5-supplier.\n*>*     if       pay-cheque = zero\n*>*              go to  read-purchase.\n*>\n*> Dont want the above, but can it happen other than BACS?\n*>\n     if       pay-cheque not = zero\n              move pay-cheque to  l5-cheque\n              move spaces to l5-acf\n     else\n              move pay-sortcode to ws-sortcode\n              move pay-account  to ws-accountno\n              move ws-account-details to l5-bacs-details.\n*>\n     move     pay-gross  to  l5-value.\n     add      pay-gross  to  bal-t.\n*>\n     write    print-record  from  line-5 after 1.\n     add      1 to line-cnt.\n     if       line-cnt > Page-Lines\n              perform  headings.\n*>\n     go       to read-purchase.\n*>\n main-end.\n     move     bal-t  to  l7-value.\n     write    print-record  from  line-6 after 2.\n     write    print-record  from  line-7 after 1.\n     write    print-record  from  line-6 after 1.\n     close    print-file.                     *> pay-file.\n     perform  Payments-Close.\n*>\n*>  As reporting is finished, print it while\n*>        completing remaining processing\n*>\n     call     \"SYSTEM\" using Print-Report.\n     perform  Payments-Open-Input.   *>  open input pay-file.\n     perform  OTM5-Open.             *>  open i-o   open-item-file-5.\n     if       G-L\n              perform  BL-Open.  *> open right posting file\n*>\n     if       bl-next-batch = zero\n              move 1 to bl-next-batch.\n*>\n loop-outer.\n     perform  Payments-Read-Next.  *> read pay-file next record at end\n     if       fs-reply = 10\n              go to  end-run.\n*>\n     move     pay-supl-key to oi5-supplier WS-Purch-Key.\n     perform  Purch-Read-Indexed.  *> read purchase-file invalid key\n     if       fs-reply = 21 or = 23\n              move \"Record Missing\" to Purch-Name.\n*>\n     move     zero to aprop-amount.\n     add      1 to pay-series.\n     if       pay-series > 999\n              move 1 to pay-series\n              add 1 to bl-next-batch.\n*>\n     perform  loop-inner through loop-inner-end\n              varying z from 1 by 1 until z > 9.\n*>\n     multiply 1000 by bl-next-batch giving oi-invoice.\n     add      pay-series to oi-invoice.\n*>\n     move     zero to oi-carriage oi-c-vat oi-vat oi-discount\n                      oi-status oi-p-c oi-extra oi-e-vat oi-cr.\n     move     zero to oi-deduct-days oi-days oi-deduct-vat.\n     move     spaces to oi-order oi-hold-flag oi-applied.\n     move     pay-supl-key to oi-supplier.\n     move     bl-next-batch to oi-b-nos.\n     move     pay-series to oi-b-item.\n     move     pay-date   to oi-date oi-date-cleared.\n*>\n     move     oi-date  to  u-bin.\n     perform  zz060-Convert-Date.  *> u-date is now set in UK format but ws-date in local\n*>\n     move     pay-gross    to oi-paid.\n     move     aprop-amount to oi-approp.\n     move     deduct-taken to oi-deduct-amt.\n     if       oi-deduct-amt not = zero\n              add 1 to n-deduct.\n     move     pay-cheque   to oi-ref.\n     move     5            to oi-type.\n     move     OI-Header to WS-OTM5-Record.\n     perform  OTM5-Write.                *> write    open-item-record-5 from oi-header.\n*>\n     if       G-L\n              perform  BL-Write.\n     add      deduct-taken to t-deduct.\n     move     zero to deduct-taken aprop-amount.\n     go       to loop-outer.\n*>\n loop-inner.\n*>*********\n*>\n     if       pay-value (z) = zero\n              go to  loop-inner-end.\n*>\n oi-read.\n*>******\n*>\n     move     pay-folio (z) to oi5-invoice.\n     perform  OTM5-Read-Indexed.  *> read open-item-file-5 invalid key\n     if       fs-reply = 21 or = 23\n              go to loop-inner-end.\n*>\n     move     open-item-record-5  to  oi-header.\n*>\n*>   SHOULD only have type 2 and matching keys\n*>      otherwise a progam bug elsewhere\n*>\n     if       oi-type not = 2\n              display PL904   at 2401  with foreground-color 4\n              accept ws-reply at 2447\n              go to loop-inner-end.\n     if       oi-supplier not = pay-supl-key\n       or     oi-invoice not = pay-folio (z)\n              display PL905   at 2401  with foreground-color 4\n              accept ws-reply at 2447\n              go to  loop-inner-end.\n*>\n     add      pay-value (z)  to  oi-paid.\n     add      oi-net oi-carriage oi-vat oi-c-vat giving  work-1.\n     subtract pay-deduct (z) from work-1.\n     if       oi-paid  =  work-1\n              move  1  to  oi-status\n              subtract pay-deduct (z) from oi-net\n              add  pay-deduct (z) to deduct-taken\n              move zero to oi-deduct-amt\n              move bl-next-batch to oi-b-nos\n              move pay-series to oi-b-item\n              move pay-date to oi-date-cleared.\n*>\n     move     OI-Header to WS-OTM5-Record.\n     perform  OTM5-Rewrite.  *> rewrite open-item-record-5 from oi-header.\n     add      pay-value (z)  to  aprop-amount.\n     add      pay-value (z)  to  oi-p-c.\n     multiply 100 by pay-value (z) giving oi-cr.\n*>\n loop-inner-end.\n     exit.\n*>\n end-run.\n*>******\n*>\n     add      1 to bl-next-batch.\n     perform  Purch-Close.  *> close open-item-file-5 pay-file purchase-file.\n     perform  OTM5-Close.\n     perform  Payments-Close.\n     perform  Payments-Open-Output.  *> open output  pay-file.\n     perform  Payments-Close.        *> close pay-file.\n     if       t-deduct not = zero\n              perform Value-Open     *> open i-o value-file\n              perform analise-deductions\n              perform Value-Close.   *> close value-file.\n*>\n     if       G-L\n              perform  BL-Close.\n*>\n     exit     program.\n*>\n headings     section.\n*>===================\n*>\n     add      1  to  p.\n     move     p  to  l3-page.\n*>\n     if       p not = 1\n              write print-record from line-1 after page\n              write print-record from line-2 after 1\n              move  spaces to print-record\n              write print-record after 1\n     else\n              write print-record from line-1 before 1\n              write print-record from line-2 before 1\n     end-if\n     write    print-record from line-3 after 1.\n     write    print-record from line-4 after 2.\n     write    print-record from line-4-a after 1.\n     move     spaces to print-record.\n     write    print-record after 1.\n     move     8 to line-cnt.\n*>\n main-exit.   exit section.\n*>\n analise-deductions   section.\n*>===========================\n*>\n     move     \"Pzb\" to va-code.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read value-file  invalid key\n     if       FS-Reply = 21 or = 23\n              go to main-exit.\n*>\n     subtract n-deduct from va-t-this.\n     subtract n-deduct from va-t-year.\n     subtract t-deduct from va-v-this.\n     subtract t-deduct from va-v-year.\n*>\n     move     1 to File-Key-No.\n     perform  Value-Rewrite.       *> rewrite  value-record.\n*>\n     move     space  to  va-second.\n     move     1 to File-Key-No.\n     perform  Value-Read-Indexed.  *> read value-file  invalid key\n     if       FS-Reply = 21 or = 23\n              go to main-exit.\n*>\n     subtract n-deduct from va-t-this.\n     subtract n-deduct from va-t-year.\n     subtract t-deduct from va-v-this.\n     subtract t-deduct from va-v-year.\n     perform  Value-Rewrite.      *> rewrite value-record.\n*>\n main-exit.   exit section.\n*>\n bl-open      section.\n*>===================\n*>\n     perform  GL-Batch-Open.                *> open i-o  batch-file.\n     if       fs-reply not = zero\n              perform GL-Batch-Close        *> close batch-file\n              perform GL-Batch-Open-Output. *> open output batch-file.\n*>\n     move     bl-next-batch  to  WS-Batch-Nos.\n     move     2  to  WS-Ledger.\n     add      1  to  bl-next-batch.\n*>\n     move     zero  to  batch-status\n                        cleared-status.\n     move     scycle   *> of system-record\n              to  bcycle. *> of batch-record.\n     move     run-date  to  entered.\n*>\n     move     \"Purchase Ledger Payments\"  to  description.\n     move     zero  to  bdefault\n                        batch-def-ac\n                        batch-def-pc\n                        items\n                        input-gross  input-vat\n                        actual-gross actual-vat.\n*>\n     move     \"DR\"  to  convention.\n     move     \"PL\"  to  batch-def-code.\n     move     \"I\"   to  batch-def-vat.\n     add      postings  1  giving  batch-start.\n*>\n     if       irs-used\n              perform SPL-Posting-Open-Extend      *> open extend irs-post-file     *> needed: -  bug in OC\n              if fs-reply not = zero\n                 perform SPL-Posting-Close         *> close irs-post-file\n                 perform SPL-Posting-Open-Output  *> open output irs-post-file\n              end-if\n     else\n              perform  GL-Posting-Open             *> open i-o posting-file\n              if  fs-reply not = zero\n                  perform GL-Posting-Close         *>  close posting-file\n                  perform GL-Posting-Open-Output   *>  open output posting-file.\n     move     batch-start  to  rrn.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-write     section.\n*>===================\n*>\n*><<<<<<<<<<<<<<<<<<<<<<<<<<< READ THIS >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n*>**********************************************************************\n*>  This will write a posting record to IRS or GL for EACH line item   *\n*>   in EACH invoice                                                   *\n*> so, to use it, you MUST have set up the GL account number for EVERY *\n*>  analysis code via pl070. It also assumes that you have followed    *\n*>  the convention in IRS & GL that default a/c 31 points to VAT input *\n*>  and default a/c 32 is VAT output tax.                              *\n*>**********************************************************************\n*>  u-date is in uk format\n*>\n     move     u-date (1:6) to post-date (1:6). *> using UK format\n     move     u-date (9:2) to post-date (7:2).\n     add      1       to items.\n     move     items   to post-number.\n     move     oi-paid to post-amount.\n*>\n*> using folio/invoice no + ' : ' supplier name instead of batch/item\n*>  on posting file for both IRS & GL.\n*>\n     move     WS-Batch-Nos  to  batch.\n     move     oi-invoice to m.\n     move     zero to b.\n     inspect  m tallying b for leading space.\n     subtract b from 8 giving c.\n     add      1 to b.\n     move     1  to  xx.\n*>\n     string   m (b:c)     delimited by size\n              \" : \"       delimited by size\n              purch-name  delimited by size into post-legend pointer  xx.\n*>\n     move     p-creditors  to  post-dr.\n     move     bl-pay-ac    to  post-cr.\n*>\n     move     zero  to  dr-pc\n                        cr-pc\n                        vat-ac of WS-Posting-Record\n                        vat-pc\n                        vat-amount.\n*>\n     move     spaces  to  post-vat-side.\n*>\n     add      post-amount  to  input-gross.\n     add      post-amount  to  actual-gross.\n*>\n     move     \"PL\" to post-code  in WS-Posting-Record.\n     move     \"DR\" to post-vat-side.\n*>\n     if       irs-used\n              move WS-post-key      to WS-IRS-Post-key\n              move post-code in WS-Posting-Record    to WS-IRS-Post-code\n              move post-date     to WS-IRS-Post-date\n              move post-dr       to WS-IRS-Post-dr\n              move post-cr       to WS-IRS-Post-cr\n              move post-amount   to WS-IRS-Post-amount\n              move post-legend   to WS-IRS-Post-legend\n              move 31            to WS-IRS-vat-ac-def\n              move post-vat-side to WS-IRS-Post-vat-side\n              move vat-amount    to WS-IRS-vat-amount\n              perform  SPL-Posting-Write        *> write irs-posting-record\n     else\n              perform  GL-Posting-Write         *> write posting-record\n              add 1  to  rrn\n     end-if\n*>\n     if       items = 99\n              perform  bl-close\n              perform  bl-open.\n*>\n main-exit.   exit section.\n*>********    ****\n*>\n bl-close     section.\n*>===================\n*>\n     perform  GL-Batch-Write.          *> write batch-record.\n     if       fs-reply not = zero\n              display PL132    at 2301\n              perform Eval-Status\n              display fs-reply at 2333\n              display exception-msg at 2336\n              display PL002                       at 2401 with foreground-color 2\n              accept ws-reply at 2430.\n     if       not irs-used\n              move rrn  to  postings.\n     perform  GL-Batch-Close.            *> close batch-file.\n     if       not irs-used\n              perform GL-Posting-Close   *> close posting-file\n     else\n              perform SPL-Posting-Close.  *> close irs-post-file.\n*>\n  main-exit.   exit section.\n*>\n Eval-Status        section.\n*>=========================\n*>\n copy \"FileStat-Msgs.cpy\"  replacing STATUS by fs-reply\n                                     msg    by exception-msg.\n*>\n main-exit.   exit section.\n*>\n zz050-Validate-Date        section.\n*>*********************************\n*>\n*>  Converts USA/Intl to UK date format for processing.\n*>*******************************\n*> Input:   ws-test-date\n*> output:  u-date/ws-date as uk date format\n*>          u-bin not zero if valid date\n*>\n     move     ws-test-date to ws-date.\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz050-test-date.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz050-test-date.\n*>\n*> So its International date format\n*>\n     move     \"dd/mm/ccyy\" to ws-date.  *> swap Intl to UK form\n     move     ws-test-date (1:4) to ws-Year.\n     move     ws-test-date (6:2) to ws-Month.\n     move     ws-test-date (9:2) to ws-Days.\n*>\n zz050-test-date.\n     move     ws-date to u-date.\n     move     zero to u-bin.\n     perform  maps04.\n*>\n zz050-exit.\n     exit     section.\n*>\n zz060-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in binary to UK/USA/Intl date format\n*>****************************************************\n*> Input:   u-bin\n*> output:  ws-date as uk/US/Inlt date format\n*>          u-date & ws-Date = spaces if invalid date\n*>\n     perform  maps04.\n     if       u-date = spaces\n              move spaces to ws-Date\n              go to zz060-Exit.\n     move     u-date to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz060-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz060-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     u-date (7:4) to ws-Intl-Year.\n     move     u-date (4:2) to ws-Intl-Month.\n     move     u-date (1:2) to ws-Intl-Days.\n*>\n zz060-Exit.\n     exit     section.\n*>\n zz070-Convert-Date        section.\n*>********************************\n*>\n*>  Converts date in to-day to UK/USA/Intl date format\n*>****************************************************\n*> Input:   to-day\n*> output:  ws-date as uk/US/Inlt date format\n*>\n     move     to-day to ws-date.\n*>\n     if       Date-Form = zero\n              move 1 to Date-Form.\n     if       Date-UK\n              go to zz070-Exit.\n     if       Date-USA                *> swap month and days\n              move ws-days to ws-swap\n              move ws-month to ws-days\n              move ws-swap to ws-month\n              go to zz070-Exit.\n*>\n*> So its International date format\n*>\n     move     \"ccyy/mm/dd\" to ws-date.  *> swap Intl to UK form\n     move     to-day (7:4) to ws-Intl-Year.\n     move     to-day (4:2) to ws-Intl-Month.\n     move     to-day (1:2) to ws-Intl-Days.\n*>\n zz070-Exit.\n     exit     section.\n*>\n maps04       section.\n*>*******************\n*>\n     call     \"maps04\"  using  maps03-ws.\n*>\n maps04-exit.\n     exit     section.\n*>\n copy \"Proc-ACAS-FH-Calls.cob\".\n*>",
        "line": 105
      }
    ],
    "evaluates": [],
    "validations": []
  },
  "complexity": {
    "mccabe": 4,
    "cognitive": 1,
    "halstead": {
      "uniqueOperators": 1,
      "uniqueOperands": 106,
      "totalOperators": 81,
      "totalOperands": 162,
      "vocabulary": 107,
      "length": 243,
      "volume": 1638.1764776954788
    }
  },
  "quality": {
    "gotos": [],
    "deadCode": [],
    "missingErrorHandlers": []
  },
  "sql": {
    "hasSQL": false,
    "statements": []
  },
  "cics": {
    "hasCICS": false,
    "statements": []
  }
}
